<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>crossoverJie&#39;s Blog</title>
  
  <subtitle>baller</subtitle>
  <link href="http://crossoverjie.top/atom.xml" rel="self"/>
  
  <link href="http://crossoverjie.top/"/>
  <updated>2024-04-07T15:27:53.792Z</updated>
  <id>http://crossoverjie.top/</id>
  
  <author>
    <name>crossoverJie</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å®æˆ˜ï¼šå¦‚ä½•ä¼˜é›…çš„ä» Skywalking åˆ‡æ¢åˆ° OpenTelemetry</title>
    <link href="http://crossoverjie.top/2024/04/07/ob/otel-replace-sw/"/>
    <id>http://crossoverjie.top/2024/04/07/ob/otel-replace-sw/</id>
    <published>2024-04-07T09:16:21.000Z</published>
    <updated>2024-04-07T15:27:53.792Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2024/03/04/8YFIh7suTirZacj.png"></p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘å…¬å¸å°†æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„é“¾è·¯å·¥å…·åˆ‡æ¢ä¸ºäº† <code>OpenTelemetry</code>.</p><p><img src="https://s2.loli.net/2024/03/03/9V1aUnpOd8EAG2Y.png"></p><span id="more"></span><p>æˆ‘ä»¬çš„æŠ€æœ¯æ ˆæ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        OTLP                               </span><br><span class="line">Clientâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºCollectâ”€â”€â”€â”€â”€â”€â”€â”€â–ºStartRocks</span><br><span class="line">(Agent)                               â–²    </span><br><span class="line">                                      â”‚    </span><br><span class="line">                                      â”‚    </span><br><span class="line">                                   Jaeger                                       </span><br></pre></td></tr></table></figure><p>å…¶ä¸­å®¢æˆ·ç«¯ä½¿ç”¨ OpenTelemetry æä¾›çš„ Java Agent è¿›è¡ŒåŸ‹ç‚¹æ”¶é›†æ•°æ®ï¼Œå†ç”± Agent é€šè¿‡ OTLP(OpenTelemetry Protocol) åè®®å°†æ•°æ®å‘å¾€ Collectorï¼Œåœ¨ <code>Collector</code> ä¸­æˆ‘ä»¬å¯ä»¥è‡ªè¡Œä»»æ„å¤„ç†æ•°æ®ï¼Œå¹¶å†³å®šå°†è¿™äº›æ•°æ®å¦‚ä½•å­˜å‚¨ï¼ˆè¿™ç‚¹åœ¨ä»¥å¾€çš„ SkyWalking ä½“ç³»ä¸­æ˜¯å¾ˆéš¾è‡ªå®šä¹‰çš„ï¼‰</p><p>è¿™é‡Œæˆ‘ä»¬å°†æ•°æ®å†™å…¥ StartRocks ä¸­ï¼Œä¾›ä¹‹åçš„ UI å±‚è¿›è¡ŒæŸ¥çœ‹ã€‚</p><blockquote><p><code>OpenTelemetry</code> æ˜¯å¯è§‚æµ‹ç³»ç»Ÿçš„æ–°æ ‡å‡†ï¼ŒåŸºäºå®ƒå¯ä»¥å…¼å®¹ä»¥å‰ä½¿ç”¨çš„ Prometheusã€ victoriametricsã€skywalking ç­‰ç³»ç»Ÿï¼ŒåŒæ—¶è¿˜å¯ä»¥çµæ´»æ‰©å±•ï¼Œä¸ç”¨ä¸ä»»ä½•ä½†ä¸€ç”Ÿæ€æˆ–æŠ€æœ¯æ ˆè¿›è¡Œç»‘å®šã€‚<br>æ›´å¤šå…³äº OTel çš„å†…å®¹ä¼šåœ¨ä»Šåä»‹ç»ã€‚</p></blockquote><h2 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h2><p>å…¶ä¸­æœ‰ä¸€ä¸ªå…³é”®é—®é¢˜å°±æ˜¯ï¼šå¦‚ä½•åœ¨çº¿ä¸Šè¿›è¡Œ<strong>æ— ç¼åˆ‡æ¢</strong>ã€‚</p><p>è™½ç„¶æˆ‘ä»¬å†…éƒ¨çš„å‘å¸ƒç³»ç»Ÿå·²ç»æ”¯æŒé‡æ–°å‘å¸ƒåå°±ä¼šåˆ‡æ¢åˆ°æ–°çš„é“¾è·¯ï¼Œä¹Ÿå¯ä»¥è®©ä¸šåŠ¡è‡ªè¡Œå‘å¸ƒç„¶åé€æ­¥çš„åˆ‡æ¢åˆ°æ–°çš„ç³»ç»Ÿï¼Œè¿™æ ·ä¹Ÿæ˜¯æœ€ä¿é™©çš„æ–¹å¼ã€‚</p><p>ä½†è¿™æ ·ä¼šæœ‰å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>å½“å­˜åœ¨è°ƒç”¨ä¾èµ–çš„ç³»ç»Ÿæ²¡æœ‰å…¨éƒ¨åˆ‡æ¢ä¸ºæ–°é“¾è·¯æ—¶ï¼Œå†æŸ¥è¯¢çš„æ—¶å€™å°±ä¼šå‡ºç°æ–­å±‚ï¼Œæ•´ä¸ªé“¾è·¯æ— æ³•å…¨éƒ¨ä¸²è”èµ·æ¥ã€‚</li><li>ä¸šåŠ¡å›¢é˜Ÿæ²¡æœ‰è¶³å¤Ÿçš„åŠ¨åŠ›å»æ¨åŠ¨å‘å¸ƒï¼Œå¯èƒ½åˆ‡æ¢çš„å‘¨æœŸè¾ƒé•¿ã€‚</li></ul><p>æ‰€ä»¥æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯ç”±æˆ‘ä»¬åœ¨åå°ç»Ÿä¸€å‘å¸ƒï¼Œå¯¹å¤–æ²¡æœ‰ä»»ä½•æ„ŸçŸ¥å°±å¯ä»¥ä¸€é”®å…¨éƒ¨åˆ‡æ¢ä¸º OpenTelemetryã€‚</p><p>ä»”ç»†ä¸€çœ‹è²Œä¼¼ä¹Ÿæ²¡ä»€ä¹ˆéš¾çš„ï¼Œæ— éå°±æ˜¯æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»å‘å¸ƒæŒ‰é’®è€Œå·²ã€‚</p><p>ä½†è¿™äº‹ç”±æˆ‘ä»¬è‡ªåŠ¨æ¥åšå°±ä¸ä¸€æ ·äº†ï¼Œç”¨æˆ·ç‚¹å‡»å‘å¸ƒçš„æ—¶å€™ä¼šé€‰æ‹©ä»–ä»¬è®¤ä¸ºå¯ä»¥å‘å¸ƒçš„åˆ†æ”¯è¿›è¡Œå‘å¸ƒï¼Œæˆ‘ä»¬ä¸èƒ½è‡ªä½œä¸»å¼ çš„æ¯”å¦‚é€‰æ‹© main åˆ†æ”¯ï¼Œæœ‰å¯èƒ½åªæ˜¯åˆå¹¶äº†ä½†è¿˜ä¸å…·å¤‡å‘å¸ƒæ¡ä»¶ã€‚</p><p>æ‰€ä»¥ä¿é™©çš„æ–¹å¼è¿˜æ˜¯å¾—ç”¨å½“å‰é¡¹ç›®ä¸Šä¸€æ¬¡å‘å¸ƒæ—¶æ‰€ä½¿ç”¨çš„ git hash å€¼é‡æ–°æ‰“åŒ…å‘å¸ƒã€‚</p><p>ä½†è¿™ä¹Ÿæœ‰å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>é‡å¤æ‰“åŒ…å‘å¸ƒå¤ªæ…¢äº†ï¼Œçº¿ä¸Šå‡ åä¸Šç™¾ä¸ªé¡¹ç›®ï¼Œæ¯æ‰“åŒ…å‘å¸ƒä¸€æ¬¡å°±å¾—å‡ åˆ†é’Ÿï¼Œè™½ç„¶å¯ä»¥å¹¶å‘ï¼Œä½†è€ƒè™‘åˆ° kubernetes çš„å‹åŠ›ä¹Ÿä¸èƒ½è°ƒçš„å¤ªé«˜ã€‚</li><li>ä¿ä¸å‡†ä¸šåŠ¡é•œåƒä¸­æœ‰å•ç‹¬åŠ å…¥ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·æ‰“åŒ…å¯èƒ½ä¼šæ¼ã€‚</li></ul><h1 id="åˆ‡æ¢æ–¹æ¡ˆ"><a href="#åˆ‡æ¢æ–¹æ¡ˆ" class="headerlink" title="åˆ‡æ¢æ–¹æ¡ˆ"></a>åˆ‡æ¢æ–¹æ¡ˆ</h1><p>æ‰€ä»¥æ€æ¥æƒ³å»æœ€ä¿é™©çš„æ–¹æ³•è¿˜æ˜¯å°†ä¸šåŠ¡é•œåƒæ‹‰å–ä¸‹æ¥ï¼Œç„¶åæ‰‹åŠ¨åˆ é™¤é•œåƒä¸­çš„ skywalking åŒ…ä»¥åŠ JVM å‚æ•°ï¼Œå…¨éƒ¨æ›¿æ¢ä¸º OpenTelemetry çš„åŒ…å’Œ JVM å‚æ•°ã€‚</p><p>æ•´ä½“çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ol><li>éå† namespace çš„ <code>pod ï¼0</code> çš„ deployment</li><li>éå† deployment ä¸­çš„æ‰€æœ‰ containerï¼Œè·å¾—ä¸šåŠ¡é•œåƒ<ol><li>è·³è¿‡ istio å’Œæ—¥å¿—é‡‡é›† containerï¼Œè·å–åˆ°ä¸šåŠ¡å®¹å™¨</li><li>åˆ¤æ–­è¯¥å®¹å™¨æ˜¯å¦éœ€è¦æ›¿æ¢ï¼Œå…¶å®å°±æ˜¯åˆ¤æ–­ç¯å¢ƒå˜é‡ä¸­æ˜¯å¦æœ‰ skywalking ï¼Œå¦‚æœæœ‰å°±éœ€è¦æ›¿æ¢ã€‚</li><li>è·å–ä¸šåŠ¡å®¹å™¨çš„é•œåƒ</li></ol></li><li>åŸºäºè¯¥ Image é‡æ–°æ„å»ºä¸€ä¸ª OpenTelemetry çš„é•œåƒ<br>   3.1 æ–°çš„é•œåƒåŒ…å«æ–°çš„å¯åŠ¨è„šæœ¬.<br>   3.1.1 æ–°çš„å¯åŠ¨è„šæœ¬ä¸­ä¼šåˆ é™¤åŸæœ‰çš„ skywalking agent<br>   3.2 æ–°é•œåƒä¼šåŒ…å« OpenTelemetry çš„ jar åŒ…ä»¥åŠæˆ‘ä»¬è‡ªå®šä¹‰çš„ OTel æ‰©å±•åŒ…<br>   3.3 æ›¿æ¢å¯åŠ¨å‘½ä»¤ä¸ºæ–°çš„å¯åŠ¨è„šæœ¬</li><li>ä¿®æ”¹ deployment ä¸­çš„ JVM å¯åŠ¨å‚æ•°</li><li>ä¿®æ”¹ deployment çš„é•œåƒåæ»šåŠ¨æ›´æ–°</li><li>å¼€å¯ä¸€ä¸ª goroutine å®šæ—¶æ£€æµ‹æ›´æ–°ä¹‹åæ˜¯å¦å¯åŠ¨æˆåŠŸ<ol><li>å¦‚æœé•¿æ—¶é—´ (æ¯”å¦‚äº”åˆ†é’Ÿ) éƒ½æ²¡æœ‰å¯åŠ¨æˆåŠŸï¼Œåˆ™æ‰§è¡Œå›æ»šæµç¨‹</li></ol></li></ol><h1 id="å…·ä½“ä»£ç "><a href="#å…·ä½“ä»£ç " class="headerlink" title="å…·ä½“ä»£ç "></a>å…·ä½“ä»£ç </h1><p>å› ä¸ºéœ€è¦æ¶‰åŠåˆ°æ“ä½œ kubernetesï¼Œæ‰€ä»¥æ•´ä½“å°±ä½¿ç”¨ Golang å®ç°äº†ã€‚</p><h2 id="éå†-deployment-å¾—åˆ°éœ€è¦æ›¿æ¢çš„å®¹å™¨é•œåƒ"><a href="#éå†-deployment-å¾—åˆ°éœ€è¦æ›¿æ¢çš„å®¹å™¨é•œåƒ" class="headerlink" title="éå† deployment å¾—åˆ°éœ€è¦æ›¿æ¢çš„å®¹å™¨é•œåƒ"></a>éå† deployment å¾—åˆ°éœ€è¦æ›¿æ¢çš„å®¹å™¨é•œåƒ</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ProcessDeployment</span><span class="params">(ctx context.Context, finish []<span class="type">string</span>, deployment v1.Deployment, clientSet kubernetes.Interface)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">deploymentName := deployment.Name</span><br><span class="line"><span class="keyword">for</span> _, s := <span class="keyword">range</span> finish &#123;</span><br><span class="line"><span class="keyword">if</span> s == deploymentName &#123;</span><br><span class="line">klog.Infof(<span class="string">&quot;Skip finish deployment:%s&quot;</span>, deploymentName)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Write finish deployment name to a file</span></span><br><span class="line"><span class="keyword">defer</span> writeDeploymentName2File(deploymentName, fmt.Sprintf(<span class="string">&quot;finish-%s.log&quot;</span>, deployment.Namespace))</span><br><span class="line"></span><br><span class="line">appName := deployment.GetObjectMeta().GetLabels()[<span class="string">&quot;appName&quot;</span>]</span><br><span class="line">klog.Infof(<span class="string">&quot;Begin to process deployment:%s, appName:%s&quot;</span>, deploymentName, appName)</span><br><span class="line"></span><br><span class="line">upgrade, err := checkContainIstio(ctx, deployment, clientSet)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> upgrade == <span class="literal">false</span> &#123;</span><br><span class="line">klog.Infof(<span class="string">&quot;Don&#x27;t have istio, No need to upgrade deployment:%s appName:%s&quot;</span>, deploymentName, appName)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, container := <span class="keyword">range</span> deployment.Spec.Template.Spec.Containers &#123;</span><br><span class="line"><span class="keyword">if</span> strings.HasPrefix(deploymentName, container.Name) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if container has sw jvm</span></span><br><span class="line"><span class="keyword">for</span> _, envVar := <span class="keyword">range</span> container.Env &#123;</span><br><span class="line"><span class="keyword">if</span> envVar.Name == <span class="string">&quot;CATALINA_OPTS&quot;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !strings.Contains(envVar.Value, <span class="string">&quot;skywalking&quot;</span>) &#123;</span><br><span class="line">klog.Infof(<span class="string">&quot;Skip upgrade don&#x27;t have sw jvm deployment:%s container:%s&quot;</span>, deploymentName, container.Name)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">upgrade(container)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check newDeployment status</span></span><br><span class="line"><span class="keyword">go</span> checkNewDeploymentStatus(ctx, clientSet, newDeployment)</span><br><span class="line"></span><br><span class="line"><span class="comment">// delete from image</span></span><br><span class="line">deleteImage(container.Image)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ª deployment ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå·²ç»å®Œæˆäº†çš„åˆ—è¡¨è¿›æ¥ã€‚</p><blockquote><p>å·²å®Œæˆåˆ—è¡¨ç”¨äºå¤šæ¬¡è¿è¡Œçš„æ—¶å€™å¯ä»¥å¿«é€Ÿè·³è¿‡å·²ç»æ‰§è¡Œçš„ deploymentã€‚</p></blockquote><p><code>checkContainIstio()</code> å‡½æ•°å¾ˆç®€å•ï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«äº† Istio å®¹å™¨ï¼Œå¦‚æœæ²¡æœ‰åŒ…å«è¯´æ˜ä¸æ˜¯åç«¯åº”ç”¨ï¼ˆå¯èƒ½æ˜¯å‰ç«¯ã€å¤§æ•°æ®ä¹‹ç±»çš„ä»»åŠ¡ï¼‰ï¼Œå°±å¯ä»¥ç›´æ¥è·³è¿‡äº†ã€‚</p><hr><p><img src="https://s2.loli.net/2024/03/03/xzHPV9mgCJkZ4cY.png"><br>è€Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ›¿æ¢çš„å‰æè¿™äº‹åˆ¤æ–­ç¯å¢ƒå˜é‡ <code>CATALINA_OPTS</code> ä¸­æ˜¯å¦åŒ…å«äº† skywalking çš„å†…å®¹ï¼Œå¦‚æœåŒ…å«åˆ™è¯´æ˜éœ€è¦è¿›è¡Œæ›¿æ¢ã€‚</p><h2 id="Upgrade-æ ¸å¿ƒå‡½æ•°"><a href="#Upgrade-æ ¸å¿ƒå‡½æ•°" class="headerlink" title="Upgrade æ ¸å¿ƒå‡½æ•°"></a>Upgrade æ ¸å¿ƒå‡½æ•°</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">upgrade</span><span class="params">(container Container)</span></span>&#123;</span><br><span class="line">klog.Infof(<span class="string">&quot;Begin to upgrade deployment:%s container:%s&quot;</span>, deploymentName, container.Name)</span><br><span class="line">newImageName := fmt.Sprintf(<span class="string">&quot;%s-otel-%s&quot;</span>, container.Image, generateRandomString(<span class="number">4</span>))</span><br><span class="line">err := BuildNewOtelImage(container.Image, newImageName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update deployment jvm ENV</span></span><br><span class="line"><span class="keyword">for</span> e, envVar := <span class="keyword">range</span> container.Env &#123;</span><br><span class="line"><span class="keyword">if</span> envVar.Name == <span class="string">&quot;CATALINA_OPTS&quot;</span> &#123;</span><br><span class="line">otelJVM := replaceSWAgent2OTel(envVar.Value, appName)</span><br><span class="line">deployment.Spec.Template.Spec.Containers[i].Env[e].Value = otelJVM</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Update deployment image</span></span><br><span class="line">deployment.Spec.Template.Spec.Containers[i].Image = newImageName</span><br><span class="line"></span><br><span class="line">newDeployment, err := clientSet.AppsV1().Deployments(deployment.Namespace).Update(ctx, &amp;deployment, metav1.UpdateOptions&#123;&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">klog.Infof(<span class="string">&quot;Finish upgrade deployment:%s container:%s&quot;</span>, deploymentName, container.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸€å…±åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨ï¼š</p><ul><li>åŸºäºè€é•œåƒæ„å»ºæ–°é•œåƒ</li><li>æ›´æ–°åŸæœ‰çš„ <code>CATALINA_OPTS</code> ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå°±æ˜¯æ›¿æ¢ skywalking çš„å‚æ•°</li><li>æ›´æ–° deployment é•œåƒï¼Œè§¦å‘æ»šåŠ¨æ›´æ–°</li></ul><h2 id="æ„å»ºæ–°é•œåƒ"><a href="#æ„å»ºæ–°é•œåƒ" class="headerlink" title="æ„å»ºæ–°é•œåƒ"></a>æ„å»ºæ–°é•œåƒ</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">dockerfile = fmt.Sprintf(<span class="string">`FROM %s</span></span><br><span class="line"><span class="string">COPY %s /home/admin/%s</span></span><br><span class="line"><span class="string">COPY otel.tar.gz /home/admin/otel.tar.gz</span></span><br><span class="line"><span class="string">RUN tar -zxvf /home/admin/otel.tar.gz -C /home/admin</span></span><br><span class="line"><span class="string">RUN rm -rf /home/admin/skywalking-agent</span></span><br><span class="line"><span class="string">ENTRYPOINT [&quot;/bin/sh&quot;, &quot;/home/admin/start.sh&quot;]</span></span><br><span class="line"><span class="string">`</span>, fromImage, script, script)</span><br><span class="line"></span><br><span class="line">idx := strings.LastIndex(newImageName, <span class="string">&quot;/&quot;</span>) + <span class="number">1</span></span><br><span class="line">dockerFileName := newImageName[idx:]</span><br><span class="line">create, err := os.Create(fmt.Sprintf(<span class="string">&quot;Dockerfile-%s&quot;</span>, dockerFileName))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">create.Close()</span><br><span class="line">os.Remove(create.Name())</span><br><span class="line">&#125;()</span><br><span class="line">_, err = create.WriteString(dockerfile)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cmd := exec.Command(<span class="string">&quot;docker&quot;</span>, <span class="string">&quot;build&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;-f&quot;</span>, create.Name(), <span class="string">&quot;-t&quot;</span>, newImageName)</span><br><span class="line">cmd.Stdin = strings.NewReader(dockerfile)</span><br><span class="line"><span class="keyword">if</span> err := cmd.Run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™é‡Œçš„é‡ç‚¹å°±æ˜¯æ„å»ºè¿™ä¸ªæ–°é•œåƒï¼Œä»è¿™ä¸ª dockerfile ä¸­ä¹Ÿèƒ½çœ‹å‡ºå…·ä½“çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„åˆ é™¤åŸæœ‰çš„ skywalking èµ„æºåŒæ—¶å°†æ–°çš„ OpenTelemetry èµ„æºæ‰“åŒ…è¿›å»ã€‚</p><p>æœ€åå†å°†è¿™ä¸ªé•œåƒä¸Šä¼ åˆ°ç§æœã€‚</p><p><img src="https://s2.loli.net/2024/03/03/s7fryhQSPJgcuvj.png"><br>å…¶ä¸­çš„æ›¿æ¢ JVM å‚æ•°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥åˆ é™¤ skywalking çš„å†…å®¹ï¼Œç„¶åå†è¿½åŠ ä¸Š OpenTelemetry éœ€è¦çš„å‚æ•°å³å¯ã€‚</p><h2 id="å®šæ—¶æ£€æµ‹æ›¿æ¢æ˜¯å¦æˆåŠŸ"><a href="#å®šæ—¶æ£€æµ‹æ›¿æ¢æ˜¯å¦æˆåŠŸ" class="headerlink" title="å®šæ—¶æ£€æµ‹æ›¿æ¢æ˜¯å¦æˆåŠŸ"></a>å®šæ—¶æ£€æµ‹æ›¿æ¢æ˜¯å¦æˆåŠŸ</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkNewDeploymentStatus</span><span class="params">(ctx context.Context, clientSet kubernetes.Interface, newDeployment *v1.Deployment)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">ready := <span class="literal">true</span></span><br><span class="line">tick := time.Tick(<span class="number">10</span> * time.Second)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">30</span>; i++ &#123;</span><br><span class="line">&lt;-tick</span><br><span class="line">originPodList, err := clientSet.CoreV1().Pods(newDeployment.Namespace).List(ctx, metav1.ListOptions&#123;</span><br><span class="line">LabelSelector: metav1.FormatLabelSelector(&amp;metav1.LabelSelector&#123;</span><br><span class="line">MatchLabels: newDeployment.Spec.Selector.MatchLabels,</span><br><span class="line">&#125;),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if there are any Pods</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(originPodList.Items) == <span class="number">0</span> &#123;</span><br><span class="line">klog.Infof(<span class="string">&quot;No Pod in deployment:%s, Skip&quot;</span>, newDeployment.Name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> originPodList.Items &#123;</span><br><span class="line"><span class="comment">// Check Pod running</span></span><br><span class="line"><span class="keyword">for</span> _, status := <span class="keyword">range</span> item.Status.ContainerStatuses &#123;</span><br><span class="line"><span class="keyword">if</span> status.RestartCount &gt; <span class="number">0</span> &#123;</span><br><span class="line">ready = <span class="literal">false</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">klog.Infof(<span class="string">&quot;Check deployment:%s namespace:%s status:%t&quot;</span>, newDeployment.Name, newDeployment.Namespace, ready)</span><br><span class="line"><span class="keyword">if</span> ready == <span class="literal">false</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ready == <span class="literal">false</span> &#123;</span><br><span class="line"><span class="comment">// rollback</span></span><br><span class="line">klog.Infof(<span class="string">&quot;=======Rollback deployment:%s namespace:%s&quot;</span>, newDeployment.Name, newDeployment.Namespace)</span><br><span class="line">writeDeploymentName2File(newDeployment.Name, fmt.Sprintf(<span class="string">&quot;rollback-%s.log&quot;</span>, newDeployment.Namespace))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šå¯åŠ¨ä¸€ä¸ª 10s æ‰§è¡Œä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œæ¯æ¬¡éƒ½ä¼šæ£€æµ‹æ˜¯å¦æœ‰å®¹å™¨å‘ç”Ÿäº†é‡å¯ï¼ˆæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå‡ºç°é‡å¯çš„ï¼‰</p><p>å¦‚æœæ£€æµ‹äº† 30 æ¬¡éƒ½æ²¡æœ‰é‡å¯çš„å®¹å™¨ï¼Œé‚£å°±è¯´æ˜æœ¬æ¬¡æ›¿æ¢æˆåŠŸäº†ï¼Œä¸ç„¶å°±è®°å½•ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œç„¶åäººå·¥å¤„ç†ã€‚</p><blockquote><p>è¿™ç§é€šå¸¸æ˜¯åŸæœ‰çš„é•œåƒä¸ OpenTelemetry ä¸å…¼å®¹ï¼Œæ¯”å¦‚é‡Œé¢å†™æ­»äº†ä¸€äº› skywalking çš„ APIï¼Œå¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚</p></blockquote><p>æ‰€ä»¥æ›¿æ¢ä»»åŠ¡è·‘å®Œä¹‹åæˆ‘è¿˜ä¼šæ£€æµ‹è¿™ä¸ª <code>rollback-$namespace</code> çš„æ—¥å¿—æ–‡ä»¶ï¼Œäººå·¥å¤„ç†è¿™äº›å¤±è´¥çš„åº”ç”¨ã€‚</p><h2 id="åˆ†æ‰¹å¤„ç†-deployment"><a href="#åˆ†æ‰¹å¤„ç†-deployment" class="headerlink" title="åˆ†æ‰¹å¤„ç† deployment"></a>åˆ†æ‰¹å¤„ç† deployment</h2><p>æœ€åè®²è®²å¦‚ä½•å•ä¸ªè°ƒç”¨åˆšæ‰çš„ <code>ProcessDeployment()</code> å‡½æ•°ã€‚</p><p>è€ƒè™‘åˆ°ä¸èƒ½å¯¹ kubernetes äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é™åˆ¶å¹¶å‘å¤„ç† deployment çš„æ•°é‡ï¼ˆæˆ‘è¿™é‡Œçš„é™åˆ¶æ˜¯ 10 ä¸ªï¼‰ã€‚</p><p>æ‰€ä»¥å°±å¾—åˆ†æ‰¹è¿›è¡Œæ›¿æ¢ï¼Œæ¯æ¬¡æ›¿æ¢ 10 ä¸ªï¼Œè€Œä¸”å…¶ä¸­æœ‰ä¸€ä¸ªæ‰§è¡Œå¤±è´¥å°±å¾—æš‚åœåç»­ä»»åŠ¡ï¼Œç”±äººå·¥æ£€æµ‹å¤±è´¥åŸå› å†å†³å®šæ˜¯å¦ç»§ç»­å¤„ç†ã€‚</p><blockquote><p>æ¯•ç«Ÿå¤„ç†çš„æ˜¯çº¿ä¸Šåº”ç”¨ï¼Œéœ€è¦å°å¿ƒè°¨æ…ã€‚</p></blockquote><p>æ‰€ä»¥è§¦å‘çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ProcessDeploymentList</span><span class="params">(ctx context.Context, data []v1.Deployment, clientSet kubernetes.Interface)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">file, err := os.ReadFile(fmt.Sprintf(<span class="string">&quot;finish-%s.log&quot;</span>, data[<span class="number">0</span>].Namespace))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">split := strings.Split(<span class="type">string</span>(file), <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">batchSize := <span class="number">10</span></span><br><span class="line">start := <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> start &lt; <span class="built_in">len</span>(data) &#123;</span><br><span class="line"></span><br><span class="line">end := start + batchSize</span><br><span class="line"><span class="keyword">if</span> end &gt; <span class="built_in">len</span>(data) &#123;</span><br><span class="line">end = <span class="built_in">len</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">batch := data[start:end]</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰å¾…goroutineç»“æŸ</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">klog.Infof(<span class="string">&quot;Start process batch size %d&quot;</span>, <span class="built_in">len</span>(batch))</span><br><span class="line"></span><br><span class="line">errs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">error</span>, <span class="built_in">len</span>(batch))</span><br><span class="line"></span><br><span class="line">wg.Add(<span class="built_in">len</span>(batch))</span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> batch &#123;</span><br><span class="line">d := item</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line"><span class="keyword">if</span> err := ProcessDeployment(ctx, split, d, clientSet); err != <span class="literal">nil</span> &#123;</span><br><span class="line">klog.Errorf(<span class="string">&quot;!!!Process deployment name:%s error: %v&quot;</span>, d.Name, err)</span><br><span class="line">errs &lt;- err</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">wg.Wait()</span><br><span class="line"><span class="built_in">close</span>(errs)</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»»ä½•ä¸€ä¸ªå¤±è´¥å°±è¿”å›</span></span><br><span class="line"><span class="keyword">for</span> err := <span class="keyword">range</span> errs &#123;</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start = end</span><br><span class="line">klog.Infof(<span class="string">&quot;Deal next batch&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>WaitGroup</code> æ¥æ§åˆ¶ä¸€ç»„ä»»åŠ¡ï¼Œä½¿ç”¨ä¸€ä¸ª chan æ¥ä¼ é€’å¼‚å¸¸ï¼›è¿™ç±»åˆ†æ‰¹å¤„ç†çš„ä»£ç åœ¨ä¸€äº›æ‰¹å¤„ç†æ¡†æ¶ä¸­è¿˜è›®å¸¸è§çš„ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ€ååªéœ€è¦æŸ¥è¯¢æŸä¸ª namespace ä¸‹çš„æ‰€æœ‰ deployment åˆ—è¡¨ä¼ å…¥è¿™ä¸ªæ‰¹å¤„ç†å‡½æ•°å³å¯ã€‚</p><p>ä¸è¿‡æ•´ä¸ªè¿‡ç¨‹ä¸­è¿˜æ˜¯æœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li>å› ä¸ºéœ€è¦æ›¿æ¢é•œåƒçš„å‰ææ˜¯è¦æŠŠç°æœ‰çš„é•œåƒæ‹‰å–åˆ°æœ¬åœ°ï¼Œæ‰€ä»¥è·‘è¿™ä¸ªä»»åŠ¡çš„å®¢æˆ·ç«¯éœ€è¦æœ‰å……è¶³çš„ç£ç›˜ï¼ŒåŒæ—¶å’Œé•œåƒæœåŠ¡å™¨çš„ç½‘ç»œæ¡ä»¶è¾ƒå¥½ã€‚</li><li>ä¸ç„¶æ‰§è¡Œçš„è¿‡ç¨‹ä¼šæ¯”è¾ƒæ…¢ï¼ŒåŒæ—¶ç£ç›˜å ç”¨æ»¡äº†ä¹Ÿä¼šå½±å“ä»»åŠ¡ã€‚</li></ul><p>å…¶å®è¿™ä¸ªåŠŸèƒ½ä¾ç„¶æœ‰æå‡ç©ºé—´ï¼Œè€ƒè™‘åˆ°åç»­ä¼šå‡çº§ OpenTelemetry  agent çš„ç‰ˆæœ¬ï¼Œç”šè‡³ä¹Ÿéœ€è¦å¢å‡ä¸€äº› JVM å‚æ•°ã€‚</p><p>æ‰€ä»¥æœ€åæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å·¥å…·ï¼Œå¯ä»¥ç›´æ¥å‡çº§ Agentï¼Œè€Œä¸æ˜¯æ¯æ¬¡æˆ‘éƒ½éœ€è¦ä¿®æ”¹è¿™é‡Œçš„ä»£ç ã€‚</p><p><img src="https://s2.loli.net/2024/03/03/lLIqQtmD2AdfGyv.png"></p><p>åæ¥åœ¨ç½‘ä¸Šçœ‹åˆ°äº†å¾—ç‰©çš„ç›¸å…³åˆ†äº«ï¼Œä»–ä»¬å¯ä»¥è¿œç¨‹åŠ è½½é…ç½®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œç›´åˆ°æˆ‘ä»¬çœ‹åˆ°äº† OpenTelemetry ç¤¾åŒºæä¾›äº† <a href="https://github.com/open-telemetry/opentelemetry-operator/#opentelemetry-auto-instrumentation-injection">Operator</a>ï¼Œå…¶ä¸­ä¹ŸåŒ…å«äº†æ³¨å…¥ agent çš„åŠŸèƒ½ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">opentelemetry.io/v1alpha1</span>  </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Instrumentation</span>  </span><br><span class="line"><span class="attr">metadata:</span>  </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-instrumentation</span>  </span><br><span class="line"><span class="attr">spec:</span>  </span><br><span class="line">  <span class="attr">exporter:</span>  </span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">http://otel-collector:4317</span>  </span><br><span class="line">  <span class="attr">propagators:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">tracecontext</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">baggage</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">b3</span>  </span><br><span class="line">  <span class="attr">sampler:</span>  </span><br><span class="line">    <span class="attr">type:</span> <span class="string">parentbased_traceidratio</span>  </span><br><span class="line">    <span class="attr">argument:</span> <span class="string">&quot;0.25&quot;</span>  </span><br><span class="line">  <span class="attr">java:</span>  </span><br><span class="line">    <span class="attr">image:</span> <span class="string">private/autoinstrumentation-java:1.32.0-1</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»–æä¾›çš„ CRD æ¥é…ç½®æˆ‘ä»¬ agentï¼Œåªè¦ç»´æŠ¤å¥½è‡ªå·±çš„é•œåƒå°±å¥½äº†ã€‚</p><p>ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦å®‰è£…å¥½äº† OpenTelemetry-operator ï¼Œç„¶åå†éœ€è¦æ³¨å…¥ Java Agent çš„ Pod ä¸­ä½¿ç”¨æ³¨è§£ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">instrumentation.opentelemetry.io/inject-java:</span> <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure><p> operator å°±ä¼šè‡ªåŠ¨ä»åˆšæ‰æˆ‘ä»¬é…ç½®çš„é•œåƒä¸­è¯»å– agentï¼Œç„¶åå¤åˆ¶åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡å®¹å™¨ã€‚</p><p>å†é…ç½®ä¸Šç¯å¢ƒå˜é‡ <code>$JAVA_TOOL_OPTIONS=/otel/javaagent.java</code>, è¿™æ˜¯ä¸€ä¸ª Java å†…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œåº”ç”¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨è¯†åˆ«ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨æ³¨å…¥ agent äº†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">envJavaToolsOptions   = <span class="string">&quot;JAVA_TOOL_OPTIONS&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set env value</span></span><br><span class="line">idx := getIndexOfEnv(container.Env, envJavaToolsOptions)  </span><br><span class="line"><span class="keyword">if</span> idx == <span class="number">-1</span> &#123;  </span><br><span class="line">    container.Env = <span class="built_in">append</span>(container.Env, corev1.EnvVar&#123;  </span><br><span class="line">       Name:  envJavaToolsOptions,  </span><br><span class="line">       Value: javaJVMArgument,  </span><br><span class="line">    &#125;)&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    container.Env[idx].Value = container.Env[idx].Value + javaJVMArgument  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// copy javaagent.jar</span></span><br><span class="line">pod.Spec.InitContainers = <span class="built_in">append</span>(pod.Spec.InitContainers, corev1.Container&#123;  </span><br><span class="line">    Name:      javaInitContainerName,  </span><br><span class="line">    Image:     javaSpec.Image,  </span><br><span class="line">    Command:   []<span class="type">string</span>&#123;<span class="string">&quot;cp&quot;</span>, <span class="string">&quot;/javaagent.jar&quot;</span>, javaInstrMountPath + <span class="string">&quot;/javaagent.jar&quot;</span>&#125;,  </span><br><span class="line">    Resources: javaSpec.Resources,  </span><br><span class="line">    VolumeMounts: []corev1.VolumeMount&#123;&#123;  </span><br><span class="line">       Name:      javaVolumeName,  </span><br><span class="line">       MountPath: javaInstrMountPath,  </span><br><span class="line">    &#125;&#125;,&#125;)</span><br></pre></td></tr></table></figure><p>å¤§è‡´çš„è¿è¡ŒåŸç†æ˜¯å½“æœ‰ Pod çš„äº‹ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼ˆé‡å¯ã€é‡æ–°éƒ¨ç½²ç­‰ï¼‰ï¼Œoperator å°±ä¼šæ£€æµ‹åˆ°å˜åŒ–ï¼Œæ­¤æ—¶ä¼šåˆ¤æ–­æ˜¯å¦å¼€å¯äº†åˆšæ‰çš„æ³¨è§£ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">instrumentation.opentelemetry.io/inject-java:</span> <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€ä¼šå†™å…¥ç¯å¢ƒå˜é‡ <code>JAVA_TOOL_OPTIONS</code>ï¼ŒåŒæ—¶å°† jar åŒ…ä» InitContainers ä¸­å¤åˆ¶åˆ°ä¸šåŠ¡å®¹å™¨ä¸­ã€‚</p><blockquote><p>è¿™é‡Œä½¿ç”¨åˆ°äº† kubernetes çš„åˆå§‹åŒ–å®¹å™¨ï¼Œè¯¥å®¹å™¨æ˜¯ç”¨äºåšä¸€äº›å‡†å¤‡å·¥ä½œçš„ï¼Œæ¯”å¦‚ä¾èµ–å®‰è£…ã€é…ç½®æ£€æµ‹æˆ–è€…æ˜¯ç­‰å¾…å…¶ä»–ä¸€äº›ç»„ä»¶å¯åŠ¨æˆåŠŸåå†å¯åŠ¨ä¸šåŠ¡å®¹å™¨ã€‚</p></blockquote><p>ç›®å‰è¿™ä¸ª operator è¿˜å¤„äºä½¿ç”¨é˜¶æ®µï¼ŒåŒæ—¶éƒ¨åˆ†åŠŸèƒ½è¿˜ä¸æ»¡è¶³ï¼ˆæ¯”å¦‚æ”¯æŒè‡ªå®šä¹‰æ‰©å±•ï¼‰ï¼Œä»Šåæœ‰æ—¶é—´ä¹Ÿå¯ä»¥åˆ†æä¸‹å®ƒçš„è¿è¡ŒåŸç†ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li><a href="https://xie.infoq.cn/article/e6def1e245e9d67735bd00dd5">https://xie.infoq.cn/article/e6def1e245e9d67735bd00dd5</a></li><li><a href="https://github.com/open-telemetry/opentelemetry-operator/#opentelemetry-auto-instrumentation-injection">https://github.com/open-telemetry/opentelemetry-operator/#opentelemetry-auto-instrumentation-injection</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/03/04/8YFIh7suTirZacj.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;æœ€è¿‘å…¬å¸å°†æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„é“¾è·¯å·¥å…·åˆ‡æ¢ä¸ºäº† &lt;code&gt;OpenTelemetry&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/03/03/9V1aUnpOd8EAG2Y.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="k8s" scheme="http://crossoverjie.top/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>2024å¹´çš„äº‘åŸç”Ÿæ¶æ„éœ€è¦å“ªäº›æŠ€æœ¯æ ˆ</title>
    <link href="http://crossoverjie.top/2024/04/05/ob/2024-cloud-native/"/>
    <id>http://crossoverjie.top/2024/04/05/ob/2024-cloud-native/</id>
    <published>2024-04-05T02:22:21.000Z</published>
    <updated>2024-04-10T13:31:32.308Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æ—¶é—´è¿‡å¾—å¾ˆå¿«å•Šï¼Œä¸€è½¬çœ¼å·²ç»åˆ°äº† 2024 å¹´ï¼Œè¿˜è®°å¾— 15 å¹´åˆšå·¥ä½œé‚£ä¼šæŒæ¡ä¸ª <code>SSM/H(Spring/Struts2/Mybatis/Hibernate)</code> æ¡†æ¶å°±èƒ½åº”ä»˜å¤§éƒ¨åˆ†é¢è¯•äº†ã€‚</p><blockquote><p>ç°åœ¨ CS ä¸“ä¸šçš„æ–°åŒå­¦ä¼°è®¡éƒ½æ²¡å¬è¯´è¿‡ SSMğŸ˜¢</p></blockquote><p>æ°å¥½ä»æˆ‘åˆšå¼€å§‹å·¥ä½œæ—¶çš„ç§»åŠ¨äº’è”ç½‘çƒ­æ½®åˆ°ç”µå•†-&gt;å…±äº«ç»æµ-&gt;toB å¤§çƒ­-&gt;å¦‚ä»Šæˆ‘éƒ½ç»å†äº†ä¸€éï¼ŒæŠ€æœ¯æ ˆä¹Ÿæœ‰ç”±æœ€å¼€å§‹çš„å•ä½“åº”ç”¨+ç‰©ç†æœºå‘å±•åˆ°ç°åœ¨çš„ kubernetes äº‘åŸç”Ÿæ¶æ„ã€‚</p><p>å½“ç„¶ä¸­é€”ä¹Ÿç»å†äº†å‡ ä¸ªå¤§çš„é˜¶æ®µï¼š<br>SOAæœåŠ¡åŒ–-&gt; å¾®æœåŠ¡-&gt; äº‘åŸç”Ÿ-&gt; æœåŠ¡ç½‘æ ¼-&gt; æ— æœåŠ¡ç­‰å‡ ä¸ªé˜¶æ®µã€‚</p><p>æœ€è¿‘ä¸€ä»½å·¥ä½œåˆä¸»è¦æ˜¯åœ¨åšåŸºç¡€æ¶æ„ï¼Œæˆ‘è®¤ä¸ºäº†è§£çš„è¿˜ç®—æ˜¯æ¯”è¾ƒå…¨é¢çš„ï¼Œæ‰€ä»¥æœ¬æ–‡æˆ‘å°±ä»¥æˆ‘çš„è§†è§’åˆ†äº«ä¸‹æˆ‘ä»¬åœ¨ 2024 å¹´åº”å½“ä½¿ç”¨å“ªäº›äº‘åŸç”ŸæŠ€æœ¯æ ˆï¼Œå› ä¸ºæ¶‰åŠåˆ°çš„æŠ€æœ¯ç»„ä»¶æ¯”è¾ƒå¤šï¼Œå°±ä¸è¿‡å¤šè®¨è®ºç»†èŠ‚äº†ã€‚</p><p>ä½†å¯ä»¥ä¿è¯çš„æ˜¯æåˆ°çš„æŠ€æœ¯æ ˆéƒ½æ˜¯æˆ‘æ‰€ç”¨è¿‡çš„ï¼Œä¼˜ç¼ºç‚¹éƒ½ä¼šæåˆ°ï¼Œä¸»æ‰“ä¸€ä¸ªçœŸå®ä½“éªŒã€‚</p><span id="more"></span><h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><p> é¦–å…ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Œè¿™é‡Œæœ‰åˆ«äºä»¥å¾€æˆ‘ä»¬ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿ(Linux&#x2F;Windows Server&#x2F;MacOS)ï¼Œä¸»è¦æŒ‡çš„æ˜¯äº‘åŸç”Ÿçš„æ“ä½œç³»ç»Ÿï¼Œæ²¡æœ‰å¤ªå¤šå¯ä»¥é€‰æ‹©çš„ä½™åœ°ï¼Œé‚£å°±æ˜¯ <code>kubernetes</code>ã€‚</p><p>ä¸è¿‡æ€ä¹ˆç»´æŠ¤å¥½ kubernetes æ˜¯ä¸€ä¸ªéš¾ç‚¹é—®é¢˜ï¼Œè¿˜è®°å¾—å»å¹´ä¸‹åŠå¹´æ»´æ»´å‡ºè¿‡ä¸€æ¬¡äº‹æ•…ï¼Œç½‘ä¼ å°±æ˜¯ kubernetes å‡çº§å‡ºç°çš„é—®é¢˜ã€‚</p><p>æ ¹æ®æˆ‘ä»¬çš„ç»éªŒæ¥çœ‹ï¼Œå¯¹äºå°å›¢é˜Ÿæ›´å»ºè®®ç›´æ¥æ‰˜ç®¡ç»™äº‘å‚å•†ï¼Œç»´æŠ¤ kubernetes æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„å·¥ä½œï¼Œå°å›¢é˜Ÿé€šå¸¸éƒ½æ˜¯ä¸€èŒå¤šèƒ½ï¼Œè‡ªå·±ç»´æŠ¤æ›´å®¹æ˜“å‡ºé—®é¢˜ã€‚</p><p>å½“ç„¶å¤§å›¢é˜Ÿæœ‰ä¸“äººç»´æŠ¤æœ€å¥½ï¼Œå³ä¾¿æ˜¯å‡ºé—®é¢˜ä¹Ÿèƒ½å¿«é€Ÿå“åº”ï¼Œå‰ææ˜¯è‡ªå·±èƒ½ cover ä½è¿™ä¸ªé£é™©ã€‚</p><blockquote><p>å› ä¸ºæˆ‘ä»¬æ˜¯å°å›¢é˜Ÿï¼Œæ‰€ä»¥è€ƒè™‘åˆ°æˆæœ¬å’Œç¨³å®šæ€§ï¼Œæˆ‘ä»¬ä¹Ÿåªä½¿ç”¨äº†äº‘å‚å•†çš„ kubernetes èƒ½åŠ›ï¼Œå…¶ä½™çš„éƒ¨åˆ†å¯æ§ç»„ä»¶ç”±æˆ‘ä»¬è‡ªå·±ç»´æŠ¤ï¼ˆå…·ä½“çš„åæ–‡ä¼šè®²åˆ°ï¼‰</p></blockquote><h2 id="å¤šäº‘çš„ä¼˜åŠ¿ä¸å¥½å¤„"><a href="#å¤šäº‘çš„ä¼˜åŠ¿ä¸å¥½å¤„" class="headerlink" title="å¤šäº‘çš„ä¼˜åŠ¿ä¸å¥½å¤„"></a>å¤šäº‘çš„ä¼˜åŠ¿ä¸å¥½å¤„</h2><p>æ—¢ç„¶éƒ½ç”¨äº†äº‘å‚å•†çš„å®¹å™¨æœåŠ¡ï¼Œé‚£ä¹Ÿè¦è€ƒè™‘åˆ°äº‘å‚å•†æ•…éšœå¯èƒ½å¸¦æ¥çš„é—®é¢˜ï¼›æ¯”å¦‚å»å¹´çš„é˜¿é‡Œäº‘æ•…éšœã€‚</p><p>æ‰€ä»¥ç°åœ¨ä¸€äº›ä¸­å¤§å‚ä¹Ÿä¼šé€‰æ‹©å¤šäº‘æ–¹æ¡ˆï¼Œå°†åŒä¸€ä»½ä»£ç éƒ¨ç½²å†å¤šä¸ªäº‘æœåŠ¡å•†ï¼Œä¸€æ—¦å…¶ä¸­ä¸€ä¸ªå‡ºç°é—®é¢˜å¯ä»¥å¿«é€Ÿåˆ‡æ¢ã€‚</p><p>ä½†å…·ä½“çš„å®æ–½è¿‡ç¨‹ä¸­ä¹Ÿæœ‰è®¸å¤šæŒ‘æˆ˜ï¼Œæ¯”å¦‚æœ€æ£˜æ‰‹ä¹Ÿæ˜¯æœ€å…³é”®çš„æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ</p><p>å½“ç„¶æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€äº›æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²çš„æ•°æ®åº“æˆ–ä¸­é—´ä»¶ï¼Œä»–ä»¬æœ¬èº«æ˜¯æ”¯æŒæ•°æ®åŒæ­¥çš„ï¼›æ¯”å¦‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ Pulsarï¼Œå®ƒå°±å¯ä»¥è·¨çº§ç¾¤éƒ¨ç½²ä»¥åŠæ¶ˆæ¯åŒæ­¥ã€‚</p><p>åŒæ—¶å¤šäº‘éƒ¨ç½²å¯¹åº”çš„æˆæœ¬ä¹Ÿä¼šæå‡ï¼Œåœ¨è¿™ä¸ªâ€œé™æœ¬å¢æ•ˆâ€çš„å¤§èƒŒæ™¯ä¸‹ä¹Ÿå¾—æ…é‡è€ƒè™‘ï¼›æ‰€ä»¥å¯¹æ­¤è¿˜æœ‰ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼š</p><blockquote><p>æˆ‘ä»¬çš„æŠ€æœ¯æ¶æ„éœ€è¦å…·å¤‡å¿«é€Ÿè¿ç§»åˆ°å…¶ä»–äº‘æœåŠ¡çš„èƒ½åŠ›ï¼Œæ¯”å¦‚æˆ‘ä»¬å†…éƒ¨æœ‰ä¸€äº›å·¥å…·å¯ä»¥å®šæœŸå¤‡ä»½èµ„æºï¼Œæ¯”å¦‚ MySQL çš„ binlogï¼Œä¸€äº›ä¸­é—´ä»¶çš„å…ƒæ•°æ®ï¼ŒåŒæ—¶å¯ä»¥åŸºäºè¿™äº›å…ƒæ•°æ®å¿«é€Ÿæ¢å¤ä¸šåŠ¡ã€‚</p></blockquote><p>ä¸€èˆ¬é‡åˆ°éœ€è¦åˆ‡æ¢äº‘æœåŠ¡æ—¶éƒ½æ˜¯ä¸€äº›æç«¯æƒ…å†µï¼Œæ‰€ä»¥å…è®¸éƒ¨åˆ†è¿è¡Œæ—¶çš„æ•°æ®ä¸¢å¤±ä¹Ÿæ˜¯èƒ½æ¥å—çš„ï¼Œæˆ‘ä»¬åªè¦ä¿è¯æœ€æ ¸å¿ƒçš„æ•°æ®ä¸ä¼šä¸¢å¤±ä»è€Œä¸å½±å“ä¸šåŠ¡å³å¯ã€‚</p><p>è¿™ä¸ªè¯´èµ·æ¥ç®€å•ï¼Œä½†ä¹Ÿéœ€è¦æˆ‘ä»¬èŠ±æ—¶é—´è¿›è¡Œæ¨¡æ‹Ÿæ¼”ç»ƒï¼›å…·ä½“æ˜¯å¦å®æ–½å°±å¾—çœ‹å…¬å¸æ˜¯å¦æ¥å—äº‘æœåŠ¡å®•æœºå¸¦æ¥çš„æŸå¤±ä»¥åŠæ¼”ç»ƒæ‰€èŠ±çš„æˆæœ¬äº†ã€‚</p><blockquote><p>æˆ‘ä»¬æ˜¯å…·å¤‡æ¢å¤å…ƒæ•°æ®èƒ½åŠ›çš„ï¼Œä½†ä¼šä¸¢å¤±éƒ¨åˆ†è¿è¡Œæ—¶çš„æ•°æ®ã€‚</p></blockquote><h1 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h1><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»é€‰æ‹© kubernetes ä½œä¸ºæˆ‘ä»¬äº‘åŸç”Ÿçš„æ“ä½œç³»ç»Ÿï¼Œé‚£æˆ‘ä»¬çš„æŒç»­é›†æˆä¸å‘å¸ƒä¹Ÿå¾—å›´ç»•ç€ kubernetes æ¥åšã€‚</p><p><img src="https://s2.loli.net/2024/03/05/P2ducxQtqSCGnDb.png"></p><p>ä¸Šå›¾æ˜¯ä¸€å¼ ä½¿ç”¨ Git é…åˆ gitlab+ArgoCD çš„æµç¨‹å›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨ gitlab æ¥ç®¡ç†æºç ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨ä»–çš„ Pipline å¸®æˆ‘ä»¬åšæŒç»­é›†æˆï¼Œæœ€ç»ˆä½¿ç”¨ Argo å¸®æˆ‘ä»¬æ‰“é€š kubernetes çš„æµç¨‹ã€‚</p><blockquote><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ <code>GitOps</code></p></blockquote><p>åŒæ—¶æˆ‘ä»¬çš„å›æ»šå†å²ç‰ˆæœ¬ï¼Œæ‰©ç¼©å®¹éƒ½ç”± kubernetes æä¾›èƒ½åŠ›ï¼Œæˆ‘ä»¬çš„ DevOps å¹³å°åªéœ€è¦è°ƒç”¨ kubernetes çš„ API å³å¯ã€‚</p><p>å½“ç„¶è¿˜æœ‰ç°åœ¨æµè¡Œ FinOpsï¼Œæˆ‘çš„ç†è§£ä¸»è¦æ˜¯åšäº‘æˆæœ¬çš„ç®¡ç†å’Œä¼˜åŒ–ï¼Œå¯¹åº”åˆ°æˆ‘çš„å·¥ä½œå°±æ˜¯å›æ”¶ä¸€äº›ä¸ç”¨çš„èµ„æºï¼Œåœ¨ä¸å½±å“ä¸šåŠ¡çš„æƒ…å†µä¸‹é€‚å½“çš„é™ä½ä¸€äº›é…ç½®ğŸ˜³ã€‚</p><h1 id="Service-Mesh"><a href="#Service-Mesh" class="headerlink" title="Service Mesh"></a>Service Mesh</h1><p><img src="https://s2.loli.net/2024/03/06/mlzdFAHNM6bDGvr.png"></p><p>æ¥ä¸‹æ¥ä¾¿æ˜¯æˆ‘è®¤ä¸ºæœ€é‡è¦çš„ Service Mesh ç¯èŠ‚äº†ï¼Œè¿™ä¸ªçš„èƒŒæ™¯æ•…äº‹å°±å¤šäº†ï¼Œæœ¬è´¨ä¸Šæˆ‘è§‰å¾—è¿™éƒ½æ˜¯ç”± RPC(Remote Process Call) å¼•èµ·çš„ä¹Ÿæ˜¯åˆ†å¸ƒå¼æ‰€å¸¦æ¥çš„ã€‚</p><p>ç”±æœ€å¼€å§‹çš„å•æœºçš„æœ¬åœ°å‡½æ•°è°ƒç”¨å¼€å§‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">local+------&gt;remote +------&gt; micro-service+-----&gt;service-mesh</span><br><span class="line">               +                  |                    +</span><br><span class="line">               v                  v                    v</span><br><span class="line">           +---+----+       +-----+------+        +----+----+</span><br><span class="line">           | motan  |       | SpringCloud|        | Istio   |</span><br><span class="line">           | dubbo  |       | Dubbo3.0   |        | Linkerd |</span><br><span class="line">           | gRPC   |       | SOFA       |        |         |</span><br><span class="line">           +--------+       +------------+        +---------+</span><br></pre></td></tr></table></figure><p>ä¸»è¦ç»å†äº†ä»¥ä¸Šä¸‰ä¸ªé‡è¦çš„é˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ RPC æ¡†æ¶åˆ°å¾®æœåŠ¡å†åˆ°ç°åœ¨çš„æœåŠ¡ç½‘æ ¼ã€‚</p><ul><li>RPC æ¡†æ¶ä¸»è¦å¸®æˆ‘ä»¬ç®€åŒ–äº†åˆ†å¸ƒå¼é€šä¿¡ï¼Œåªä¸“æ³¨äºä¸šåŠ¡æœ¬èº«</li><li>å¾®æœåŠ¡æ¡†æ¶çš„å‡ºç°å¯ä»¥æ›´å¥½çš„å¸®æˆ‘ä»¬æ²»ç†å¤§æ‰¹é‡çš„æœåŠ¡ï¼Œæ¯”å¦‚ä¸€äº›é™æµã€è·¯ç”±ã€é™çº§ç­‰åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åˆ†å¸ƒå¼åº”ç”¨æ›´åŠ å¥å£®ã€‚</li><li>è€Œå¦‚ä»Šçš„æœåŠ¡ç½‘æ ¼è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ›´åŠ é€‚é…äº‘åŸç”Ÿï¼Œä¸“æ³¨äºä¸šåŠ¡ç ”å‘è€Œä¸å†éœ€è¦å»ç»´æŠ¤å¾®æœåŠ¡æ¡†æ¶ï¼›å°†è¿™äº›åŸºç¡€åŠŸèƒ½å…¨éƒ¨ä¸‹æ²‰åˆ°æˆ‘ä»¬çš„åŸºç¡€å±‚ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸å¼±äºå¾®æœåŠ¡æ¡†æ¶çš„åŠŸèƒ½æ€§ã€‚</li></ul><p>ä½†ä½¿ç”¨ Istio ä¹Ÿæœ‰ç€ä¸ä½çš„æŠ€æœ¯é—¨æ§›ï¼Œæˆ‘è§‰å¾—å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ›´æ¨èä½¿ç”¨ Istioï¼š</p><ul><li>åº”ç”¨å·²ç»æ¥å…¥ kubernetes å¹³å°</li><li>åº”ç”¨ä¹‹é—´é‡‡ç”¨çš„æ˜¯ gRPC é€šè®¯æ¡†æ¶</li><li>API ç½‘å…³ä¹Ÿè¿ç§»åˆ° Istio Gateway</li><li>å…¬å¸è‡³å°‘é¢„å¤‡ä¸€ä¸ªä¸“äººç»´æŠ¤ Istioï¼ˆè¿™é‡Œçš„ç»´æŠ¤ä¸ä¸€å®šæ˜¯å¯¹ä»£ç çš„äº†è§£ï¼Œä½†ä¸€å®šè¦å¯¹ Istio æœ¬èº«çš„åŠŸèƒ½å’Œæ–‡æ¡£è¶³å¤Ÿäº†è§£ï¼‰</li></ul><p>é™¤æ­¤ä¹‹å¤–ä½¿ç”¨ <code>SpringCloud</code>ã€<code>Dubbo</code>ã€<code>kratos</code>ã€<code>go-zero</code>ä¹‹ç±»çš„å¾®æœåŠ¡æ¡†æ¶ä¹Ÿæœªå°ä¸å¯ã€‚</p><p>æˆ‘ä¹‹å‰æœ‰å†™è¿‡ä¸¤ç¯‡å…³äº Istio çš„ æ–‡ç« ï¼Œä¹Ÿå¯ä»¥ç”¨åšå‚è€ƒï¼š</p><ul><li><a href="https://crossoverjie.top/2023/10/16/ob/k8s-grpc-lb/">åœ¨ kubernetes ç¯å¢ƒä¸­å®ç° gRPC è´Ÿè½½å‡è¡¡</a></li><li><a href="https://crossoverjie.top/2023/10/31/ob/k8s-Istio01/">æœåŠ¡ç½‘æ ¼å®æˆ˜-å…¥é—¨Istio</a></li></ul><h1 id="å¯è§‚æµ‹æ€§"><a href="#å¯è§‚æµ‹æ€§" class="headerlink" title="å¯è§‚æµ‹æ€§"></a>å¯è§‚æµ‹æ€§</h1><p><img src="https://s2.loli.net/2024/03/06/wOtk3Fb5fhEIWpB.png"><br>ç°å¦‚ä»Šå¯è§‚æµ‹ç³»ç»Ÿä¹Ÿå˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼Œä¸ªäººè§‰å¾—è¯„ä»·ä¸€ä¸ªæŠ€æœ¯å›¢é˜Ÿé‡è¦æŒ‡æ ‡å°±æ˜¯ä»–ä»¬çš„å¯è§‚æµ‹ç³»ç»Ÿåšçš„å¦‚ä½•ã€‚</p><p>ä¸€ä¸ªä¼˜ç§€çš„å¯è§‚æµ‹ç³»ç»Ÿå¯ä»¥æ¸…æ™°å¾—çŸ¥ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ã€é«˜æ•ˆçš„æ’æŸ¥é—®é¢˜ã€è¿˜æœ‰åŠæ—¶çš„æ•…éšœå‘Šè­¦ã€‚</p><p>è¦å®ç°ä¸Šè¿°æ ‡å‡†å°±éœ€è¦æˆ‘ä»¬å¯è§‚æµ‹ç³»ç»Ÿçš„ä¸‰ä¸ªæ ¸å¿ƒæŒ‡æ ‡äº†ï¼š</p><p><img src="https://s2.loli.net/2024/03/06/gXQIfcJO1qVWimH.png"></p><ul><li>Metricsï¼Œå€ŸåŠ©å®ƒæˆ‘ä»¬å¯ä»¥åœ¨ Grafana ä¸­ç»˜åˆ¶å‡ºå„ç§ç›´è§‚çš„é¢æ¿ï¼Œå¯ä»¥æ›´åŠ å…¨é¢çš„äº†è§£æˆ‘ä»¬ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€</li></ul><p><img src="https://s2.loli.net/2024/03/06/sWk2gXnTNxuafBF.png"></p><ul><li>Traceåˆ™æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºå‡ºç³»ç»Ÿè°ƒç”¨çš„å…¨è²Œï¼Œé€šè¿‡ä¸€ä¸ª trace å°±å¯ä»¥çŸ¥é“ä¸€ä¸ªè¯·æ±‚ç»å†äº†å“ªäº›ç³»ç»Ÿï¼Œåœ¨å“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ã€‚</li><li>Logs å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œå°±æ˜¯æˆ‘ä»¬è‡ªå·±åœ¨åº”ç”¨é‡Œæ‰“å°çš„ä¸€äº›æ—¥å¿—ï¼›åªæ˜¯å’Œä»¥å¾€çš„å¼€å‘æ¨¡å¼ç•¥æœ‰ä¸åŒçš„æ˜¯ï¼šåœ¨äº‘åŸç”Ÿä½“ç³»ä¸­æ›´æ¨èç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æµä¸­ï¼Œä¸€äº›ç¬¬ä¸‰æ–¹é‡‡é›†ç»„ä»¶å¯ä»¥æ›´æ–¹ä¾¿çš„è¿›è¡Œé‡‡é›†ã€‚</li></ul><hr><p>æˆ‘ä»¬è‡ªå·±çš„å¯è§‚æµ‹ç³»ç»Ÿç»å†è¿‡ä¸€æ¬¡è¿­ä»£ï¼Œä»¥å¾€çš„æŠ€æœ¯æ ˆæ˜¯ï¼š</p><ul><li><code>Metrics</code> ä½¿ç”¨ <code>VictoriaMetrics</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå®Œå…¨å…¼å®¹ <code>Prometheus</code> çš„æ—¶åºæ•°æ®åº“ï¼Œä½†ç›¸å¯¹ <code>Prometheus</code> æ¥è¯´æ›´åŠ çš„èŠ‚çœèµ„æºã€‚</li><li>Trace é€‰æ‹©çš„æ˜¯ <code>SkyWalking</code>ï¼Œè¿™ä¹Ÿæ˜¯ Java trace é¢†åŸŸæ¯”è¾ƒæµè¡Œçš„æŠ€æœ¯æ–¹æ¡ˆã€‚</li><li>Logsï¼šä½¿ç”¨ filebeat é‡‡é›†æ—¥å¿—ç„¶åè¾“å‡ºåˆ° ElasticSearch ä¸­ï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒç»å…¸çš„æ–¹æ¡ˆã€‚</li></ul><p>å»å¹´åº•æˆ‘ä»¬åšäº†ä¸€æ¬¡æ¯”è¾ƒå¤§çš„æ”¹é€ ï¼Œä¸»è¦å°±æ˜¯å°† <code>SkyWalking</code> æ¢ä¸ºäº† <code>OpenTelemetry</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´åŠ å¼€æ”¾çš„ç¤¾åŒºï¼Œä¹Ÿé€æ¸æˆä¸ºäº‘åŸç”Ÿå¯è§‚æµ‹çš„æ ‡å‡†äº†ã€‚</p><p>ä½¿ç”¨å®ƒæˆ‘ä»¬çš„çµæ´»æ€§æ›´é«˜ï¼Œä¸ç”¨ä¸æŸäº›å…·ä½“çš„æŠ€æœ¯æ ˆè¿›è¡Œç»‘å®šï¼›ç›®å‰ logs è¿˜æ²¡æœ‰åˆ‡æ¢ï¼Œç¤¾åŒºä¹Ÿè¿˜åœ¨ beta æµ‹è¯•ä¸­ï¼Œåç»­æˆç†Ÿåä¹Ÿå¯ä»¥ç›´æ¥ç”¨ <code>OpenTelemetry</code> æ¥æ”¶é›†æ—¥å¿—ã€‚</p><p>æˆ‘ä¹Ÿå†™çš„æœ‰ä¸€ç¯‡ SW è¿ç§»åˆ° <code>OpenTelemetry</code> çš„æ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒï¼š</p><ul><li><a href="https://juejin.cn/post/7341669201010262053">å®æˆ˜ï¼šå¦‚ä½•ä¼˜é›…çš„ä» SkyWalking åˆ‡æ¢åˆ° OpenTelemetry</a></li></ul><h1 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h1><p>è¿™é‡Œå•ç‹¬æŠŠæ¶ˆæ¯é˜Ÿåˆ—æ‹å‡ºæ¥æ˜¯å› ä¸ºæˆ‘ç›®å‰ä¸»è¦æ˜¯åœ¨ç»´æŠ¤å…¬å¸å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¸šåŠ¡ä½“é‡å¤§äº†ä¹‹åæ¶ˆæ¯é˜Ÿåˆ—å˜å¾—éå¸¸é‡è¦äº†ï¼Œé€šå¸¸ä¼šå……å½“å„ä¸ªä¸šåŠ¡çº¿å¯¹æ¥çš„æ¡¥æ¢ï¼Œæˆ–è€…æ˜¯æ•°æ®åº“åŒæ­¥ MySQL çš„æ¸ é“ï¼Œæ€»ä¹‹ç”¨å¤„éå¸¸å¹¿æ³›ã€‚</p><p><img src="https://s2.loli.net/2024/03/07/WBeYUK8AVlcrgGs.png"></p><p>è¿™é‡Œè¿˜æ˜¯æ¨èæ›´è´´åˆäº‘åŸç”Ÿçš„æ¶ˆæ¯é˜Ÿåˆ— Pulsarï¼Œç”±äºå®ƒå­˜ç®—åˆ†ç¦»çš„æ¶æ„ç‰¹æ€§ï¼Œé…åˆkubernetes çš„ç‰¹æ€§å¯ä»¥å®ç°å¿«é€Ÿçš„æ‰©ç¼©å®¹ï¼Œç›¸æ¯” kafka æ¥è¯´æ›´æ˜“ç»´æŠ¤ï¼›åŒæ—¶ç¤¾åŒºæ´»è·ƒåº¦ä¹Ÿéå¸¸é«˜ï¼Œåœ¨ Bug ä¿®å¤å’Œæ”¯æŒæ–°ç‰¹æ€§æ–¹é¢æ¯”è¾ƒç§¯æã€‚</p><p>Pulsarå®˜æ–¹æ”¯æŒçš„å®¢æˆ·ç«¯ä¹Ÿæ¯”è¾ƒå…¨é¢ï¼š</p><table><thead><tr><th>Language</th><th>Documentation</th><th>Release note</th><th>Code repo</th></tr></thead><tbody><tr><td>Java</td><td><a href="client-libraries-java.md">User doc</a>   <br/> <a href="/api/client/">API doc</a></td><td><a href="pathname:///release-notes/client-java">Standalone</a></td><td><a href="https://github.com/apache/pulsar/tree/master/pulsar-client">Bundled</a></td></tr><tr><td>C++</td><td><a href="client-libraries-cpp.md">User doc</a>    <br/> <a href="@pulsar:apidoc:cpp@">API doc</a></td><td><a href="pathname:///release-notes/client-cpp">Standalone</a></td><td><a href="https://github.com/apache/pulsar-client-cpp">Standalone</a></td></tr><tr><td>Python</td><td><a href="client-libraries-python.md">User doc</a> <br/> <a href="@pulsar:apidoc:python@">API doc</a></td><td><a href="pathname:///release-notes/client-python">Standalone</a></td><td><a href="https://github.com/apache/pulsar-client-python">Standalone</a></td></tr><tr><td>Go client</td><td><a href="client-libraries-go.md">User doc</a>   <br/> <a href="https://pkg.go.dev/github.com/apache/pulsar-client-go/pulsar">API doc</a></td><td><a href="pathname:///release-notes/client-go">Standalone</a></td><td><a href="https://github.com/apache/pulsar-client-go">Standalone</a></td></tr><tr><td>Node.js</td><td><a href="client-libraries-node.md">User doc</a>  <br/> <a href="@pulsar:apidoc:js@">API doc</a></td><td><a href="pathname:///release-notes/client-node">Standalone</a></td><td><a href="https://github.com/apache/pulsar-client-node">Standalone</a></td></tr><tr><td>C#&#x2F;DotPulsar</td><td><a href="client-libraries-dotnet.md">User doc</a></td><td><a href="pathname:///release-notes/client-cs">Standalone</a></td><td><a href="https://github.com/apache/pulsar-dotpulsar">Standalone</a></td></tr></tbody></table><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚ä½•éƒ¨ç½²æˆ‘ä»¬çš„ Pulsar é›†ç¾¤ï¼Œæ˜¯ç§æœ‰åŒ–éƒ¨ç½²è¿˜æ˜¯è´­ä¹°äº‘æœåŠ¡ï¼ˆç›®å‰ Pulsarçš„å•†ä¸šå…¬å¸ streamnative å’Œå›½å†…çš„è…¾è®¯äº‘éƒ½æœ‰ç±»ä¼¼çš„æœåŠ¡ï¼‰</p><p>æˆ‘ä»¬ä¹‹å‰æœ‰å’¨è¯¢è¿‡ä»·æ ¼ï¼Œç›¸å¯¹æ¥è¯´è¿˜æ˜¯è‡ªå·±éƒ¨ç½²æ€§ä»·æ¯”æœ€é«˜ï¼›å’Œå‰æ–‡è®²çš„ä¸€æ ·ï¼Œåªä½¿ç”¨äº‘å‚å•†çš„ kubernetes æœåŠ¡ï¼Œåœ¨è¿™åŸºç¡€ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„è‡ªå·±çš„æœåŠ¡ã€‚</p><p>å› ä¸ºå¾—ç›Šäº Pulsar ç¤¾åŒºçš„æ´»è·ƒï¼Œå³ä¾¿æ˜¯è‡ªå·±ç»´æŠ¤å‡ºç°é—®é¢˜ä¹Ÿå¯ä»¥åŠæ—¶å¾—åˆ°åé¦ˆï¼›åŒæ—¶è‡ªå·±å¹³æ—¶è¸©çš„å‘ä¹Ÿå¯ä»¥åå“ºç¤¾åŒºã€‚</p><p>ä¹‹å‰ä¹Ÿå†™è¿‡ä¸€äº›å…³äº Pulsar çš„ç³»åˆ—æ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥é˜…ï¼š</p><ul><li><a href="https://juejin.cn/post/7340195874867904547">åœ¨ kubernetes ç¯å¢ƒä¸‹å¦‚ä½•ä¼˜é›…æ‰©ç¼©å®¹ Pulsar</a></li><li><a href="https://crossoverjie.top/2024/01/03/ob/Pulsar3.0-new-feature/">Pulsar3.0æ–°åŠŸèƒ½ä»‹ç»</a></li><li><a href="https://crossoverjie.top/2023/02/07/pulsar/pulsar-load-banance/">Pulsarè´Ÿè½½å‡è¡¡åŸç†åŠä¼˜åŒ–</a></li><li><a href="https://crossoverjie.top/2024/01/15/ob/Bookkeeper-storage/">ç™½è¯ Pulsar Bookkeeper çš„å­˜å‚¨æ¨¡å‹</a></li><li><a href="https://crossoverjie.top/2023/01/16/pulsar/pulsar-perf-test/">Pulsarå‹æµ‹åŠä¼˜åŒ–</a></li></ul><h1 id="ä¸šåŠ¡æ¡†æ¶"><a href="#ä¸šåŠ¡æ¡†æ¶" class="headerlink" title="ä¸šåŠ¡æ¡†æ¶"></a>ä¸šåŠ¡æ¡†æ¶</h1><p>æœ€åæ˜¯ä¸šåŠ¡æ¡†æ¶çš„é€‰æ‹©ï¼Œå†³å®šè¿™ä¸ªçš„å‰ææ˜¯æˆ‘ä»¬å…ˆè¦ç¡®å®šé€‰æ‹©å“ªä¸ªè¯­è¨€ä½œä¸ºä¸»åŠ›ä¸šåŠ¡è¯­è¨€ã€‚</p><p>è™½ç„¶è¿™ç‚¹å¯¹äº kubernetes æ¥è¯´æ— å…³ç´§è¦ï¼Œä¸‹é¢ä»¥æˆ‘æ¯”è¾ƒç†Ÿæ‚‰çš„ Java å’Œ Golang è¿›è¡Œä»‹ç»ã€‚</p><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p>Java å¯é€‰çš„æŠ€æœ¯æ–¹æ¡ˆå°±æ¯”è¾ƒå¤šäº†ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ä¸Šäº† kubernetes ä½†æ²¡æœ‰ä½¿ç”¨æœåŠ¡ç½‘æ ¼ï¼›é‚£å®Œå…¨å¯ä»¥åªä½¿ç”¨ <code>springboot</code> å¼€å‘ http æ¥å£ï¼Œå°±å’Œå¼€å‘ä¸€ä¸ªå•ä½“åº”ç”¨ä¸€æ ·ç®€å•ã€‚</p><p>åªæ˜¯è¿™æ ·ä¼šç¼ºå°‘ä¸€äº›æœåŠ¡æ²»ç†çš„èƒ½åŠ›ï¼Œæ›´é€‚ç”¨äºä¸­å°å‹å›¢é˜Ÿã€‚</p><p>å¦‚æœå›¢é˜Ÿäººå‘˜è¾ƒå¤šï¼Œä¹Ÿæ²¡ä½¿ç”¨æœåŠ¡ç½‘æ ¼æ—¶ï¼›é‚£å°±æ¨èä½¿ç”¨å‰æ–‡ä»‹ç»çš„å¾®æœåŠ¡æ¡†æ¶ï¼šæ¯”å¦‚ Dubboã€SpringCloud ç­‰ã€‚</p><p>å½“æœ‰ä¸“é—¨çš„äº‘åŸç”Ÿå›¢é˜Ÿæ—¶ï¼Œåˆ™æ›´æ¨èä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„æ–¹æ¡ˆï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç»¼åˆä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼š</p><ul><li>ä»£ç ç®€æ´ï¼Œåªæ˜¯éœ€è¦å°† http æ¢ä¸º gRPCã€‚</li><li>åŒæ—¶åˆ©ç”¨ Istio ä¹ŸåŒ…å«äº†å¾®æœåŠ¡æ¡†æ¶çš„èƒ½åŠ›ã€‚</li></ul><h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><p>Golang å…¶å®ä¹Ÿä¸ Java ç±»ä¼¼ï¼Œä¸­å°å›¢é˜Ÿæ—¶æˆ‘ä»¬å®Œå…¨å¯ä»¥åªä½¿ç”¨ Gin è¿™ç±» http æ¡†æ¶è¿›è¡Œå¼€å‘ã€‚</p><p>è€Œä¸­å¤§å‹å›¢é˜Ÿåœ¨ <code>Golang</code> ç”Ÿæ€ä¸­ä¹Ÿæœ‰å¯¹æ ‡ <code>Dubbo</code> å’Œ <code>SpringCloud</code> çš„æ¡†æ¶ï¼Œæ¯”å¦‚ <a href="https://github.com/go-kratos/kratos">kratos</a>å’Œ <a href="https://github.com/zeromicro/go-zero">go-zero</a> ç­‰ã€‚</p><p>å¾—ç›Šäº Golang çš„ç®€æ´ç‰¹æ€§ï¼Œæˆ‘è§‰å¾—æ¯”ä½¿ç”¨ Java å¼€å‘ä¸šåŠ¡æ›´åŠ ç®€å•å’Œâ€œæ— è„‘â€ã€‚</p><p>åŒæ ·çš„åç»­ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°æœåŠ¡ç½‘æ ¼ï¼Œç›´æ¥é‡‡ç”¨ gRPC å’Œ Golang ä¹Ÿéå¸¸é€‚é…ï¼Œæ­¤æ—¶å›¢é˜Ÿåº”è¯¥ä¹Ÿæ¯”è¾ƒæˆç†Ÿäº†ï¼Œå®Œå…¨å¯ä»¥è‡ªå·±åŸºäº gRPC åšä¸€ä¸ªå¼€å‘è„šæ‰‹æ¶ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ Kratos æˆ–è€…æ˜¯ go-zero å»æ‰ä»–ä»¬çš„æœåŠ¡è°ƒç”¨æ¨¡å—å³å¯ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šå°±æ˜¯ä¸ªäººå¯¹ç›®å‰æµè¡Œçš„æŠ€æœ¯æ–¹æ¡ˆçš„ç†è§£ï¼Œä¹Ÿåˆ†åˆ«å¯¹ä¸åŒå›¢é˜Ÿè§„æ¨¡è¿›è¡Œäº†æ¨èï¼›ç¡®å®æ²¡æœ‰å®Œç¾çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œåªæœ‰æœ€åˆé€‚çš„ï¼Œä¹Ÿä¸è¦è·Ÿé£é€‰æ‹©ä¸€äº›è‡ªå·±ä¸èƒ½æŠŠæ§çš„æŠ€æœ¯æ ˆï¼Œæœ€ç»ˆåƒäºçš„å¯èƒ½å°±æ˜¯è‡ªå·±ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li><a href="https://levelup.gitconnected.com/gitops-in-kubernetes-with-gitlab-ci-and-argocd-9e20b5d3b55b">https://levelup.gitconnected.com/gitops-in-kubernetes-with-gitlab-ci-and-argocd-9e20b5d3b55b</a></li><li><a href="https://grpc.io/">https://grpc.io/</a></li></ul><p>#Blog #CloudNative </p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;æ—¶é—´è¿‡å¾—å¾ˆå¿«å•Šï¼Œä¸€è½¬çœ¼å·²ç»åˆ°äº† 2024 å¹´ï¼Œè¿˜è®°å¾— 15 å¹´åˆšå·¥ä½œé‚£ä¼šæŒæ¡ä¸ª &lt;code&gt;SSM/H(Spring/Struts2/Mybatis/Hibernate)&lt;/code&gt; æ¡†æ¶å°±èƒ½åº”ä»˜å¤§éƒ¨åˆ†é¢è¯•äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç°åœ¨ CS ä¸“ä¸šçš„æ–°åŒå­¦ä¼°è®¡éƒ½æ²¡å¬è¯´è¿‡ SSMğŸ˜¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ°å¥½ä»æˆ‘åˆšå¼€å§‹å·¥ä½œæ—¶çš„ç§»åŠ¨äº’è”ç½‘çƒ­æ½®åˆ°ç”µå•†-&amp;gt;å…±äº«ç»æµ-&amp;gt;toB å¤§çƒ­-&amp;gt;å¦‚ä»Šæˆ‘éƒ½ç»å†äº†ä¸€éï¼ŒæŠ€æœ¯æ ˆä¹Ÿæœ‰ç”±æœ€å¼€å§‹çš„å•ä½“åº”ç”¨+ç‰©ç†æœºå‘å±•åˆ°ç°åœ¨çš„ kubernetes äº‘åŸç”Ÿæ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ä¸­é€”ä¹Ÿç»å†äº†å‡ ä¸ªå¤§çš„é˜¶æ®µï¼š&lt;br&gt;SOAæœåŠ¡åŒ–-&amp;gt; å¾®æœåŠ¡-&amp;gt; äº‘åŸç”Ÿ-&amp;gt; æœåŠ¡ç½‘æ ¼-&amp;gt; æ— æœåŠ¡ç­‰å‡ ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ä¸€ä»½å·¥ä½œåˆä¸»è¦æ˜¯åœ¨åšåŸºç¡€æ¶æ„ï¼Œæˆ‘è®¤ä¸ºäº†è§£çš„è¿˜ç®—æ˜¯æ¯”è¾ƒå…¨é¢çš„ï¼Œæ‰€ä»¥æœ¬æ–‡æˆ‘å°±ä»¥æˆ‘çš„è§†è§’åˆ†äº«ä¸‹æˆ‘ä»¬åœ¨ 2024 å¹´åº”å½“ä½¿ç”¨å“ªäº›äº‘åŸç”ŸæŠ€æœ¯æ ˆï¼Œå› ä¸ºæ¶‰åŠåˆ°çš„æŠ€æœ¯ç»„ä»¶æ¯”è¾ƒå¤šï¼Œå°±ä¸è¿‡å¤šè®¨è®ºç»†èŠ‚äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å¯ä»¥ä¿è¯çš„æ˜¯æåˆ°çš„æŠ€æœ¯æ ˆéƒ½æ˜¯æˆ‘æ‰€ç”¨è¿‡çš„ï¼Œä¼˜ç¼ºç‚¹éƒ½ä¼šæåˆ°ï¼Œä¸»æ‰“ä¸€ä¸ªçœŸå®ä½“éªŒã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="CloudNative" scheme="http://crossoverjie.top/tags/CloudNative/"/>
    
    <category term="k8s" scheme="http://crossoverjie.top/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ kubernetes ç¯å¢ƒä¸‹å¦‚ä½•ä¼˜é›…æ‰©ç¼©å®¹ Pulsar</title>
    <link href="http://crossoverjie.top/2024/03/27/ob/k8s-pulsar-scale/"/>
    <id>http://crossoverjie.top/2024/03/27/ob/k8s-pulsar-scale/</id>
    <published>2024-03-27T08:13:42.000Z</published>
    <updated>2024-03-29T03:16:45.501Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨æ•´ä¸ªå¤§ç¯å¢ƒçš„é™æœ¬å¢æ•ˆçš„ç†é™¶ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¾—ä¸åšå¥½åº”å¯¹æ–¹æ¡ˆã€‚</p><p>æ ¹æ®å¯¹çº¿ä¸Šæµé‡ã€å­˜å‚¨ä»¥åŠç³»ç»Ÿèµ„æºçš„å ç”¨ï¼Œå‘ç°æˆ‘ä»¬çš„ Pulsar é›†ç¾¤æœ‰è®¸å¤šçš„å†—ä½™ï¼Œæ‰€ä»¥è€ƒè™‘è¿›è¡Œç¼©å®¹ä»è€Œå‡å°‘èµ„æºæµªè´¹ï¼Œæœ€ç»ˆä¹Ÿèƒ½çœä¸€äº›è´¹ç”¨ã€‚</p><p>ä¸è¿‡åœ¨ç¼©å®¹ä¹‹å‰å¾ˆæœ‰å¿…è¦å…ˆèŠèŠæ‰©å®¹ï¼ŒPulsar ä¸€å¼€å§‹å°±æ˜¯å­˜ç®—åˆ†ç¦»çš„æ¶æ„ï¼ˆæ›´å¤šå…³äº Pulsar æ¶æ„çš„å†…å®¹æœ¬æ–‡ä¸åšè¿‡å¤šä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œæœç´¢ï¼‰ï¼Œå¤©ç„¶å°±éå¸¸é€‚åˆ kubernetes ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ <code>kubernetes</code> çš„èƒ½åŠ›è¿›è¡Œå¿«é€Ÿæ‰©å®¹ã€‚</p><span id="more"></span><h1 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h1><p>Pulsar çš„æ‰©å®¹ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œåœ¨ kubernetes ç¯å¢ƒä¸‹åªéœ€è¦ä¿®æ”¹å‰¯æœ¬å³å¯ã€‚</p><h2 id="Broker"><a href="#Broker" class="headerlink" title="Broker"></a>Broker</h2><p>å½“æˆ‘ä»¬çš„ broker å±‚å‡ºç°ç“¶é¢ˆæ—¶ï¼ˆæ¯”å¦‚ CPUã€å†…å­˜è´Ÿè½½è¾ƒé«˜ã€GC é¢‘ç¹æ—¶ï¼‰å¯ä»¥è€ƒè™‘æ‰©å®¹ã€‚</p><blockquote><p>è®¡ç®—å±‚éƒ½æ‰©å®¹äº†ï¼Œä¹Ÿéœ€è¦æ ¹æ®æµé‡è®¡ç®—ä¸‹å­˜å‚¨å±‚æ˜¯å¦å¤Ÿç”¨ã€‚</p></blockquote><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ helm å®‰è£…çš„ Pulsar é›†ç¾¤ï¼Œé‚£åªéœ€è¦ä¿®æ”¹å¯¹äºçš„å‰¯æœ¬æ•°å³å¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">broker:</span>  </span><br><span class="line">  <span class="string">configuration</span>  </span><br><span class="line">  <span class="attr">component:</span> <span class="string">broker</span>  </span><br><span class="line">  <span class="attr">replicaCount:</span> <span class="number">3</span><span class="string">-&gt;5</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å°†å‰¯æœ¬æ•°ä» 3 å¢åŠ åˆ° 5 ä¹‹å kubernetes ä¼šè‡ªåŠ¨æ‹‰èµ·æ–°å¢çš„ä¸¤ä¸ª Podï¼Œä¹‹åæˆ‘ä»¬å•¥ä¹Ÿä¸éœ€è¦åšäº†ã€‚</p><p>Pulsar çš„è´Ÿè½½å‡è¡¡å™¨ä¼šè‡ªåŠ¨æ„ŸçŸ¥åˆ°æ–°å¢ä¸¤ä¸ª broker çš„åŠ å…¥ï¼Œä»è€Œå¸®æˆ‘ä»¬å°†ä¸€äº›è´Ÿè½½é«˜çš„èŠ‚ç‚¹çš„æµé‡è¿ç§»åˆ°æ–°å¢çš„èŠ‚ç‚¹ä¸­ã€‚</p><h2 id="Bookkeeper"><a href="#Bookkeeper" class="headerlink" title="Bookkeeper"></a>Bookkeeper</h2><p>åœ¨ä»‹ç» bookkeeper æ‰©å®¹å‰å…ˆç®€å•ä»‹ç»äº› Bookkeeper çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p><ul><li>Ensemble size (E)ï¼šå½“å‰ Bookkeeper é›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡</li><li>Write quorum size (QW)ï¼šä¸€æ¡æ¶ˆæ¯éœ€è¦å†™å…¥åˆ°å‡ ä¸ª Bookkeeper èŠ‚ç‚¹ä¸­</li><li>ACK quorum size (QA)ï¼šæœ‰å¤šå°‘ä¸ª Bookkeeper èŠ‚ç‚¹ ACK ä¹‹åè¡¨ç¤ºå†™å…¥æˆåŠŸ</li></ul><p>å¯¹åº”åˆ°æˆ‘ä»¬åœ¨ <code>broker.conf</code> ä¸­çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">managedLedgerDefaultEnsembleSize</span>: <span class="string">&quot;2&quot;  </span></span><br><span class="line"><span class="attr">managedLedgerDefaultWriteQuorum</span>: <span class="string">&quot;2&quot;  </span></span><br><span class="line"><span class="attr">managedLedgerDefaultAckQuorum</span>: <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¸‰ä¸ªå‚æ•°è¡¨ç¤ºä¸€æ¡æ¶ˆæ¯éœ€è¦åŒæ—¶å†™å…¥ä¸¤ä¸ª Bookkeeper èŠ‚ç‚¹ï¼ŒåŒæ—¶éƒ½è¿”å› ACK ä¹‹åæ‰èƒ½è¡¨ç¤ºå½“å‰æ¶ˆæ¯å†™å…¥æˆåŠŸã€‚</p><p>ä»è¿™ä¸ªé…ç½®ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒBookkeeper æ˜¯å¤šå‰¯æœ¬å†™å…¥æ¨¡å‹ï¼Œé€‚å½“çš„é™ä½ QW å’Œ QA çš„æ•°é‡å¯ä»¥æé«˜å†™å…¥ååç‡ã€‚</p><p>å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ Bookkeeper æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ç„¶å E&#x2F;QW&#x2F;QA éƒ½é…ç½®ä¸º 2 å°±å¯ä»¥æ»¡è¶³æ¶ˆæ¯å¤šå‰¯æœ¬å†™å…¥äº†ã€‚</p><blockquote><p>å¤šå‰¯æœ¬å¯ä»¥ä¿è¯å½“æŸä¸ªèŠ‚ç‚¹å®•æœºåï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„æ¶ˆæ¯åœ¨å…¶ä»–èŠ‚ç‚¹ä¾ç„¶æœ‰å­˜æ”¾ï¼Œæ¶ˆæ¯è¯»å–ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p></blockquote><p>é‚£ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦æ‰©å®¹ Bookkeeper äº†ï¼Œå½“ç„¶å¦‚æœå•ä¸ª Bookkeeper çš„è´Ÿè½½è¾ƒé«˜ä¹Ÿæ˜¯å¯ä»¥æ‰©å®¹çš„ã€‚</p><p>ä½†æˆ‘ä»¬å½“æ—¶æ‰©å®¹ Bookkeeper çš„åœºæ™¯æ˜¯æƒ³åˆ©ç”¨ Pulsar çš„èµ„æºéš”ç¦»åŠŸèƒ½ã€‚</p><p>å› ä¸ºæœ‰éƒ¨åˆ†ä¸šåŠ¡çš„æ¶ˆæ¯é‡æ˜æ˜¾æ¯”é«˜äºå…¶ä»–çš„ topicï¼Œè¿™æ ·ä¼šå¯¼è‡´æŸä¸ª Broker çš„è´Ÿè½½è¾ƒé«˜ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½å½±å“åˆ°å…¶ä»–æ­£å¸¸çš„ topicã€‚</p><p>æœ€å¥½çš„æ–¹å¼å°±å°†è¿™éƒ¨åˆ†æ•°æ®ç”¨å•ç‹¬çš„ broker å’Œ Bookkeeper æ¥æ‰¿è½½ï¼Œä»è€Œå®ç°ç¡¬ä»¶èµ„æºçš„éš”ç¦»ã€‚</p><p>è¿™æ ·çš„éœ€æ±‚å¦‚æœä½¿ç”¨å…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—å¾€å¾€ä¸å¤ªå¥½å®ç°ï¼Œåˆ°åæ¥å¯èƒ½å°±ä¼šéƒ¨ç½²å¤šä¸ªé›†ç¾¤æ¥å®ç°éš”ç¦»ï¼Œä½†è¿™æ ·ä¹Ÿä¼šå¢åŠ è¿ç»´çš„å¤æ‚åº¦ã€‚</p><p>å¥½åœ¨ Pulsar å¤©ç„¶å°±æ”¯æŒèµ„æºéš”ç¦»ï¼Œåªéœ€è¦ä¸€ä¸ªé›†ç¾¤å°±å¯ä»¥å®ç°ä¸åŒ namespace çš„æµé‡éš”ç¦»ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥é¢å¤–æ‰©å®¹å‡ ä¸ª Bookkeeper èŠ‚ç‚¹ç”¨äºç‰¹å®šçš„ namespace ä½¿ç”¨ã€‚<br><img src="https://s2.loli.net/2024/02/27/qA89EUDHpxNmK7O.png"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼šæˆ‘ä»¬å¯ä»¥å°† broker å’Œ Bookkeeper åˆ†åˆ«è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå†é…ç½®å¯¹åº”çš„ namespaceï¼Œè¿™æ ·å°±èƒ½å®ç°èµ„æºéš”ç¦»äº†ã€‚</p><blockquote><p>æ›´å¤šå…³äºèµ„æºéš”ç¦»çš„ç»†èŠ‚æœ¬æ–‡å°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p></blockquote><p>é“ºå«äº†è¿™ä¹ˆå¤šï¼Œå…¶å® Bookkeeper çš„æ‰©å®¹ä¹Ÿè›®ç®€å•çš„ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bookkeeper:</span></span><br><span class="line">  <span class="attr">component:</span> <span class="string">bookie</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">    <span class="comment"># requests:</span></span><br><span class="line">    <span class="comment"># memory: 4Gi</span></span><br><span class="line">    <span class="comment"># cpu: 2</span></span><br><span class="line">  <span class="attr">replicaCount:</span> <span class="number">3</span><span class="string">-&gt;5</span></span><br></pre></td></tr></table></figure><p>å’Œ broker æ‰©å®¹ç±»ä¼¼ï¼Œæé«˜å‰¯æœ¬æ•°é‡åï¼ŒPulsar çš„å…ƒæ•°æ®ä¸­å¿ƒä¼šæ„ŸçŸ¥åˆ°æ–°çš„ Bookkeeper èŠ‚ç‚¹åŠ å…¥ï¼Œä»è€Œæ›´æ–° broker ä¸­çš„èŠ‚ç‚¹æ•°æ®ï¼Œè¿™æ ·å°±ä¼šæ ¹æ®æˆ‘ä»¬é…ç½®çš„éš”ç¦»ç­–ç•¥åˆ†é…æµé‡ã€‚</p><h1 id="ç¼©å®¹"><a href="#ç¼©å®¹" class="headerlink" title="ç¼©å®¹"></a>ç¼©å®¹</h1><p>å…¶å®æœ¬æ–‡çš„é‡ç‚¹åœ¨äºç¼©å®¹ï¼Œç‰¹åˆ«æ˜¯ Bookkeeper çš„ç¼©å®¹ï¼Œè¿™éƒ¨åˆ†å†…å®¹æˆ‘åœ¨äº’è”ç½‘ä¸Šå¾ˆå°‘çœ‹åˆ°æœ‰äººæåŠã€‚</p><h2 id="Broker-1"><a href="#Broker-1" class="headerlink" title="Broker"></a>Broker</h2><p>Broker çš„ç¼©å®¹ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå­˜ç®—åˆ†ç¦»çš„ç‰¹ç‚¹ï¼šbroker ä½œä¸ºè®¡ç®—å±‚æ˜¯æ— çŠ¶æ€çš„ï¼Œå¹¶ä¸æ‰¿è½½ä»»ä½•çš„æ•°æ®ã€‚</p><blockquote><p>å…¶å®æ˜¯æ‰¿è½½æ•°æ®çš„ï¼Œåªæ˜¯ Pulsar ä¼šè‡ªåŠ¨è¿ç§»æ•°æ®ï¼Œä»è€Œä½“æ„Ÿä¸Šè§‰å¾—æ˜¯æ— çŠ¶æ€çš„ã€‚</p></blockquote><p>åªæ˜¯å½“ä¸€ä¸ª broker ä¸‹çº¿åï¼Œå®ƒä¸Šé¢æ‰€ç»‘å®šçš„ topic ä¼šè‡ªåŠ¨è½¬ç§»åˆ°å…¶ä»–åœ¨çº¿çš„ broker ä¸­ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¼šå¯¼è‡´è¿æ¥äº†è¿™ä¸ª broker çš„ client è§¦å‘é‡è¿ï¼Œä»è€ŒçŸ­æš‚çš„å½±å“ä¸šåŠ¡ã€‚</p><blockquote><p>æ­£å› ä¸º broker çš„ä¸‹çº¿ä¼šå¯¼è‡´ topic çš„å½’å±å‘ç”Ÿè½¬ç§»ï¼Œæ‰€ä»¥åœ¨ä¸‹çº¿å‰æœ€å¥½æ˜¯å…ˆé€šè¿‡ç›‘æ§é¢æ¿è§‚å¯Ÿéœ€è¦ä¸‹çº¿çš„ broker topic æ˜¯å¦è¿‡å¤šï¼Œå¦‚æœè¿‡å¤šåˆ™å¯ä»¥å…ˆæ‰‹åŠ¨ unload ä¸€äº›æ•°æ®ï¼Œå°½é‡é¿å…ä¸€æ¬¡æ€§å¤§æ‰¹é‡çš„æ•°æ®è½¬ç§»ã€‚</p></blockquote><p><img src="https://s2.loli.net/2024/02/27/1SzKpNiACdZIbrq.png" alt="image.png"></p><blockquote><p>è§‚å¯Ÿå„ä¸ªbroker çš„ topic æ•°é‡</p></blockquote><h2 id="Bookkeeper-1"><a href="#Bookkeeper-1" class="headerlink" title="Bookkeeper"></a>Bookkeeper</h2><p>è€Œ Bookkeeper çš„ç¼©å®¹åˆ™æ²¡é‚£ä¹ˆå®¹æ˜“äº†ï¼Œç”±äºå®ƒæ˜¯ä½œä¸ºå­˜å‚¨å±‚ï¼Œæœ¬èº«æ˜¯æœ‰çŠ¶æ€çš„ï¼Œä¸‹çº¿åèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ•°æ®æ˜¯éœ€è¦è¿ç§»åˆ°å…¶ä»–çš„ Bookkeeper èŠ‚ç‚¹ä¸­çš„ã€‚</p><p>ä¸ç„¶å°±æ— æ³•æ»¡è¶³ä¹‹å‰æåˆ°çš„ Write quorum size (QW) è¦æ±‚ï¼›å› æ­¤ç¼©å®¹è¿˜æœ‰ä¸€ä¸ªæ½œåœ¨æ¡ä»¶éœ€è¦æ»¡è¶³ï¼š</p><p>ç¼©å®¹åçš„ Bookkeeper èŠ‚ç‚¹æ•°é‡éœ€è¦å¤§äºbroker ä¸­çš„é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">managedLedgerDefaultEnsembleSize</span>: <span class="string">&quot;2&quot;  </span></span><br><span class="line"><span class="attr">managedLedgerDefaultWriteQuorum</span>: <span class="string">&quot;2&quot;  </span></span><br><span class="line"><span class="attr">managedLedgerDefaultAckQuorum</span>: <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure><p>ä¸ç„¶å†™å…¥ä¼šå¤±è´¥ï¼Œæ•´ä¸ªé›†ç¾¤å°†å˜å¾—ä¸å¯ç”¨ã€‚</p><p>Pulsar æä¾›äº†ä¸¤ç§ Bookkeeper çš„ä¸‹çº¿æ–¹æ¡ˆï¼š</p><h3 id="ä¸éœ€è¦è¿ç§»æ•°æ®"><a href="#ä¸éœ€è¦è¿ç§»æ•°æ®" class="headerlink" title="ä¸éœ€è¦è¿ç§»æ•°æ®"></a>ä¸éœ€è¦è¿ç§»æ•°æ®</h3><p>å…¶å®ä¸¤ç§æ–¹æ¡ˆä¸»è¦åŒºåˆ«åœ¨äºæ˜¯å¦éœ€è¦è¿ç§»æ•°æ®ï¼Œç¬¬ä¸€ç§æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä¸è¿ç§»æ•°æ®çš„æ–¹æ¡ˆã€‚</p><p>é¦–å…ˆéœ€è¦å°† Bookkeeper è®¾ç½®ä¸º read-only çŠ¶æ€ï¼Œæ­¤æ—¶è¯¥èŠ‚ç‚¹å°†ä¸ä¼šæ¥å—å†™è¯·æ±‚ï¼Œç›´åˆ°è¿™ä¸ª Bookkeeper ä¸Šçš„æ•°æ®å…¨éƒ¨è¿‡æœŸè¢«å›æ”¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰‹åŠ¨ä¸‹çº¿è¯¥èŠ‚ç‚¹ã€‚</p><p>ä½¿ç”¨ <code>forceReadOnlyBookie=true</code> å¯ä»¥å¼ºåˆ¶å°† Bookkeeper è®¾ç½®ä¸ºåªè¯»ã€‚</p><p>ä½†è¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>ä¸‹çº¿æ—¶é—´ä¸ç¡®å®šï¼Œå¦‚æœè¯¥ <code>Bookkeeper</code> ä¸Šå­˜å‚¨çš„æ•°æ®ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œåˆ™æ— æ³•é¢„ä¼°ä»€ä¹ˆæ—¶å€™å¯ä»¥ä¸‹çº¿è¯¥èŠ‚ç‚¹ã€‚</li><li>è¯¥é…ç½®ä¿®æ”¹åéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼Œåœ¨ kubernetes ç¯å¢ƒä¸­è¿™äº›é…ç½®éƒ½æ˜¯å†™åœ¨äº† configmap ä¸­ï¼Œä¸€æ—¦åˆ·æ–°åæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šè¯»å–åˆ°è¯¥é…ç½®ï¼Œæ— æ³•é’ˆå¯¹æŸä¸€ä¸ªèŠ‚ç‚¹ç”Ÿæ•ˆï¼›æ‰€ä»¥å¯èƒ½ä¼šå‡ºç°å°†ä¸è¯¥ä¸‹çº¿çš„èŠ‚ç‚¹è®¾ç½®ä¸ºäº†åªè¯»çŠ¶æ€ã€‚</li></ul><p>ä½†è¯¥æ–¹æ¡ˆçš„å¥½å¤„æ˜¯ä¸éœ€è¦è¿ç§»æ•°æ®ï¼Œäººå·¥ä»‹å…¥çš„æµç¨‹å°‘ï¼ŒåŒæ ·ä¹Ÿå°±å‡å°‘äº†å‡ºé”™çš„å¯èƒ½ã€‚</p><p>æ¯”è¾ƒé€‚åˆäºç”¨è™šæ‹Ÿæœºéƒ¨ç½²çš„é›†ç¾¤ã€‚</p><h3 id="è¿ç§»æ•°æ®"><a href="#è¿ç§»æ•°æ®" class="headerlink" title="è¿ç§»æ•°æ®"></a>è¿ç§»æ•°æ®</h3><p>ç¬¬äºŒç§å°±æ˜¯éœ€è¦è¿ç§»æ•°æ®çš„æ–¹æ¡ˆï¼Œæ›´é€‚ç”¨äº kubernetes ç¯å¢ƒã€‚</p><h4 id="è¿ç§»åŸç†"><a href="#è¿ç§»åŸç†" class="headerlink" title="è¿ç§»åŸç†"></a>è¿ç§»åŸç†</h4><p>å…ˆæ¥çœ‹çœ‹è¿ç§»çš„åŸç†ï¼š</p><ol><li>å½“ bookkeeper åœæœºåï¼ŒAutoRecovery Auditor ä¼šæ£€æµ‹åˆ° zookeeper èŠ‚ç‚¹<code>/ledger/available</code> å‘ç”Ÿå˜åŒ–ï¼Œå°†ä¸‹çº¿èŠ‚ç‚¹çš„ ledger ä¿¡æ¯å†™å…¥åˆ° zookeeper çš„ <code>/ledgers/underreplicated</code> èŠ‚ç‚¹ä¸­ã€‚</li><li>AutoRecoveryÂ ReplicationWorkerÂ ä¼šæ£€æµ‹ <code>/ledgers/underreplicated</code>èŠ‚ç‚¹ä¿¡æ¯ï¼Œç„¶åè½®è®­è¿™äº› ledger ä¿¡æ¯ä»å…¶ä»–åœ¨çº¿çš„ BK ä¸­å¤åˆ¶æ•°æ®åˆ°æ²¡æœ‰è¯¥æ•°æ®çš„èŠ‚ç‚¹ï¼Œä¿è¯ QW æ•°é‡ä¸å˜ã€‚<ol><li>æ¯å¤åˆ¶ä¸€æ¡æ•°æ®åéƒ½ä¼šåˆ é™¤ <code>/ledgers/underreplicated</code> èŠ‚ç‚¹ä¿¡æ¯ã€‚</li><li>æ‰€æœ‰ <code>/ledgers/underreplicated</code> è¢«åˆ é™¤åè¯´æ˜è¿ç§»ä»»åŠ¡å®Œæˆã€‚</li></ol></li><li>æ‰§è¡Œ <code>bin/bookkeeper shell decommissionbookie</code> ä¸‹çº¿å‘½ä»¤ï¼š<ol><li>ä¼šç­‰å¾… <code>/ledgers/underreplicated</code> å…¨éƒ¨åˆ é™¤</li><li>Â ç„¶ååˆ é™¤ zookeeper ä¸­çš„å…ƒæ•°æ®</li><li>å…ƒæ•°æ®åˆ é™¤å bookkeeper æ‰æ˜¯çœŸæ­£ä¸‹çº¿æˆåŠŸï¼Œæ­¤æ—¶ broker æ‰ä¼šæ„ŸçŸ¥åˆ° Bookkeeper ä¸‹çº¿ã€‚</li></ol></li></ol><p><code>AutoRecovery</code> æ˜¯ Bookkeeper æä¾›çš„ä¸€ä¸ªè‡ªåŠ¨æ¢å¤ç¨‹åºï¼Œä»–ä¼šåœ¨åå°æ£€æµ‹æ˜¯å¦æœ‰æ•°æ®éœ€è¦è¿ç§»ã€‚</p><blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯å½“æŸä¸ªBookkeeper åœæœºåï¼Œå®ƒä¸Šé¢æ‰€å­˜å‚¨çš„ ledgerID ä¼šè¢«å†™å…¥åˆ°å…ƒæ•°æ®ä¸­å¿ƒï¼Œæ­¤æ—¶ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰«æè¿™äº›éœ€è¦è¿ç§»çš„æ•°æ®ï¼Œæœ€ç»ˆå°†è¿™äº›æ•°æ®å†™å…¥åˆ°å…¶ä»–åœ¨çº¿çš„ Bookkeeper èŠ‚ç‚¹ã€‚</p></blockquote><p>Bookkeeper ä¸­çš„ä¸€äº›å…³é”®ä»£ç ï¼š<br><img src="https://s2.loli.net/2024/02/27/QqtYUBvadWpDmnR.png" alt="image.png"><br><img src="https://s2.loli.net/2024/02/27/gi9JLdMmYxunHTE.png" alt="image.png"></p><h4 id="ä¸‹çº¿æ­¥éª¤"><a href="#ä¸‹çº¿æ­¥éª¤" class="headerlink" title="ä¸‹çº¿æ­¥éª¤"></a>ä¸‹çº¿æ­¥éª¤</h4><p>ä¸‹é¢æ¥çœ‹å…·ä½“çš„ä¸‹çº¿æµç¨‹ï¼š</p><ol><li>å‰¯æœ¬æ•°-1<ol><li><code>bin/bookkeeper shell listunderreplicated</code> æ£€æµ‹æœ‰å¤šå°‘ ledger éœ€è¦è¢«è¿ç§»</li></ol></li><li>æ‰§è¡Œè¿œç¨‹ä¸‹çº¿å…ƒæ•°æ®<ol><li><code>nohup bin/bookkeeper shell decommissionbookie -bookieid bkid:3181 &gt; bk.log 2&gt;&amp;1 &amp;</code></li><li>è¿™ä¸ªå‘½ä»¤ä¼šä¸€ç›´åå°è¿è¡Œç­‰å¾…æ•°æ®è¿ç§»å®Œæˆï¼Œæ¯”è¾ƒè€—æ—¶</li></ol></li><li>æŸ¥çœ‹ä¸‹çº¿èŠ‚ç‚¹æ˜¯å¦å·²è¢«å‰”é™¤<ol><li><code>bin/bookkeeper shell listbookies -a</code></li></ol></li><li>å¾ªç¯ç¬¬ä¸€æ­¥</li></ol><p>ç¬¬ä¸€æ­¥æ˜¯æ£€æµ‹ä¸€äº›ç°åœ¨æœ‰å¤šå°‘æ•°æ®éœ€è¦è¿ç§»ï¼š<br><code>bin/bookkeeper shell listunderreplicated</code> å‘½ä»¤æŸ¥çœ‹éœ€è¦è¢«è¿ç§»çš„ ledger æ•°æ®ä¹Ÿæ˜¯æ¥è‡ªäº <code>/ledgers/underreplicated</code>èŠ‚ç‚¹<br><img src="https://s2.loli.net/2024/02/27/FiWJ8b27QD6w5E1.png" alt="image.png"></p><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹æ˜¯ 0</p></blockquote><p>ç¬¬äºŒæ­¥çš„å‘½ä»¤ä¼šç­‰å¾…æ•°æ®è¿ç§»å®Œæˆåä» zookeeper ä¸­åˆ é™¤èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿™ä¸ªè¿›ç¨‹é€€å‡ºåè¡¨ç¤ºä¸‹çº¿æˆåŠŸã€‚</p><p><img src="https://s2.loli.net/2024/02/27/TuK7FPXCm1fcgJS.png" alt="image.png"></p><blockquote><p>è¿™ä¸ªå‘½ä»¤æœ€å¥½æ˜¯åå°æ‰§è¡Œï¼Œå¹¶è¾“å‡ºæ—¥å¿—åˆ°ä¸“é—¨çš„æ–‡ä»¶ï¼Œå› ä¸ºå‘¨æœŸè¾ƒé•¿ï¼Œå¾ˆæœ‰å¯èƒ½ç»ˆç«¯ä¼šè¯å·²ç»è¶…æ—¶äº†ã€‚</p></blockquote><p>æˆ‘ä»¬ç™»å½• zookeeper å¯ä»¥çœ‹åˆ°éœ€è¦è¿ç§»çš„ ledger æ•°æ®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/pulsar zookeeper-shell -server pulsar-zookeeper:2181</span><br><span class="line"></span><br><span class="line">get /ledgers/underreplication/ledgers/0000/0000/0000/0002/urL0000000002</span><br><span class="line">replica: &quot;pulsar-test-2-bookie-0.pulsar-test-2-bookie.pulsar-test-2.svc.cluster.local:3181&quot;</span><br><span class="line">ctime: 1708507296519</span><br></pre></td></tr></table></figure><p>underreplication çš„èŠ‚ç‚¹è·¯å¾„ä¸­å­˜æ”¾äº† ledgerIdï¼Œé€šè¿‡ ledgerId è®¡ç®—è·¯å¾„ï¼š<br><img src="https://s2.loli.net/2024/02/27/bAx8nqeKQT7F4HV.png"><br><img src="https://s2.loli.net/2024/02/27/GiVlDP2M85pafAO.png"></p><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><p>ä¸‹çº¿è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ <code>nohup bin/bookkeeper shell decommissionbookie -bookieid bkid:3181 &gt; bk.log 2&gt;&amp;1 &amp;</code>è¿™ä¸ªå‘½ä»¤å†™å…¥çš„æ—¥å¿—æ¥ç¡®è®¤è¿ç§»çš„è¿›åº¦ï¼Œæ—¥å¿—ä¸­ä¼šæ‰“å°å½“å‰è¿˜æœ‰å¤šå°‘æ•°é‡çš„ ledger æ²¡æœ‰è¿ç§»ã€‚</p><p>åŒæ—¶éœ€è¦è§‚å¯Ÿ zookeeperã€Bookkeeper çš„èµ„æºå ç”¨æƒ…å†µã€‚</p><p>å› ä¸ºè¿ç§»è¿‡ç¨‹ä¸­å†™å…¥å¤§é‡æ•°æ®åˆ° zookeeper èŠ‚ç‚¹ï¼ŒåŒæ—¶è¿ç§»æ•°æ—¶ä¹Ÿä¼šæœ‰å¤§é‡æµé‡å†™å…¥ Bookkeeperã€‚</p><p>ä¸è¦è®©è¿ç§»è¿‡ç¨‹å½±å“åˆ°äº†æ­£å¸¸çš„ä¸šåŠ¡ä½¿ç”¨ã€‚</p><p>æ ¹æ®æˆ‘çš„è¿ç§»ç»éªŒæ¥çœ‹ï¼Œé€šå¸¸ 2w çš„ledger æ•°æ®éœ€è¦ 2ï½3 å°æ—¶ä¸ç­‰çš„æ—¶é—´ï¼Œå…·ä½“æƒ…å†µè¿˜å¾—æ ¹æ®ä½ çš„é›†ç¾¤æ¥ç¡®è®¤ã€‚</p><h4 id="å›æ»šæ–¹æ¡ˆ"><a href="#å›æ»šæ–¹æ¡ˆ" class="headerlink" title="å›æ»šæ–¹æ¡ˆ"></a>å›æ»šæ–¹æ¡ˆ</h4><p>å½“ç„¶ä¸‡ä¸€è¿ç§»æ¯”è¾ƒè€—æ—¶ï¼Œæˆ–è€…å½±å“äº†ä¸šåŠ¡ä½¿ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦æœ‰ä¸€ä¸ªå›æ»šæ–¹æ¡ˆï¼š</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¤§çš„å‰æï¼š<br><strong>åªè¦ BK èŠ‚ç‚¹å…ƒæ•°æ®ã€PVCï¼ˆä¹Ÿå°±æ˜¯ç£ç›˜ä¸­çš„æ•°æ®ï¼‰ æ²¡æœ‰è¢«åˆ é™¤å°±å¯ä»¥è¿›è¡Œå›æ»šã€‚</strong></p><p>æ‰€ä»¥åªè¦ä¸Šè¿°çš„ decommissionbookie å‘½ä»¤æ²¡æœ‰å®Œå…¨æ‰§è¡Œå®Œæ¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰‹åŠ¨ kill è¯¥è¿›ç¨‹ï¼Œç„¶åæ¢å¤å‰¯æœ¬æ•°æ®ã€‚</p><p>è¿™æ ·æ¢å¤çš„ Bookkeeper èŠ‚ç‚¹ä¾ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼ŒåŒæ—¶æ•°æ®ä¹Ÿè¿˜å­˜åœ¨ï¼›åªæ˜¯æµªè´¹äº†ä¸€äº› autorecovery çš„èµ„æºã€‚</p><p>æœ€åå½“ bookkeeper æˆåŠŸä¸‹çº¿åï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤ PVCï¼Œä¸ç„¶å¦‚æœä»Šåéœ€è¦æ‰©å®¹çš„æ—¶å€™æ˜¯æ— æ³•å¯åŠ¨ bookkeeper çš„ï¼Œå› ä¸ºåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­æŒ‚è½½çš„ç£ç›˜æ˜¯å¦æœ‰æ•°æ®ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»çš„æ¥è¯´ Pulsar çš„æ‰©ç¼©å®¹è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œåªæ˜¯å¯¹äºæœ‰çŠ¶æ€èŠ‚ç‚¹çš„æ•°æ®è¿ç§»ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†åªè¦è·Ÿç€æµç¨‹èµ°å°±ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li><a href="https://pulsar.apache.org/docs/next/administration-isolation/">https://pulsar.apache.org/docs/next/administration-isolation/</a></li><li><a href="https://bookkeeper.apache.org/docs/4.13.0/admin/decomission">https://bookkeeper.apache.org/docs/4.13.0/admin/decomission</a></li><li><a href="https://bookkeeper.apache.org/docs/4.13.0/admin/autorecovery">https://bookkeeper.apache.org/docs/4.13.0/admin/autorecovery</a></li></ul><p>#Blog #Pulsar </p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;åœ¨æ•´ä¸ªå¤§ç¯å¢ƒçš„é™æœ¬å¢æ•ˆçš„ç†é™¶ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¾—ä¸åšå¥½åº”å¯¹æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®å¯¹çº¿ä¸Šæµé‡ã€å­˜å‚¨ä»¥åŠç³»ç»Ÿèµ„æºçš„å ç”¨ï¼Œå‘ç°æˆ‘ä»¬çš„ Pulsar é›†ç¾¤æœ‰è®¸å¤šçš„å†—ä½™ï¼Œæ‰€ä»¥è€ƒè™‘è¿›è¡Œç¼©å®¹ä»è€Œå‡å°‘èµ„æºæµªè´¹ï¼Œæœ€ç»ˆä¹Ÿèƒ½çœä¸€äº›è´¹ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡åœ¨ç¼©å®¹ä¹‹å‰å¾ˆæœ‰å¿…è¦å…ˆèŠèŠæ‰©å®¹ï¼ŒPulsar ä¸€å¼€å§‹å°±æ˜¯å­˜ç®—åˆ†ç¦»çš„æ¶æ„ï¼ˆæ›´å¤šå…³äº Pulsar æ¶æ„çš„å†…å®¹æœ¬æ–‡ä¸åšè¿‡å¤šä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œæœç´¢ï¼‰ï¼Œå¤©ç„¶å°±éå¸¸é€‚åˆ kubernetes ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ &lt;code&gt;kubernetes&lt;/code&gt; çš„èƒ½åŠ›è¿›è¡Œå¿«é€Ÿæ‰©å®¹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
  <entry>
    <title>é¡¶çº§å¼€æºç¤¾åŒºéƒ½èƒ½åµèµ·æ¥ï¼Ÿ</title>
    <link href="http://crossoverjie.top/2024/03/20/ob/about-opensource-argument/"/>
    <id>http://crossoverjie.top/2024/03/20/ob/about-opensource-argument/</id>
    <published>2024-03-20T03:15:51.000Z</published>
    <updated>2024-03-21T14:08:20.204Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h1><p>å› ä¸ºè®¢é˜…äº† Pulsar çš„å¼€å‘è€…é‚®ä»¶ï¼Œå‰æ®µæ—¶é—´çœ‹åˆ°ä¸€å°æ ‡é¢˜ä¸º<a href="https://lists.apache.org/thread/gzx4j9q0xdtcvrfvvq72t9tm2rt9h3r7">ã€Š(Apache committer criteria) [ANNOUNCE] New Committer: Asaf Mesikaã€‹</a>çš„é‚®ä»¶ã€‚</p><p>ä¹ä¸€çœ‹ä»¥ä¸ºæ˜¯æ¬¢è¿ <code>Asaf Mesika</code> æˆä¸º Committerï¼Œä½†ä»”ç»†ä¸€çœ‹ä¸å¤ªå¯¹åŠ²ï¼Œè¿™å†…å®¹ä¹Ÿå¤ªå¤šäº†ï¼Œä»¥å¾€çš„æ¬¢è¿éƒ½æ˜¯ç®€å•çš„ <code>Congratulations!</code> ä½œä¸ºå›å¤ï¼Œè¿™ç¯‡å†…å®¹æ˜æ˜¾æœ‰ç‚¹å¤šäº†ï¼Œäºæ˜¯ä¾¿ä»”ç»†çœ‹äº†ä¸‹ã€‚</p><span id="more"></span><p><img src="https://s2.loli.net/2024/03/20/aASNcDpnwVIjHFv.png"></p><h1 id="äº‰è®º"><a href="#äº‰è®º" class="headerlink" title="äº‰è®º"></a>äº‰è®º</h1><p>å¤§æ¦‚çš„æ„æ€æ˜¯è¿™å°é‚®ä»¶çš„ä½œè€… <code>Kalwit</code> å¯¹æˆä¸º Committer çš„æ ‡å‡†äº§ç”Ÿäº†ç–‘é—®ï¼š</p><blockquote><p>ä»–è§‰å¾—æœ¬æ¬¡æåæˆä¸º Committer çš„å¤§éƒ¨åˆ†è´¡çŒ®éƒ½æ˜¯ä¸€äº›æ–‡æ¡£ç›¸å…³çš„å†…å®¹ï¼Œè¿˜æœ‰å°‘éƒ¨åˆ†æ˜¯ä¸ç›‘æ§ç›¸å…³çš„ææ¡ˆã€‚<br>ä»–ä»¬å›¢é˜Ÿä½¿ç”¨ Pulsar æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä½†ç›®å‰è¿˜æœªå‘ç°ç¨³å®šçš„ Pulsar ç‰ˆæœ¬ï¼›å¤§éƒ¨åˆ†çš„ Review éƒ½æ˜¯æ¥è‡ªåŒä¸€å…¬å¸ï¼ˆstreamnativeï¼‰ã€‚<br>çœ‹èµ·æ¥æ˜¯æ•´ä¸ª Pulsar é¡¹ç›®ç”±æŸä¸€å®¶å…¬å¸æ§åˆ¶äº†ï¼Œä»–ä»¬å½“åˆé€‰æ‹©ä» Kafka åˆ‡æ¢åˆ° Pulsar å°±æ˜¯å› ä¸º Kafka ç”± Confluent æ§åˆ¶ï¼Œæ‰é€‰æ‹©ä¸€ä¸ªæ›´åŠ å¼€æ”¾çš„ç¤¾åŒºã€‚</p></blockquote><p>è¿™æ ·çš„ä¸€å°æœ‰ç€â€œè®¨ä¼â€æ„å‘³çš„é‚®ä»¶ä¸€ç»å‘å‡ºï¼Œè‡ªç„¶æ˜¯ä¸€çŸ³æ¿€èµ·åƒå±‚æµªï¼Œç¤¾åŒºé‡Œå¾ˆå¤šæˆå‘˜éƒ½å‘è¡¨äº†å›å¤ã€‚</p><p>è¿™é‡Œæˆ‘æŒ‘é€‰äº†å‡ ä¸ªä»£è¡¨æ€§çš„å›å¤ï¼š<br><img src="https://s2.loli.net/2024/03/21/8ZEBJrVpiW6KYXk.png"><br>å¤§æ¦‚æ„æ€å°±æ˜¯ Pulsar æ˜¯ä¸€ä¸ªå¼€æ”¾æ€§é¡¹ç›®ï¼Œä»»ä½•äººéƒ½å¯ä»¥å‚åŠ ï¼Œæ¯ä¸¤å‘¨ä¹Ÿæœ‰ Zoom ä¼šè®®ï¼Œä¹Ÿæ˜¯æ¯ä¸ªäººéƒ½å¯ä»¥å‚åŠ ã€‚</p><p>åœ¨è¿œç¨‹çš„ç¤¾åŒºå¼‚æ­¥æ²Ÿé€šè¿‡ç¨‹ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½ä½ çš„è¯·æ±‚æ²¡æœ‰å¾—åˆ°åŠæ—¶çš„å“åº”ï¼Œè¿™å¾ˆæ­£å¸¸ã€‚</p><p>Pulsar æ˜¯ç”±ç¤¾åŒºå¼€å‘è´Ÿè´£ç»´æŠ¤çš„ï¼Œæ²¡æœ‰å…¬å¸å¯¹æ­¤è´Ÿè´£ï¼Œå› æ­¤æ²¡æœ‰å¾—åˆ°å“åº”æ—¶æ˜¯æ²¡æœ‰å…¬å¸å¯ä»¥è´£æ€ªçš„ï¼›éœ€è¦å¤§å®¶ä¸€èµ·æ¥è§£å†³é—®é¢˜ï¼Œå¹¶ä¸ä¸€å®šæ˜¯éœ€è¦ PMCï¼ˆé¡¹ç›®ç®¡ç†å§”å‘˜ä¼šæˆå‘˜ï¼‰è¿˜æ˜¯ committeræ‰èƒ½æå‡ºæ„è§ï¼Œä»»ä½•äººéƒ½å¯ä»¥å‘è¡¨è‡ªå·±çš„çœ‹æ³•ã€‚</p><p>ä½†è¿™ä¸ªè¿‡ç¨‹ä¸­å¤§å®¶çš„èº«ä»½éƒ½æ˜¯å¿—æ„¿è€…ï¼Œéœ€è¦å¤§å®¶è‡ªå‘çš„å»åšè¿™äº›äº‹æƒ…ã€‚</p><p>åç»­ Kalwit åˆç»§ç»­å›å¤äº†ä¸€äº›é‚®ä»¶ï¼Œæ€»ä½“å†…å®¹å°±æ˜¯å¯¹ç¤¾åŒºæ²»ç†å­˜åœ¨ç–‘æƒ‘ï¼›ç‰¹åˆ«æ˜¯æ‹…å¿ƒç¤¾åŒºèƒŒåç”±æŸä¸€å®¶å…¬å¸ä½œä¸ºä¸»å¯¼ï¼Œä»è€Œå¯¼è‡´ç¤¾åŒºå’Œå…¬å¸çš„åˆ©ç›Šè¿›è¡Œç»‘å®šã€‚</p><p>å½“ç„¶ç¤¾åŒºçš„è§‚ç‚¹ä¾ç„¶æ˜¯ï¼ŒPulsar ç¤¾åŒºä¸å—æŸä¸€å…·ä½“å…¬å¸æŒæ§ï¼Œå¹¶ä¸¾äº†å…·ä½“æ•°æ®ï¼š<br><img src="https://s2.loli.net/2024/03/21/UDiRHjMWdO8xsSI.png"><br>åœ¨ 41 ä¸ª PMC æˆå‘˜ä¸­ï¼Œåªæœ‰ 9 ä½æ˜¯ StreamNative çš„å‘˜å·¥ï¼Œ41 ä½ committer ä¸­æœ‰ 13 ä½æ˜¯ StreamNative çš„å‘˜å·¥ã€‚</p><blockquote><p>å…¶å®ä»¥æˆ‘ç›®å‰åœ¨ç¤¾åŒºçš„è§‚æ„Ÿï¼Œç¡®å®æ˜¯ streamnative å…¬å¸ç¤¾åŒºç»´æŠ¤è€…æ›´åŠ æ´»è·ƒï¼Œå…¶ä»–çš„ä¸€äº› committer å¯èƒ½ç”±äºå·¥ä½œå˜åŠ¨å•¥çš„å¾ˆå°‘å†è´¡çŒ®é¡¹ç›®äº†ã€‚</p></blockquote><h2 id="ææ¡ˆè¢«å¦"><a href="#ææ¡ˆè¢«å¦" class="headerlink" title="ææ¡ˆè¢«å¦"></a>ææ¡ˆè¢«å¦</h2><p><code>Kalwit</code> ä¸¾äº†ä¸€äº›ä¾‹å­è®¤ä¸ºè¿™äº› PIP ææ¡ˆæ²¡æœ‰è·å¾—é€šè¿‡ï¼Œä½†æ˜¯ SN å›¢é˜Ÿæå‡ºçš„ææ¡ˆå¤§éƒ¨åˆ†éƒ½èƒ½é€šè¿‡ã€‚</p><p>æˆ‘è§‰å¾—è¿™ç¡®å®æ˜¯ä¸€ç§å®¢è§‚ç°è±¡ï¼Œä½†å¯èƒ½æ›´å¤šçš„åŸå› å¹¶ä¸æ˜¯ SN å…¬å¸æƒ³è¦ä¸»å¯¼ Pulsar ç¤¾åŒºçš„è¿›å±•ï¼Œè€Œæ˜¯ä»–ä»¬åœ¨ç¤¾åŒºä¹‹å¤–ï¼ˆä¸ç®¡æ˜¯çº¿ä¸Šè¿˜æ˜¯çº¿ä¸‹ï¼‰è¿›è¡Œè¿‡é¢å¤–çš„æ²Ÿé€šï¼Œä¹Ÿè®¸åœ¨æäº¤è‰æ¡ˆä¹‹å‰å°±å·²ç»è¾¾æˆäº†åˆæ­¥ä¸€è‡´äº†ï¼Œæ‰€ä»¥åœ¨ææ¡ˆå®¡æ ¸é˜¶æ®µåªéœ€è¦åšä¸€äº›å…·ä½“çš„è°ƒæ•´å°±å¾ˆå®¹æ˜“è¢«é€šè¿‡ã€‚</p><p>æˆ‘è‡ªå·±ä¹Ÿæè¿‡ä¸€äº›ææ¡ˆï¼Œå¤§æ¦‚æäº¤äº†ä¸‰ä¸ªåªæœ‰ä¸€ä¸ªé€šè¿‡äº†ï¼›æˆ‘ä¸ªäººçš„æ„Ÿå—æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­å“åº”æ—¶é—´ç¡®å®ä¸å¯æ§ï¼ˆæ¯•ç«Ÿæ˜¯å¼‚æ­¥æ²Ÿé€šï¼‰ï¼Œä½†å¹¶ä¸ä¼šå­˜åœ¨æŸä¸ªå›¢é˜Ÿæƒ³è¦æ§åˆ¶å“ªäº›ææ¡ˆå¯ä»¥é€šè¿‡ï¼Œå“ªäº›ææ¡ˆä¸è¡Œçš„è¿™ç§è¯´æ³•ã€‚</p><p>éƒ½æ˜¯åœ¨å°±äº‹è®ºäº‹çš„è®¨è®ºäº‹æƒ…ï¼Œè€Œä¸”ä¸é€šè¿‡çš„è¯ä¹Ÿä¼šç”±ç›¸å…³çš„å›å¤å’Œå»ºè®®ï¼Œç¡®å®å¤§éƒ¨åˆ†æƒ…å†µä¹Ÿæ˜¯æˆ‘è€ƒè™‘ä¸å‘¨ã€‚</p><p>æˆ‘ä¹Ÿçœ‹è¿‡ asafm çš„è´¡çŒ®ï¼Œå…¶ä¸­å…³äº Pulsar é›†æˆ <a href="https://github.com/apache/pulsar/pull/21080">OpenTelemetry</a> çš„ææ¡ˆç¡®å®æ˜¯ä¸‹äº†åŠŸå¤«çš„ï¼ˆä¸€ä¸‡å¤šå­—çš„å†…å®¹ï¼‰ï¼Œä»å¤´è®²è§£äº† OpenTelemetry çš„æ¦‚å¿µï¼Œä»¥åŠ Pulsar éœ€è¦åšå“ªäº›äº‹æƒ…æ¥é›†æˆã€‚</p><h1 id="ä¸ªäººæ„Ÿå—"><a href="#ä¸ªäººæ„Ÿå—" class="headerlink" title="ä¸ªäººæ„Ÿå—"></a>ä¸ªäººæ„Ÿå—</h1><h2 id="å‚å•†ç»‘å®š"><a href="#å‚å•†ç»‘å®š" class="headerlink" title="å‚å•†ç»‘å®š"></a>å‚å•†ç»‘å®š</h2><p>çœ‹å®Œä¹‹åæˆ‘ä¸ªäººçš„æ„Ÿå—æ˜¯ <code>Kalwit</code> æˆ–è€…ä»–çš„å›¢é˜Ÿåœ¨å‚ä¸ç¤¾åŒºçš„æ—¶å€™åº”è¯¥æ˜¯è¿›å±•ä¸é¡ºåˆ©ï¼Œä¸€äº›ææ¡ˆæˆ–è€…æ”¹åŠ¨æ²¡æœ‰å¾—åˆ°æ”¯æŒï¼Œä½†çœ‹åˆ° SN å…¬å¸æäº¤çš„å†…å®¹æ›´å¿«å¾—åˆ°å“åº”ï¼Œæ‰€ä»¥å¾—å‡ºäº†ä»¥ä¸Šçš„ç»“è®ºï¼šPulsar ç¤¾åŒºç”± SN å…¬å¸è¿›è¡Œäº†ä¸»å¯¼ã€‚</p><p>ä»–çš„é¡¾è™‘ä¹Ÿä¸æ˜¯æ²¡æœ‰é“ç†ï¼Œå°±åƒä»–è¯´çš„ Kafka ç¤¾åŒºç”± confluence å…¬å¸ä¸»å¯¼ï¼Œç±»ä¼¼çš„è¿˜æœ‰ Dubbo ç¤¾åŒºç”±é˜¿é‡Œä¸»å¯¼ã€Golang ç”± google ä¸»å¯¼ã€‚</p><p>ä½†é¡¹ç›®å¦‚æœåŠ å…¥äº† Apache é‚£ä»–åŸæœ¬çš„å…¬å¸å…¶å®å·²ç»å¤±å»äº†å¯¹é¡¹ç›®çš„æ‰€æœ‰æƒï¼Œåªæ˜¯åˆšå¼€å§‹çš„ä¸€äº› PMC&#x2F;committer å¤§éƒ¨åˆ†ä¼šæ˜¯è¿™ä¸ªå…¬å¸çš„å‘˜å·¥ï¼Œæ¯•ç«Ÿä»–ä»¬æ˜¯é¡¹ç›®çš„å‘èµ·è€…ï¼Œä¹Ÿæ›´åŠ ç†Ÿæ‚‰æ•´ä¸ªç³»ç»Ÿã€‚</p><p>å¦‚æœç¤¾åŒºå‘å±•çš„å¥åº·ï¼Œåç»­åº”è¯¥ä¼šè¡¥å……ä¸€äº›å…¶ä»–å¼€å‘è€…ï¼Œè¿™äº›å¼€å‘è€…ä¸å—é›‡äºä¹‹å‰å‘èµ·çš„é¡¹ç›®çš„å…¬å¸ï¼Œç”šè‡³æ˜¯ä»¥ä¸ªäººèº«ä»½åŠ å…¥ï¼›åªæœ‰è¿™æ ·ç¤¾åŒºå°±ä¼šæ›´åŠ å¤šæ ·åŒ–ï¼Œå‡ºç°â€œä¸€è¨€å ‚â€çš„å‡ ç‡å°±ä¼šå¤§å¤§é™ä½ã€‚</p><p>æˆ‘è§‰å¾—é€ æˆè¿™ç§ç°è±¡çš„åŸå› å’Œä¸€å¼€å§‹è¯¥é¡¹ç›®æ˜¯ç”±æŸä¸€ä¸ªç‰¹å®šå…¬å¸å‘èµ·æœ‰æœ‰å¾ˆå¤§çš„åŸå› ï¼Œæ¯”å¦‚ Dubboã€Golangï¼Œæ‰€ä»¥ä»–ä»¬å…¬å¸åœ¨ç¤¾åŒºçš„å£°æµªæ›´å¤§ï¼Œè‡ªå·±å…¬å¸çš„éœ€æ±‚ä¼˜å…ˆçº§ä¹Ÿä¼šæ›´é«˜ï¼Œæ¯•ç«Ÿä¼šæœ‰æ¥è‡ªåŒä¸€å…¬å¸çš„æ›´å¤šçš„äººæ¥å®¡æ ¸è¿™äº›éœ€æ±‚ã€‚</p><p>è™½è¯´å¦‚å‰é¢é‚®ä»¶é‡Œå›å¤çš„ï¼š<code>ç¤¾åŒºæ˜¯ç”±å¿—æ„¿è€…è‡ªæ„¿ç»´æŠ¤çš„</code>ï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯åœ¨è¿™äº›åšå¼€æºé¡¹ç›®å•†ä¸šåŒ–çš„å…¬å¸å†…æœ‰ä¸€æ‰¹äººå°±åœ¨ä¸“é—¨ç»´æŠ¤ç¤¾åŒºå·¥ä½œã€‚</p><p>ä»–ä»¬ä¼šæŠŠè‡ªå·±å•†ä¸šåŒ–è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œæˆ–è€…æ˜¯æ–°çš„ feature ä¹Ÿæäº¤ç»™ç¤¾åŒºï¼Œä½†è¿™é‡Œçš„åŒºåˆ«æ˜¯ä»–ä»¬æ˜¯æ‹¿å·¥èµ„çš„ï¼Œç§¯ææ€§è‚¯å®šè¦æ¯”åœ¨ç¤¾åŒºç”¨çˆ±å‘ç”µçš„å¼€å‘è€…æ›´ç§¯æã€‚</p><p>è¿™æ ·å°±ä¼šå¯¼è‡´ç¤¾åŒºä¸­æœ€æ´»è·ƒçš„é‚£æ‰¹äººå¤§æ¦‚ç‡æ˜¯é ç¤¾åŒºå…»æ´»è‡ªå·±çš„äººï¼Œä½†è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆåäº‹ï¼›å¦‚æœä½ ä¸ªäººæˆ–è€…å…¬å¸å¼ºä¾èµ–äºæŸä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé‚£ä¹Ÿå¯ä»¥æƒ³åŠæ³•å¤šåšè´¡çŒ®ï¼Œæˆä¸º committerï¼Œè¿™æ ·åœ¨ä¸€äº›éœ€è¦æŠ•ç¥¨çš„ç¯èŠ‚ä¹Ÿèƒ½æœ‰ä¸€å¸­ä¹‹ä½ã€‚</p><h2 id="å‚å•†æ— å…³"><a href="#å‚å•†æ— å…³" class="headerlink" title="å‚å•†æ— å…³"></a>å‚å•†æ— å…³</h2><p>å½“ç„¶ä¹Ÿæœ‰å¯¹åº”çš„ä¸æ˜¯ç”±æŸä¸€ä¸ªå‚å•†å‘èµ·çš„é¡¹ç›®ï¼Œæ¯”å¦‚æˆ‘æœ€è¿‘å‚ä¸è¾ƒå¤šçš„ <code>OpenTelemetry</code> ç¤¾åŒºã€‚</p><p><img src="https://s2.loli.net/2024/03/21/DZ2KAX5Wklpm7tr.png"><br>æŒ‰ç…§å®˜æ–¹è¯´æ³•æœ‰ç€ 1000 å¤šä½ç‹¬ç«‹çš„å¼€å‘è€…ï¼Œä»£è¡¨äº†è¶…è¿‡ 180 å®¶å…¬å¸ï¼Œåœ¨ç»´æŠ¤è€…çš„åˆ—è¡¨ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°å¤§å¤šæ•°éƒ½æ˜¯æ¥è‡ªäºä¸åŒçš„å…¬å¸ï¼š<br><img src="https://s2.loli.net/2024/03/21/jHgCdyoanmzGR8D.png"></p><p>æ‰€ä»¥è‡ªç„¶ä¹Ÿå°±æ²¡æœ‰æŸä¸€å‚å•†ä¸»å¯¼çš„è¯´æ³•ï¼Œæ‰€ä»¥æƒ³è¦é¿å…è¿™ç±»äº‹æƒ…å†æ¬¡å‘ç”Ÿï¼Œæœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯å¸çº³æ›´å¤šçš„å¼€å‘è€…åŠ å…¥ï¼Œåªæœ‰ç¤¾åŒºæˆå‘˜ä¸°å¯Œèµ·æ¥ç¤¾åŒºæ‰å¥½è‰¯æ€§å‘å±•ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li><a href="https://lists.apache.org/thread/gzx4j9q0xdtcvrfvvq72t9tm2rt9h3r7">https://lists.apache.org/thread/gzx4j9q0xdtcvrfvvq72t9tm2rt9h3r7</a></li><li><a href="https://github.com/apache/pulsar/pull/21080">https://github.com/apache/pulsar/pull/21080</a></li><li><a href="https://opentelemetry.io/blog/2024/opentelemetry-announced-support-for-profiling/">https://opentelemetry.io/blog/2024/opentelemetry-announced-support-for-profiling/</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h1&gt;&lt;p&gt;å› ä¸ºè®¢é˜…äº† Pulsar çš„å¼€å‘è€…é‚®ä»¶ï¼Œå‰æ®µæ—¶é—´çœ‹åˆ°ä¸€å°æ ‡é¢˜ä¸º&lt;a href=&quot;https://lists.apache.org/thread/gzx4j9q0xdtcvrfvvq72t9tm2rt9h3r7&quot;&gt;ã€Š(Apache committer criteria) [ANNOUNCE] New Committer: Asaf Mesikaã€‹&lt;/a&gt;çš„é‚®ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¹ä¸€çœ‹ä»¥ä¸ºæ˜¯æ¬¢è¿ &lt;code&gt;Asaf Mesika&lt;/code&gt; æˆä¸º Committerï¼Œä½†ä»”ç»†ä¸€çœ‹ä¸å¤ªå¯¹åŠ²ï¼Œè¿™å†…å®¹ä¹Ÿå¤ªå¤šäº†ï¼Œä»¥å¾€çš„æ¬¢è¿éƒ½æ˜¯ç®€å•çš„ &lt;code&gt;Congratulations!&lt;/code&gt; ä½œä¸ºå›å¤ï¼Œè¿™ç¯‡å†…å®¹æ˜æ˜¾æœ‰ç‚¹å¤šäº†ï¼Œäºæ˜¯ä¾¿ä»”ç»†çœ‹äº†ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="OpenSource" scheme="http://crossoverjie.top/tags/OpenSource/"/>
    
  </entry>
  
  <entry>
    <title>æŠ€æœ¯é˜…è¯»å‘¨åˆŠç¬¬åå››æœŸï¼šå¸¸ç”¨çš„ Git é…ç½®</title>
    <link href="http://crossoverjie.top/2024/02/29/ob/newsletter/Newsletter14-20240223/"/>
    <id>http://crossoverjie.top/2024/02/29/ob/newsletter/Newsletter14-20240223/</id>
    <published>2024-02-29T09:28:25.000Z</published>
    <updated>2024-02-29T14:09:37.281Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2024/01/11/YMoyEKwUubfZA9a.png"></p><p><strong>æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚</strong></p><span id="more"></span><h2 id="å†å²æ›´æ–°"><a href="#å†å²æ›´æ–°" class="headerlink" title="å†å²æ›´æ–°"></a>å†å²æ›´æ–°</h2><ul><li><a href="https://crossoverjie.top/2023/12/22/ob/newsletter/Newsletter10-20231222/">20231122ï¼šç¬¬åä¸€æœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/29/ob/newsletter/Newsletter12-20231229/">20231129ï¼šç¬¬åäºŒæœŸ</a></li><li><a href="https://crossoverjie.top/2024/01/05/ob/newsletter/Newsletter12-20240105/">20240105ï¼šç¬¬åä¸‰æœŸï¼šä¸€äº›æé«˜ç”Ÿäº§åŠ›çš„ç»ˆç«¯å‘½ä»¤</a></li><li><a href="https://crossoverjie.top/2024/01/12/ob/newsletter/Newsletter12-202401012/">20240112ï¼šç¬¬åå››æœŸï¼šGolang ä½œè€… Rob Pike åœ¨ GopherConAU ä¸Šçš„åˆ†äº«</a></li></ul><h1 id="How-I-write-HTTP-services-in-Go-after-13-years"><a href="#How-I-write-HTTP-services-in-Go-after-13-years" class="headerlink" title="How I write HTTP services in Go after 13 years"></a>How I write HTTP services in Go after 13 years</h1><p><img src="https://s2.loli.net/2024/02/27/SJIHKtpc5m1u7vs.png"></p><ol><li>ä½¿ç”¨NewServerå‡½æ•°æ„å»ºæœåŠ¡å®ä¾‹,åˆ©ç”¨ä¾èµ–æ³¨å…¥æ–¹å¼å°†æ‰€æœ‰çš„ä¾èµ–å‚æ•°åŒ…å«è¿›æ¥ã€‚</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">logger *Logger</span></span></span><br><span class="line"><span class="params"><span class="function">config *Config</span></span></span><br><span class="line"><span class="params"><span class="function">commentStore *commentStore</span></span></span><br><span class="line"><span class="params"><span class="function">anotherStore *anotherStore</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> http.Handler &#123;</span><br><span class="line">mux := http.NewServeMux()</span><br><span class="line">addRoutes(</span><br><span class="line">mux,</span><br><span class="line">Logger,</span><br><span class="line">Config,</span><br><span class="line">commentStore,</span><br><span class="line">anotherStore,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> handler http.Handler = mux</span><br><span class="line">handler = someMiddleware(handler)</span><br><span class="line">handler = someMiddleware2(handler)</span><br><span class="line">handler = someMiddleware3(handler)</span><br><span class="line"><span class="keyword">return</span> handler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨routes.goæ–‡ä»¶ä¸­ç»Ÿä¸€å®šä¹‰æ‰€æœ‰è·¯ç”±å‡½æ•°ã€‚</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addRoutes</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">mux                 *http.ServeMux,</span></span></span><br><span class="line"><span class="params"><span class="function">logger              *logging.Logger,</span></span></span><br><span class="line"><span class="params"><span class="function">config              Config,</span></span></span><br><span class="line"><span class="params"><span class="function">tenantsStore        *TenantsStore,</span></span></span><br><span class="line"><span class="params"><span class="function">commentsStore       *CommentsStore,</span></span></span><br><span class="line"><span class="params"><span class="function">conversationService *ConversationService,</span></span></span><br><span class="line"><span class="params"><span class="function">chatGPTService      *ChatGPTService,</span></span></span><br><span class="line"><span class="params"><span class="function">authProxy           *authProxy</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">mux.Handle(<span class="string">&quot;/api/v1/&quot;</span>, handleTenantsGet(logger, tenantsStore))</span><br><span class="line">mux.Handle(<span class="string">&quot;/oauth2/&quot;</span>, handleOAuth2Proxy(logger, authProxy))</span><br><span class="line">mux.HandleFunc(<span class="string">&quot;/healthz&quot;</span>, handleHealthzPlease(logger))</span><br><span class="line">mux.Handle(<span class="string">&quot;/&quot;</span>, http.NotFoundHandler())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>ä¸»å‡½æ•°åªè°ƒç”¨runå‡½æ•°æ¥è¿è¡ŒæœåŠ¡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(ctx context.Context, w io.Writer, args []<span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">ctx, cancel := signal.NotifyContext(ctx, os.Interrupt)</span><br><span class="line"><span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ctx := context.Background()</span><br><span class="line"><span class="keyword">if</span> err := run(ctx, os.Stdout, os.Args); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintf(os.Stderr, <span class="string">&quot;%s\n&quot;</span>, err)</span><br><span class="line">os.Exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¿”å›é—­åŒ… handle</p></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// handleSomething handles one of those web requests</span></span><br><span class="line"><span class="comment">// that you hear so much about.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleSomething</span><span class="params">(logger *Logger)</span></span> http.Handler &#123;</span><br><span class="line">thing := prepareThing()</span><br><span class="line"><span class="keyword">return</span> http.HandlerFunc(</span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line"><span class="comment">// use thing to handle request</span></span><br><span class="line">logger.Info(r.Context(), <span class="string">&quot;msg&quot;</span>, <span class="string">&quot;handleSomething&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><p>å®šä¹‰é€šç”¨çš„encodeå’Œdecodeå‡½æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encode</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(w http.ResponseWriter, r *http.Request, status <span class="type">int</span>, v T)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">w.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">w.WriteHeader(status)</span><br><span class="line"><span class="keyword">if</span> err := json.NewEncoder(w).Encode(v); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;encode json: %w&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decode</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(r *http.Request)</span></span> (T, <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> v T</span><br><span class="line"><span class="keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;v); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> v, fmt.Errorf(<span class="string">&quot;decode json: %w&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> v, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æä¾›ä¸€ä¸ªæŠ½è±¡çš„ Validator æ¥å£ç”¨äºéªŒè¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Validator is an object that can be validated.</span></span><br><span class="line"><span class="keyword">type</span> Validator <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// Valid checks the object and returns any</span></span><br><span class="line"><span class="comment">// problems. If len(problems) == 0 then</span></span><br><span class="line"><span class="comment">// the object is valid.</span></span><br><span class="line">Valid(ctx context.Context) (problems <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decodeValid</span>[<span class="title">T</span> <span class="title">Validator</span>]<span class="params">(r *http.Request)</span></span> (T, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> v T</span><br><span class="line"><span class="keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;v); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> v, <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;decode json: %w&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> problems := v.Valid(r.Context()); <span class="built_in">len</span>(problems) &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> v, problems, fmt.Errorf(<span class="string">&quot;invalid %T: %d problems&quot;</span>, v, <span class="built_in">len</span>(problems))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> v, <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>è‡ªå®šä¹‰æ ¡éªŒéœ€è¦å®ç° <code>Validator</code> æ¥å£ã€‚</p><ol start="8"><li>ä½¿ç”¨ Once å»¶è¿Ÿè°ƒç”¨æ¥æé«˜å¯åŠ¨æ€§èƒ½ã€‚<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleTemplate</span><span class="params">(files <span class="type">string</span>...)</span></span> http.HandlerFunc &#123;</span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">init    sync.Once</span><br><span class="line">tpl     *template.Template</span><br><span class="line">tplerr  <span class="type">error</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">init.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">tpl, tplerr = template.ParseFiles(files...)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> tplerr != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(w, tplerr.Error(), http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// use tpl</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="What-is-OpenTelemetry"><a href="#What-is-OpenTelemetry" class="headerlink" title="What is OpenTelemetry?"></a>What is OpenTelemetry?</h1><p><img src="https://s2.loli.net/2024/02/27/w13m5cQqdinLDIP.png"></p><blockquote><p>è¿™æ˜¯ä¸€ç¯‡ OTel çš„ç§‘æ™®æ–‡ç« </p></blockquote><p>OpenTelemetry æä¾›ä¸€ä¸ªç»Ÿä¸€ã€å¯æ‰©å±•çš„æ¡†æ¶ï¼Œç”¨äºæ”¶é›†ã€åˆ†æå’Œè§‚å¯Ÿåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ€§èƒ½æ•°æ®ã€‚å®ƒåŒ…æ‹¬ä¸€ç»„APIã€åº“ã€ä»£ç†å’Œæ”¶é›†å™¨ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥è·¨å¤šç§ç¼–ç¨‹è¯­è¨€å’Œå¹³å°å®ç°å¯¹åº”ç”¨ç¨‹åºçš„ç›‘æ§ã€‚</p><p>OpenTelemetry æ•´åˆ OpenTracing å’Œ OpenCensusã€‚</p><p><img src="https://s2.loli.net/2024/02/27/3C1VLqIBGgAwdeR.png"></p><blockquote><p>2019å¹´ï¼Œä¸¤ä¸ªç¤¾åŒºè¿›è¡Œäº†åˆå¹¶ã€‚</p></blockquote><p>åŒæ—¶ OTel å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š</p><ol><li><p><strong>ç»Ÿä¸€æ€§</strong>ï¼šOpenTelemetry æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„APIï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶ä¸­ä»¥ä¸€è‡´çš„æ–¹å¼å®ç°ç›‘æ§ã€‚</p></li><li><p><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¯ä»¥ç¼–å†™è‡ªå·±çš„æ‰©å±•æ¥æ»¡è¶³ä¸ªæ€§åŒ–éœ€è¦</p></li><li><p><strong>è·¨å¹³å°</strong>ï¼šOpenTelemetry æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ Javaã€Pythonã€Goã€.NET ç­‰ï¼Œä»¥åŠå¤šç§äº‘æœåŠ¡å’Œå®¹å™¨å¹³å°ã€‚</p></li><li><p><strong>ç¤¾åŒºé©±åŠ¨</strong>ï¼šä½œä¸ºä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ŒOpenTelemetry ç”±ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºæ”¯æŒï¼Œç¤¾åŒºæˆå‘˜è´¡çŒ®ä»£ç ã€æ–‡æ¡£å’Œæœ€ä½³å®è·µã€‚</p></li><li><p><strong>ä¸ç°æœ‰å·¥å…·çš„å…¼å®¹æ€§</strong>ï¼šOpenTelemetry è®¾è®¡æ—¶è€ƒè™‘äº†ä¸ç°æœ‰ç›‘æ§å·¥å…·çš„å…¼å®¹æ€§ï¼Œå¦‚ Prometheusã€Jaegerã€Zipkin ç­‰ï¼Œè¿™ä½¿å¾—å®ƒå¯ä»¥è½»æ¾åœ°é›†æˆåˆ°ç°æœ‰çš„ç›‘æ§åŸºç¡€è®¾æ–½ä¸­ã€‚</p></li></ol><p>æä¾›äº†ä¸€ç§åä¸ºï¼šOTLPï¼ˆOpenTelemetry Protocolï¼‰çš„é€šè®¯åè®®ï¼ŒåŸºäº gRPCã€‚</p><p>ä½¿ç”¨è¯¥åè®®ç”¨äºå®¢æˆ·ç«¯ä¸ Collector é‡‡é›†å™¨è¿›è¡Œäº¤äº’ã€‚</p><p>Collector æ˜¯ OpenTelemetry æ¶æ„ä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œå®ƒè´Ÿè´£æ¥æ”¶ã€å¤„ç†å’Œå¯¼å‡ºæ•°æ®(Trace&#x2F;log&#x2F;metrics)ã€‚</p><p><img src="https://s2.loli.net/2024/02/27/fFOnesN4zhQIPR2.png"></p><p>å®ƒå¯ä»¥æ¥å—ä»å®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®è¿›è¡Œå¤„ç†ï¼ŒåŒæ—¶å¯ä»¥å¯¼å‡ºä¸ºä¸åŒæ ¼å¼çš„æ•°æ®ã€‚</p><blockquote><p>æ€»çš„æ¥è¯´ OTel æ˜¯å¯è§‚æµ‹ç³»ç»Ÿçš„æ–°æ ‡å‡†ï¼ŒåŸºäºå®ƒå¯ä»¥å…¼å®¹ä»¥å‰ä½¿ç”¨çš„ Prometheusã€ victoriametricsã€skywalking ç­‰ç³»ç»Ÿï¼ŒåŒæ—¶è¿˜å¯ä»¥çµæ´»æ‰©å±•ï¼Œä¸ç”¨ä¸ä»»ä½•ä½†ä¸€ç”Ÿæ€æˆ–æŠ€æœ¯æ ˆè¿›è¡Œç»‘å®šã€‚</p></blockquote><h1 id="Popular-git-config-options"><a href="#Popular-git-config-options" class="headerlink" title="Popular git config options"></a>Popular git config options</h1><p><img src="https://s2.loli.net/2024/02/29/d9x7T2yhFfcjluO.png"></p><blockquote><p>æœ¬æ–‡æ€»ç»“äº†ä¸€äº›å¸¸ç”¨çš„ git é…ç½®</p></blockquote><ol><li><p><code>pull.ff only</code> æˆ– <code>pull.rebase true</code>ï¼šè¿™ä¸¤ä¸ªé€‰é¡¹éƒ½å¯ä»¥é¿å…åœ¨æ‰§è¡Œ<code>git pull</code>æ—¶æ„å¤–åˆ›å»ºåˆå¹¶æäº¤ï¼Œç‰¹åˆ«æ˜¯å½“ä¸Šæ¸¸åˆ†æ”¯å·²ç»å‘ç”Ÿäº†å˜åŒ–çš„æ—¶å€™ã€‚</p></li><li><p><code>merge.conflictstyle diff3</code>ï¼šè¿™ä¸ªé€‰é¡¹ä½¿å¾—åˆå¹¶å†²çªæ›´æ˜“äºé˜…è¯»ï¼Œé€šè¿‡åœ¨å†²çªä¸­æ˜¾ç¤ºåŸå§‹ä»£ç ç‰ˆæœ¬ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°è§£å†³å†²çªã€‚</p></li><li><p><code>rebase.autosquash true</code> å’Œ <code>rebase.autostash true</code>ï¼šè¿™äº›é€‰é¡¹ä½¿å¾—ä¿®æ”¹æ—§æäº¤å˜å¾—æ›´å®¹æ˜“ï¼Œå¹¶ä¸”è‡ªåŠ¨å¤„ç†stashã€‚</p></li><li><p><code>push.default simple</code> æˆ– <code>push.default current</code>ï¼šè¿™äº›é€‰é¡¹å‘Šè¯‰<code>git push</code>è‡ªåŠ¨æ¨é€å½“å‰åˆ†æ”¯åˆ°åŒåçš„è¿œç¨‹åˆ†æ”¯ã€‚</p></li><li><p><code>init.defaultBranch main</code>ï¼šåˆ›å»ºæ–°ä»“åº“æ—¶ï¼Œé»˜è®¤åˆ›å»º<code>main</code>åˆ†æ”¯è€Œä¸æ˜¯<code>master</code>åˆ†æ”¯ã€‚</p></li><li><p><code>commit.verbose true</code>ï¼šåœ¨æäº¤æ—¶æ˜¾ç¤ºæ•´ä¸ªæäº¤å·®å¼‚ã€‚</p></li><li><p><code>rerere.enabled true</code>ï¼šå¯ç”¨<code>rerere</code>åŠŸèƒ½ï¼Œè‡ªåŠ¨è§£å†³å†²çª</p></li><li><p><code>help.autocorrect</code>ï¼šè®¾ç½®è‡ªåŠ¨çŸ«æ­£çš„çº§åˆ«ï¼Œä»¥è‡ªåŠ¨è¿è¡Œå»ºè®®çš„å‘½ä»¤ã€‚</p></li><li><p><code>core.pager delta</code>ï¼šè®¾ç½®Gitä½¿ç”¨çš„åˆ†é¡µå™¨ï¼Œä¾‹å¦‚ä½¿ç”¨<code>delta</code>æ¥æŸ¥çœ‹å¸¦æœ‰è¯­æ³•é«˜äº®çš„diffã€‚</p></li><li><p><code>diff.algorithm histogram</code>ï¼šè®¾ç½®Gitçš„diffç®—æ³•ï¼Œä»¥æ”¹å–„å‡½æ•°é‡æ’æ—¶çš„diffæ˜¾ç¤ºã€‚</p></li></ol><p>æ–‡ç« é“¾æ¥ï¼š</p><ul><li><a href="https://grafana.com/blog/2024/02/09/how-i-write-http-services-in-go-after-13-years/">https://grafana.com/blog/2024/02/09/how-i-write-http-services-in-go-after-13-years/</a></li><li><a href="https://codeboten.medium.com/what-is-opentelemetry-6a7e5c6901c5">https://codeboten.medium.com/what-is-opentelemetry-6a7e5c6901c5</a></li><li><a href="https://jvns.ca/blog/2024/02/16/popular-git-config-options/">https://jvns.ca/blog/2024/02/16/popular-git-config-options/</a></li></ul><p>#Newletters </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/01/11/YMoyEKwUubfZA9a.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    <category term="Newsletter" scheme="http://crossoverjie.top/categories/OB/Newsletter/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Apache Pulsar 3.2.0 å‘å¸ƒ</title>
    <link href="http://crossoverjie.top/2024/02/27/ob/translate-pulsar-3.2.0/"/>
    <id>http://crossoverjie.top/2024/02/27/ob/translate-pulsar-3.2.0/</id>
    <published>2024-02-27T02:37:24.000Z</published>
    <updated>2024-02-27T06:31:23.848Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://pulsar.apache.org/blog/2024/02/12/announcing-apache-pulsar-3-2/">åŸæ–‡é“¾æ¥</a></p><p>Pulsar3.2.0 äº 2024-02-05 å‘å¸ƒï¼Œæä¾›äº†ä¸€äº›æ–°ç‰¹æ€§å’Œä¿®å¤äº†ä¸€äº› bug ï¼Œå…±æœ‰ 57 ä½å¼€å‘è€…æäº¤äº† 88 æ¬¡ commitã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‰¹æ€§ä»‹ç».</p><span id="more"></span><h1 id="é€Ÿç‡é™åˆ¶"><a href="#é€Ÿç‡é™åˆ¶" class="headerlink" title="é€Ÿç‡é™åˆ¶"></a>é€Ÿç‡é™åˆ¶</h1><p>åœ¨ 3.2 ä¸­å¯¹é€Ÿç‡é™åˆ¶åšäº†é‡æ„ï¼š<br><a href="https://github.com/apache/pulsar/blob/master/pip/pip-322.md">PIP-322 Pulsar Rate Limiting Refactoring</a>.</p><p>é€Ÿç‡é™åˆ¶å™¨æ˜¯ Pulsar æœåŠ¡è´¨é‡ï¼ˆQosï¼‰ä¿è¯çš„é‡è¦æ¸ é“ï¼Œä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>é€Ÿç‡é™åˆ¶å™¨çš„é«˜ CPU è´Ÿè½½</li><li>å¤§é‡çš„é”ç«äº‰ä¼šå½±å“ <code>Netty IO</code> çº¿ç¨‹ï¼Œä»è€Œå¢åŠ å…¶ä»– topic çš„å‘é€å»¶è¿Ÿ</li><li>æ›´å¥½çš„ä»£ç å°è£…</li></ul><h1 id="Topic-å‹ç¼©æ—¶ä¼šåˆ é™¤-Null-key-æ¶ˆæ¯"><a href="#Topic-å‹ç¼©æ—¶ä¼šåˆ é™¤-Null-key-æ¶ˆæ¯" class="headerlink" title="Topic å‹ç¼©æ—¶ä¼šåˆ é™¤ Null-key æ¶ˆæ¯"></a>Topic å‹ç¼©æ—¶ä¼šåˆ é™¤ Null-key æ¶ˆæ¯</h1><p>Pulsar æ”¯æŒ <a href="https://pulsar.apache.org/docs/3.2.x/concepts-topic-compaction/">Topic å‹ç¼©</a>ï¼Œåœ¨ 3.2 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ topic å‹ç¼©æ—¶ä¼šä¿ç•™ Null key çš„æ¶ˆæ¯ã€‚</p><p>ä» 3.2.0 å¼€å§‹å°†ä¼šä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œé»˜è®¤ä¸ä¼šä¿ç•™ï¼Œè¿™å¯ä»¥å‡å°‘å­˜å‚¨ã€‚å¦‚æœæƒ³è¦æ¢å¤ä»¥å‰çš„ç­–ç•¥å¯ä»¥åœ¨ broker.conf ä¸­æ–°å¢é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">topicCompactionRetainNullKey</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>å…·ä½“ä¿¡æ¯è¯·å‚è€ƒï¼š<a href="https://github.com/apache/pulsar/blob/master/pip/pip-318.md">PIP-318</a>.</p><h1 id="WebSocket-çš„æ–°ç‰¹æ€§"><a href="#WebSocket-çš„æ–°ç‰¹æ€§" class="headerlink" title="WebSocket çš„æ–°ç‰¹æ€§"></a>WebSocket çš„æ–°ç‰¹æ€§</h1><ul><li>æ”¯æŒå¤šä¸ª topic æ¶ˆè´¹ï¼š<a href="https://github.com/apache/pulsar/blob/master/pip/pip_307.md">PIP-307</a>.</li><li>ç«¯å¯¹ç«¯åŠ å¯†Â <a href="https://github.com/apache/pulsar/blob/master/pip/pip-290.md">PIP-290</a>.</li></ul><h1 id="CLI-çš„ç”¨æˆ·ä½“éªŒæ”¹è¿›"><a href="#CLI-çš„ç”¨æˆ·ä½“éªŒæ”¹è¿›" class="headerlink" title="CLI çš„ç”¨æˆ·ä½“éªŒæ”¹è¿›"></a>CLI çš„ç”¨æˆ·ä½“éªŒæ”¹è¿›</h1><ul><li><a href="https://github.com/apache/pulsar/pull/20663">CLI å¯ä»¥é…ç½®å†…å­˜é™åˆ¶</a></li><li><a href="https://github.com/apache/pulsar/pull/21664">å…è®¸é€šè¿‡æ­£åˆ™æˆ–è€…æ˜¯æ–‡ä»¶æ‰¹é‡åˆ é™¤ topic</a></li><li><a href="https://github.com/apache/pulsar/pull/20614">é€šè¿‡Â <code>pulsar-admin clusters list</code> å¯ä»¥æ‰“å°å½“å‰ä½¿ç”¨çš„ cluster</a></li></ul><h1 id="æ„å»ºç³»ç»Ÿçš„æ”¹è¿›"><a href="#æ„å»ºç³»ç»Ÿçš„æ”¹è¿›" class="headerlink" title="æ„å»ºç³»ç»Ÿçš„æ”¹è¿›"></a>æ„å»ºç³»ç»Ÿçš„æ”¹è¿›</h1><p>3.2.0 ä¸­å¼•å…¥äº†PIP-326: <a href="https://github.com/apache/pulsar/blob/master/pip/pip-326.md">Bill of Materials(BOM)</a> æ¥ç®€åŒ–ä¾èµ–ç®¡ç†ã€‚</p><h1 id="å‚ä¸å…¶ä¸­"><a href="#å‚ä¸å…¶ä¸­" class="headerlink" title="å‚ä¸å…¶ä¸­"></a>å‚ä¸å…¶ä¸­</h1><p>Pulsar æ˜¯å‘å±•æœ€å¿«çš„å¼€æºé¡¹ç›®ä¹‹ä¸€ï¼Œè¢« Apache åŸºé‡‘ä¼šè¯„é€‰ä¸ºå‚ä¸åº¦å‰äº”çš„é¡¹ç›®ï¼Œç¤¾åŒºæ¬¢è¿å¯¹å¼€æºã€æ¶ˆæ¯ç³»ç»Ÿã€streaming æ„Ÿå…´è¶£çš„å‚ä¸è´¡çŒ®ğŸ‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹èµ„æºä¸ç¤¾åŒºä¿æŒè”ç³»ï¼š</p><ul><li>é˜…è¯»è´¡çŒ®æ‰‹å†Œ Â <a href="https://pulsar.apache.org/contribute/">Apache Pulsar Contribution Guide</a>Â å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªè´¡çŒ®ã€‚</li><li>è®¿é—®Â <a href="https://github.com/apache/pulsar">Pulsar GitHub repository</a>, å…³æ³¨Â <a href="https://twitter.com/apache_pulsar">@apache_pulsar</a>Â çš„ Twitter&#x2F;XÂ , åŠ å…¥ slack ç¤¾åŒº <a href="https://apache-pulsar.slack.com/">Pulsar community on Slack</a>.</li></ul><p>ğŸ”—å‚è€ƒé“¾æ¥ï¼š</p><ul><li><a href="https://github.com/apache/pulsar/blob/master/pip/pip-318.md">https://github.com/apache/pulsar/blob/master/pip/pip-318.md</a></li><li><a href="https://pulsar.apache.org/docs/3.2.x/concepts-topic-compaction/">https://pulsar.apache.org/docs/3.2.x/concepts-topic-compaction/</a></li><li><a href="https://github.com/apache/pulsar/blob/master/pip/pip-322.md">https://github.com/apache/pulsar/blob/master/pip/pip-322.md</a></li><li><a href="https://github.com/apache/pulsar/blob/master/pip/pip_307.md">https://github.com/apache/pulsar/blob/master/pip/pip_307.md</a></li><li><a href="https://github.com/apache/pulsar/blob/master/pip/pip-290.md">https://github.com/apache/pulsar/blob/master/pip/pip-290.md</a></li><li><a href="https://github.com/apache/pulsar/pull/20663">https://github.com/apache/pulsar/pull/20663</a></li><li><a href="https://github.com/apache/pulsar/pull/20614">https://github.com/apache/pulsar/pull/20614</a></li><li><a href="https://github.com/apache/pulsar/blob/master/pip/pip-326.md">https://github.com/apache/pulsar/blob/master/pip/pip-326.md</a></li><li><a href="https://pulsar.apache.org/contribute/">https://pulsar.apache.org/contribute/</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://pulsar.apache.org/blog/2024/02/12/announcing-apache-pulsar-3-2/&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Pulsar3.2.0 äº 2024-02-05 å‘å¸ƒï¼Œæä¾›äº†ä¸€äº›æ–°ç‰¹æ€§å’Œä¿®å¤äº†ä¸€äº› bug ï¼Œå…±æœ‰ 57 ä½å¼€å‘è€…æäº¤äº† 88 æ¬¡ commitã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‰¹æ€§ä»‹ç».&lt;/p&gt;</summary>
    
    
    
    <category term="ç¿»è¯‘" scheme="http://crossoverjie.top/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„ 2023</title>
    <link href="http://crossoverjie.top/2024/02/17/annual-summary/2023/"/>
    <id>http://crossoverjie.top/2024/02/17/annual-summary/2023/</id>
    <published>2024-02-17T07:59:49.000Z</published>
    <updated>2024-02-21T13:46:59.929Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯æ˜¥èŠ‚çš„æœ€åä¸€å¤©ï¼Œå› ä¸ºå·¥ä½œä¸Šä¸´æ—¶æœ‰ç‚¹äº‹ï¼Œå¾ˆä¸æƒ…æ„¿çš„æ‰“å¼€ç”µè„‘çœ‹ç€ä¹Ÿå°± 10 å¤©æ²¡çœ‹ä»£ç è§‰å¾—éå¸¸é™Œç”Ÿã€‚</p><span id="more"></span><p>ä¹‹åä¾¿å‡†å¤‡å°†è¿Ÿè¿Ÿæœªå†™çš„ 2023 æ€»ç»“è¡¥å®Œï¼Œè¿™ä¸ªä¼ ç»Ÿä»16å¹´è‡³ä»Šå·²ç»åšæŒå°†è¿‘ 7 å¹´æ—¶é—´äº†ï¼Œä»Šå¹´å½“ç„¶ä¹Ÿä¸èƒ½æ„å¤–ã€‚</p><p><img src="https://s2.loli.net/2024/02/17/AgYLTPxs7u35RqB.png"></p><h1 id="å¥èº«"><a href="#å¥èº«" class="headerlink" title="å¥èº«"></a>å¥èº«</h1><p>ä»Šå¹´è¦è¯´æœ€è®©æˆ‘å°è±¡æ·±åˆ»çš„äº‹å°±æ˜¯å¥èº«äº†ï¼Œä¸ºæ­¤æˆ‘æŠ•å…¥äº†å¤§é‡çš„æ—¶é—´ã€‚</p><p><img src="https://s2.loli.net/2024/02/17/NB6dLUxZRnQPCAS.jpg"><br><img src="https://s2.loli.net/2024/02/17/gWe2p7LQITDuCh5.jpg"><br>æˆ‘è®°å¾—æ˜¯åœ¨ 22 å¹´å››æœˆä»½å½“æ—¶æ˜¯å› ä¸ºç¡®å®é•¿èƒ–å¤ªæ˜æ˜¾äº†ï¼Œä¸‹å®šå†³å¿ƒæ‰¾ä¸ªæ•™ç»ƒè¿›è¡Œè®­ç»ƒï¼Œæ•ˆæœç¡®å®ä¹Ÿæœ‰ã€‚</p><p>å»å¹´ä¹Ÿåˆ†äº«è¿‡ï¼Œæœ€åä» 75kg å‡åˆ° 66kgï¼›ä½†å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯è¢«åŠ¨çš„è¿›è¡Œè®­ç»ƒï¼Œæ‰€ä»¥åˆ°äº† 23 å¹´åˆçš„æ—¶å€™å…¶å®å°±åå¼¹ä¸å°‘äº†ã€‚</p><p>è€Œä»Šå¹´æœ€å¤§çš„ä¸åŒæ˜¯æˆ‘ç”±åŸå…ˆçš„è¢«åŠ¨å¥èº«æ”¹ä¸ºä¸»åŠ¨äº†ï¼Œç”šè‡³åˆ°åé¢ä¸€å¤©ä¸ç»ƒè¿˜æµ‘èº«ä¸èˆ’æœã€‚</p><p>æ‰€ä»¥ä»Šå¹´æˆ‘å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯è‡ªå·±é”»ç‚¼ï¼Œå› ä¸ºæˆ‘æ˜¯ä¸ª I äººï¼Œæ¯”è¾ƒå–œæ¬¢ä¸€ä¸ªäººï¼Œæ‰€ä»¥å¤å¤©çš„æ—¶å€™æ˜¯æ¯å¤©æ—©ä¸Š 7 ç‚¹å¤šå»å¥èº«æˆ¿ç„¶åå†å»å…¬å¸ã€‚ </p><p>åˆ°äº†å†¬å¤©æ—©ä¸Šç¡®å®æ˜¯èµ·ä¸æ¥ï¼Œå°±æ”¹ä¸ºäº†ä¸­åˆå»è®­ç»ƒã€‚</p><p>å°±è¿™æ ·ä¸çŸ¥ä¸è§‰å°±åšæŒäº†å¤§åŠå¹´ï¼Œç›´åˆ°ç°åœ¨ã€‚</p><p>è®­ç»ƒæ—¥å¿—è§æ–‡æœ«ã€‚</p><blockquote><p>ç”šè‡³ç°åœ¨å¶å°”æ‰¾æ•™ç»ƒè®­ç»ƒæ—¶ï¼Œä»–è¯´æˆ‘æ¯”ä»–ç»ƒçš„éƒ½å‹¤ğŸ¤£ã€‚</p></blockquote><p>æœ€ç»ˆè¾¾åˆ°çš„æ•ˆæœå°±æ˜¯ç”Ÿæ´»ä½œæ¯æ›´åŠ è§„å¾‹ï¼ŒåŒæ—¶èº«ä½“ç´ è´¨ä¹Ÿæ˜¯è‚‰çœ¼å¯è§çš„æå‡ã€‚</p><ul><li>è‡ªé‡å¼•ä½“ä»ä¸€ä¸ªä¸èƒ½åš-&gt;åæ¡-&gt;å¯¹æ¡-&gt;æ­£æ¡-&gt;æ­£æ¡åšç»„</li><li>ä¿¯å§æ’‘ä» 5 ä¸ª-&gt;10ä¸ª&#x2F;ç»„-&gt;15ä¸ª&#x2F;ç»„-&gt;25ä¸ª&#x2F;ç»„-&gt;ä¸€æ¬¡æœ€å¤šåš 40 ä¸ª-&gt;é’»çŸ³ä¿¯å§æ’‘ 15&#x2F;ç»„</li></ul><p>å…¶ä½™çš„å°±æ˜¯èƒ¸è‚Œæœ‰äº›è½®å»“ã€è‚©éƒ¨ä¹Ÿæ¯”ä»¥å¾€æ›´åœ†æ¶¦ä¸€äº›ï¼Œè…¹è‚Œåœ¨æŸäº›ç‰¹å®šè§’åº¦ä¹Ÿå¯ä»¥è‹¥éšè‹¥ç°ï¼ˆå½“ç„¶è¿™ä¸ªå¾—ä½“è„‚è¶³å¤Ÿä½æ‰è¡Œï¼‰ï¼Œä»Šå¹´çš„ä¸»è¦ç›®æ ‡æ˜¯ä¸ŠåŠå¹´è®¤çœŸåˆ·åˆ·è„‚ã€‚</p><h1 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h1><p>å·¥ä½œä»Šå¹´å¤§ä½“ä¸Šæ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œä½†ç»æµä¸æ™¯æ°”åº”è¯¥æ¯ä¸ªäººéƒ½èƒ½æ„Ÿå—åˆ°ï¼›ç›®å‰æˆ‘èƒ½è‹Ÿç€çš„åŒæ—¶è¿˜èƒ½å­¦ä¸€äº›è‡ªå·±æ„Ÿå…´è¶£çš„ä¸œè¥¿å°±éå¸¸æ»¡è¶³äº†ã€‚</p><p><img src="https://s2.loli.net/2024/02/18/yoqsN3S1LWalw8P.png"></p><blockquote><p>åˆ°ç°åœ¨ä¾ç„¶å¾ˆæ€€æ‹åœ¨ä¸Šå®¶å…¬å¸çš„æ—¥å­ã€‚</p></blockquote><p>ä»Šå¹´åœ¨å…¬å¸ä¸»è¦è¿˜æ˜¯ç»´æŠ¤ Pulsarï¼ŒåŒæ—¶ä¹Ÿç»™ç¤¾åŒºè´¡çŒ®äº†ä¸€äº›ä»£ç ï¼Œç®—æ˜¯è¿™ä¹ˆäº›å¹´æ¥æœ€è®¤çœŸå‚ä¸å¼€æºçš„ä¸€å¹´ã€‚</p><p>æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ä¹‹å‰å†™çš„æ–‡ç« ï¼š</p><ul><li><a href="https://crossoverjie.top/2023/12/21/ob/Pulsar%20Proposal/">å¦‚ä½•ç»™å¼€æºé¡¹ç›®å‘èµ·ææ¡ˆ</a></li><li><a href="https://crossoverjie.top/2023/08/05/ob/novice-contribute-open-source/">æ–°æ‰‹å¦‚ä½•å¿«é€Ÿå‚ä¸å¼€æºé¡¹ç›®</a></li></ul><p>ç›¸æ¯”æˆ‘ä»¥å‰çš„å·¥ä½œæ¥è¯´ï¼Œç°åœ¨çš„å²—ä½æ˜¯åŸºç¡€æ¶æ„ï¼Œæ‰€ä»¥æ¥è§¦çš„å‡ ä¹éƒ½æ˜¯ä¸€äº›å¼€æºäº§å“ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸ªäººæ„Ÿå…´è¶£çš„æ–¹å‘ã€‚</p><p>æ‰€ä»¥è™½ç„¶åŒäº‹ä¹‹é—´çš„äº¤æµæ²¡æœ‰ä¹‹å‰çš„å…¬å¸é‚£ä¹ˆé¢‘ç¹ï¼ˆæˆ‘ä»¬éƒ¨é—¨å’Œä¸šåŠ¡å›¢é˜Ÿåœ¨ä¸åŒçš„åŸå¸‚ï¼‰ï¼Œä½†å› ä¸ºç”±å…´è¶£é©±åŠ¨ï¼Œæ‰€ä»¥ä¹Ÿæ²¡é‚£ä¹ˆæ¯ç‡¥ã€‚</p><h2 id="è‹±è¯­"><a href="#è‹±è¯­" class="headerlink" title="è‹±è¯­"></a>è‹±è¯­</h2><p>å¯¹äº†ï¼Œå¹´ä¸­çš„æ—¶å€™è¿˜å¤´è„‘å‘çƒ­å»æŠ¥äº†ä¸€ä¸ªè‹±è¯­çº¿ä¸‹åŸ¹è®­ç­ï¼Œä¸Šäº†ä¸¤æœˆåå‘ç°é™¤éæ˜¯è¿ç»­æ¯å¤©ä¸Š 8 å°æ—¶çªå‡»å‡ ä¸ªæœˆï¼Œä¸ç„¶åˆ«æƒ³ä¸€ä¸‹å­é€Ÿæˆã€‚</p><p>å¹³æ—¶æ²¡æœ‰ä½¿ç”¨è‹±è¯­çš„ç¯å¢ƒï¼Œé‚£å°±åªèƒ½è‡ªå·±åˆ›é€ äº†ï¼Œæˆ‘ç°åœ¨ä¼šåšæŒæ¯å¤©çœ‹ä¸€ä¸ªæ²¹ç®¡çš„ç§‘æŠ€è§†é¢‘ï¼Œç›®å‰çœ‹ç”Ÿè‚‰æœ‰å­—å¹•çš„æƒ…å†µä¸‹å‹‰å¼ºå¯ä»¥ç†è§£ã€‚</p><p>åŒæ—¶åˆå› ä¸ºä»Šå¹´é•¿æœŸéƒ½åœ¨æ°´å¼€æºç¤¾åŒºï¼Œå¯¼è‡´æˆ‘ç°åœ¨çœ‹è‹±æ–‡æ–‡æ¡£ã€é‚®ä»¶ä¹‹ç±»çš„ä¸å€ŸåŠ©ç¿»è¯‘ä¹Ÿæ²¡é‚£ä¹ˆåƒåŠ›ï¼Œç®—æ˜¯å¼€äº†ä¸€ä¸ªå¥½å¤´ã€‚</p><p>ä»Šå¹´äº‰å–å†å¤šå¬å¬è‹±æ–‡æ’­å®¢ï¼Œè™½ç„¶æš‚æ—¶æ— æ³•é€šè¿‡è‹±è¯­æ‰¾åˆ°è¿œç¨‹å·¥ä½œï¼Œä½†åˆ©ç”¨è‹±æ–‡ç¡®å®å¯ä»¥æ‰“å¼€æ–°ä¸–ç•Œã€‚</p><h2 id="æ’­å®¢"><a href="#æ’­å®¢" class="headerlink" title="æ’­å®¢"></a>æ’­å®¢</h2><p><img src="https://s2.loli.net/2024/02/20/wMLS5luy8HDKerf.jpg"><br>ä»Šå¹´ç®—æ˜¯æ’­å®¢çš„é‡åº¦ç”¨æˆ·ï¼Œå…¶å®å¬æ’­å®¢çš„ä¹ æƒ¯å‰å‡ å¹´å°±æœ‰äº†ï¼Œä½†é‚£æ—¶å€™å¤§éƒ¨åˆ†æ˜¯å†å¼€è½¦çš„æ—¶å€™å¬ï¼Œä»Šå¹´å› ä¸ºæ¯å¤©æœ‰1~2å°æ—¶çš„å¥èº«æ—¶é—´ï¼Œæ‰€ä»¥å¥èº«çš„æ—¶å€™å‡ ä¹éƒ½æ˜¯å¬æ’­å®¢è¿‡æ¥çš„ã€‚</p><p>ä¸ªäººè§‰å¾—æ’­å®¢æ˜¯éå¸¸å¥½çš„å†…å®¹è¾“å…¥æºï¼Œæ¯”å¾ˆå¤šè§†é¢‘å†…å®¹çš„è´¨é‡è¿˜é«˜ï¼›è¿™é‡Œæ¨èå‡ ä¸ªæˆ‘å¸¸å¬çš„é¢‘é“ï¼š</p><ul><li>æ«è¨€æ«è¯­</li><li>ç¡¬åœ°éª‡å®¢</li><li>çˆ±å¦ç§‘æŠ€</li><li>å¼€æºé¢å¯¹é¢</li><li>æ•è›‡è€…è¯´</li><li>çš®è›‹æ¼«æ¸¸è®°ç­‰</li></ul><h2 id="å‰¯ä¸š"><a href="#å‰¯ä¸š" class="headerlink" title="å‰¯ä¸š"></a>å‰¯ä¸š</h2><p>åœ¨å¹´åº•çš„æ—¶å€™æ— æ„é—´åˆ©ç”¨ Pulsar å®Œæˆäº†æˆ‘äººç”Ÿçš„ç¬¬ä¸€ç¬”å’¨è¯¢æœåŠ¡ï¼Œå½“æ—¶è¿˜å‘äº†ä¸ªæœ‹å‹åœˆã€‚<br><img src="https://s2.loli.net/2024/02/18/d6PnUej5DSrJZ8R.png" alt="image.png"><br>æ²¡æƒ³åˆ°ä¹‹ååˆæœ‰ä¸ªæœ‹å‹æ¥å’¨è¯¢äº†ä¸€äº›å…³äºèŒåœºçš„é—®é¢˜ï¼Œå®Œäº‹åå®¢æˆ·æ»¡æ„åº¦è¿˜æŒºé«˜ã€‚</p><p>äºæ˜¯æˆ‘ä»Šå¹´ä¹Ÿå‡†å¤‡å¥½å¥½ç­¹å¤‡ä¸‹ï¼Œè¯´ä¸å®šçœŸèƒ½åšæˆä¸€ä¸ªå‰¯ä¸šã€‚</p><blockquote><p>æ‰“ä¸ªå¹¿å‘Šï¼Œæ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥ç§èŠã€‚</p></blockquote><hr><p>å¹´åº•è¿˜å¥½è¿è·å¾—äº†æ˜é‡‘çš„<a href="https://juejin.cn/post/7328012551756464139">ç­¾çº¦</a>èµ„æ ¼ï¼š<br><img src="https://s2.loli.net/2024/02/18/25xMEJANaRIbHgP.png"><br>æˆ‘ç®—æ˜¯æ˜é‡‘æœ€æ—©ä¸€æ‰¹ç”¨æˆ·äº†ï¼Œè®°å¾—æ˜¯ 16 å¹´å°±å¼€å§‹åœ¨ä¸Šé¢å‘å¸ƒæ–‡ç« ï¼Œè¿™ä¹Ÿæ˜¯é•¿æœŸåšæŒè·å¾—çš„è‚¯å®šã€‚</p><p>è€Œä¸”æ˜é‡‘ç”±äºè¢«å­—èŠ‚æ”¶è´­åèµ„é‡‘æ˜æ˜¾æ¯”å‰å‡ å¹´å®½è£•ï¼Œå‚ä¸è¿‡å‡ æ¬¡å¾æ–‡æ´»åŠ¨è¿˜æ˜¯æ”¶è·äº†ä¸€äº›ç°é‡‘å¥–åŠ±ã€‚</p><p>ç°åœ¨å’Œæ˜é‡‘ç­¾çº¦åè¿˜èƒ½è·å¾—æ›´å¤šçš„ç°é‡‘å’Œæµé‡å¥–åŠ±ï¼Œå¯¹ä½œè€…å’Œå¹³å°æ¥è¯´éƒ½æ˜¯åŒèµ¢ï¼Œåªæ˜¯ä»Šåçš„æ–‡ç« éœ€è¦å…ˆåœ¨æ˜é‡‘å‘å¸ƒä¸‰ä¸ªæœˆåæ‰å¯ä»¥åŒæ­¥åˆ°å…¶ä»–å¹³å°ã€‚</p><p>æ‰€ä»¥æ˜é‡‘è¿˜æ²¡å…³æ³¨çš„æˆ‘çš„æœ‹å‹èµ¶ç´§å…³æ³¨ä¸€æ³¢å§ï¼š<br><a href="https://juejin.cn/user/835284565229597">https://juejin.cn/user/835284565229597</a></p><h1 id="æŠ€èƒ½"><a href="#æŠ€èƒ½" class="headerlink" title="æŠ€èƒ½"></a>æŠ€èƒ½</h1><p>æŠ€èƒ½ä¸Šé™¤äº†åˆšæ‰åœ¨å·¥ä½œä¸­æåˆ°çš„ Pulsar å¤–è¿˜é¢å¤–å­¦ä¹ äº†ï¼š</p><ul><li><code>VictoriaMetrics</code> å…¥é—¨åˆ°å®‰è£…<ul><li><code>VictoriaLog</code> ä¸€ä¸ªæ–°çš„æ—¥å¿—å­˜å‚¨æ•°æ®åº“ï¼Œä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡ä»‹ç»ä½¿ç”¨<a href="https://crossoverjie.top/2023/08/23/ob/VictoriaLogs-Intro/">æ–‡ç« </a>ã€‚</li><li>è¿˜ç»™ <code>VictoriaLog</code> åšè¿‡ä¸€ç‚¹è´¡çŒ®ã€‚</li></ul></li><li>Grafana æ›´ç†Ÿç»ƒäº†</li><li>kubernetes çš„ä¸€äº›çŸ¥è¯†ç‚¹ä¹Ÿæ•°é‡äº†ï¼Œå†™è¿‡å‡ ä¸ªå°å·¥å…·ï¼š<ul><li><a href="https://crossoverjie.top/2023/10/19/ob/k8s-restart-pod/">ä¼˜é›…é‡å¯ Pod</a></li><li>æ‰¹é‡æ›¿æ¢åº”ç”¨é•œåƒ</li></ul></li><li>Istio çš„åº”ç”¨ï¼ŒåŒ…å«ç½‘å…³å’ŒæœåŠ¡è°ƒç”¨ç­‰</li><li>åœ¨å…¬å¸å†…éƒ¨åšè¿‡ä¸¤æ¬¡åˆ†äº«ï¼ˆå…³äº Pulsar å’Œå¼€æºçš„å†…å®¹ï¼‰</li><li>å¹´åº•çš„æ—¶å€™è¿˜å†™è¿‡ä¸€ä¸ª <code>OTel</code> çš„ <code>extension</code>ï¼Œç†Ÿæ‚‰äº† <code>OTel</code> çš„ä¸€äº›æ¦‚å¿µå’Œå®è·µã€‚</li></ul><p><img src="https://s2.loli.net/2024/02/21/kYTHJLrnVmvlxMB.png"><br>ä»ä»Šå¹´é•¿æœŸä½¿ç”¨çš„ tag æ¥çœ‹ï¼Œæœç„¶è¿˜æ˜¯ <code>Pulsar</code> å’Œ <code>kubernetes</code> ä½¿ç”¨çš„æœ€å¤šã€‚</p><h2 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h2><p><img src="https://s2.loli.net/2024/02/20/B2kATswN7ZGQSzd.png"><br>ä»Šå¹´çš„åšå®¢æ•°æ®äº§é‡ç®—æ˜¯æ¯”è¾ƒå¤šçš„äº†ï¼Œç¡®å®ä¹Ÿæ˜¯æœ‰æˆ‘å·¥ä½œçš„å…³ç³»ï¼Œå¹³æ—¶æ¥è§¦åˆ°çš„å¤§éƒ¨åˆ†éƒ½æ˜¯äº›æŠ€æœ¯é—®é¢˜ï¼Œæ‰€ä»¥èƒ½å†™çš„ä¸œè¥¿ä¹Ÿå°±æ¯”è¾ƒå¤šäº†ã€‚</p><p>åŒæ—¶ä¹Ÿå†å°è¯•æ¯å‘¨å‘å¸ƒæŠ€æœ¯å‘¨åˆŠï¼š<br><img src="https://s2.loli.net/2024/02/20/B1zoHZUNd6iKw48.png"></p><p>ç›®å‰å‘äº†åå‡ æœŸï¼Œæ•ˆæœä¸é”™ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›è‹±æ–‡æ–‡ç« ï¼Œè‡ªå·±ä¹Ÿèƒ½å­¦åˆ°ä¸€äº›ä¸œè¥¿ã€‚</p><h2 id="å¼€æº"><a href="#å¼€æº" class="headerlink" title="å¼€æº"></a>å¼€æº</h2><p>ä¹‹å‰ä¹Ÿæåˆ°äº†ä»Šå¹´ç®—æ˜¯æˆ‘æ¯”è¾ƒæ·±å…¥çš„å‚ä¸å¼€æºé¡¹ç›®ï¼Œä»¥å¾€å¤§éƒ¨åˆ†éƒ½æ˜¯å‘å¸ƒä¸€äº›ä¸ªäººä½œå“ï¼Œå½“ç„¶ä¹Ÿæœ‰ç»™ä¸€äº›ä¸ªäººæˆ–è€…å°é¡¹ç›®æè¿‡ PRï¼Œç°åœ¨çœ‹æ¥å¤šå°‘æœ‰ç‚¹â€å°æ‰“å°é—¹â€œäº†ã€‚</p><p><img src="https://s2.loli.net/2024/02/20/y84mXRtDJYz7HuG.png"><br>å› ä¸ºåœ¨å…¬å¸ä¸»è¦ç»´æŠ¤ Pulsarï¼Œæ‰€ä»¥ä¸å¯é¿å…çš„å°±éœ€è¦å’Œç¤¾åŒºæ²Ÿé€šï¼Œä¸ç®¡æ˜¯åé¦ˆ Bug è¿˜æ˜¯ä¿®å¤é—®é¢˜æµç¨‹éƒ½æ¯”ä»¥å¾€æ­£è§„ï¼Œæ¯•ç«Ÿè¿™ä¹Ÿæ˜¯ä¸€ä¸ª Apache é¡¶çº§é¡¹ç›®ã€‚</p><p><img src="https://s2.loli.net/2024/02/20/IZKxknlzdO9Gcys.png"></p><p>ä¸»è¦æ´»è·ƒçš„æ˜¯ <a href="https://github.com/apache/pulsar/pulls?q=is:pr+sort:updated-desc+author:crossoverJie+is:merged">Pulsar</a> ä¸»ä»“åº“ï¼Œåˆå¹¶äº† 14 ä¸ª PRã€‚</p><p><img src="https://s2.loli.net/2024/02/20/xbmp8hLZnCkBuMR.png"></p><p>å…¶æ¬¡æ˜¯ <a href="https://github.com/apache/pulsar-client-go/pulls?q=is:pr+sort:updated-desc+author:crossoverJie+is:merged">pulsar-client-go</a> ä¹Ÿå°±æ˜¯ Pulsar çš„ Go å®¢æˆ·ç«¯ï¼Œåˆå¹¶äº† 6 ä¸ª PRã€‚</p><hr><p><img src="https://s2.loli.net/2024/02/20/vpfMGde6gq4hsRm.png"></p><p><img src="https://s2.loli.net/2024/02/20/83zZDhX9arGu6Yo.jpg"></p><p>ç„¶åæ˜¯ <code>VictoriaMetrics</code>ï¼Œå…¶å®ä¸»è¦å°±æ˜¯ç»™ä»–ä»¬æ–°å‘å¸ƒçš„ <code>VictoriaLogs</code> ä¿®äº†ä¸ª Bugï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è¢«å•ç‹¬æåŠçš„è´¡çŒ®ã€‚</p><hr><p>æœ€åå°±æ˜¯å¹´åº•çš„æ—¶å€™åœ¨ä¸€ä¸ªåšå¯è§‚æµ‹æ€§å¤§ä½¬çš„å…¬ä¼—å·ä¸‹çœ‹åˆ°çš„é¡¹ç›®ï¼š<a href="https://github.com/cprobe/cprobe/">cprobe</a></p><p><img src="https://s2.loli.net/2024/02/20/luc9yaMvW18wHdF.png"><br>ä¸»è¦æ˜¯è´¡çŒ®äº†ä¸€ä¸ª helm å®‰è£…ä»“åº“ä»¥åŠå‡ ä¸ªæ’ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹æ–°æ‰‹å¾ˆå‹å¥½çš„é¡¹ç›®ï¼Œå¯¹å¼€æºæ„Ÿå…´è¶£çš„éƒ½å¯ä»¥æ¥å‚ä¸ä¸‹ã€‚</p><p>å½“ç„¶è´¡çŒ®æ•°é‡ä¸èƒ½ä½œä¸ºè¯„åˆ¤å‚ä¸å¼€æºçš„å”¯ä¸€æ ‡å‡†ï¼Œä½†ç¡®å®æ¯”è¾ƒå¥½é‡åŒ–çš„æŒ‡æ ‡ï¼Œä»Šå¹´åŠ æ²¹ç»§ç»­è´¡çŒ®ã€‚</p><h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><p>åˆåˆ°äº†ç»™å¾€å¹´æ‰“åˆ†çš„ç¯èŠ‚äº†ï¼š<br><img src="https://s2.loli.net/2024/02/21/Flfrmn4Tp6qYVWI.png"></p><p>å»å¹´ç®—æ˜¯å®Œæˆäº† 60%ï¼Œä»Šå¹´çš„å®šä¸€äº›å®¹æ˜“å®ç°çš„ç›®æ ‡ï¼š</p><ul><li>å§æ¨ 80kg</li><li>ä½“è„‚ä¿æŒåœ¨ 13% å·¦å³ï¼ˆè¯¯å·®ä¸èƒ½å¤šäº 2ï¼‰</li><li>å»æµ·å¤–ç©ä¼°è®¡æœ‰ç‚¹éš¾åº¦ï¼Œé‚£å°±å…ˆå®šå›½å†…å§ï¼Œå“ªé‡Œéƒ½è¡Œ.</li><li>å¹´åº•å¼€æºç¤¾åŒºäº‰å–æåä¸€ä¸ª Committer</li><li>è‹±è¯­å¯ä»¥è¾¾åˆ°ç”Ÿè‚‰æ²¹ç®¡çš„ç¨‹åº¦</li><li>åšä¸€ä¸ªå‰¯ä¸šè¯•è¯•</li></ul><h2 id="å¾€å¹´è®°å½•"><a href="#å¾€å¹´è®°å½•" class="headerlink" title="å¾€å¹´è®°å½•"></a>å¾€å¹´è®°å½•</h2><ul><li><a href="https://crossoverjie.top/2023/01/18/annual-summary/2022/">2022</a></li><li><a href="https://crossoverjie.top/2022/01/27/annual-summary/2021/">2021</a></li><li><a href="https://crossoverjie.top/2021/03/02/annual-summary/2020/">2020</a></li><li><a href="https://crossoverjie.top/2019/12/30/annual-summary/2019/">2019</a></li><li><a href="https://crossoverjie.top/2018/12/30/annual-summary/2018/">2018</a></li><li><a href="https://crossoverjie.top/2018/12/30/annual-summary/2018/">2016</a></li></ul><blockquote><p><strong>é•¿å›¾é¢„è­¦</strong></p></blockquote><p><img src="https://s2.loli.net/2024/02/17/8Tl19muAntiXg4a.jpg"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šå¤©æ˜¯æ˜¥èŠ‚çš„æœ€åä¸€å¤©ï¼Œå› ä¸ºå·¥ä½œä¸Šä¸´æ—¶æœ‰ç‚¹äº‹ï¼Œå¾ˆä¸æƒ…æ„¿çš„æ‰“å¼€ç”µè„‘çœ‹ç€ä¹Ÿå°± 10 å¤©æ²¡çœ‹ä»£ç è§‰å¾—éå¸¸é™Œç”Ÿã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="annual-summary" scheme="http://crossoverjie.top/categories/annual-summary/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Apache Pulsar 2023 å¹´åº¦å›é¡¾</title>
    <link href="http://crossoverjie.top/2024/01/26/ob/translate-pulsar-2023-year-in-review/"/>
    <id>http://crossoverjie.top/2024/01/26/ob/translate-pulsar-2023-year-in-review/</id>
    <published>2024-01-26T02:37:24.000Z</published>
    <updated>2024-01-26T06:58:04.544Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://pulsar.apache.org/blog/2024/01/12/pulsar-2023-year-in-review/">åŸæ–‡é“¾æ¥</a><br>å‰ä¸¤å¤© Pulsar ç¤¾åŒºå‘å¸ƒäº† 2023 å¹´å¹´åº¦å›é¡¾ï¼Œå»å¹´æˆ‘ä¹ŸèŠ±äº†ä¸€äº›æ—¶é—´å‚ä¸ç¤¾åŒºï¼Œæ‰€ä»¥å…¶ä¸­ä¸€äº›å†…å®¹æ„Ÿå—æŒºæ˜æ˜¾çš„ï¼Œä»¥ä¸‹å°±æ˜¯å¯¹ä¸€äº›é‡ç‚¹å†…å®¹çš„æç‚¼ã€‚</p><span id="more"></span><p>2023 å¹´æ˜¯ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ï¼Œå‚ä¸<a href="https://github.com/apache/pulsar">ä¸»ä»“åº“</a>è´¡çŒ®çš„å¼€å‘è€…è¾¾åˆ°äº† 600 ä½ã€‚<br>è‡ªä» Pulsar ä» 2018 æ¯•ä¸šæˆä¸º Apache é¡¶çº§é¡¹ç›®è‡³ä»Šä¸€å…±åˆ 12K+ çš„ä»£ç æäº¤æ¬¡æ•°ã€639 ä½è´¡çŒ®è€…ã€12.2k starã€3.5k forkã€10k+ çš„ slack ç”¨æˆ·ã€‚</p><h1 id="2023-é«˜å…‰æ—¶åˆ»"><a href="#2023-é«˜å…‰æ—¶åˆ»" class="headerlink" title="2023 é«˜å…‰æ—¶åˆ»"></a>2023 é«˜å…‰æ—¶åˆ»</h1><h2 id="ç¬¬ä¸€ä¸ª-LTS-3-0-é‡Œç¨‹ç¢‘ç‰ˆæœ¬"><a href="#ç¬¬ä¸€ä¸ª-LTS-3-0-é‡Œç¨‹ç¢‘ç‰ˆæœ¬" class="headerlink" title="ç¬¬ä¸€ä¸ª LTS 3.0 é‡Œç¨‹ç¢‘ç‰ˆæœ¬"></a>ç¬¬ä¸€ä¸ª LTS 3.0 é‡Œç¨‹ç¢‘ç‰ˆæœ¬</h2><p><img src="https://s2.loli.net/2024/01/26/BRvYSLPOnxoQ614.png"><br>ç¤¾åŒºå‘å¸ƒ Apache Pulsar 3.0ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªé•¿æœŸæ”¯æŒ ï¼ˆLTSï¼‰ ç‰ˆæœ¬ï¼Œä» Pulsar 3.0 å¼€å§‹ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç”¨æˆ·å¯¹ç¨³å®šæ€§å’Œæ–°åŠŸèƒ½çš„éœ€æ±‚ï¼ŒåŒæ—¶å‡è½»ç»´æŠ¤å†å²ç‰ˆæœ¬çš„è´Ÿæ‹…ã€‚</p><p>ä»¥å¾€çš„ç‰ˆæœ¬å‘å¸ƒå‘¨æœŸå¾ˆçŸ­ï¼Œä¸€èˆ¬æ˜¯ 3ï½4 ä¸ªæœˆï¼Œä¸ºäº†å¯ä»¥è·Ÿä¸Šç¤¾åŒºæ–°ç‰ˆï¼Œå¾€å¾€éœ€è¦ä¸åœçš„å‡çº§ï¼Œå¯¹ç»´æŠ¤ä¸­çš„è´Ÿæ‹…è¾ƒå¤§ã€‚</p><p>ä»Šåçš„ç»´æŠ¤æ—¶é—´è¡¨å¦‚ä¸Šå›¾ï¼Œä»¥ç¨³å®šä¸ºä¸»çš„å›¢é˜Ÿå¯ä»¥é€‰æ‹© LTS ç‰ˆæœ¬ï¼Œè¿½æ±‚æ–°åŠŸèƒ½çš„å›¢é˜Ÿå¯ä»¥é€‰æ‹© feature ç‰ˆæœ¬ã€‚</p><h2 id="æ–°çš„å®˜æ–¹ç½‘ç«™"><a href="#æ–°çš„å®˜æ–¹ç½‘ç«™" class="headerlink" title="æ–°çš„å®˜æ–¹ç½‘ç«™"></a>æ–°çš„å®˜æ–¹ç½‘ç«™</h2><p><a href="https://pulsar.apache.org/">https://pulsar.apache.org/</a>å®˜æ–¹ç½‘ç«™å¾—åˆ°äº†æ–°çš„è®¾è®¡ã€‚</p><h2 id="Pulsar-Admin-Go-Library"><a href="#Pulsar-Admin-Go-Library" class="headerlink" title="Pulsar Admin Go Library"></a>Pulsar Admin Go Library</h2><p>æä¾›äº† Pulsar Admin Go çš„å®¢æˆ·ç«¯ï¼Œæ–¹ä¾¿ Go ç”¨æˆ·ç®¡ç† Pulsar èµ„æº</p><h2 id="ä½¿ç”¨-OTel-å¢å¼º-Pulsar-çš„å¯è§‚æµ‹ç³»ç»Ÿ"><a href="#ä½¿ç”¨-OTel-å¢å¼º-Pulsar-çš„å¯è§‚æµ‹ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨ OTel å¢å¼º Pulsar çš„å¯è§‚æµ‹ç³»ç»Ÿ"></a>ä½¿ç”¨ OTel å¢å¼º Pulsar çš„å¯è§‚æµ‹ç³»ç»Ÿ</h2><p><a href="https://github.com/apache/pulsar/blob/master/pip/pip-264.md">PIP-264</a> ææ¡ˆå·²ç»è·å¾—äº†ç¤¾åŒºæ‰¹å‡†å¼€å§‹å¼€å‘ï¼Œå®ƒå°†è§£å†³ topic æ•°é‡è¾¾åˆ° 50k~100M çš„å¯è§‚æµ‹æ€§é—®é¢˜ã€‚<br>åŒæ—¶ Pulsar ç¤¾åŒºå·²ç»ä¸º OpenTelemetry æäº¤äº†ä¸¤ä¸ªç‰¹æ€§ <a href="https://github.com/open-telemetry/opentelemetry-java/issues/5105">Near-zero memory allocations</a>Â <a href="https://github.com/open-telemetry/opentelemetry-java/issues/6107">metric filtering upon collection</a> å·²ç»ä½œä¸ºäº† OpenTelemetry çš„è§„èŒƒã€‚</p><h1 id="ä¸»è¦äº‹ä»¶å›é¡¾"><a href="#ä¸»è¦äº‹ä»¶å›é¡¾" class="headerlink" title="ä¸»è¦äº‹ä»¶å›é¡¾"></a>ä¸»è¦äº‹ä»¶å›é¡¾</h1><p>2023 å¹´ï¼ŒPulsar ç¤¾åŒºåœ¨å…¨çƒèŒƒå›´å†…ä¸¾åŠäº†ä¸€ç³»åˆ—æ´»åŠ¨ã€‚</p><ul><li><a href="https://streamnative.io/blog/pulsar-virtual-summit-europe-2023-key-takeaways">Pulsar Summit Europe 2023</a></li><li><a href="https://pulsar.apache.org/blog/2023/08/28/pulsar-sessions-in-communityovercode-aisa-2023/">CommunityOverCode Asia 2023</a></li><li><a href="https://communityovercode.org/past-sessions/community-over-code-na-2023/">CommunityOverCode NA 2023</a></li><li><a href="https://streamnative.io/blog/pulsar-summit-north-america-2023-a-deep-dive-into-the-on-demand-summit-videos">Pulsar Summit NA 2023</a></li></ul><h1 id="ç¤¾åŒºæˆé•¿"><a href="#ç¤¾åŒºæˆé•¿" class="headerlink" title="ç¤¾åŒºæˆé•¿"></a>ç¤¾åŒºæˆé•¿</h1><p>æ²¡æœ‰è´¡çŒ®è€…ç¤¾åŒºå¾ˆéš¾å‘å±•ï¼Œ2023å¹´åŠ å…¥äº†è®¸å¤šæ–°é¢å­”ã€‚</p><ul><li>639 ä½è´¡çŒ®è€…</li><li>13.4k Github star</li><li>3.5k fork</li><li>æ–°å¢ 8 ä½ Committers</li><li>æ–°å¢ 6 ä½ PMC</li><li>10k+ slack ç”¨æˆ·</li><li>20M+ docker pulls</li></ul><h1 id="é¡¹ç›®å‘å¸ƒ"><a href="#é¡¹ç›®å‘å¸ƒ" class="headerlink" title="é¡¹ç›®å‘å¸ƒ"></a>é¡¹ç›®å‘å¸ƒ</h1><p>2023å¹´ï¼Œç¤¾åŒºå‘å¸ƒäº†ä¸¤ä¸ª major version å’Œ 12 ä¸ª minor version ç‰ˆæœ¬ï¼›æœ€å¤§çš„é‡Œç¨‹ç¢‘ä¾ç„¶æ˜¯å‘å¸ƒäº†é¦–ä¸ª LTS ç‰ˆæœ¬ <a href="https://pulsar.apache.org/blog/2023/05/02/announcing-apache-pulsar-3-0/">Pulsar3.0</a>ã€‚<br>è¶…è¿‡äº† 140 ä¸ªè´¡çŒ®è€…æäº¤äº†å¤§çº¦ 1500 æ¬¡æäº¤ã€‚</p><p>åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›é‡è¦çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æ–°ç‰ˆæœ¬çš„<a href="https://github.com/apache/pulsar/issues/16691">è´Ÿè½½å‡è¡¡å™¨</a>ï¼Œ<a href="https://github.com/apache/pulsar/issues/16763">å¤§è§„æ¨¡çš„å»¶æ—¶æ¶ˆæ¯æ”¯æŒ</a>ã€‚</p><p>æ›´æ–°äº†ä»¥ä¸‹ä¸€äº›å®¢æˆ·ç«¯ï¼š</p><ul><li><a href="https://github.com/apache/pulsar-client-cpp/releases/tag/v3.4.2">Pulsar C++ Client 3.4.2</a></li><li><a href="https://github.com/apache/pulsar-client-go/releases/tag/v0.11.1">Pulsar Go Client 0.11.1</a></li><li><a href="https://github.com/apache/pulsar-client-node/releases/tag/v1.9.0">Pulsar Node.js Client 1.9.0</a></li><li><a href="https://github.com/apache/pulsar-client-python/releases/tag/v3.3.0">Pulsar Python Client 3.3.0</a></li><li><a href="https://github.com/apache/pulsar-manager/releases/tag/v0.4.0">Pulsar Manager 0.4.0</a></li><li><a href="https://github.com/apache/pulsar-helm-chart/releases/tag/pulsar-3.1.0">Pulsar Helm Chart 3.1.0</a></li><li><a href="https://github.com/apache/pulsar-dotpulsar/blob/master/CHANGELOG.md#311---2023-12-11">Pulsar dotnet Client 3.1.1</a></li><li><a href="https://github.com/apache/pulsar-client-reactive/releases/tag/v0.5.1">Reactive Client for Apache Pulsar 0.1.0</a></li></ul><h1 id="ç”Ÿæ€ç³»ç»Ÿ"><a href="#ç”Ÿæ€ç³»ç»Ÿ" class="headerlink" title="ç”Ÿæ€ç³»ç»Ÿ"></a>ç”Ÿæ€ç³»ç»Ÿ</h1><p>2023 å¹´Pulsar ç¤¾åŒºä¹Ÿä¸å¤šä¸ªå¼€æºé¡¹ç›®è¿›è¡Œäº†é›†æˆï¼š</p><ul><li><a href="https://quarkus.io/guides/pulsar">Quarkus Extension for Apache Pulsar</a>ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨åœ¨ Quarkus ä½¿ç”¨ Pulsarã€‚</li><li><a href="https://spring.io/blog/2023/11/21/spring-for-apache-pulsar-1-0-0-goes-ga/">Spring for Apache Pulsar</a> æä¾›äº† PulsarTemplate ç”¨äºç”Ÿäº§æ¶ˆæ¯ï¼ŒPulsarListener æ³¨è§£å¯ä»¥æ–¹ä¾¿çš„æ¶ˆè´¹æ¶ˆæ¯ï¼Œåœ¨ spring ç”Ÿæ€ä¸‹æ›´å®¹æ˜“é›†æˆ Pulsar</li><li><a href="https://github.com/streamnative/oxia">Oxia</a>:å¯ä»¥ä½¿ç”¨ Oxia æåˆ° zookeeper ä»è€Œçªç ´ Pulsar æ”¯æŒ 1M topic çš„é™åˆ¶ã€‚</li></ul><h1 id="2024å¹´è®¡åˆ’"><a href="#2024å¹´è®¡åˆ’" class="headerlink" title="2024å¹´è®¡åˆ’"></a>2024å¹´è®¡åˆ’</h1><h2 id="OTel"><a href="#OTel" class="headerlink" title="OTel"></a>OTel</h2><p>ç»§ç»­æ¨è¿›ä½¿ç”¨ OpenTelemetry æ›¿æ¢ç°æœ‰çš„å¯è§‚æµ‹æ€§ç³»ç»Ÿ</p><h2 id="é™æµé‡æ„"><a href="#é™æµé‡æ„" class="headerlink" title="é™æµé‡æ„"></a>é™æµé‡æ„</h2><p><a href="https://github.com/apache/pulsar/blob/master/pip/pip-322.md">PIP-322 Pulsar Rate Limiting Refactoring</a>é™æµé‡æ„å·²ç»è¢«åˆå¹¶ï¼Œå°†åœ¨ 3.2 ç‰ˆæœ¬ä¸­å‘å¸ƒã€‚</p><h2 id="ç§»é™¤-Pulsar-SQL-æ¨¡å—"><a href="#ç§»é™¤-Pulsar-SQL-æ¨¡å—" class="headerlink" title="ç§»é™¤ Pulsar SQL æ¨¡å—"></a>ç§»é™¤ Pulsar SQL æ¨¡å—</h2><p>å°† SQL æ¨¡å—ç§»é™¤åæœ‰æ•ˆçš„å‡å°‘äº†é•œåƒå¤§å°ä»¥åŠæ„å»ºæ—¶é—´ã€‚</p><h2 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h2><p>2024 å¹´å°†ä¼šç»§ç»­ä¸¾åŠæ´»åŠ¨ï¼ŒåŒ…æ‹¬ Pulsar Summit North America å’Œ Pulsar Summit APACã€‚<a href="https://youtube.com/playlist?list=PLqRma1oIkcWhOZ6W-g4D_3JNxJzYnwLNX&si=o6G-fRcNgW9zqHGa">åœ¨è¿™é‡Œå¯ä»¥æŸ¥çœ‹ä»¥å¾€çš„æ´»åŠ¨</a>ã€‚</p><p>ğŸ”—å‚è€ƒé“¾æ¥ï¼š</p><ul><li><a href="https://youtube.com/playlist?list=PLqRma1oIkcWhOZ6W-g4D_3JNxJzYnwLNX&amp;si=o6G-fRcNgW9zqHGa">https://youtube.com/playlist?list=PLqRma1oIkcWhOZ6W-g4D_3JNxJzYnwLNX&amp;si=o6G-fRcNgW9zqHGa</a></li><li><a href="https://github.com/apache/pulsar/wiki/Community-Meetings">https://github.com/apache/pulsar/wiki/Community-Meetings</a></li><li><a href="https://pulsar.apache.org/blog/2024/01/12/pulsar-2023-year-in-review/">https://pulsar.apache.org/blog/2024/01/12/pulsar-2023-year-in-review/</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://pulsar.apache.org/blog/2024/01/12/pulsar-2023-year-in-review/&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;&lt;br&gt;å‰ä¸¤å¤© Pulsar ç¤¾åŒºå‘å¸ƒäº† 2023 å¹´å¹´åº¦å›é¡¾ï¼Œå»å¹´æˆ‘ä¹ŸèŠ±äº†ä¸€äº›æ—¶é—´å‚ä¸ç¤¾åŒºï¼Œæ‰€ä»¥å…¶ä¸­ä¸€äº›å†…å®¹æ„Ÿå—æŒºæ˜æ˜¾çš„ï¼Œä»¥ä¸‹å°±æ˜¯å¯¹ä¸€äº›é‡ç‚¹å†…å®¹çš„æç‚¼ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¿»è¯‘" scheme="http://crossoverjie.top/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ ä¸ºå¼€æºé¡¹ç›®è´¡çŒ®ä»£ç </title>
    <link href="http://crossoverjie.top/2024/01/25/ob/create-a-plugin-for-cprobe/"/>
    <id>http://crossoverjie.top/2024/01/25/ob/create-a-plugin-for-cprobe/</id>
    <published>2024-01-25T11:49:09.000Z</published>
    <updated>2024-01-25T15:56:28.553Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å‰æ®µæ—¶é—´æ— æ„é—´çœ‹åˆ°ä¸€ç¯‡å…¬ä¼—å· <a href="https://mp.weixin.qq.com/s/T8B3XnXd30vT7OvsFTnaFw">æ‹›è´¤ä»¤ï¼šä¸€èµ·æ¥æä¸€ä¸ªæ–°å¼€æºé¡¹ç›®</a>ï¼Œä½œè€…ä»‹ç»ä»–æƒ³è¦åšä¸€ä¸ªå¼€æºé¡¹ç›®ï¼š<a href="https://github.com/cprobe/cprobe">cprobe</a> ç”¨äºæ•´åˆç›®å‰å¸‚é¢ä¸Šæ•£è½åœ¨å„åœ°çš„ <code>Exporter</code>ï¼Œç»Ÿä¸€è¿›è¡Œç®¡ç†ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ <code>blackbox_exporter/mysqld_exporter</code> ç­‰ã€‚</p><blockquote><p>ä»¥å¾€çš„æ¯ä¸€ä¸ª Exporter éƒ½éœ€è¦å•ç‹¬éƒ¨ç½²è¿ç»´ã€‚</p></blockquote><span id="more"></span><p>åŒæ—¶åˆå®Œå…¨å…¼å®¹ <code>Prometheus</code> ç”Ÿæ€ï¼Œä¹Ÿå¯ä»¥å¤ç”¨ç°æœ‰çš„ç›‘æ§é¢æ¿ã€‚</p><p>æ°å¥½è¿™æ®µæ—¶é—´æˆ‘ä¹Ÿåœ¨å…¬å¸ä»äº‹å¯è§‚æµ‹æ€§ç›¸å…³çš„ä¸šåŠ¡ï¼Œå‘ç°è¿™ç¡®å®æ˜¯ä¸€ä¸ªç—›ç‚¹ã€‚</p><p>äºæ˜¯ä¾¿ä¸€ç›´åœ¨å…³æ³¨è¿™ä¸ªé¡¹ç›®ï¼ŒåŒæ—¶ä¹Ÿåšäº†äº›è´¡çŒ®ï¼›å› ä¸ºè¯¥é¡¹ç›®çš„æ ¸å¿ƒæ˜¯ç”¨äºæ•´åˆ exporterï¼Œæ‰€ä»¥ä¸ºå…¶ç¼–å†™æ’ä»¶ä¹Ÿæ˜¯éå¸¸é‡è¦çš„è´¡çŒ®äº†ã€‚</p><h1 id="ç¼–å†™æ’ä»¶"><a href="#ç¼–å†™æ’ä»¶" class="headerlink" title="ç¼–å†™æ’ä»¶"></a>ç¼–å†™æ’ä»¶</h1><p>æ•´ä¸ªé¡¹ç›®æ‰§è¡Œæµç¨‹å›¾å¦‚ä¸‹ï¼š<br><img src="https://s2.loli.net/2024/01/25/SihX4C5PN8IeR3Z.png"></p><p>å¯ä»¥çœ‹åˆ°ç¼–å†™æ’ä»¶æœ€æ ¸å¿ƒçš„ä¾¿æ˜¯è‡ªå®šä¹‰æ’ä»¶è§£æè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ã€æŠ“å–æŒ‡æ ‡çš„é€»è¾‘ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨é…ç½®ä¸­æŒ‡å®šæŠ“å–ç›®æ ‡çš„åŸŸåã€æŠ“å–è§„åˆ™ç­‰ã€‚</p><p>è¿™é‡Œ  <code>cprobe</code> å·²ç»æŠ½è±¡å‡ºäº†ä¸¤ä¸ªæ¥å£ï¼Œæˆ‘ä»¬åªéœ€è¦åšå¯¹åº”çš„å®ç°å³å¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Plugin <span class="keyword">interface</span> &#123;  </span><br><span class="line">    <span class="comment">// ParseConfig is used to parse config  </span></span><br><span class="line">    ParseConfig(baseDir <span class="type">string</span>, bs []<span class="type">byte</span>) (any, <span class="type">error</span>)  </span><br><span class="line">    <span class="comment">// Scrape is used to scrape metrics, cfg need to be cast specific cfg  </span></span><br><span class="line">    Scrape(ctx context.Context, target <span class="type">string</span>, cfg any, ss *types.Samples) <span class="type">error</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±ä»¥æˆ‘ä¹‹å‰ç¼–å†™çš„ <a href="https://github.com/cprobe/cprobe/pull/29">Consul</a> ä¸ºä¾‹ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Allows any Consul server (non-leader) to service a read.  </span></span><br><span class="line"><span class="string">allow_stale</span> <span class="string">=</span> <span class="literal">true</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># === CA  </span></span><br><span class="line"><span class="comment"># File path to a PEM-encoded certificate authority used to validate the authenticity of a server certificate.  </span></span><br><span class="line"><span class="string">ca_file</span> <span class="string">=</span> <span class="string">&quot;/etc/consul.d/consul-agent-ca.pem&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># File path to a PEM-encoded certificate used with the private key to verify the exporter&#x27;s authenticity.  </span></span><br><span class="line"><span class="string">cert_file</span> <span class="string">=</span> <span class="string">&quot;/etc/consul.d/consul-agent.pem&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Generate a health summary for each service instance. Needs n+1 queries to collect all information.  </span></span><br><span class="line"><span class="string">health_summary</span> <span class="string">=</span> <span class="literal">true</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># File path to a PEM-encoded private key used with the certificate to verify the exporter&#x27;s authenticity  </span></span><br><span class="line"><span class="string">key_file</span> <span class="string">=</span> <span class="string">&quot;/etc/consul.d/consul-agent-key.pem&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Disable TLS host verification.  </span></span><br><span class="line"><span class="string">insecure</span> <span class="string">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¯ä¸ªæ’ä»¶çš„é…ç½®éƒ½ä¸ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†é…ç½®è§£æåˆ°å…·ä½“çš„ç»“æ„ä½“ä¸­ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*Consul)</span></span> ParseConfig(baseDir <span class="type">string</span>, bs []<span class="type">byte</span>) (any, <span class="type">error</span>) &#123;  </span><br><span class="line">    <span class="keyword">var</span> c Config  </span><br><span class="line">    err := toml.Unmarshal(bs, &amp;c)  </span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line">       <span class="keyword">return</span> <span class="literal">nil</span>, err  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> c.Timeout == <span class="number">0</span> &#123;  </span><br><span class="line">       c.Timeout = time.Millisecond * <span class="number">500</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> &amp;c, <span class="literal">nil</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æé…ç½®æ–‡ä»¶æ²¡å•¥å¥½è¯´çš„ï¼Œæ ¹æ®è‡ªå·±çš„é€»è¾‘å®ç°å³å¯ï¼Œå¯èƒ½ä¼šé…ç½®ä¸€äº›é»˜è®¤å€¼è€Œå·²ã€‚</p><hr><p>ä¸‹é¢æ˜¯æ ¸å¿ƒçš„æŠ“å–é€»è¾‘ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä½¿ç”¨å¯¹åº”æ’ä»¶çš„ <code>Client</code> è·å–ä¸€äº›æ ¸å¿ƒæŒ‡æ ‡å°è£…ä¸º <code>Prometheus</code> çš„ <code>Metric</code>ï¼Œç„¶åç”± <code>cprobe</code> å†™å…¥åˆ°è¿œç«¯çš„ <code>Prometheus</code> ä¸­(æˆ–è€…æ˜¯å…¼å®¹ <code>Prometheus</code> çš„æ•°æ®åº“ä¸­)ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Create client</span></span><br><span class="line">config.HttpClient.Timeout = opts.Timeout  </span><br><span class="line">config.HttpClient.Transport = transport  </span><br><span class="line">  </span><br><span class="line">client, err := consul_api.NewClient(config)  </span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">var</span> requestLimitChan <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;  </span><br><span class="line"><span class="keyword">if</span> opts.RequestLimit &gt; <span class="number">0</span> &#123;  </span><br><span class="line">    requestLimitChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, opts.RequestLimit)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/01/25/Hbnqz36wSDohuBJ.png"><br>æ‰€æœ‰çš„æŒ‡æ ‡æ•°æ®éƒ½æ˜¯é€šè¿‡å¯¹åº”çš„å®¢æˆ·ç«¯è·å–ã€‚</p><p>å¦‚æœæ˜¯è¿ç§»ä¸€ä¸ªå­˜åœ¨çš„  export åˆ° cprobe ä¸­æ—¶ï¼Œè¿™äº›æŠ“å–ä»£ç æˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥å¤åˆ¶å¯¹åº” <a href="https://github.com/prometheus/consul_exporter">repo</a> ä¸­çš„ä»£ç ã€‚</p><p>æ¯”å¦‚æˆ‘å°±æ˜¯å‚è€ƒçš„ï¼š<a href="https://github.com/prometheus/consul_exporter">https://github.com/prometheus/consul_exporter</a></p><p>é™¤éæˆ‘ä»¬æ˜¯é‡æ–°å†™ä¸€ä¸ªæ’ä»¶ï¼Œä¸ç„¶å¯¹äºä¸€äº›æµè¡Œçš„åº“æˆ–è€…æ˜¯ä¸­é—´ä»¶éƒ½å·²ç»æœ‰å¯¹åº”çš„ <code>exporter</code> äº†ã€‚</p><p>å…·ä½“çš„åˆ—è¡¨å¯ä»¥å‚è€ƒè¿™é‡Œï¼š<br><a href="https://prometheus.io/docs/instrumenting/exporters/">https://prometheus.io/docs/instrumenting/exporters/</a></p><p><img src="https://s2.loli.net/2024/01/25/6DEKwyWqA3MBm8f.png"></p><p>ä¹‹åä¾¿éœ€è¦åœ¨å¯¹åº”çš„æ’ä»¶ç›®å½•(<code>./conf.d</code>)åˆ›å»ºæˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼š<br><img src="https://s2.loli.net/2024/01/25/BJuyoqNtmvZ15wr.png"></p><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œå¯ä»¥åœ¨å¯åŠ¨ cprobe æ—¶æ·»åŠ  <code>-no-writer</code> è®©æŒ‡æ ‡æ‰“å°åœ¨æ§åˆ¶å°ï¼Œä»è€Œæ–¹ä¾¿è°ƒè¯•ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¹‹å‰å°±æœ‰äººé—®æˆ‘æœ‰æ²¡æœ‰æ¯•ç«Ÿå¥½ä¸Šæ‰‹çš„å¼€æºé¡¹ç›®ï¼Œè¿™ä¸å°±æ¥äº†å—ï¼Ÿ</p><p>æ­£å¥½ç›®å‰é¡¹ç›®åˆ›å»ºæ—¶é—´ä¸é•¿ï¼Œä»£ç å’ŒåŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒåŒæ—¶è¿˜æœ‰å¯è§‚å¯Ÿç³»ç»Ÿå¤§ä½¬å¸¦é˜Ÿï¼Œç¡®å®æ˜¯ä¸€ä¸ªéå¸¸é€‚åˆæ–°æ‰‹å‚ä¸çš„å¼€æºé¡¹ç›®ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š</p><p><a href="https://github.com/cprobe/cprobe">https://github.com/cprobe/cprobe</a></p><h1 id="ç§è´§"><a href="#ç§è´§" class="headerlink" title="ç§è´§"></a>ç§è´§</h1><p><img src="https://s2.loli.net/2024/01/25/2K3um8dPlfneyLw.png"></p><p>æœ€åå¤¹å¸¦ä¸€ç‚¹ç§è´§ï¼šå‰ä¸¤å¤©å¸®ä¸€ä¸ªè¯»è€…æœ‹å‹åšäº†ä¸€æ¬¡ä»˜è´¹çš„æŠ€æœ¯å’¨è¯¢ï¼ˆä¸»è¦æ˜¯å…³äº Pulsar ç›¸å…³çš„ï¼‰ï¼Œä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡åšä»˜è´¹å†…å®¹ï¼Œè¿™ç§æ‹¿äººé’±è´¢æ›¿äººæ¶ˆç¾éš¾é“å°±æ˜¯çŸ¥è¯†ä»˜è´¹çš„å‘³é“å—ğŸ˜‚ï¼Ÿ</p><p><img src="https://s2.loli.net/2024/01/25/LJq6xlowRmdnrHv.png"></p><p>æ‰€ä»¥æˆ‘å°±è¶çƒ­æ‰“é“åœ¨æœ‹å‹åœˆå‘äº†ä¸ªå¹¿å‘Šï¼Œæ²¡æƒ³åˆ°åˆæœ‰ä¸ªæœ‹å‹æ‰¾æˆ‘åšå…³äºèŒåœºç›¸å…³å’¨è¯¢ï¼Œæœ€åèƒ½å¸®åŠ©åˆ°å¯¹æ–¹è‡ªå·±ä¹Ÿå¾ˆå¼€å¿ƒã€‚</p><p>å…¶å®ç»å¸¸ä¹Ÿæœ‰äººé€šè¿‡ç¤¾åª’ã€é‚®ä»¶ç­‰æ¸ é“æ‰¾æˆ‘å¸®å¿™çœ‹é—®é¢˜ï¼Œä¸€äº›ç®€å•çš„æˆ‘é€šå¸¸ä¹Ÿä¼šæŠ½æ—¶é—´å›å¤ã€‚</p><p>ä½†åé¢è¿™ä½æœ‹å‹ä¹Ÿæåˆ°ï¼Œå¦‚æœæˆ‘ä¸æ˜¯ä»˜è´¹ï¼Œä»–ä¹Ÿä¸å¥½æ„æ€æ¥æ‰¾æˆ‘èŠè¿™äº›å†…å®¹ï¼Œæ¯•ç«Ÿæ¶‰åŠåˆ°ä¸€äº›éšç§ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦å ç”¨åŒæ–¹ 1ï½2 å°æ—¶çš„æ—¶é—´ã€‚</p><p>è¿™æ ·æ˜ç æ ‡ä»·çš„æ–¹å¼ç¡®å®ä¹Ÿèƒ½æ›´æ–¹ä¾¿çš„æ²Ÿé€šï¼ŒåŒæ—¶ä¹Ÿèƒ½å‡è½»å¯¹æ–¹çš„å¿ƒé‡Œè´Ÿæ‹…ï¼Œç›´æ¥ä»ç™½å«–è½¬ä¸ºä»˜è´¹å¤§ä½¬ã€‚</p><p>é“ºå«äº†è¿™ä¹ˆå¤šï¼Œä¸»è¦ç›®çš„æ˜¯æƒ³è¿›è¡Œä¸€ä¸ªå°èŒƒå›´çš„å°è¯•ï¼Œå¦‚æœå¯¹ä»¥ä¸‹å†…å®¹æ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿åŠ æˆ‘å¾®ä¿¡ç§èŠï¼š</p><blockquote><p>åŒ…æ‹¬ä½†ä¸é™äºæŠ€æœ¯ã€èŒåœºã€å¼€æºç­‰æˆ‘æœ‰ç»éªŒçš„è¡Œä¸šéƒ½å¯ä»¥èŠã€‚</p></blockquote><p><img src="https://s2.loli.net/2024/01/25/brqMxl5ZBvRz3mu.jpg"></p><p>åé¦ˆä¸é”™çš„è¯ä¹Ÿéœ€è¦å¯ä»¥ä½œä¸ºæˆ‘çš„é•¿æœŸå‰¯ä¸šåšä¸‹å»ã€‚<br>#Blog </p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´æ— æ„é—´çœ‹åˆ°ä¸€ç¯‡å…¬ä¼—å· &lt;a href=&quot;https://mp.weixin.qq.com/s/T8B3XnXd30vT7OvsFTnaFw&quot;&gt;æ‹›è´¤ä»¤ï¼šä¸€èµ·æ¥æä¸€ä¸ªæ–°å¼€æºé¡¹ç›®&lt;/a&gt;ï¼Œä½œè€…ä»‹ç»ä»–æƒ³è¦åšä¸€ä¸ªå¼€æºé¡¹ç›®ï¼š&lt;a href=&quot;https://github.com/cprobe/cprobe&quot;&gt;cprobe&lt;/a&gt; ç”¨äºæ•´åˆç›®å‰å¸‚é¢ä¸Šæ•£è½åœ¨å„åœ°çš„ &lt;code&gt;Exporter&lt;/code&gt;ï¼Œç»Ÿä¸€è¿›è¡Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ &lt;code&gt;blackbox_exporter/mysqld_exporter&lt;/code&gt; ç­‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥å¾€çš„æ¯ä¸€ä¸ª Exporter éƒ½éœ€è¦å•ç‹¬éƒ¨ç½²è¿ç»´ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="OpenSource" scheme="http://crossoverjie.top/tags/OpenSource/"/>
    
    <category term="å¼€æº" scheme="http://crossoverjie.top/tags/%E5%BC%80%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>ç™½è¯ Pulsar Bookkeeper çš„å­˜å‚¨æ¨¡å‹</title>
    <link href="http://crossoverjie.top/2024/01/15/ob/Bookkeeper-storage/"/>
    <id>http://crossoverjie.top/2024/01/15/ob/Bookkeeper-storage/</id>
    <published>2024-01-15T11:20:59.000Z</published>
    <updated>2024-01-15T15:30:41.385Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2024/01/15/xU7FZCPjckRMBAD.png"></p><p>æœ€è¿‘æˆ‘ä»¬çš„ Pulsar å­˜å‚¨æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´æ•°æ®ä¸€ç›´å¾—ä¸åˆ°å›æ”¶ï¼Œä½†æ¶ˆæ¯ç¡®å®å·²ç»æ˜¯ ACK äº†ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯ä¼šè¢«å›æ”¶çš„ï¼Œéšç€æ—¶é—´æµé€ä¸ä½†æ²¡å›æ”¶è¿˜ä¸€ç›´å†æ¶¨ï¼Œæœ€ååœ¨æ²¡æ‰¾åˆ°åŸå› çš„æƒ…å†µä¸‹å°±åªæœ‰ä¸€ç›´ä¸åœçš„æ‰©å®¹ã€‚</p><blockquote><p>æœ€åç£ç›˜æ˜¯å¾—åˆ°äº†å›æ”¶ï¼Œè¿‡ç¨‹å…ˆä¸è¡¨ï¼Œä¹‹åå†è®¨è®ºã€‚</p></blockquote><p>ä¸ºäº†é˜²æ­¢ç±»ä¼¼çš„é—®é¢˜å†æ¬¡å‘ç”Ÿï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥ç›‘æ§åˆ°ç£ç›˜ç»´åº¦ï¼Œèƒ½å¤Ÿåˆ—å‡ºå„ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ä»¥åŠåˆ›å»ºæ—¶é—´ã€‚</p><p>è¿™æ—¶å°±éœ€è¦å¯¹ <code>Pulsar</code> çš„å­˜å‚¨æ¨¡å‹æœ‰ä¸€å®šçš„äº†è§£ï¼Œä¹Ÿå°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p><span id="more"></span><p><img src="https://s2.loli.net/2024/01/15/EjpuQKJN5MVIW8r.png" alt="image.png"><br>è®²åˆ° Pulsar çš„å­˜å‚¨æ¨¡å‹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ Bookkeeper çš„å­˜å‚¨æ¨¡å‹ã€‚</p><p>Pulsar æ‰€æœ‰çš„æ¶ˆæ¯è¯»å†™éƒ½æ˜¯é€šè¿‡ Bookkeeper å®ç°çš„ã€‚</p><blockquote><p><code>Bookkeeper</code> æ˜¯ä¸€ä¸ªå¯æ‰©å±•ã€å¯å®¹é”™ã€ä½å»¶è¿Ÿçš„æ—¥å¿—å­˜å‚¨æ•°æ®åº“ï¼ŒåŸºäº Append Only æ¨¡å‹ã€‚ï¼ˆæ•°æ®åªèƒ½è¿½åŠ ä¸èƒ½ä¿®æ”¹ï¼‰</p></blockquote><p><img src="https://s2.loli.net/2024/01/15/tMITYocL89ZapVG.png" alt="image.png"></p><p>è¿™é‡Œæˆ‘åˆ©ç”¨ Pulsar å’Œ Bookkeeper çš„ Admin API åˆ—å‡ºäº† Broker å’Œ BK ä¸­ Ledger åˆ†åˆ«å ç”¨çš„ç£ç›˜ç©ºé—´ã€‚</p><blockquote><p>å…³äºè¿™ä¸ªå¦‚ä½•è·å–å’Œè®¡ç®—çš„ï¼Œåç»­ä¹Ÿå‡†å¤‡æäº¤ç»™ç¤¾åŒºã€‚</p></blockquote><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä½†å’Œæˆ‘ä»¬å®é™… <code>kubernetes</code> ä¸­çš„ç£ç›˜å ç”¨é‡ä¾ç„¶å¯¹ä¸ä¸Šï¼Œæ‰€ä»¥å°±æƒ³çœ‹çœ‹åœ¨ BK ä¸­å®é™…çš„å­˜å‚¨æ—¥å¿—å’Œ <code>Ledger</code> åˆ°åº•å·®åœ¨å“ªé‡Œã€‚</p><blockquote><p>çŸ¥é“ Ledger å°±å¯ä»¥é€šè¿‡ Ledger çš„å…ƒæ•°æ®ä¸­æ‰¾åˆ°å¯¹åº”çš„ topicï¼Œä»è€Œåˆ¤æ–­å“ªäº› topic çš„æ•°æ®å¯¼è‡´ç»Ÿè®¡ä¸èƒ½åŒ¹é…ã€‚</p></blockquote><p>Bookkeeper æœ‰ææä¾›ä¸€ä¸ªAdmin API å¯ä»¥è¿”å›å½“å‰ BK æ‰€ä½¿ç”¨äº†å“ªäº›æ—¥å¿—æ–‡ä»¶çš„æ¥å£:<br><a href="https://bookkeeper.apache.org/docs/admin/http#endpoint-apiv1bookielist_disk_filefile_typetype">https://bookkeeper.apache.org/docs/admin/http#endpoint-apiv1bookielist_disk_filefile_typetype</a></p><p><img src="https://s2.loli.net/2024/01/15/ZOMcNSG53Ttz4eo.png"></p><p>ä»è¿”å›çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè½åˆ°å…·ä½“çš„ç£ç›˜ä¸Šåªæœ‰ä¸€ä¸ªæ–‡ä»¶åç§°ï¼Œæ˜¯æ— æ³•çŸ¥é“å…·ä½“å’Œå“ªäº› Ledger è¿›è¡Œå…³è”çš„ï¼Œä¹Ÿå°±æ— æ³•çŸ¥é“å…·ä½“çš„ topic äº†ã€‚</p><p>æ­¤æ—¶åªèƒ½å¤§èƒ†å‡è®¾ï¼Œåº”è¯¥æ¯ä¸ªæ–‡ä»¶å’Œå…·ä½“çš„æ¶ˆæ¯ ID æœ‰ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•ã€‚<br>æ‰€ä»¥éœ€è¦ææ¸…æ¥šè¿™ä¸ªç´¢å¼•æ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p><h1 id="å­˜å‚¨æ¨¡å‹"><a href="#å­˜å‚¨æ¨¡å‹" class="headerlink" title="å­˜å‚¨æ¨¡å‹"></a>å­˜å‚¨æ¨¡å‹</h1><p><img src="https://s2.loli.net/2024/01/15/uvPC1Y8kdOJ3m5B.png"></p><p>æˆ‘æŸ¥é˜…äº†ä¸€äº›ç½‘ä¸Šçš„æ–‡ç« å’Œæºç å¤§æ¦‚æ¢³ç†äº†ä¸€ä¸ªå­˜å‚¨æµç¨‹ï¼š</p><ol><li>BK æ”¶åˆ°å†™å…¥è¯·æ±‚ï¼Œæ•°æ®ä¼šå¼‚æ­¥å†™å…¥åˆ° <code>Journal</code>&#x2F;<code>Entrylog</code></li><li>Journal ç›´æ¥é¡ºåºå†™å…¥ï¼Œå¹¶ä¸”ä¼šå¿«é€Ÿæ¸…é™¤å·²ç»å†™å…¥çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦çš„ç£ç›˜ç©ºé—´ä¸å¤šï¼ˆæ‰€ä»¥ä»ç›‘æ§ä¸­å…¶å®å¯ä»¥çœ‹åˆ° Journal çš„ç£ç›˜å æœ‰ç‡æ˜¯å¾ˆä½çš„ï¼‰ã€‚</li><li>è€ƒè™‘åˆ°ä¼šéšæœºè¯»æ¶ˆæ¯ï¼ŒEntryLog åœ¨å†™å…¥å‰è¿›è¡Œæ’åºï¼Œä¿è¯è½ç›˜çš„æ•°æ®ä¸­åŒä¸€ä¸ª Ledger çš„æ•°æ®å°½é‡æŒ¨åœ¨ä¸€èµ·ï¼Œå……åˆ†åˆ©ç”¨ PageCache.</li><li>æœ€ç»ˆæ•°æ®çš„ç´¢å¼•é€šè¿‡ <code>LedgerId+EntryId</code> ç”Ÿæˆç´¢å¼•ä¿¡æ¯å­˜æ”¾åˆ° <code>RockDB</code> ä¸­ï¼ˆ<code>Pulsar</code> çš„åœºæ™¯ä½¿ç”¨çš„æ˜¯ <code>DbLedgerStorage</code> å®ç°ï¼‰ã€‚</li><li>è¯»å–æ•°æ®æ—¶å…ˆä»è·å–ç´¢å¼•ï¼Œç„¶åå†ä»ç£ç›˜è¯»å–æ•°æ®ã€‚</li><li>åˆ©ç”¨ <code>Journal</code> å’Œ <code>EntryLog</code> å®ç°æ¶ˆæ¯çš„è¯»å†™åˆ†ç¦»ã€‚</li></ol><p>ç®€å•æ¥è¯´ BK åœ¨å­˜å‚¨æ•°æ®çš„æ—¶å€™ä¼šè¿›è¡ŒåŒå†™ï¼Œ<code>Journal</code> ç›®å½•ç”¨äºå­˜æ”¾å†™çš„æ•°æ®ï¼Œå¯¹æ¶ˆæ¯é¡ºåºæ²¡æœ‰è¦æ±‚ï¼Œå†™å®Œåå°±å¯ä»¥æ¸…é™¤äº†ã€‚</p><p>è€Œ <code>Entry</code> ç›®å½•ä¸»è¦ç”¨äºåç»­æ¶ˆè´¹æ¶ˆæ¯è¿›è¡Œè¯»å–ä½¿ç”¨ï¼Œå¤§éƒ¨åˆ†åœºæ™¯éƒ½æ˜¯é¡ºåºè¯»ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™å¾ˆå°‘ä¼šå›æº¯ï¼Œæ‰€ä»¥éœ€è¦å……åˆ†åˆ©ç”¨ç£ç›˜çš„ PageCacheï¼Œå°†é¡ºåºçš„æ¶ˆæ¯å°½é‡çš„å­˜å‚¨åœ¨ä¸€èµ·ã€‚</p><blockquote><p>åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­å¯èƒ½ä¼šå­˜æ”¾å¤šä¸ª Ledger çš„æ¶ˆæ¯ï¼Œè¿™äº›æ•°æ®å¦‚æœä¸æ’åºç›´æ¥å†™å…¥å°±ä¼šå¯¼è‡´ä¹±åºï¼Œè€Œæ¶ˆè´¹æ—¶å¤§æ¦‚ç‡æ˜¯é¡ºåºçš„ï¼Œä½†å…·ä½“åˆ°ç£ç›˜çš„è¡¨ç°å°±æ˜¯éšæœºè¯»äº†ï¼Œè¿™æ ·è¯»å–æ•ˆç‡è¾ƒä½ã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>Helm</code> éƒ¨ç½² <code>Bookkeeper</code> çš„æ—¶å€™éœ€è¦åˆ†åˆ«æŒ‡å®š <code>journal</code> å’Œ <code>ledgers</code> çš„ç›®å½•</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span>  </span><br><span class="line">  <span class="comment"># use a persistent volume or emptyDir  </span></span><br><span class="line">  <span class="attr">persistence:</span> <span class="literal">true</span>  </span><br><span class="line">  <span class="attr">journal:</span>  </span><br><span class="line">    <span class="attr">name:</span> <span class="string">journal</span>  </span><br><span class="line">    <span class="attr">size:</span> <span class="string">20Gi</span>  </span><br><span class="line">    <span class="attr">local_storage:</span> <span class="literal">false</span>  </span><br><span class="line">    <span class="attr">multiVolumes:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">journal0</span>  </span><br><span class="line">        <span class="attr">size:</span> <span class="string">10Gi</span>  </span><br><span class="line">        <span class="comment"># storageClassName: existent-storage-class  </span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/pulsar/data/bookkeeper/journal0</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">journal1</span>  </span><br><span class="line">        <span class="attr">size:</span> <span class="string">10Gi</span>  </span><br><span class="line">        <span class="comment"># storageClassName: existent-storage-class  </span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/pulsar/data/bookkeeper/journal1</span>  </span><br><span class="line">  <span class="attr">ledgers:</span>  </span><br><span class="line">    <span class="attr">name:</span> <span class="string">ledgers</span>  </span><br><span class="line">    <span class="attr">size:</span> <span class="string">50Gi</span>  </span><br><span class="line">    <span class="attr">local_storage:</span> <span class="literal">false</span>  </span><br><span class="line">    <span class="attr">storageClassName:</span> <span class="string">sc</span></span><br><span class="line">    <span class="comment"># storageClass:  </span></span><br><span class="line">      <span class="comment"># ...    useMultiVolumes: false  </span></span><br><span class="line">    <span class="attr">multiVolumes:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ledgers0</span>  </span><br><span class="line">        <span class="attr">size:</span> <span class="string">1000Gi</span>  </span><br><span class="line">        <span class="comment"># storageClassName: existent-storage-class  </span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/pulsar/data/bookkeeper/ledgers0</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ledgers1</span>  </span><br><span class="line">        <span class="attr">size:</span> <span class="string">1000Gi</span>  </span><br><span class="line">        <span class="comment"># storageClassName: existent-storage-class  </span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/pulsar/data/bookkeeper/ledgers1</span></span><br></pre></td></tr></table></figure><hr><p><img src="https://s2.loli.net/2024/01/15/nJeNDFbu2MIQp5a.png"><br>æ¯æ¬¡åœ¨å†™å…¥å’Œè¯»å–æ•°æ®çš„æ—¶å€™éƒ½éœ€è¦é€šè¿‡æ¶ˆæ¯ ID ä¹Ÿå°±æ˜¯ ledgerId å’Œ entryId æ¥è·å–ç´¢å¼•ä¿¡æ¯ã€‚</p><blockquote><p>ä¹Ÿå°è¯äº†ä¹‹å‰ç´¢å¼•çš„çŒœæµ‹ã€‚</p></blockquote><p>æ‰€ä»¥å€ŸåŠ©äº BK è¯»å†™åˆ†ç¦»çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å•ç‹¬ä¼˜åŒ–å­˜å‚¨ã€‚</p><p>æ¯”å¦‚å†™å…¥ <code>Journal</code> çš„ç£ç›˜å› ä¸ºæ˜¯é¡ºåºå†™å…¥ï¼Œæ‰€ä»¥å³ä¾¿æ˜¯æ™®é€šçš„ <code>HDD</code> ç¡¬ç›˜é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚</p><p>å¤§éƒ¨åˆ†åœºæ™¯ä¸‹éƒ½æ˜¯è¯»å¤§äºå†™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å•ç‹¬ä¸º <code>Ledger</code> åˆ†é…é«˜æ€§èƒ½ SSD ç£ç›˜ï¼ŒæŒ‰éœ€ä½¿ç”¨ã€‚</p><blockquote><p>å› ä¸ºåœ¨æœ€åº•å±‚çš„æ—¥å¿—æ–‡ä»¶ä¸­æ— æ³•ç›´æ¥é€šè¿‡ ledgerId å¾—çŸ¥å ç”¨ç£ç›˜çš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å®é™…çš„ç£ç›˜å ç”¨ç‡å¯¹ä¸ä¸Šçš„é—®é¢˜ä¾ç„¶æ²¡æœ‰å¾—åˆ°è§£å†³ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘è¿˜ä¼šæŒç»­è·Ÿè¿›ï¼Œæœ‰æ–°çš„è¿›å±•å†ç»§ç»­åŒæ­¥ã€‚</p></blockquote><p>#Blog #Pulsar </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/01/15/xU7FZCPjckRMBAD.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘æˆ‘ä»¬çš„ Pulsar å­˜å‚¨æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´æ•°æ®ä¸€ç›´å¾—ä¸åˆ°å›æ”¶ï¼Œä½†æ¶ˆæ¯ç¡®å®å·²ç»æ˜¯ ACK äº†ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯ä¼šè¢«å›æ”¶çš„ï¼Œéšç€æ—¶é—´æµé€ä¸ä½†æ²¡å›æ”¶è¿˜ä¸€ç›´å†æ¶¨ï¼Œæœ€ååœ¨æ²¡æ‰¾åˆ°åŸå› çš„æƒ…å†µä¸‹å°±åªæœ‰ä¸€ç›´ä¸åœçš„æ‰©å®¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ€åç£ç›˜æ˜¯å¾—åˆ°äº†å›æ”¶ï¼Œè¿‡ç¨‹å…ˆä¸è¡¨ï¼Œä¹‹åå†è®¨è®ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢ç±»ä¼¼çš„é—®é¢˜å†æ¬¡å‘ç”Ÿï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥ç›‘æ§åˆ°ç£ç›˜ç»´åº¦ï¼Œèƒ½å¤Ÿåˆ—å‡ºå„ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ä»¥åŠåˆ›å»ºæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ—¶å°±éœ€è¦å¯¹ &lt;code&gt;Pulsar&lt;/code&gt; çš„å­˜å‚¨æ¨¡å‹æœ‰ä¸€å®šçš„äº†è§£ï¼Œä¹Ÿå°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
    <category term="Bookkeeper" scheme="http://crossoverjie.top/tags/Bookkeeper/"/>
    
  </entry>
  
  <entry>
    <title>æŠ€æœ¯é˜…è¯»å‘¨åˆŠç¬¬åå››æœŸï¼šGolang ä½œè€… Rob Pike åœ¨ GopherConAU ä¸Šçš„åˆ†äº«</title>
    <link href="http://crossoverjie.top/2024/01/12/ob/newsletter/Newsletter12-202401012/"/>
    <id>http://crossoverjie.top/2024/01/12/ob/newsletter/Newsletter12-202401012/</id>
    <published>2024-01-12T09:28:25.000Z</published>
    <updated>2024-01-11T09:59:20.030Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2024/01/11/YMoyEKwUubfZA9a.png"></p><p><strong>æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚</strong></p><span id="more"></span><h2 id="å†å²æ›´æ–°"><a href="#å†å²æ›´æ–°" class="headerlink" title="å†å²æ›´æ–°"></a>å†å²æ›´æ–°</h2><ul><li><a href="https://crossoverjie.top/2023/12/15/ob/newsletter/Newsletter10-20231215/">20231215ï¼šç¬¬åæœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/22/ob/newsletter/Newsletter10-20231222/">20231122ï¼šç¬¬åä¸€æœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/29/ob/newsletter/Newsletter12-20231229/">20231129ï¼šç¬¬åäºŒæœŸ</a></li><li><a href="https://crossoverjie.top/2024/01/05/ob/newsletter/Newsletter12-20240105/">20240105ï¼šç¬¬åä¸‰æœŸï¼šä¸€äº›æé«˜ç”Ÿäº§åŠ›çš„ç»ˆç«¯å‘½ä»¤</a></li></ul><h2 id="What-We-Got-Right-What-We-Got-Wrong"><a href="#What-We-Got-Right-What-We-Got-Wrong" class="headerlink" title="What We Got Right, What We Got Wrong"></a>What We Got Right, What We Got Wrong</h2><p>URL: <a href="https://commandcenter.blogspot.com/2024/01/what-we-got-right-what-we-got-wrong.html?utm_source=changelog-news">https://commandcenter.blogspot.com/2024/01/what-we-got-right-what-we-got-wrong.html?utm_source=changelog-news</a></p><blockquote><p>æœ¬æ–‡æ˜¯ <code>Golang</code> æ ¸å¿ƒä½œè€…ä¹‹ä¸€  <a href="http://robpike.blogspot.com/">Rob Pike</a> å»å¹´åº•åœ¨æ¾³å¤§åˆ©äºš GopherConAU ä¼šè®®ä¸Šçš„åˆ†äº«ï¼›æ€»ç»“äº† Go è¯­è¨€ 14 å¹´æ¥çš„åšå¯¹äº†å“ªäº›äº‹æƒ…ã€åšé”™äº†å“ªäº›äº‹æƒ…ã€‚</p></blockquote><p><img src="https://s2.loli.net/2024/01/10/1MRo4ZTPwzmd6F2.png"></p><p>ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>è¯­è¨€æ¶‰åŠ</li><li>ç¤¾åŒºç®¡ç†</li><li>é¡¹ç›®è¿è¥<br>ç­‰æ–¹é¢ï¼Œæ„Ÿå…´è¶£çš„è¿˜å¯ä»¥çœ‹æ²¹ç®¡è§†é¢‘ã€‚<br><a href="https://www.youtube.com/watch?v=yE5Tpp2BSGw">https://www.youtube.com/watch?v=yE5Tpp2BSGw</a></li></ul><h2 id="Top-10-Platform-Engineering-Tools-You-Should-Consider-in-2024-by-Romaric-Philogene-Jan-2024-Medium"><a href="#Top-10-Platform-Engineering-Tools-You-Should-Consider-in-2024-by-Romaric-Philogene-Jan-2024-Medium" class="headerlink" title="Top 10 Platform Engineering Tools You Should Consider in 2024 | by Romaric PhilogÃ¨ne | Jan, 2024 | Medium"></a>Top 10 Platform Engineering Tools You Should Consider in 2024 | by Romaric PhilogÃ¨ne | Jan, 2024 | Medium</h2><p>URL: <a href="https://medium.com/@rphilogene/top-10-platform-engineering-tools-you-should-consider-in-2024-892e6e211b85">https://medium.com/@rphilogene/top-10-platform-engineering-tools-you-should-consider-in-2024-892e6e211b85</a><br><img src="https://s2.loli.net/2024/01/11/VUhodB7rn12lYwR.png"></p><blockquote><p>æœ¬æ–‡ä»‹ç»äº†ä½œä¸ºä¸€ä¸ªå¹³å°å·¥ç¨‹å¸ˆéœ€è¦æŒæ¡çš„å·¥å…·ã€‚</p></blockquote><p>å…ˆå®šä¹‰äº†ä»€ä¹ˆæ˜¯å¹³å°å·¥ç¨‹å¸ˆï¼š<br>ä¸ºç ”å‘äººå‘˜æä¾›å¹³å°èµ„æºè¿›è¡Œå¼€å‘ï¼Œè®©å¼€å‘äººå‘˜å¯ä»¥åœ¨äº‘ç¯å¢ƒä¸­è‡ªåŠ©å®Œæˆæ•´ä¸ªè½¯ä»¶ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªç¯èŠ‚ï¼Œæ¯”å¦‚åŸºç¡€ç¯å¢ƒæ­å»ºã€ä»£ç  pipelinesã€ç›‘æ§ç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¼šç”¨åˆ°çš„å·¥å…·ï¼š</p><ul><li>kubernetesï¼šè¿™ä¸ªå°±ä¸ç”¨å¤šè®²äº†ã€‚</li><li>Crossplaneï¼šç”¨äºç®¡ç†å¤šé›†ç¾¤çš„ kubernetes</li><li>Qoveryï¼šå†…éƒ¨å¼€å‘è€…å¹³å°</li><li>Github&#x2F;Gitlab CI&#x2F;CD</li><li>ArgoCDï¼škubernetes åŸç”Ÿæä¾›çš„æŒç»­éƒ¨ç½²å·¥å…·ã€‚</li><li>Docker</li><li>Terraformï¼š åŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–å·¥å…·,å¯ä»¥é€šè¿‡å£°æ˜å¼é…ç½®æ–‡ä»¶å®ç°å¤šäº‘åŸºç¡€è®¾æ–½çš„éƒ¨ç½²å’Œç®¡ç†ã€‚</li><li>Datadogï¼šç›‘æ§å’Œæ—¥å¿—åˆ†æå¹³å°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Prometheus&#x2F;Grafana ç­‰</li></ul><h2 id="Load-Balancing-Algorithms-Explained-Visually"><a href="#Load-Balancing-Algorithms-Explained-Visually" class="headerlink" title="Load Balancing Algorithms Explained Visually"></a>Load Balancing Algorithms Explained Visually</h2><p>URL: <a href="https://blog.quastor.org/p/load-balancing-algorithms-explained-visually?utm_source=tldrwebdev">https://blog.quastor.org/p/load-balancing-algorithms-explained-visually?utm_source=tldrwebdev</a></p><blockquote><p>æœ¬æ–‡ä»‹ç»äº†ä¸€äº›è´Ÿè½½å‡è¡¡ç®—æ³•ä»¥åŠå…¶ä¼˜ç¼ºç‚¹ã€‚</p></blockquote><p><img src="https://s2.loli.net/2024/01/11/NGV9YWJ6g7Dx2sy.gif" alt="Round Robin_1.gif"></p><ol><li><p>è½®è¯¢ç®—æ³•(Round Robin):æ¯ä¸ªè¯·æ±‚æŒ‰é¡ºåºåˆ†é…åˆ°ä¸åŒæœåŠ¡å™¨ã€‚å®ç°ç®€å•,ä½†ä¸èƒ½è€ƒè™‘æœåŠ¡å™¨è´Ÿè½½æƒ…å†µã€‚</p></li><li><p>åŠ æƒè½®è¯¢(Weighted Round Robin):è€ƒè™‘æœåŠ¡å™¨æ€§èƒ½ç»™å„æœåŠ¡å™¨è®¾ç½®æƒé‡,è¯·æ±‚åˆ†é…æŒ‰æƒé‡æ¯”ä¾‹è¿›è¡Œã€‚ä»ç„¶ä¸èƒ½å®æ—¶ååº”æœåŠ¡å™¨è´Ÿè½½å˜åŒ–ã€‚</p></li><li><p>æœ€å°‘è¿æ¥æ•°(Least Connections):å®æ—¶ç›‘æµ‹å„æœåŠ¡å™¨è¿æ¥æ•°,å°†è¯·æ±‚åˆ†é…åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ä¸Šã€‚å®ç°è¾ƒå¤æ‚,éœ€è¦å®šæœŸæ¢æµ‹å„æœåŠ¡å™¨çŠ¶æ€ã€‚</p></li><li><p>æœ€çŸ­å“åº”æ—¶é—´(Least Response Time):ç›‘æµ‹å„æœåŠ¡å™¨å“åº”æ—¶é—´,åˆ†é…ç»™å“åº”æœ€å¿«çš„æœåŠ¡å™¨ã€‚</p></li><li><p>åŒéšæœºé€‰æ‹©(Power of Two Choices):éšæœºé€‰æ‹©ä¸¤å°æœåŠ¡å™¨,å°†è¯·æ±‚åˆ†é…ç»™è´Ÿè½½è¾ƒè½»çš„ä¸€å°ã€‚å‡å°‘ç›‘æµ‹å¼€é”€ã€‚</p></li><li><p>ä¸€è‡´å“ˆå¸Œ(Consistent Hashing):æ ¹æ®è¯·æ±‚å…³é”®ä¿¡æ¯è®¡ç®—å“ˆå¸Œå€¼,å°†è¯·æ±‚åˆ†é…ç»™å¯¹åº”çš„æœºå™¨èŒƒå›´ã€‚è§£å†³ä¸»æœºæ·»åŠ å’Œåˆ é™¤é—®é¢˜ã€‚</p></li><li><p>å…¶ä»–ç®—æ³•å¦‚æ ¹æ®ç£ç›˜ã€å†…å­˜åˆ©ç”¨ç‡è¿›è¡Œè´Ÿè½½åˆ†é…ç­‰ã€‚</p></li></ol><h2 id="What-problem-did-Go-actually-solve-for-Google"><a href="#What-problem-did-Go-actually-solve-for-Google" class="headerlink" title="What problem did Go actually solve for Google"></a>What problem did Go actually solve for Google</h2><p>URL: <a href="https://www.reddit.com/r/golang/comments/176b5pn/what_problem_did_go_actually_solve_for_google/">https://www.reddit.com/r/golang/comments/176b5pn/what_problem_did_go_actually_solve_for_google/</a></p><blockquote><p>è¿™æ˜¯ä¸€ä¸ª Reddit ä¸Šçš„å¸–å­ï¼ŒOP çš„é—®é¢˜æ˜¯ Rob åœ¨ä¹‹å‰çš„åˆ†äº«ä¸­æåˆ° Golang åˆ›å»ºçš„åŸå› æ˜¯è¦è§£å†³ Google å†…éƒ¨çš„é—®é¢˜ï¼Œä½†æ²¡æœ‰å…·ä½“è®²  Google åˆ°åº•é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>ä»€ä¹ˆé—®é¢˜æ˜¯å‡ ç™¾ç§ç¼–ç¨‹è¯­è¨€éƒ½æ— æ³•è§£å†³çš„é—®é¢˜ï¼Ÿ</p></blockquote><p>ä»¥ä¸‹æ˜¯ä¸€äº›é«˜èµå›ç­”ï¼š</p><ul><li>æ›´å¿«çš„æœ¬åœ°ç¼–è¯‘é€Ÿåº¦</li><li>å¯¹æ–°æ‰‹æ¥è¯´æ›´å¥½ç†è§£çš„ä»£ç </li><li>æ›´ä¸¥æ ¼çš„ä»£ç é£æ ¼ï¼Œä½¿å¾—å¤§å®¶çš„ä»£ç éƒ½å·®ä¸å¤šã€‚</li><li>æ›´å®¹æ˜“ç¼–å†™å¹¶å‘ç¨‹åº</li></ul><p>æ€»ä½“æ¥è¯´, Go ä¸»è¦è§£å†³çš„æ˜¯åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä½•æ›´é«˜æ•ˆåœ°è¿›è¡Œåä½œå¼€å‘ã€å®ç°é«˜æ€§èƒ½åˆæ˜“ç»´æŠ¤ã€‚è¿™æ­£æ˜¯ Google å½“æ—¶æœ€å…³å¿ƒçš„é—®é¢˜ã€‚</p><p>æ–‡ç« é“¾æ¥ï¼š</p><ul><li><a href="https://commandcenter.blogspot.com/2024/01/what-we-got-right-what-we-got-wrong.html?utm_source=changelog-news">https://commandcenter.blogspot.com/2024/01/what-we-got-right-what-we-got-wrong.html?utm_source=changelog-news</a></li><li><a href="https://medium.com/@rphilogene/top-10-platform-engineering-tools-you-should-consider-in-2024-892e6e211b85">https://medium.com/@rphilogene/top-10-platform-engineering-tools-you-should-consider-in-2024-892e6e211b85</a></li><li><a href="https://blog.quastor.org/p/load-balancing-algorithms-explained-visually?utm_source=tldrwebdev">https://blog.quastor.org/p/load-balancing-algorithms-explained-visually?utm_source=tldrwebdev</a></li></ul><p>#Newletters </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/01/11/YMoyEKwUubfZA9a.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    <category term="Newsletter" scheme="http://crossoverjie.top/categories/OB/Newsletter/"/>
    
    
  </entry>
  
  <entry>
    <title>è¯·æ³¨æ„ï¼Œä½ çš„ Pulsar é›†ç¾¤å¯èƒ½æœ‰åˆ é™¤æ•°æ®çš„é£é™©</title>
    <link href="http://crossoverjie.top/2024/01/09/ob/Pulsar-Delete-Topic/"/>
    <id>http://crossoverjie.top/2024/01/09/ob/Pulsar-Delete-Topic/</id>
    <published>2024-01-09T15:04:58.000Z</published>
    <updated>2024-01-08T15:26:11.780Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸Šä¸€ç¯‡ <a href="https://crossoverjie.top/2024/01/03/ob/Pulsar3.0-new-feature/#topic%E8%A2%AB%E5%88%A0%E9%99%A4">Pulsar3.0æ–°åŠŸèƒ½ä»‹ç»</a>ä¸­æåˆ°ï¼Œåœ¨å‡çº§åˆ° 3.0 çš„è¿‡ç¨‹ä¸­ç¢°åˆ°ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯å‡çº§ä¹‹å topic è¢«åˆ é™¤äº†ã€‚</p><p>æ­£å¥½æœ€è¿‘ç¤¾åŒºä¹Ÿè¡¥å……äº†ç›¸å…³ç»†èŠ‚ï¼Œæœ¬æ¬¡ä¹Ÿæ¥ç€è¿™ä¸ªæœºä¼šå†æ¬¡å¤ç›˜ä¸€ä¸‹ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªéå¸¸è‡´å‘½çš„ Bugã€‚</p><span id="more"></span><p><img src="https://s2.loli.net/2024/01/08/MKFhYVL95C8qtHR.png"></p><h1 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h1><p>å…ˆæ¥å›é¡¾ä¸‹å½“æ—¶çš„æƒ…å†µï¼šå‡çº§å½“æ™šæ²¡æœ‰å‡ºç°å•¥é—®é¢˜ï¼Œå„ä¸ªæµé‡æŒ‡æ ‡ã€ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æ•°é‡éƒ½æ˜¯åœ¨æ­£å¸¸èŒƒå›´å†…æ³¢åŠ¨ã€‚</p><blockquote><p>äº‹åæ‰çŸ¥é“ï¼Œå› ä¸ºåªæ˜¯åˆ é™¤äº†å¾ˆå°‘ä¸€éƒ¨åˆ†çš„ topicï¼Œæ‰€ä»¥ä»ç›‘æ§ä¸­ååº”ä¸å‡ºæ¥ã€‚</p></blockquote><p>æ—©ä¸Šä¸Šç­åé™†ç»­æœ‰éƒ¨åˆ†ä¸šåŠ¡åé¦ˆåº”ç”¨è¿ä¸ä¸Š topicï¼Œæç¤º <code>topic nof found</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name <span class="string">&#x27;Producer&#x27;</span>: Invocation of init method failed; nested exception is org.apache.pulsar.client.api.PulsarClientException$TopicDoesNotExistException: Topic Not Found.</span><br></pre></td></tr></table></figure><p>å› ä¸ºåªæ˜¯éƒ¨åˆ†åº”ç”¨åœ¨åé¦ˆï¼Œæ‰€ä»¥èµ·åˆæ€€ç–‘æ˜¯ broker å‡çº§ä¹‹åå¯¼è‡´è€ç‰ˆæœ¬çš„ pulsar-client å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>æ‰€ä»¥æˆ‘å°±æ‹¿äº†å¹³æ—¶æµ‹è¯•ç”¨çš„ topic å†é…åˆå¤šä¸ªè€ç‰ˆæœ¬çš„ sdk è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°æ²¡æœ‰é—®é¢˜ã€‚</p><blockquote><p>ç›´åˆ°è¿™ä¸€æ­¥è¿˜å¥½ï¼Œè‡³å°‘è¯æ˜æ˜¯å°èŒƒæ•…éšœã€‚</p></blockquote><p>å› ä¸ºæç¤ºçš„æ˜¯ topic ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å°±å‡†å¤‡æŸ¥ä¸€ä¸‹ topic çš„å…ƒæ•°æ®æ˜¯å¦æ­£å¸¸ã€‚</p><p><img src="https://s2.loli.net/2024/01/08/My6KVsTkRaF3SwQ.png"><br>æŸ¥è¯¢åå‘ç°å…ƒæ•°æ®æ˜¯å­˜åœ¨çš„ã€‚</p><p>ä¹‹åæˆ‘ä¾¿æƒ³çœ‹çœ‹æç¤ºäº† topic ä¸å­˜åœ¨çš„ topic çš„å½’å±ï¼Œç„¶åå†çœ‹çœ‹é‚£ä¸ª broker ä¸­æ˜¯å¦æœ‰å¼‚å¸¸æ—¥å¿—ã€‚</p><p><img src="https://s2.loli.net/2024/01/08/rWRdnbmXkisMvLB.png"><br>å‘ç°æŸ¥çœ‹å½’å±çš„æ¥å£ä¹Ÿæ˜¯æç¤º topic ä¸å­˜åœ¨ï¼Œæ­¤æ—¶æˆ‘ä¾¿æ€€ç–‘æ˜¯ topic çš„è´Ÿè½½å‡ºç°äº†é—®é¢˜ï¼Œå¯¼è‡´è¿™äº› topic æ²¡æœ‰ç»‘å®šåˆ°å…·ä½“çš„ brokerã€‚</p><p>äºæ˜¯ä¾¿é‡å¯äº† brokerï¼Œç»“æœä¾ç„¶æ²¡æœ‰è§£å†³é—®é¢˜ã€‚<br><img src="https://s2.loli.net/2024/01/08/s3BhMvLCOR7ES2k.png"><br>ä¹‹åæˆ‘ä»¬æŸ¥è¯¢äº† topic çš„ internal state å‘ç°å…ƒæ•°æ®ä¸­ä¼šå°‘ä¸€ä¸ªåˆ†åŒºã€‚</p><h1 id="ç´§æ€¥æ¢å¤"><a href="#ç´§æ€¥æ¢å¤" class="headerlink" title="ç´§æ€¥æ¢å¤"></a>ç´§æ€¥æ¢å¤</h1><p>æˆ‘ä»¬å°è¯•å°†è¿™ä¸ªåˆ†åŒºæ•°æ¢å¤åï¼Œå‘ç°è¿™ä¸ª topic å°±å¯ä»¥æ­£å¸¸è¿æ¥äº†ã€‚</p><p>äºæ˜¯å†æŒ‘é€‰äº†å‡ ä¸ªå¼‚å¸¸çš„ topic å‘ç°éƒ½æ˜¯åŒæ ·çš„é—®é¢˜ï¼Œæ¢å¤åˆ†åŒºæ•°ä¹‹åä¹Ÿå¯ä»¥æ­£å¸¸è¿æ¥äº†ã€‚</p><p>æ‰€ä»¥æˆ‘å†™äº†ä¸€ä¸ªå·¥å…·éå†äº†æ‰€æœ‰çš„ topicï¼Œæ£€æµ‹åˆ†åŒºæ•°æ˜¯å¦æ­£å¸¸ï¼Œä¸æ­£å¸¸æ—¶ä¾¿ä¿®å¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">checkPartition</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="type">String</span> <span class="variable">namespace</span> <span class="operator">=</span> <span class="string">&quot;tenant/ns&quot;</span>;  </span><br><span class="line">    List&lt;String&gt; topicList = pulsarAdmin.topics().getPartitionedTopicList(namespace);  </span><br><span class="line">    <span class="keyword">for</span> (String topic : topicList) &#123;  </span><br><span class="line">        <span class="type">PartitionedTopicStats</span> <span class="variable">stats</span> <span class="operator">=</span> pulsarAdmin.topics().getPartitionedStats(topic, <span class="literal">true</span>);  </span><br><span class="line">        <span class="type">int</span> <span class="variable">partitions</span> <span class="operator">=</span> stats.getMetadata().partitions;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> stats.getPartitions().size();  </span><br><span class="line">        <span class="keyword">if</span> (partitions != size) &#123;  </span><br><span class="line">            log.info(<span class="string">&quot;topic=&#123;&#125;,partitions=&#123;&#125;,size=&#123;&#125;&quot;</span>, topic, partitions, size);  </span><br><span class="line">            pulsarAdmin.topics().updatePartitionedTopic(topic, partitions);  </span><br><span class="line">        &#125;    </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ’æŸ¥"><a href="#æ’æŸ¥" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h1><p>ä¿®å¤å¥½æ‰€æœ‰ topic ä¹‹åä¾¿å¼€å§‹æ’æŸ¥æ ¹å› ï¼Œå› ä¸ºçœ‹åˆ°çš„æ˜¯å…ƒæ•°æ®ä¸ä¸€è‡´æ‰€ä»¥æ€€ç–‘æ˜¯ zk é‡Œçš„æ•°æ®å’Œ broker å†…å­˜ä¸­çš„æ•°æ®ä¸åŒå¯¼è‡´çš„è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä½†æˆ‘ä»¬æŸ¥çœ‹äº† zookeeper ä¸­çš„æ•°æ®å‘ç°ä¸€åˆ‡åˆæ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥åªèƒ½è½¬å˜æ€è·¯ã€‚</p><p>ä¹‹åæˆ‘ä»¬é€šè¿‡æœ‰é—®é¢˜çš„ topic åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªå…³é”®æ—¥å¿—ï¼š<br><img src="https://s2.loli.net/2024/01/08/OfazoZRUt8W2ypk.png"><br><img src="https://s2.loli.net/2024/01/08/emZ7BGkcbiS2dpM.png"><br>ä»¥åŠå…·ä½“çš„å †æ ˆã€‚</p><p>æ­¤æ—¶å…·ä½“çš„åŸå› å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œå…ƒæ•°æ®è¿™äº›è‡ªç„¶æ˜¯æ²¡é—®é¢˜ï¼›æ ¹æœ¬åŸå› æ˜¯ topic è¢«åˆ é™¤äº†ï¼Œä½†è¢«åˆ é™¤çš„ topic åªæ˜¯æŸä¸ªåˆ†åŒºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æŸ¥è¯¢ <code>internalState</code> æ—¶æ‰å‘å‘ç°å°‘ä¸€ä¸ª topicã€‚</p><p>é€šè¿‡è¿™ä¸ªåˆ é™¤æ—¥å¿—å®šä½åˆ°å…·ä½“çš„åˆ é™¤ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.pulsar.broker.service.persistent.PersistentTopic#checkReplication</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/01/08/9Rb1AyHfpGcPqZO.png"><br>åŸæ¥æ˜¯è¿™é‡Œçš„  <code>configuredClusters</code> å€¼ä¸ºç©ºæ‰å¯¼è‡´çš„ topic è°ƒç”¨äº† <code>deleteForcefully()</code>è¢«åˆ é™¤ã€‚</p><p>è€Œè¿™ä¸ªå€¼æ˜¯ä» topic çš„ Policy ä¸­è·å–çš„ã€‚</p><h2 id="å¤ç°é—®é¢˜"><a href="#å¤ç°é—®é¢˜" class="headerlink" title="å¤ç°é—®é¢˜"></a>å¤ç°é—®é¢˜</h2><p>é€šè¿‡ä¸Šå›¾ä¸­çš„å †æ ˆè·Ÿè¸ªï¼Œæ€€ç–‘æ˜¯é‡å¯  broker å¯¼è‡´çš„ topic unload ï¼ŒåŒæ—¶ broker åˆåœ¨æ„å»º topic å¯¼è‡´äº†å¯¹ topicPolicy çš„è¯»å†™ã€‚</p><p>æœ€ç»ˆå¯¼è‡´ topicPolicy ä¸ºç©ºã€‚</p><p>åªè¦å†™ä¸ªå•æµ‹å¯ä»¥å¤ç°è¿™ä¸ªé—®é¢˜å°±å¥½åŠäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateTopicAndUpdatePolicyConcurrent</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">topicNum</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">partition</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (1) Init topic</span></span><br><span class="line">    admin.namespaces().createNamespace(<span class="string">&quot;public/retention&quot;</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">topicName</span> <span class="operator">=</span> <span class="string">&quot;persistent://public/retention/policy_with_broker_restart&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; topicNum; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">shadowTopicNames</span> <span class="operator">=</span> topicName + <span class="string">&quot;_&quot;</span> + i;</span><br><span class="line">        admin.topics().createPartitionedTopic(shadowTopicNames, partition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (2) Set Policy</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">90</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">shadowTopicNames</span> <span class="operator">=</span> topicName + <span class="string">&quot;_&quot;</span> + i;</span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">PublishRate</span> <span class="variable">publishRate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PublishRate</span>();</span><br><span class="line">                publishRate.publishThrottlingRateInMsg = <span class="number">100</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    admin.topicPolicies().setPublishRate(shadowTopicNames, publishRate);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (PulsarAdminException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">90</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">shadowTopicNames</span> <span class="operator">=</span> topicName + <span class="string">&quot;_&quot;</span> + i;</span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    admin.lookups().lookupPartitionedTopic(shadowTopicNames);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    admin.namespaces().unload(<span class="string">&quot;public/retention&quot;</span>);</span><br><span class="line">    admin.namespaces().unload(<span class="string">&quot;public/retention&quot;</span>);</span><br><span class="line">    admin.namespaces().unload(<span class="string">&quot;public/retention&quot;</span>);</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>* <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; topicNum; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">shadowTopicNames</span> <span class="operator">=</span> topicName + <span class="string">&quot;_&quot;</span> + i;</span><br><span class="line">        log.info(<span class="string">&quot;check topic: &#123;&#125;&quot;</span>, shadowTopicNames);</span><br><span class="line">        <span class="type">PartitionedTopicStats</span> <span class="variable">partitionedStats</span> <span class="operator">=</span> admin.topics().getPartitionedStats(shadowTopicNames, <span class="literal">true</span>);</span><br><span class="line">        Assert.assertEquals(partitionedStats.getPartitions().size(), partition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶è¿˜å¾—æŸ¥è¯¢å…ƒæ•°æ®æœ‰è€—æ—¶æ‰èƒ½å¤ç°ï¼š<br><img src="https://s2.loli.net/2024/01/08/2ry5Ife4aTvwxGM.png"></p><blockquote><p>åªèƒ½æ‰‹åŠ¨ sleep æ¨¡æ‹Ÿè¿™ä¸ªè€—æ—¶</p></blockquote><p>å…·ä½“ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ª issue<br><a href="https://github.com/apache/pulsar/issues/21653#issuecomment-1842962452">https://github.com/apache/pulsar/issues/21653#issuecomment-1842962452</a></p><p>æ­¤æ—¶å°±ä¼šå‘ç°æœ‰ topic è¢«åˆ é™¤äº†ï¼Œè€Œä¸”æ˜¯éšæœºåˆ é™¤çš„ï¼Œå› ä¸ºå‡ºç°å¹¶å‘çš„å‡ ç‡æœ¬èº«ä¹Ÿæ˜¯éšæœºçš„ã€‚</p><p><img src="https://s2.loli.net/2024/01/08/wYSoGHDc7Arp13j.png"></p><p>è¿™é‡Œç”»äº†ä¸€ä¸ªæµç¨‹å›¾å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œåœ¨ broker é‡å¯çš„æ—¶å€™ä¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶topicPolicy è¿›è¡Œæ“ä½œã€‚</p><p>åœ¨ thread3 è¯»å– topicPolicy è¿›è¡Œåˆ¤æ–­æ—¶ï¼Œthread2 å¯èƒ½è¿˜æ²¡æœ‰æŠŠæ•°æ®å‡†å¤‡å¥½ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº† topic è¢«åˆ é™¤ã€‚</p><h1 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h1><p><img src="https://s2.loli.net/2024/01/08/15iyVmOFe72X6tl.png"><br>æ—¢ç„¶çŸ¥é“äº†é—®é¢˜åŸå› å°±å¥½ä¿®å¤äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ thread3 å’Œ thread2 ä¿®æ”¹ä¸ºä¸²è¡Œæ‰§è¡Œå°±å¥½äº†ã€‚</p><blockquote><p>è¿™ä¹Ÿæ˜¯å¤„ç†å¹¶å‘æœ€ç®€å•é«˜æ•ˆçš„æ–¹æ³•ï¼Œå°±æ˜¯ç›´æ¥é¿å…å¹¶å‘ï¼›åŠ é”ã€é˜Ÿåˆ—å•¥çš„è™½ç„¶ä¹Ÿå¯ä»¥è§£å†³ï¼Œä½†ä»£ç å¤æ‚åº¦ä¹Ÿé«˜äº†å¾ˆå¤šï¼Œæ‰€ä»¥èƒ½ä¸å¹¶å‘å°±å°½é‡ä¸è¦å¹¶å‘ã€‚</p></blockquote><p>ä½†è¦æŠŠè¿™ä¸ªä¿®å¤æ¨é€åˆ°ç¤¾åŒºä¸Šæ¸¸ä¸»åˆ†æ”¯æœ€å¥½æ˜¯è¦åŠ ä¸Šå•æµ‹ï¼Œè¿™æ ·å³ä¾¿æ˜¯åç»­æœ‰å…¶ä»–çš„æ”¹åŠ¨ä¹Ÿèƒ½ä¿è¯è¿™ä¸ª bug ä¸ä¼šå†æ¬¡å‡ºç°ã€‚</p><p>ä¹‹ååœ¨ç¤¾åŒºå¤§ä½¬çš„å¸®åŠ©ä¸‹å®Œå–„äº†å•æµ‹ï¼Œæœ€ç»ˆåˆå¹¶äº†è¿™ä¸ªä¿®å¤ã€‚</p><blockquote><p>å†æ¬¡è¯æ˜å†™å•æµ‹å¾€å¾€æ¯”ä»£ç æ›´å¤æ‚ï¼Œä¹Ÿæ›´èŠ±è´¹æ—¶é—´ã€‚</p></blockquote><p>PRï¼š<a href="https://github.com/apache/pulsar/pull/21704">https://github.com/apache/pulsar/pull/21704</a></p><h2 id="ä½¿ç”¨ä¿®å¤é•œåƒ"><a href="#ä½¿ç”¨ä¿®å¤é•œåƒ" class="headerlink" title="ä½¿ç”¨ä¿®å¤é•œåƒ"></a>ä½¿ç”¨ä¿®å¤é•œåƒ</h2><p>å› ä¸ºç¤¾åŒºåˆå¹¶ä»£ç å†å‘ç‰ˆçš„å‘¨æœŸè¾ƒé•¿ï¼Œè€Œæˆ‘ä»¬åˆæ€¥äºä¿®å¤è¯¥é—®é¢˜ï¼›ä¸ç„¶éƒ½ä¸æ•¢é‡å¯ brokerï¼Œå› ä¸ºæ¯é‡å¯ä¸€æ¬¡éƒ½å¯èƒ½ä¼šå¯¼è‡´ä¸çŸ¥é“å“ªä¸ª topic å°±è¢«åˆ é™¤äº†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è‡ªå·±åœ¨æœ¬åœ°æ„å»ºäº†ä¸€ä¸ªä¿®å¤çš„é•œåƒï¼Œå‡†å¤‡åœ¨çº¿ä¸Šè¿›è¡Œæ›¿æ¢ã€‚</p><p>æ­¤æ—¶å‘åˆæ¥äº†ï¼Œæˆ‘ä»¬æ»¡æ€€ä¿¡å¿ƒçš„æ›¿æ¢äº†ä¸€ä¸ªé•œåƒå†è§‚å¯Ÿæ—¥å¿—å‘ç°å±…ç„¶è¿˜æœ‰åˆ é™¤çš„æ—¥å¿—ğŸ˜±ã€‚</p><p>å†·é™ä¸‹æ¥ä¸€åˆ†æï¼ŒåŸæ¥æ˜¯å½“å‰æ›¿æ¢è¿›è¡Œçš„ broker æ²¡æœ‰é—®é¢˜äº†ï¼Œä½†å®ƒå¤„ç†çš„ topic è¢«è½¬ç§»åˆ°äº†å…¶ä»– broker ä¸­ï¼Œè€Œå…¶ä»–çš„ broker å¹¶æ²¡æœ‰æ›¿æ¢ä¸ºæˆ‘ä»¬æœ€æ–°çš„é•œåƒã€‚</p><p>æ‰€ä»¥å¯¼è‡´ topic åœ¨å…¶ä»– broker ä¸­ä¾ç„¶è¢«åˆ é™¤äº†ã€‚</p><blockquote><p>é™¤éæˆ‘ä»¬åœæœºï¼Œå°†æ‰€æœ‰çš„é•œåƒéƒ½æ›¿æ¢ä¹‹åå†ä¸€èµ·é‡å¯ã€‚</p></blockquote><p>ä½†è¿™æ ·çš„æˆæœ¬å¤ªé«˜äº†ï¼Œæœ€å¥½æ˜¯å¯ä»¥å¹³æ»‘å‘å¸ƒã€‚</p><p>æœ€ç»ˆæˆ‘ä»¬æƒ³åˆ°ä¸€ä¸ªåŠæ³•ï¼Œä½¿ç”¨ <code>arthas</code> å»å…³é—­äº†ä¸€ä¸ª broker çš„ä¸€ä¸ªé€‰é¡¹ï¼Œä¹‹åå°±ä¸ä¼šæ‰§è¡Œå‡ºç° bug çš„é‚£æ®µä»£ç äº†ã€‚</p><p><img src="https://s2.loli.net/2024/01/08/nVrWLYjzs5e9UXw.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://arthas.aliyun.com/arthas-boot.jar &amp;&amp; java -jar arthas-boot.jar 1 -c &quot;vmtool -x 3 --action getInstances --className org.apache.pulsar.broker.ServiceConfiguration  --express &#x27;instances[0].setTopicLevelPoliciesEnabled(false)&#x27;&quot;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¹Ÿå°†æ“ä½œæ–¹æ³•è´´åˆ°äº†å¯¹äº issue çš„è¯„è®ºåŒºã€‚<br><a href="https://github.com/apache/pulsar/issues/21653#issuecomment-1857548997">https://github.com/apache/pulsar/issues/21653#issuecomment-1857548997</a><br>å¦‚æœä¸å¹¸ç¢°åˆ°äº†è¿™ä¸ª bugï¼Œå¯ä»¥å‚è€ƒä¿®å¤ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆ é™¤çš„è¿™äº› topic çš„åŒæ—¶å®ƒçš„è®¢é˜…è€…ä¹Ÿè¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¿®å¤è®¢é˜…è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">topicName</span> <span class="operator">=</span> <span class="string">&quot;persistent://tenant/ns/topicName&quot;</span>;  </span><br><span class="line">pulsarTopicService.createSubscription(topicName, <span class="string">&quot;subName&quot;</span>, MessageId.latest);</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥è¯´è¿™ä¸ª bug éå¸¸è‡´å‘½ï¼Œæ˜¯å› ä¸ºè¿™æ ·ä¼šå¯¼è‡´ topic çš„æ•°æ®ä¸¢å¤±ï¼ŒåŒæ—¶è¿™äº› topic ä¸Šçš„æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p><hr><p>åç»­ <a href="https://github.com/apache/pulsar/pull/21704#issuecomment-1878315926">https://github.com/apache/pulsar/pull/21704#issuecomment-1878315926</a>ç¤¾åŒºä¹Ÿè¡¥å……äº†ä¸€äº›åœºæ™¯ã€‚</p><p><img src="https://s2.loli.net/2024/01/08/q4OjXGPtibF8csU.png"></p><blockquote><p>å…¶å®åœºæ™¯ 2 æ›´å®¹æ˜“å‡ºç°å¤ç°ï¼Œæ¯•ç«Ÿæ›´å®¹æ˜“å‡ºç°å¹¶å‘ï¼›ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç¢°åˆ°çš„åœºæ™¯</p></blockquote><p>è¯´æ¥ä¹Ÿå¥‡æ€ªï¼Œç»“åˆç¤¾åŒºçš„ issue å’Œå…¶ä»–å¤§ä½¬çš„åé¦ˆï¼Œè¿™ä¸ªé—®é¢˜åªæœ‰æˆ‘ä»¬ç¢°åˆ°äº†ï¼Œä¼°è®¡ä¹Ÿæ˜¯è¿™ä¸ªé—®é¢˜çš„è§¦å‘æ¡ä»¶ä¹Ÿæ¯”è¾ƒè‹›åˆ»ï¼š</p><ul><li>å¼€å¯ <code>systemTopic/topicLevelPolices</code><br>  systemTopicEnabled: â€œtrueâ€<br>  topicLevelPoliciesEnabled: â€œtrueâ€</li><li>è®¾ç½®è¶³å¤Ÿå¤šçš„ topicPolicies</li><li>é‡å¯ broker<ul><li>é‡å¯è¿‡ç¨‹ä¸­ä» zk ä¸­è·å–æ•°æ®å‡ºç°è€—æ—¶</li></ul></li></ul><p>ç¬¦åˆä»¥ä¸Šæ¡ä»¶çš„é›†ç¾¤å°±éœ€è¦æ³¨æ„äº†ã€‚</p><p>å…¶å®è¿™ä¸ªé—®é¢˜åœ¨è¿™ä¸ª PR å°±å·²ç»å¼•å…¥äº†<br><a href="https://github.com/apache/pulsar/pull/11021">https://github.com/apache/pulsar/pull/11021</a></p><p>æ‰€ä»¥å·²ç»å­˜åœ¨è›®ä¹…äº†ï¼Œåç»­æˆ‘ä»¬ä¹Ÿå°†æ£€æµ‹å…ƒæ•°æ®ä½œä¸ºå‡çº§æµç¨‹ä¹‹ä¸€äº†ï¼Œç¡®ä¿å‡çº§åæ•°æ®ä¾ç„¶æ˜¯å®Œæ•´çš„ã€‚</p><p>ç›¸å…³çš„ issue å’Œ PRï¼š<br><a href="https://github.com/apache/pulsar/issues/21653">https://github.com/apache/pulsar/issues/21653</a><br><a href="https://github.com/apache/pulsar/pull/21704">https://github.com/apache/pulsar/pull/21704</a></p><p>#Blog #Pulsar </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡ &lt;a href=&quot;https://crossoverjie.top/2024/01/03/ob/Pulsar3.0-new-feature/#topic%E8%A2%AB%E5%88%A0%E9%99%A4&quot;&gt;Pulsar3.0æ–°åŠŸèƒ½ä»‹ç»&lt;/a&gt;ä¸­æåˆ°ï¼Œåœ¨å‡çº§åˆ° 3.0 çš„è¿‡ç¨‹ä¸­ç¢°åˆ°ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯å‡çº§ä¹‹å topic è¢«åˆ é™¤äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¥½æœ€è¿‘ç¤¾åŒºä¹Ÿè¡¥å……äº†ç›¸å…³ç»†èŠ‚ï¼Œæœ¬æ¬¡ä¹Ÿæ¥ç€è¿™ä¸ªæœºä¼šå†æ¬¡å¤ç›˜ä¸€ä¸‹ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªéå¸¸è‡´å‘½çš„ Bugã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
  <entry>
    <title>æŠ€æœ¯é˜…è¯»å‘¨åˆŠç¬¬åä¸‰æœŸï¼šä¸€äº›æé«˜ç”Ÿäº§åŠ›çš„ç»ˆç«¯å‘½ä»¤</title>
    <link href="http://crossoverjie.top/2024/01/05/ob/newsletter/Newsletter12-20240105/"/>
    <id>http://crossoverjie.top/2024/01/05/ob/newsletter/Newsletter12-20240105/</id>
    <published>2024-01-05T09:28:25.000Z</published>
    <updated>2024-01-08T04:01:31.588Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2024/01/05/wU8gPSzaoitBerC.png"></p><p><strong>æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚</strong></p><span id="more"></span><h2 id="å†å²æ›´æ–°"><a href="#å†å²æ›´æ–°" class="headerlink" title="å†å²æ›´æ–°"></a>å†å²æ›´æ–°</h2><ul><li><a href="https://crossoverjie.top/2023/12/01/ob/newsletter/Newsletter08-20231201/">20231201ï¼šç¬¬å…«æœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/15/ob/newsletter/Newsletter10-20231215/">20231215ï¼šç¬¬åæœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/22/ob/newsletter/Newsletter10-20231222/">20231122ï¼šç¬¬åä¸€æœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/29/ob/newsletter/Newsletter12-20231229/">20231129ï¼šç¬¬åäºŒæœŸ</a><!--more--></li></ul><h2 id="ç”Ÿå­˜è¿˜æ˜¯æ¯ç­ï¼Ÿä¸€æ–‡å¸¦ä½ çœ‹æ‡‚-Pulsar-çš„æ¶ˆæ¯ä¿ç•™å’Œè¿‡æœŸç­–ç•¥-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘"><a href="#ç”Ÿå­˜è¿˜æ˜¯æ¯ç­ï¼Ÿä¸€æ–‡å¸¦ä½ çœ‹æ‡‚-Pulsar-çš„æ¶ˆæ¯ä¿ç•™å’Œè¿‡æœŸç­–ç•¥-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘" class="headerlink" title="ç”Ÿå­˜è¿˜æ˜¯æ¯ç­ï¼Ÿä¸€æ–‡å¸¦ä½ çœ‹æ‡‚ Pulsar çš„æ¶ˆæ¯ä¿ç•™å’Œè¿‡æœŸç­–ç•¥-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘"></a>ç”Ÿå­˜è¿˜æ˜¯æ¯ç­ï¼Ÿä¸€æ–‡å¸¦ä½ çœ‹æ‡‚ Pulsar çš„æ¶ˆæ¯ä¿ç•™å’Œè¿‡æœŸç­–ç•¥-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</h2><p>URL: <a href="https://cloud.tencent.com/developer/article/2245703">https://cloud.tencent.com/developer/article/2245703</a></p><p><img src="https://s2.loli.net/2024/01/05/ZYRxDydaIn2W4jJ.png"></p><blockquote><p>æœ¬æ–‡åˆ†æäº† Pulsar æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸»è¦æ˜¯å¦‚ä½•ä¿ç•™å’Œå›æ”¶æ¶ˆæ¯</p></blockquote><ul><li>TTLï¼ˆTime To Liveï¼‰ï¼šä½¿å¾—æœª ACK çš„æ¶ˆæ¯è¿›å…¥ ACK çŠ¶æ€ï¼Œä¾›åç»­å›æ”¶çš„æ—¶å€™ä½¿ç”¨</li><li><strong>Retention</strong>ä¿ç•™ç­–ç•¥ï¼šé»˜è®¤æƒ…å†µä¸‹å·²ç»è¢«æ‰€æœ‰è®¢é˜…è€… ACK çš„æ¶ˆæ¯ä¼šè¢«ç«‹å³å›æ”¶æ‰ï¼Œé…ç½®ä¿ç•™ç­–ç•¥å¯ä»¥ä¿ç•™ä¸€å®šæ—¶é—´ã€ä¸€å®šæ•°é‡çš„ ACK æ¶ˆæ¯ï¼Œåˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®å¯ä»¥åšæ¶ˆæ¯å›æŸ¥</li><li>Backlog: æœªè¢«ç¡®è®¤æ¶ˆæ¯çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯ç§¯å‹æ¶ˆæ¯ï¼›ä¹Ÿå¯ä»¥é…ç½®åªä¿ç•™ä¸€å®šæ—¶é—´ã€æ•°é‡çš„æ¶ˆæ¯ï¼Œä»è€Œå‡å°‘ç£ç›˜å‹åŠ›ï¼›å½“è¶…è¿‡æˆ‘ä»¬é…ç½®çš„é˜ˆå€¼æ—¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š<br><img src="https://s2.loli.net/2024/01/04/pdEKHRT4v2fAkBm.png" alt="image.png"></li></ul><h2 id="è¿™äº›æµè¡Œçš„K8Så·¥å…·ï¼Œä½ éƒ½ç”¨ä¸Šäº†å—"><a href="#è¿™äº›æµè¡Œçš„K8Så·¥å…·ï¼Œä½ éƒ½ç”¨ä¸Šäº†å—" class="headerlink" title="è¿™äº›æµè¡Œçš„K8Så·¥å…·ï¼Œä½ éƒ½ç”¨ä¸Šäº†å—"></a>è¿™äº›æµè¡Œçš„K8Så·¥å…·ï¼Œä½ éƒ½ç”¨ä¸Šäº†å—</h2><p>URL: <a href="https://mp.weixin.qq.com/s/EC-YLm71YB4cMDoTjrdfyg">https://mp.weixin.qq.com/s/EC-YLm71YB4cMDoTjrdfyg</a></p><blockquote><p>æ¨èäº†ä¸€äº›å¸¸ç”¨çš„ kubernetes ç®¡ç†å·¥å…·</p></blockquote><p><img src="https://s2.loli.net/2024/01/05/kWbLtETcey9Gmzp.png"></p><ul><li>Helm: kubernetes å¹³å°çš„å¿…å¤‡çš„åŒ…ç®¡ç†å·¥å…·</li><li>æœ¬åœ°è¿è¡Œçš„ kubernetes å·¥å…·ï¼šæœ‰æ—¶å€™éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œè¿™ç±»å·¥å…·å°±å¾ˆæœ‰ç”¨ï¼š<ul><li>Docker Desktop</li><li>minikube</li><li>kind</li><li>k3s</li><li>è¿™ç±»å·¥å…·åœ¨ingressã€è´Ÿè½½å‡è¡¡ã€é›†ç¾¤å¤–è®¿é—®ç­‰éœ€è¦å•ç‹¬é…ç½®ã€‚</li></ul></li><li>é›†ç¾¤è‡ªåŠ¨ç¼©æ”¾å™¨ï¼šç”¨äºç¼©æ”¾åº•å±‚èŠ‚ç‚¹<ul><li>ä¸€äº›äº‘æœåŠ¡å‚å•†è‡ªåŠ¨é›†æˆäº†è¿™ç±»åŠŸèƒ½ï¼Œå¦‚æœæ˜¯è‡ªå»ºé›†ç¾¤ï¼š</li><li>kubernetes Autoscaler</li><li>Karpenter</li></ul></li><li>å¤‡ä»½å’Œè¿ç§»<ul><li>å¦‚æœéƒ¨ç½²äº†æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œéœ€è¦è¿›è¡Œæ•°æ®è¿ç§»å’Œå¤‡ä»½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>velero</code></li></ul></li><li>å‘½ä»¤è¡Œå·¥å…·<ul><li>kube-ps1 ç”¨äºç»ˆç«¯çš„ kubernetes å‘½ä»¤æç¤º</li><li>kubectx ç”¨äºåœ¨ç»ˆç«¯è¿›è¡Œ é›†ç¾¤ã€namespace ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul></li><li>IDE<ul><li>OpenLens ä¸€ä¸ªå®¢æˆ·ç«¯å¯è§†åŒ– appï¼Œç”¨äºæ–¹ä¾¿ç®¡ç† kubernetes é›†ç¾¤</li></ul></li></ul><h2 id="3-Terminal-Commands-to-Increase-Your-Productivity-DEV-Community"><a href="#3-Terminal-Commands-to-Increase-Your-Productivity-DEV-Community" class="headerlink" title="3 Terminal Commands to Increase Your Productivity - DEV Community"></a>3 Terminal Commands to Increase Your Productivity - DEV Community</h2><p>URL: <a href="https://dev.to/pankajgupta221b/3-terminal-commands-to-increase-your-productivity-57dm?ref=dailydev">https://dev.to/pankajgupta221b/3-terminal-commands-to-increase-your-productivity-57dm?ref=dailydev</a></p><blockquote><p>ä½œè€…ä»‹ç»äº†å‡ ä¸ªå¸¸ç”¨çš„å¯ä»¥æé«˜ç”Ÿäº§åŠ›çš„ç»ˆç«¯å‘½ä»¤</p></blockquote><p><img src="https://s2.loli.net/2024/01/05/9UQjHvpaLEqMldW.png"></p><h3 id="alias-åˆ«å"><a href="#alias-åˆ«å" class="headerlink" title="alias åˆ«å"></a>alias åˆ«å</h3><p>åˆ«åéå¸¸å¥½ç”¨ï¼Œä»¥ä¸‹æ˜¯æˆ‘å¸¸ç”¨çš„ä¸€äº›åˆ«å:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-=&#x27;cd -&#x27;</span><br><span class="line">...=../..</span><br><span class="line">....=../../..</span><br><span class="line">.....=../../../..</span><br><span class="line">......=../../../../..</span><br><span class="line">1=&#x27;cd -&#x27;</span><br><span class="line">2=&#x27;cd -2&#x27;</span><br><span class="line">3=&#x27;cd -3&#x27;</span><br><span class="line">4=&#x27;cd -4&#x27;</span><br><span class="line">5=&#x27;cd -5&#x27;</span><br><span class="line">6=&#x27;cd -6&#x27;</span><br><span class="line">7=&#x27;cd -7&#x27;</span><br><span class="line">8=&#x27;cd -8&#x27;</span><br><span class="line">9=&#x27;cd -9&#x27;</span><br><span class="line">dc=docker</span><br><span class="line">jdk11=&#x27;export JAVA_HOME=~/jdk/jdk-11.0.16.1.jdk/Contents/Home&#x27;</span><br><span class="line">jdk17=&#x27;export JAVA_HOME=~/Users/chenjie/Documents/dev~/jdk/jdk-17.0.1.jdk/Contents/Home/&#x27;</span><br><span class="line">jdk21=&#x27;export JAVA_HOME=~/jdk/jdk-21.0.1.jdk/Contents/Home&#x27;</span><br><span class="line">jdk8=&#x27;export JAVA_HOME=&#x27;</span><br><span class="line">k=kubectl</span><br><span class="line">pp=&#x27;sh hexo-push.sh&#x27;</span><br></pre></td></tr></table></figure><h3 id="pbcopy"><a href="#pbcopy" class="headerlink" title="pbcopy"></a>pbcopy</h3><p>è¿™ä¸ªåœ¨æœ‰æ—¶å€™éœ€è¦ debug æ—¥å¿—æˆ–è€…å¤åˆ¶ä¸€äº›é•¿æ–‡æœ¬åˆ°å‰ªè´´æ¿é‡Œéå¸¸æœ‰ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat xx.properties |grep timeout | pbcopy</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æŠŠ timeout è¿™ä¸ªå…³é”®å­—ä»æ–‡ä»¶ä¸­å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼Œæˆ‘å°±å¯ä»¥å°†å®ƒå¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹ä½¿ç”¨ã€‚</p><h3 id="åå‘æœç´¢"><a href="#åå‘æœç´¢" class="headerlink" title="åå‘æœç´¢"></a>åå‘æœç´¢</h3><p>åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ ctrl+r å°±å¯ä»¥æ ¹æ®å…³é”®å­—åœ¨å†å²å‘½ä»¤ä¸­æŸ¥æ‰¾å‘½ä»¤ï¼Œè¿™ä¸ªåœ¨å¿˜è®°äº†ä¸€äº›å‘½ä»¤ä½†åªè®°å¾—å…³é”®å­—çš„æ—¶å€™éå¸¸æœ‰ç”¨ã€‚<br><img src="https://s2.loli.net/2024/01/05/dfuDG6L2n7h5BNP.png"></p><p>æˆ‘è¿™é‡Œä½¿ç”¨çš„ç»ˆç«¯æ˜¯ Warp ï¼Œäº¤äº’ä¸Šæ›´åŠ å¥½ç”¨ä¸€äº›ã€‚</p><h3 id="cal"><a href="#cal" class="headerlink" title="cal"></a>cal</h3><p>å¯ä»¥ç”¨äºæ˜¾ç¤ºæ—¥å†<br><img src="https://s2.loli.net/2024/01/05/5yCL9oKWIrjB2Dc.png"></p><p>æ–‡ç« é“¾æ¥ï¼š</p><ul><li><a href="https://cloud.tencent.com/developer/article/2245703">https://cloud.tencent.com/developer/article/2245703</a></li><li><a href="https://mp.weixin.qq.com/s/EC-YLm71YB4cMDoTjrdfyg">https://mp.weixin.qq.com/s/EC-YLm71YB4cMDoTjrdfyg</a></li><li><a href="https://dev.to/pankajgupta221b/3-terminal-commands-to-increase-your-productivity-57dm?ref=dailydev">https://dev.to/pankajgupta221b/3-terminal-commands-to-increase-your-productivity-57dm?ref=dailydev</a></li></ul><p>#Newletters </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/01/05/wU8gPSzaoitBerC.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    <category term="Newsletter" scheme="http://crossoverjie.top/categories/OB/Newsletter/"/>
    
    
  </entry>
  
  <entry>
    <title>Pulsar3.0æ–°åŠŸèƒ½ä»‹ç»</title>
    <link href="http://crossoverjie.top/2024/01/03/ob/Pulsar3.0-new-feature/"/>
    <id>http://crossoverjie.top/2024/01/03/ob/Pulsar3.0-new-feature/</id>
    <published>2024-01-03T15:04:58.000Z</published>
    <updated>2024-01-02T16:41:35.234Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2024/01/03/1QuX3wI6P8hefLa.png" alt="Pulsar3.0-NewFeature.png"></p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://crossoverjie.top/2023/12/24/ob/Pulsar3.0-upgrade/">Pulsar3.0 å‡çº§æŒ‡åŒ—</a>è®²äº†å…³äºå‡çº§ Pulsar é›†ç¾¤çš„å…³é”®æ­¥éª¤ä¸ç¾éš¾æ¢å¤ï¼Œæœ¬æ¬¡ä¸»è¦åˆ†äº«ä¸€äº› <code>Pulsar3.0</code> çš„æ–°åŠŸèƒ½ä¸å¯èƒ½å¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚</p><h1 id="å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜"><a href="#å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜"></a>å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜</h1><p>å…ˆæ¥ä¸ªæ¬²æ‰¬å…ˆæŠ‘ï¼ŒèŠèŠå‡çº§åæ‰€ç¢°åˆ°çš„é—®é¢˜å§ã€‚</p><p>å…¶ä¸­æœ‰ä¸¤ä¸ªé—®é¢˜æˆ‘ä»¬æ„ŸçŸ¥æ¯”è¾ƒæ˜æ˜¾ï¼Œç‰¹åˆ«æ˜¯ç¬¬ä¸€ä¸ªã€‚</p><span id="more"></span><h2 id="topicè¢«åˆ é™¤"><a href="#topicè¢«åˆ é™¤" class="headerlink" title="topicè¢«åˆ é™¤"></a>topicè¢«åˆ é™¤</h2><p>æˆ‘ä»¬åœ¨ä¸Šä¸ªæœˆæŸå¤©å‡Œæ™¨ä» <code>2.11.2</code> å‡çº§åˆ° <code>3.0.1</code> ä¹‹åï¼Œè¿›è¡Œäº†ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€æåˆ°çš„åŠŸèƒ½æ€§æµ‹è¯•ï¼Œå‘ç°æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè§‰å¾—ä¸€åˆ‡éƒ½è¿˜æŒºé¡ºåˆ©çš„ï¼ŒåŠä¸ªå°æ—¶æå®šåå°±ä¸‹ç­äº†ã€‚</p><p>ç»“æœå“ªçŸ¥é“ç¬¬äºŒå¤©æ˜¯è¢«ç”µè¯å«é†’çš„ï¼Œæœ‰éƒ¨åˆ†ä¸šåŠ¡åé¦ˆä¸šåŠ¡é‡å¯ä¹‹åå°±æ— æ³•è¿æ¥åˆ° Pulsar äº†ã€‚</p><p><img src="https://s2.loli.net/2024/01/02/KUAnZ8W65jO3x7d.png" alt="image.png"><br>æœ€ç»ˆå®šä½æ˜¯ topic è¢«åˆ é™¤äº†ã€‚</p><blockquote><p>å…¶ä¸­çš„ç»†èŠ‚è¿˜è›®å¤šçš„ï¼Œä¿®å¤è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€æ³¢ä¸‰æŠ˜ï¼Œåé¢æˆ‘ä¼šå•ç‹¬å†™ä¸€ç¯‡æ–‡ç« æ¥è¯¦ç»†æ¢³ç†è¿™ä¸ªè¿‡ç¨‹ã€‚</p></blockquote><p>åœ¨è¿™ä¸ª issue å’Œ PR ä¸­æœ‰è¯¦ç»†çš„æè¿°ï¼š<br><a href="https://github.com/apache/pulsar/issues/21653">https://github.com/apache/pulsar/issues/21653</a><br><a href="https://github.com/apache/pulsar/pull/21704">https://github.com/apache/pulsar/pull/21704</a></p><p>æ„Ÿå…´è¶£çš„æœ‹å‹ä¹Ÿå¯ä»¥å…ˆçœ‹çœ‹ã€‚</p><h2 id="ç›‘æ§æŒ‡æ ‡ä¸¢å¤±"><a href="#ç›‘æ§æŒ‡æ ‡ä¸¢å¤±" class="headerlink" title="ç›‘æ§æŒ‡æ ‡ä¸¢å¤±"></a>ç›‘æ§æŒ‡æ ‡ä¸¢å¤±</h2><p>ç¬¬äºŒä¸ªé—®é¢˜ä¸æ˜¯é‚£ä¹ˆä¸¥é‡ï¼Œæ˜¯å‡çº§åå‘ç°  bookkeeper çš„ä¸€äº›ç›‘æ§æŒ‡æ ‡ä¸¢å¤±äº†ï¼Œæ¯”å¦‚è¿™é‡Œçš„å†™å…¥å»¶è¿Ÿï¼š<br><img src="https://s2.loli.net/2024/01/02/9c7qs4CX1lejOIn.png" alt="image.png"><br>æˆ‘ä¹Ÿå®šä½äº†è›®ä¹…ï¼Œä½†ä¸ç®¡æ˜¯å®˜æ–¹çš„ docker é•œåƒè¿˜æ˜¯æºç ç¼–è¯‘éƒ½æ— æ³•å¤ç°è¿™ä¸ªé—®é¢˜ã€‚</p><p>æœ€ç»ˆä¸¢å¤±çš„æŒ‡æ ‡æœ‰è¿™äº›ï¼š</p><ul><li>bookkeeper_server_ADD_ENTRY_REQUEST</li><li>bookkeeper_server_ADD_ENTRY_BLOCKED</li><li>bookkeeper_server_READ_ENTRY_BLOCKED</li><li>bookie_journal_JOURNAL_CB_QUEUE_SIZE</li><li>bookie_read_cache_hits_count</li><li>bookie_read_cache_misses_count</li><li>bookie_DELETED_LEDGER_COUNT</li><li>bookie_MAJOR_COMPACTION_COUNT</li></ul><p>è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒè¿™ä¸ª issueï¼š<br><a href="https://github.com/apache/pulsar/issues/21766">https://github.com/apache/pulsar/issues/21766</a></p><h1 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h1><p>è®²å®Œäº†é‡åˆ°çš„ bugï¼Œå†æ¥çœ‹çœ‹å¸¦æ¥çš„æ–°ç‰¹æ€§ï¼Œé‡ç‚¹ä»‹ç»æˆ‘ä»¬ç”¨å¾—ä¸Šçš„ç‰¹æ€§ã€‚</p><h2 id="æ”¯æŒä½è´Ÿè½½å‡è¡¡"><a href="#æ”¯æŒä½è´Ÿè½½å‡è¡¡" class="headerlink" title="æ”¯æŒä½è´Ÿè½½å‡è¡¡"></a>æ”¯æŒä½è´Ÿè½½å‡è¡¡</h2><p><img src="https://s2.loli.net/2024/01/02/KVpW4DyNimlMhqH.png" alt="image.png"></p><p>å½“æˆ‘ä»¬å‡çº§æˆ–è€…æ˜¯é‡å¯ broker çš„æ—¶å€™ï¼Œå…¨éƒ¨é‡å¯æˆåŠŸåå…¶å®ä¼šå‘ç°æœ€åé‡å¯çš„é‚£ä¸ª broker æ˜¯æ²¡æœ‰æµé‡çš„ã€‚</p><p>è¿™ä¸ªåŸç†å’Œä¼˜åŒ–åœ¨ä¹‹å‰å†™è¿‡çš„ <a href="https://crossoverjie.top/2023/02/07/pulsar/pulsar-load-banance/#Pulsar-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8E%9F%E7%90%86">Pulsarè´Ÿè½½å‡è¡¡åŸç†åŠä¼˜åŒ–</a> å…¶å®æœ‰è¯¦ç»†ä»‹ç»ã€‚</p><p>æœ¬æ¬¡ 3.0 ç»ˆäºå°†é‚£ä¸ªä¼˜åŒ–å‘ç‰ˆäº†ï¼Œä¹‹ååªè¦æˆ‘ä»¬é…ç½® <code>lowerBoundarySheddingEnabled: true</code> å°±èƒ½å¼€å¯è¿™ä¸ªä½è´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä½¿å¾—ä½è´Ÿè½½çš„ broker ä¾ç„¶æœ‰æµé‡è¿›å…¥ã€‚</p><h2 id="è·³è¿‡ç©ºæ´æ¶ˆæ¯"><a href="#è·³è¿‡ç©ºæ´æ¶ˆæ¯" class="headerlink" title="è·³è¿‡ç©ºæ´æ¶ˆæ¯"></a>è·³è¿‡ç©ºæ´æ¶ˆæ¯</h2><p><img src="https://s2.loli.net/2024/01/02/nj2IyteVUQ79SBZ.png" alt="image.png"><br>Pulsar å¯èƒ½ä¼šå› ä¸ºæ¶ˆæ¯æ¶ˆè´¹å¼‚å¸¸å¯¼è‡´æ¸¸æ ‡å‡ºç°ç©ºæ´ï¼Œä»è€Œå¯¼è‡´ç£ç›˜å¾—ä¸åˆ°é‡Šæ”¾ï¼›</p><p>æ‰€ä»¥æˆ‘ä»¬æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä¼šå®šæœŸæ‰«æç§¯å‹æ¶ˆæ¯çš„ topic åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç©ºæ´æ¶ˆæ¯ï¼Œå¦‚æœå­˜åœ¨ä¾¿å¯ä»¥åœ¨ç®¡ç†å°ä½¿ç”¨ skipMessage API è·³è¿‡ç©ºæ´æ¶ˆæ¯ï¼Œä»è€Œé‡Šæ”¾ç£ç›˜ã€‚</p><p>ä½†åœ¨ 3.0 ä¹‹å‰è¿™ä¸ªè·³è¿‡ API å­˜åœ¨ bugï¼Œåªè¦è·³è¿‡çš„æ•°é‡è¶…è¿‡ 8 æ—¶ï¼Œå®é™…è·³è¿‡çš„æ•°é‡å°±ä¼šå°äº 8.</p><p>å…·ä½“ issue å’Œä¿®å¤è¿‡ç¨‹åœ¨è¿™é‡Œï¼š<br><a href="https://github.com/apache/pulsar/issues/20262">https://github.com/apache/pulsar/issues/20262</a><br><a href="https://github.com/apache/pulsar/pull/20326">https://github.com/apache/pulsar/pull/20326</a></p><p>æ€»ä¹‹è¿™ä¸ªé—®é¢˜åœ¨ 3.0 ä¹‹åä¹Ÿæ˜¯ä¿®å¤äº†ï¼Œæœ‰ç±»ä¼¼éœ€æ±‚çš„æœ‹å‹ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p><h2 id="æ–°çš„è´Ÿè½½å‡è¡¡å™¨"><a href="#æ–°çš„è´Ÿè½½å‡è¡¡å™¨" class="headerlink" title="æ–°çš„è´Ÿè½½å‡è¡¡å™¨"></a>æ–°çš„è´Ÿè½½å‡è¡¡å™¨</h2><p>åŒæ—¶ä¹Ÿæ”¯æŒäº†ä¸€ä¸ªæ–°çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œè§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>ä»¥å‰çš„è´Ÿè½½å‡è¡¡å¤§é‡ä¾èµ– zkï¼Œå½“ topic æ•°é‡å¢å¤šæ—¶å¯¹æ‰©å±•æ€§å¸¦æ¥é—®é¢˜ã€‚<ul><li>æ–°çš„è´Ÿè½½å‡è¡¡å™¨ä½¿ç”¨ <code>non-persistent</code> æ¥å­˜å‚¨è´Ÿè½½ä¿¡æ¯ï¼Œå°±ä¸å†ä¾èµ– zk ã€‚</li></ul></li><li>ä»¥å‰çš„è´Ÿè½½å‡è¡¡å™¨éœ€è¦ä¾èµ– <code>leader broker</code> è¿›è¡Œé‡å®šå‘åˆ°å…·ä½“çš„ brokerï¼Œå…¶å®è¿™äº›é‡å®šå‘å¹¶æ— æ„ä¹‰ï¼Œå¾’å¢äº†ç³»ç»Ÿå¼€é”€ã€‚<ul><li>æ–°çš„è´Ÿè½½å‡è¡¡å™¨ä½¿ç”¨äº† SystemTopic æ¥å­˜æ”¾ topic çš„æ‰€æœ‰æƒä¿¡æ¯ï¼Œè¿™æ ·æ¯ä¸ª broker éƒ½å¯ä»¥æ‹¿åˆ°æ•°æ®ï¼Œä»è€Œä¸å†éœ€è¦ä» leader broker é‡å®šå‘äº†ã€‚</li></ul></li></ul><p>æ›´å¤šå®Œæ•´ä¿¡æ¯å¯ä»¥å‚è€ƒè¿™ä¸ª PIP: <a href="https://github.com/apache/pulsar/issues/16691">PIP-192: New Pulsar Broker Load Balancer</a></p><h2 id="æ”¯æŒå¤§è§„æ¨¡å»¶è¿Ÿæ¶ˆæ¯"><a href="#æ”¯æŒå¤§è§„æ¨¡å»¶è¿Ÿæ¶ˆæ¯" class="headerlink" title="æ”¯æŒå¤§è§„æ¨¡å»¶è¿Ÿæ¶ˆæ¯"></a>æ”¯æŒå¤§è§„æ¨¡å»¶è¿Ÿæ¶ˆæ¯</h2><p>ç¬¬äºŒä¸ªé‡å¤§ç‰¹æ€§æ˜¯æ”¯æŒå¤§è§„æ¨¡å»¶è¿Ÿæ¶ˆæ¯ï¼Œç›¸ä¿¡æ˜¯æœ‰ä¸å°‘ä¼ä¸šé€‰æ‹© Pulsar ä¹Ÿæ˜¯å› ä¸ºä»–åŸç”Ÿå°±æ”¯æŒå»¶è¿Ÿæ¶ˆæ¯ã€‚</p><p>æˆ‘ä»¬ä¹Ÿæ˜¯å¤§é‡åœ¨ä¸šåŠ¡ä¸­ä½¿ç”¨å»¶è¿Ÿæ¶ˆæ¯ï¼Œä»¥å¾€çš„å»¶è¿Ÿæ¶ˆæ¯æœ‰ç€ä»¥ä¸‹ä¸€äº›é—®é¢˜ï¼š</p><ul><li>å†…å­˜å¼€é”€è¿‡å¤§ï¼Œå»¶è¿Ÿæ¶ˆæ¯çš„ç´¢å¼•éƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå³ä¾¿æ˜¯å¯ä»¥åˆ†å¸ƒåœ¨å¤šä¸ª broker ä¸­åˆ†æ•£å­˜å‚¨ï¼Œä½†æ¶ˆè€—ä¾ç„¶è¾ƒå¤§<ul><li>é‡ç‚¹ä¼˜åŒ–äº†ç´¢å¼•çš„å†…å­˜å æœ‰é‡ã€‚</li></ul></li><li>é‡å¯ broker æ—¶ä¼šæ¶ˆè€—å¤§é‡æ—¶å€™é‡å»ºç´¢å¼•<ul><li>æ”¯æŒäº†ç´¢å¼•å¿«ç…§ï¼Œæœ€å¤§é™åº¦çš„é™ä½äº†æ„å»ºç´¢å¼•çš„èµ„æºæ¶ˆè€—ã€‚</li></ul></li></ul><h1 id="å¾…ä¼˜åŒ–åŠŸèƒ½"><a href="#å¾…ä¼˜åŒ–åŠŸèƒ½" class="headerlink" title="å¾…ä¼˜åŒ–åŠŸèƒ½"></a>å¾…ä¼˜åŒ–åŠŸèƒ½</h1><h2 id="ç›‘æ§é¢æ¿ä¼˜åŒ–"><a href="#ç›‘æ§é¢æ¿ä¼˜åŒ–" class="headerlink" title="ç›‘æ§é¢æ¿ä¼˜åŒ–"></a>ç›‘æ§é¢æ¿ä¼˜åŒ–</h2><p>æœ€åå³ä¾¿æ˜¯å‡çº§åˆ°äº† 3.0 ä¾ç„¶è¿˜æœ‰ä¸€äº›å¾…ä¼˜åŒ–çš„åŠŸèƒ½ï¼Œåœ¨ä¹‹å‰çš„ <a href="https://crossoverjie.top/2023/08/03/ob/Pulsar-Client/">ä» Pulsar Client çš„åŸç†åˆ°å®ƒçš„ç›‘æ§é¢æ¿</a>ä¸­æœ‰æåˆ°ç»™å®¢æˆ·ç«¯åŠ äº†ä¸€äº›ç›‘æ§åŸ‹ç‚¹ä¿¡æ¯ã€‚</p><p>æœ€ç»ˆä½¿ç”¨ä¸‹æ¥å‘ç°è¿˜ç¼ºä¸€ä¸ª ack è€—æ—¶çš„ä¸€ä¸ªé¢æ¿ï¼Œå…¶å®æ—¥å¸¸ç¢°åˆ°æœ€å¤šçš„é—®é¢˜å°±æ˜¯çªç„¶ä¸èƒ½æ¶ˆè´¹äº†ï¼ˆæˆ–è€…æ¶ˆè´¹è¿‡æ…¢ï¼‰ã€‚</p><p>è¿™æ—¶å¦‚æœæœ‰è¿™æ ·çš„è€—æ—¶é¢æ¿ï¼Œé¦–å…ˆå°±å¯ä»¥å®šä½å‡ºæ˜¯å¦æ˜¯æ¶ˆè´¹è€…æœ¬èº«çš„é—®é¢˜ã€‚</p><p><img src="https://s2.loli.net/2024/01/03/YFoy4PfnRbz72qX.png" alt="image.png"><br>ç›®å‰è¿˜åœ¨å¼€å‘ä¸­ï¼Œå¤§æ¦‚ç±»ä¼¼äºè¿™æ ·çš„æ•°æ®ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Pulsar3.0 æ˜¯ Pulsar çš„ç¬¬ä¸€ä¸ª LTS ç‰ˆæœ¬ï¼Œæ¨èå°½å¿«å‡çº§å¯ä»¥è·å¾—é•¿æœŸæ”¯æŒã€‚<br>ä½†åªè¦æ˜¯è½¯ä»¶å°±ä¼šæœ‰ bugï¼Œå³ä¾¿æ˜¯ LTS ç‰ˆæœ¬ï¼Œæ‰€ä»¥å¤§å®¶æ—¥å¸¸ä½¿ç”¨ç¢°åˆ° Bug å»ºè®®å¤šå‘ç¤¾åŒºåé¦ˆï¼Œä¸€èµ·æ¨åŠ¨ Pulsar çš„è¿›æ­¥ã€‚</p><p>#Blog #Pulsar </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2024/01/03/1QuX3wI6P8hefLa.png&quot; alt=&quot;Pulsar3.0-NewFeature.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  &lt;a href=&quot;https://crossoverjie.top/2023/12/24/ob/Pulsar3.0-upgrade/&quot;&gt;Pulsar3.0 å‡çº§æŒ‡åŒ—&lt;/a&gt;è®²äº†å…³äºå‡çº§ Pulsar é›†ç¾¤çš„å…³é”®æ­¥éª¤ä¸ç¾éš¾æ¢å¤ï¼Œæœ¬æ¬¡ä¸»è¦åˆ†äº«ä¸€äº› &lt;code&gt;Pulsar3.0&lt;/code&gt; çš„æ–°åŠŸèƒ½ä¸å¯èƒ½å¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜&quot;&gt;&lt;a href=&quot;#å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜&quot;&gt;&lt;/a&gt;å‡çº§åæ‰€é‡åˆ°çš„é—®é¢˜&lt;/h1&gt;&lt;p&gt;å…ˆæ¥ä¸ªæ¬²æ‰¬å…ˆæŠ‘ï¼ŒèŠèŠå‡çº§åæ‰€ç¢°åˆ°çš„é—®é¢˜å§ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­æœ‰ä¸¤ä¸ªé—®é¢˜æˆ‘ä»¬æ„ŸçŸ¥æ¯”è¾ƒæ˜æ˜¾ï¼Œç‰¹åˆ«æ˜¯ç¬¬ä¸€ä¸ªã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
  <entry>
    <title>æŠ€æœ¯é˜…è¯»å‘¨åˆŠç¬¬åäºŒæœŸ</title>
    <link href="http://crossoverjie.top/2023/12/29/ob/newsletter/Newsletter12-20231229/"/>
    <id>http://crossoverjie.top/2023/12/29/ob/newsletter/Newsletter12-20231229/</id>
    <published>2023-12-29T09:28:25.000Z</published>
    <updated>2023-12-29T06:10:06.808Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/12/29/t1FmIn4i6HAOoDB.png" alt="image.png"></p><p><strong>æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚</strong></p><span id="more"></span><h2 id="å†å²æ›´æ–°"><a href="#å†å²æ›´æ–°" class="headerlink" title="å†å²æ›´æ–°"></a>å†å²æ›´æ–°</h2><ul><li><a href="https://crossoverjie.top/2023/12/01/ob/newsletter/Newsletter08-20231201/">20231201ï¼šç¬¬å…«æœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/15/ob/newsletter/Newsletter10-20231215/">20231215ï¼šç¬¬åæœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/22/ob/newsletter/Newsletter10-20231222/">20231122ï¼šç¬¬åä¸€æœŸ</a><!--more--></li></ul><h2 id="Deno-vs-Go-Native-hello-world-performance-Tech-Tonic"><a href="#Deno-vs-Go-Native-hello-world-performance-Tech-Tonic" class="headerlink" title="Deno vs Go: Native hello world performance | Tech Tonic"></a>Deno vs Go: Native hello world performance | Tech Tonic</h2><p>URL: <a href="https://medium.com/deno-the-complete-reference/deno-vs-go-native-hello-world-performance-c57d8fc13c75">https://medium.com/deno-the-complete-reference/deno-vs-go-native-hello-world-performance-c57d8fc13c75</a></p><blockquote><p>ä½¿ç”¨ Deno å’Œ Go è¿›è¡ŒåŸºæœ¬çš„æ¥å£å¯¹æ¯”</p></blockquote><ul><li>MacBook Pro M2 with 16GB of RAM</li><li><code>Deno</code> v1.38.0</li><li>Go v1.21.3</li></ul><p>éƒ½æ˜¯æœ€ç®€å•çš„ httpServer:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Deno</span>.<span class="title function_">serve</span>(&#123;</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">&#125;, <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pathName = <span class="keyword">new</span> <span class="title function_">URL</span>(req.<span class="property">url</span>).<span class="property">pathname</span>;</span><br><span class="line">    <span class="keyword">if</span> (pathName !== <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="literal">null</span>, &#123; <span class="attr">status</span>: <span class="number">404</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="literal">null</span>, &#123; <span class="attr">status</span>: <span class="number">500</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;io&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  http.HandleFunc(<span class="string">&quot;/&quot;</span>, helloWorld)</span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:3000&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloWorld</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  io.WriteString(w, <span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/12/25/6GdkNpm8V7azrtR.png" alt="image.png"></p><p>æ€»çš„æ¥è¯´ Deno æ¯” Go æ…¢äº† 30% å·¦å³ï¼Œä½† CPU å æœ‰ç‡æ¯” Go æ›´å°‘ï¼ŒGo çš„å†…å­˜å ç”¨æ›´ä½ã€‚</p><blockquote><p>è¿™ä¸ªå¯¹æ¯”å°±å›¾ä¸€ä¹ã€‚</p></blockquote><h2 id="Top-7-Spring-Boot-Design-Patterns-Unveiled-by-Dharmendra-Awasthi-Dec-2023-Stackademic"><a href="#Top-7-Spring-Boot-Design-Patterns-Unveiled-by-Dharmendra-Awasthi-Dec-2023-Stackademic" class="headerlink" title="Top 7 Spring Boot Design Patterns Unveiled | by Dharmendra Awasthi | Dec, 2023 | Stackademic"></a>Top 7 Spring Boot Design Patterns Unveiled | by Dharmendra Awasthi | Dec, 2023 | Stackademic</h2><p>URL: <a href="https://blog.stackademic.com/top-7-spring-boot-design-patterns-unveiled-4a2569f8d324">https://blog.stackademic.com/top-7-spring-boot-design-patterns-unveiled-4a2569f8d324</a></p><blockquote><p>7 ä¸ªæˆ‘ä»¬å¯ä»¥å­¦ä¹ çš„ Spring Boot çš„è®¾è®¡æ¨¡å¼</p></blockquote><h3 id="Singleton-Pattern-å•ä¾‹æ¨¡å¼"><a href="#Singleton-Pattern-å•ä¾‹æ¨¡å¼" class="headerlink" title="Singleton Pattern å•ä¾‹æ¨¡å¼"></a><code>Singleton Pattern</code> å•ä¾‹æ¨¡å¼</h3><p>è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œé¢è¯•éƒ½è¢«è®²çƒ‚äº†ï¼Œä¾ç„¶å¾ˆç»å…¸ã€‚<br>å½“æˆ‘ä»¬ä½¿ç”¨è¿™äº›æ³¨è§£å£°æ˜ä¸€ä¸ª Bean æ—¶<code>@Component</code>,Â <code>@Service</code>,Â <code>@Repository</code>, orÂ <code>@Controller</code>ï¼Œå°±ä¼šè¢«åˆ›å»ºä¸€ä¸ªå•ä¾‹å¯¹è±¡æ³¨å…¥åˆ° IOC å®¹å™¨ä¸­ã€‚</p><h3 id="Factory-Pattern-å·¥å‚æ¨¡å¼"><a href="#Factory-Pattern-å·¥å‚æ¨¡å¼" class="headerlink" title="Factory Pattern å·¥å‚æ¨¡å¼"></a>Factory Pattern å·¥å‚æ¨¡å¼</h3><p>Spring ä¹Ÿæä¾›äº†å·¥å‚æ¨¡å¼çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰åˆ›å»ºé€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;MyBean&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MyBean <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Custom logic to create and return MyBean instance</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> MyBean.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Or false, depending on your bean&#x27;s scope</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Builder-åˆ›å»ºè€…æ¨¡å¼"><a href="#Builder-åˆ›å»ºè€…æ¨¡å¼" class="headerlink" title="Builder åˆ›å»ºè€…æ¨¡å¼"></a>Builder åˆ›å»ºè€…æ¨¡å¼</h3><p>è¿™ä¸ªå…¶å®ä¸ç®—æ˜¯ Spring æ‰€æä¾›çš„ï¼Œä½†ç¡®å®å¾ˆå¥½ç”¨ï¼›é€šå¸¸ç”¨äºåˆ›å»ºéœ€è¦å¾ˆå¤šå¯é€‰å‚æ•°çš„å¯¹è±¡æ—¶ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="comment">// Other fields</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> User.builder()</span><br><span class="line">    .username(<span class="string">&quot;john_doe&quot;</span>)</span><br><span class="line">    .email(<span class="string">&quot;john@example.com&quot;</span>)</span><br><span class="line">    .age(<span class="number">30</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure><h3 id="Proxy-ä»£ç†æ¨¡å¼"><a href="#Proxy-ä»£ç†æ¨¡å¼" class="headerlink" title="Proxy ä»£ç†æ¨¡å¼"></a>Proxy ä»£ç†æ¨¡å¼</h3><p>ä»£ç†æ¨¡å¼åœ¨ spring ä¸­é€šå¸¸ç”¨äº AOP åˆ‡é¢ï¼Œå¯ä»¥å®ç°ä¸€äº›é€šç”¨çš„éä¸šåŠ¡é€»è¾‘åŠŸèƒ½ï¼›æ¯”å¦‚æ—¥å¿—ã€ç¼“å­˜ã€å®‰å…¨æ£€æµ‹ç­‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeServiceMethods</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Logic to be executed before service methods</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Logging before service methods...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Observe-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#Observe-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="Observe è§‚å¯Ÿè€…æ¨¡å¼"></a>Observe è§‚å¯Ÿè€…æ¨¡å¼</h3><p>æœ¬è´¨ä¸Šæ˜¯å°†ä¸šåŠ¡è§£è€¦ï¼Œç”Ÿäº§è€…å‘å¸ƒäº‹ä»¶ï¼Œè®¢é˜…è€…æ¥æ”¶äº‹ä»¶ï¼Œåªæ˜¯ spring å¸®æˆ‘ä»¬å°è£…å¥½äº†é€»è¾‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderPlacedEvent</span> <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Order order;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderPlacedEvent</span><span class="params">(Object source, Order order)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">        <span class="built_in">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters for order information</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEventPublisher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ApplicationEventPublisher eventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(ApplicationEventPublisher eventPublisher)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.eventPublisher = eventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// Logic to place order</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Publish OrderPlacedEvent</span></span><br><span class="line">        eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">OrderPlacedEvent</span>(<span class="built_in">this</span>, order));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmailOnOrderPlacement</span><span class="params">(OrderPlacedEvent event)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> event.getOrder();</span><br><span class="line">        <span class="comment">// Logic to send email based on the placed order</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è½¬è½¬ä¸€ä½“åŒ–ç›‘æ§ç³»ç»Ÿâ€”â€”PrometheusÂ·Grafanaæˆæœ¬æ²»ç†-TakinTalksç¨³å®šæ€§æŠ€æœ¯äº¤æµå¹³å°"><a href="#è½¬è½¬ä¸€ä½“åŒ–ç›‘æ§ç³»ç»Ÿâ€”â€”PrometheusÂ·Grafanaæˆæœ¬æ²»ç†-TakinTalksç¨³å®šæ€§æŠ€æœ¯äº¤æµå¹³å°" class="headerlink" title="è½¬è½¬ä¸€ä½“åŒ–ç›‘æ§ç³»ç»Ÿâ€”â€”PrometheusÂ·Grafanaæˆæœ¬æ²»ç†_TakinTalksç¨³å®šæ€§æŠ€æœ¯äº¤æµå¹³å°"></a>è½¬è½¬ä¸€ä½“åŒ–ç›‘æ§ç³»ç»Ÿâ€”â€”PrometheusÂ·Grafanaæˆæœ¬æ²»ç†_TakinTalksç¨³å®šæ€§æŠ€æœ¯äº¤æµå¹³å°</h2><p>URL: <a href="https://news.shulie.io/?p=8229">https://news.shulie.io/?p=8229</a><br><img src="https://s2.loli.net/2023/12/29/WSl4PQDKh9g3Hiu.png" alt="image.png"></p><p>é“¾æ¥é‡Œæœ‰ B ç«™è§†é¢‘ï¼Œæ–‡å­—ç‰ˆé“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/FySeVBL7EfihOlNDBvAPpw">https://mp.weixin.qq.com/s/FySeVBL7EfihOlNDBvAPpw</a></p><blockquote><p>è½¬è½¬çš„ç›‘æ§æ–¹æ¡ˆ</p></blockquote><ul><li>åŸºäº Prometheus æ¶æ„ï¼ˆç¡®å®å·²ç»æ˜¯ç›‘æ§é¢†åŸŸçš„æ ‡å‡†äº†ï¼‰</li><li>ä½¿ç”¨ <strong>M3DB</strong> æ›¿æ¢äº†å•æœºçš„ Prometheusã€‚<ul><li>æˆ‘ä»¬ä½¿ç”¨ VM æ›¿æ¢çš„ Prometheusï¼Œè½¬è½¬æ²¡æœ‰é€‰æ‹© VM æ˜¯å› ä¸º M3DB çš„å‹ç¼©ç‡æ›´é«˜ã€‚</li></ul></li><li>é‡‡ç”¨ Push æ¨¡å‹æ¨é€æ•°æ®<ul><li>ç”± SDK è¿›è¡Œæ¨é€ï¼Œå¯¹ä¸šåŠ¡æ— æ„ŸçŸ¥</li><li>çœç•¥äº†æ³¨å†Œä¸­å¿ƒï¼Œæ”¹ä¸ºäº†æ•°æ®åº“å­˜å‚¨æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯ã€‚<ul><li>ç”±äºæˆ‘ä»¬ä½¿ç”¨äº† <code>kubernetes</code>ï¼Œæ‰€ä»¥æ˜¯åŸºäº kubernetes çš„ SD å®ç°çš„æœåŠ¡å‘ç°ã€‚</li><li>æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨çš„ä¹Ÿæ˜¯ Pull æ‹‰å–æ¨¡å‹</li></ul></li></ul></li><li>é‡å†™äº†å‘Šè­¦ç³»ç»Ÿï¼ŒPrometheus è‡ªå¸¦çš„å‘Šè­¦ç³»ç»Ÿå­˜åœ¨å­¦ä¹ éš¾åº¦å¤§ç­‰é—®é¢˜ã€‚</li></ul><p>æ–‡ç« é“¾æ¥ï¼š</p><ul><li><a href="https://medium.com/deno-the-complete-reference/deno-vs-go-native-hello-world-performance-c57d8fc13c75">https://medium.com/deno-the-complete-reference/deno-vs-go-native-hello-world-performance-c57d8fc13c75</a></li><li><a href="https://blog.stackademic.com/top-7-spring-boot-design-patterns-unveiled-4a2569f8d324">https://blog.stackademic.com/top-7-spring-boot-design-patterns-unveiled-4a2569f8d324</a></li><li><a href="https://news.shulie.io/?p=8229">https://news.shulie.io/?p=8229</a></li></ul><p>#Newletters </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/12/29/t1FmIn4i6HAOoDB.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    <category term="Newsletter" scheme="http://crossoverjie.top/categories/OB/Newsletter/"/>
    
    
  </entry>
  
  <entry>
    <title>Pulsar3.0 å‡çº§æŒ‡åŒ—</title>
    <link href="http://crossoverjie.top/2023/12/24/ob/Pulsar3.0-upgrade/"/>
    <id>http://crossoverjie.top/2023/12/24/ob/Pulsar3.0-upgrade/</id>
    <published>2023-12-24T09:08:27.000Z</published>
    <updated>2023-12-28T02:14:11.229Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/12/24/4EVJDOaxl1WI3j9.png" alt="Pulsar3.0-upgrade.png"></p><h1 id="Pulsar3-0-ä»‹ç»"><a href="#Pulsar3-0-ä»‹ç»" class="headerlink" title="Pulsar3.0 ä»‹ç»"></a>Pulsar3.0 ä»‹ç»</h1><p>Pulsar3.0 æ˜¯ Pulsar ç¤¾åŒºæ¨å‡ºçš„ç¬¬ä¸€ä¸ª LTS é•¿æœŸæ”¯æŒç‰ˆæœ¬ã€‚</p><p><img src="https://s2.loli.net/2023/12/22/RL2AvFCQiIseMxH.png" alt="image.png"></p><p>å¦‚å›¾æ‰€ç¤ºï¼ŒLTS ç‰ˆæœ¬ä¼šæœ€é•¿æ”¯æŒåˆ° 36 ä¸ªæœˆï¼Œè€Œ Feature ç‰ˆæœ¬æœ€å¤šåªæœ‰å…­ä¸ªæœˆï¼›ç±»ä¼¼äºæˆ‘ä»¬ä½¿ç”¨çš„ <code>JDK11,17,21</code> éƒ½æ˜¯å¯ä»¥é•¿æœŸä½¿ç”¨çš„ï¼›æ‰€ä»¥ä¹Ÿæ¨èå¤§å®¶éƒ½å‡çº§åˆ° LTS ç‰ˆæœ¬ã€‚</p><hr><p>ä½œä¸ºé¦–ä¸ª LTS ç‰ˆæœ¬ï¼Œ3.0 è‡ªç„¶ä¹Ÿæ˜¯è‡ªå¸¦äº†è®¸å¤šæ–°ç‰¹æ€§ï¼Œè¿™ä¸ªä¼šåœ¨åç»­ä»‹ç»ã€‚</p><span id="more"></span><h1 id="å‡çº§æŒ‡å—"><a href="#å‡çº§æŒ‡å—" class="headerlink" title="å‡çº§æŒ‡å—"></a>å‡çº§æŒ‡å—</h1><p>å…ˆæ¥çœ‹çœ‹å‡çº§æŒ‡å—ï¼š<br><img src="https://s2.loli.net/2023/12/24/ZAc2845LvhsBHfx.png" alt="image.png"><br>åœ¨å®˜æ–¹çš„å…¼å®¹è¡¨ä¸­ä¼šå‘ç°ï¼šä¸æ¨èè·¨ç‰ˆæœ¬å‡çº§ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ ç°åœ¨è¿˜åœ¨ä½¿ç”¨çš„æ˜¯ 2.10.xï¼Œé‚£ä¹ˆæ¨èæ˜¯å…ˆå‡çº§åˆ° 2.11.x ç„¶åå†å‡çº§åˆ° 3.0.x.</p><p>è€Œä¸”æ ¹æ®æˆ‘ä»¬çš„ä½¿ç”¨ç»éªŒæ¥çœ‹ï¼Œé¦–ä¸ªç‰ˆæœ¬æ˜¯ä¸ä¿é™©çš„ï¼Œå³ä¾¿æ˜¯ LTS ç‰ˆæœ¬ï¼›<br>æ‰€ä»¥ä¸æ¨èç›´æ¥å‡çº§åˆ° 3.0.0ï¼Œè€Œæ˜¯æ›´æ¨è 3.0.1+ï¼Œè¿™ä¸ªå°ç‰ˆæœ¬ä¼šä¿®å¤ 3.0 æ‰€å¸¦æ¥çš„ä¸€äº› bugã€‚</p><p>å…ˆè®²ä¸€ä¸‹æˆ‘ä»¬çš„å‡çº§æµç¨‹ï¼Œå¤§å®¶å¯ä»¥ç”¨åšå‚è€ƒã€‚</p><h2 id="å‡çº§å‰å‡†å¤‡"><a href="#å‡çº§å‰å‡†å¤‡" class="headerlink" title="å‡çº§å‰å‡†å¤‡"></a>å‡çº§å‰å‡†å¤‡</h2><p>æ ¹æ®æˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯ï¼Œä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œé¦–å…ˆéœ€è¦å°†æˆ‘ä»¬çš„æ’ä»¶ä¾èµ–å‡çº§åˆ°å¯¹åº”çš„ç‰ˆæœ¬ã€‚<br><img src="https://s2.loli.net/2023/12/24/8NzRJUrBWqKPkm9.png" alt="image.png"><br>å…¶å®ç®€å•æ¥è¯´å°±æ˜¯æ›´æ–°ä¸‹ä¾èµ–ï¼Œç„¶åå†é‡æ–°æ‰“åŒ…ï¼Œåœ¨åç»­çš„æµç¨‹è¿›è¡Œæµ‹è¯•ã€‚</p><h3 id="é¢„çƒ­é•œåƒ"><a href="#é¢„çƒ­é•œåƒ" class="headerlink" title="é¢„çƒ­é•œåƒ"></a>é¢„çƒ­é•œåƒ</h3><p>ä¹‹åæ˜¯é¢„çƒ­é•œåƒï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>harbor</code> æ­å»ºäº†è‡ªå·±çš„ docker é•œåƒä»“åº“ï¼Œè¿™æ ·åœ¨å‡çº§é‡å¯é•œåƒçš„æ—¶å€™å¯ä»¥æ›´å¿«çš„ä»å†…ç½‘æ‹‰å–é•œåƒã€‚</p><blockquote><p>æ¯•ç«Ÿä¸€ä¸ª pulsar-all çš„é•œåƒä¹Ÿä¸å°ï¼Œå°½é‡çš„ç¼©çŸ­å¯åŠ¨æ—¶é—´ã€‚</p></blockquote><p>é¢„çƒ­çš„è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull apachepulsar/pulsar-all:3.0.1</span><br><span class="line"></span><br><span class="line">docker tag apachepulsar/pulsar-all:3.0.1 harbor-private.xx.com/pulsar/pulsar-all:3.0.1</span><br><span class="line"></span><br><span class="line">docker image push harbor-private.xx.com/pulsar/pulsar-all:3.0.1</span><br></pre></td></tr></table></figure><p>ä¹‹åå‡çº§çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ç§æœçš„é•œåƒäº†ã€‚</p><h2 id="åŠŸèƒ½æµ‹è¯•"><a href="#åŠŸèƒ½æµ‹è¯•" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h2><p>æˆ‘è¿™è¾¹æœ‰å†™äº†ä¸€ä¸ª <code>cli</code> å¯ä»¥å¸®æˆ‘å¿«é€Ÿåˆ›å»ºæˆ–å‡çº§ä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åè§¦å‘æˆ‘æ‰€ç¼–å†™çš„åŠŸèƒ½æµ‹è¯•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./pulsar-upgrade-cli upgrade pulsar-test ./charts/pulsar --version x.x.x -f charts/pulsar/values.yaml -n pulsar-test</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª cli å¾ˆç®€å•ï¼Œä¸€å…±å°±åšä¸‰ä»¶äº‹ï¼š</p><ul><li>ä½¿ç”¨ helm æ¥å£å‡çº§é›†ç¾¤</li><li>ç­‰å¾…æ‰€æœ‰çš„ Pod éƒ½å‡çº§æˆåŠŸ</li><li>è§¦å‘åŠŸèƒ½æµ‹è¯•</li></ul><p>ä¹‹åçš„æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://s2.loli.net/2023/12/24/m85XPGr9nLqtp17.png" alt="image.png"></p><p>ä¸»è¦å°±æ˜¯è¦†ç›–äº†æˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯ï¼Œéƒ½è·‘é€šè¿‡ä¹‹åæ‰ä¼šèµ°åç»­çš„æµç¨‹ã€‚</p><h2 id="è¿è¡Œç›‘æ§"><a href="#è¿è¡Œç›‘æ§" class="headerlink" title="è¿è¡Œç›‘æ§"></a>è¿è¡Œç›‘æ§</h2><p><img src="https://s2.loli.net/2023/12/24/2iDHdwPB4UJXsGh.png" alt="image.png"></p><p>ä¹‹åä¼šå¯åŠ¨ä¸€ä¸ª 200 å·¦å³çš„å¹¶å‘ç”Ÿäº§å’Œæ¶ˆè´¹æ•°æ®ï¼Œæ¨¡æ‹Ÿçº¿ä¸Šçš„ä½¿ç”¨æƒ…å†µï¼Œä¼šä¸€ç›´è®©è¿™ä¸ªä»»åŠ¡è·‘ç€ï¼Œå¤§æ¦‚ä¸€æ™šä¸Šå°±å¯ä»¥äº†ï¼Œç¬¬äºŒå¤©é€šè¿‡ç›‘æ§æŸ¥çœ‹ï¼š</p><ul><li>åº”ç”¨æœ‰æ— å¼‚å¸¸æ—¥å¿—</li><li>æµé‡æ˜¯å¦æ­£å¸¸</li><li>å„ä¸ªç»„ä»¶çš„å†…å­˜å ç”¨</li><li>å†™å…¥å»¶è¿Ÿç­‰ä¿¡æ¯</li></ul><h2 id="å‡çº§æ­¥éª¤"><a href="#å‡çº§æ­¥éª¤" class="headerlink" title="å‡çº§æ­¥éª¤"></a>å‡çº§æ­¥éª¤</h2><p>ç»„ä»¶çš„å‡çº§æ­¥éª¤è¿™é‡Œå‚è€ƒäº†å®˜æ–¹æŒ‡å—ï¼š<br><a href="https://pulsar.apache.org/docs/3.1.x/administration-upgrade/#upgrade-zookeeper-optional">https://pulsar.apache.org/docs/3.1.x/administration-upgrade/#upgrade-zookeeper-optional</a><br><img src="https://s2.loli.net/2023/12/24/9dXxSTOwb8lFm1v.png" alt="image.png"></p><ul><li>å‡çº§ZK</li><li>å…³é—­auto recovery</li><li>å‡çº§Bookkeeper</li><li>å‡çº§Broker</li><li>å‡çº§Proxy</li><li>å¼€å¯auto recovery</li></ul><p>åªè¦ä¸€æ­¥æ­¥æŒ‰ç…§è¿™ä¸ªæµç¨‹èµ°ï¼Œé—®é¢˜ä¸å¤§ï¼Œå“ªä¸€æ­¥å‡ºç°é—®é¢˜åéœ€è¦åŠæ—¶å›æ»šï¼Œå›æ»šæµç¨‹å‚è€ƒä¸‹é¢çš„å›æ»šéƒ¨åˆ†ã€‚</p><p>åŒæ—¶åœ¨å‡çº§è¿‡ç¨‹ä¸­éœ€è¦ä¸€ç›´æŸ¥çœ‹ broker çš„ error æ—¥å¿—ï¼Œå¦‚æœæœ‰æ˜æ˜¾çš„ä¸ç¬¦åˆé¢„æœŸçš„æ—¥å¿—ä¸€å®šè¦æ³¨æ„ã€‚</p><blockquote><p>åœ¨å‡çº§  bookkeeper çš„æ—¶å€™ï¼Œbroker å¯èƒ½ä¼šå‡ºç° bk è¿æ¥å¤±è´¥çš„å¼‚å¸¸ï¼Œè¿™ä¸ªå¯ä»¥ä¸ç”¨åœ¨æ„ã€‚</p></blockquote><h2 id="çº¿ä¸ŠéªŒè¯"><a href="#çº¿ä¸ŠéªŒè¯" class="headerlink" title="çº¿ä¸ŠéªŒè¯"></a>çº¿ä¸ŠéªŒè¯</h2><p>éƒ½å‡çº§å®Œåå°±æ˜¯çº¿ä¸Šä¸šåŠ¡éªŒè¯ç¯èŠ‚äº†ï¼š</p><ul><li><input checked="" disabled="" type="checkbox"> æŸ¥çœ‹ç›‘æ§é¢æ¿ï¼Œæ˜¯å¦æœ‰æ˜æ˜¾çš„æµé‡ã€å†…å­˜ã€å»¶è¿Ÿçš„å¼‚å¸¸æŒ‡æ ‡ã€‚ âœ… 2023-12-24</li><li><input checked="" disabled="" type="checkbox"> topic å…ƒæ•°æ®å®Œæ•´æ€§éªŒè¯ï¼šè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬è¿™æ¬¡å‡çº§å‡ºäº†ä¸€ä¸ª topic è¢«åˆ é™¤çš„ bugï¼Œæ‰€ä»¥éœ€è¦é‡ç‚¹éªŒè¯ä¸‹ï¼›è¿™éƒ¨åˆ†ä¼šåœ¨ä¸‹æ¬¡è¯¦ç»†åˆ†æã€‚ âœ… 2023-12-24</li><li><input checked="" disabled="" type="checkbox"> æŸ¥çœ‹ä¸šåŠ¡æ¶ˆæ¯æ”¶å‘æœ‰æ— å¼‚å¸¸ âœ… 2023-12-24</li><li><input checked="" disabled="" type="checkbox"> é“¾è·¯æŸ¥è¯¢æ˜¯å¦æ­£å¸¸ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¶ˆæ¯é“¾è·¯æŸ¥è¯¢çš„é¡µé¢ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ <code>Pulsar-SQL</code> å’Œ <code>broker-interceptor</code> å®ç°çš„ã€‚ âœ… 2023-12-24</li></ul><h2 id="å¼‚å¸¸å›æ»š"><a href="#å¼‚å¸¸å›æ»š" class="headerlink" title="å¼‚å¸¸å›æ»š"></a>å¼‚å¸¸å›æ»š</h2><p>å½“å‡ºç°å¼‚å¸¸çš„æ—¶å€™éœ€è¦ç«‹å³å›æ»šï¼Œè¿™é‡Œçš„å¼‚å¸¸ä¸€èˆ¬å°±æ˜¯æ¶ˆæ¯æ”¶å‘å¼‚å¸¸ï¼Œå®¢æˆ·ç«¯æ‰çº¿ç­‰ã€‚</p><p>ç»è¿‡æˆ‘çš„æµ‹è¯• 3.0.x çš„å­˜å‚¨å’Œä¹‹å‰çš„ç‰ˆæœ¬æ˜¯å…¼å®¹çš„ï¼Œæ‰€ä»¥ <code>bookkeeper</code> éƒ½èƒ½é™çº§å…¶ä»–çš„ç»„ä»¶å°±æ²¡å•¥å¯æ‹…å¿ƒçš„äº†ã€‚</p><p>éœ€è¦é™çº§æ—¶ç›´æ¥å°†æ‰€æœ‰ç»„ä»¶é™çº§ä¸ºä¸Šä¸€ä¸ªç‰ˆæœ¬å³å¯ã€‚</p><h2 id="ç¾éš¾æ¢å¤"><a href="#ç¾éš¾æ¢å¤" class="headerlink" title="ç¾éš¾æ¢å¤"></a>ç¾éš¾æ¢å¤</h2><p>å› ä¸ºæ˜¯ä» 2.x å‡çº§åˆ° 3.x ä¹Ÿæ˜¯æ¶‰åŠåˆ°äº†è·¨å¤§ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¹Ÿå‡†å¤‡äº†ç¾éš¾æ¢å¤çš„æ–¹æ¡ˆã€‚</p><blockquote><p>æ¯”å¦‚æç«¯æƒ…å†µä¸‹å‡çº§å¤±è´¥ï¼Œæ‰€æœ‰æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚</p></blockquote><p>æ•´ä¸ªç¾éš¾æ¢å¤çš„ä¸»è¦ç›®çš„å°±æ˜¯æ¢å¤åçš„é›†ç¾¤å¯¹å¤–æä¾›çš„åŸŸåä¸å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ—¶æ‰€æœ‰çš„å®¢æˆ·ç«¯å¯ä»¥è‡ªåŠ¨é‡è¿ä¸Šæ¥ï¼Œä¹Ÿå°±æ˜¯æœ€åçš„æƒ…å†µä¸‹æ‰€æœ‰çš„æ•°æ®ä¸¢äº†å¯ä»¥æ¥å—ï¼Œä½†ä¸èƒ½å½±å“ä¸šåŠ¡æ­£å¸¸ä½¿ç”¨ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„æµç¨‹å¦‚ä¸‹ï¼š</p><h3 id="å¤‡ä»½-topic"><a href="#å¤‡ä»½-topic" class="headerlink" title="å¤‡ä»½ topic"></a>å¤‡ä»½ topic</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SneakyThrows</span>  </span><br><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backup</span><span class="params">()</span>&#123;  </span><br><span class="line">    List&lt;String&gt; topicList = pulsarAdmin.topics().getPartitionedTopicList(<span class="string">&quot;tenant/namespace&quot;</span>);  </span><br><span class="line">    log.info(<span class="string">&quot;topic size=&#123;&#125;&quot;</span>,topicList.size());  </span><br><span class="line">    <span class="comment">// create a custom thread pool  </span></span><br><span class="line">    CopyOnWriteArrayList&lt;TopicMeta&gt; dataList = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();  </span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">customThreadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);  </span><br><span class="line">    <span class="keyword">for</span> (String topicName : topicList) &#123;  </span><br><span class="line">        customThreadPool.execute(()-&gt; &#123;  </span><br><span class="line">            PartitionedTopicMetadata metadata;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                metadata = pulsarAdmin.topics().getPartitionedTopicMetadata(topicName);  </span><br><span class="line">                <span class="type">TopicMeta</span> <span class="variable">topicMeta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TopicMeta</span>();  </span><br><span class="line">  </span><br><span class="line">                <span class="comment">// backup topic  </span></span><br><span class="line">                topicMeta.setName(topicName);  </span><br><span class="line">                topicMeta.setPartition(metadata.partitions);  </span><br><span class="line">  </span><br><span class="line">                <span class="comment">// backup permission  </span></span><br><span class="line">                Map&lt;String, Set&lt;AuthAction&gt;&gt; permissions = pulsarAdmin.topics().getPermissions(topicName);  </span><br><span class="line">                topicMeta.setPermissions(permissions);  </span><br><span class="line">  </span><br><span class="line">                <span class="comment">// back sub  </span></span><br><span class="line">                List&lt;String&gt; subscriptions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">                <span class="type">PartitionedTopicStats</span> <span class="variable">topicStats</span> <span class="operator">=</span> pulsarAdmin.topics().getPartitionedStats(topicName, <span class="literal">true</span>);  </span><br><span class="line">                topicStats.getSubscriptions().forEach((k,v)-&gt; subscriptions.add(k));  </span><br><span class="line">                topicMeta.setSubscriptions(subscriptions);  </span><br><span class="line">  </span><br><span class="line">                dataList.add(topicMeta);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (PulsarAdminException e) &#123;  </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">            &#125;        &#125;);    &#125;  </span><br><span class="line">    customThreadPool.shutdown();  </span><br><span class="line">    <span class="keyword">while</span> (!customThreadPool.isTerminated()) &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">    log.info(<span class="string">&quot;&#123;&#125;&quot;</span>,dataList.size());  </span><br><span class="line">    log.info(<span class="string">&quot;&#123;&#125;&quot;</span>,JSONUtil.toJsonStr(dataList));  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TopicMetaData</span></span><br><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TopicMeta</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> partition;  </span><br><span class="line">    Map&lt;String, Set&lt;AuthAction&gt;&gt; permissions;  </span><br><span class="line">    List&lt;String&gt; subscriptions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥æ˜¯å¤‡ä»½ topicï¼š</p><ul><li>topic ä¸»è¦æ˜¯åç§°å’Œåˆ†åŒºæ•°é‡</li><li>å¤‡ä»½æƒé™</li><li>å¤‡ä»½ topic çš„è®¢é˜…è€…</li></ul><h3 id="å…¬ç§é’¥å¤‡ä»½"><a href="#å…¬ç§é’¥å¤‡ä»½" class="headerlink" title="å…¬ç§é’¥å¤‡ä»½"></a>å…¬ç§é’¥å¤‡ä»½</h3><p>å› ä¸ºæˆ‘ä»¬å®¢æˆ·ç«¯ä½¿ç”¨äº† JWT éªŒè¯ï¼Œæ‰€æœ‰ä¸ºäº†ä½¿å¾—æ¢å¤çš„ Pulsar é›†ç¾¤å¯ä»¥è®©å®¢æˆ·ç«¯æ— ç¼åˆ‡æ¢åˆ°æ–°é›†ç¾¤ï¼Œå› æ­¤å¿…é¡»å¾—ä½¿ç”¨ç›¸åŒçš„å…¬ç§é’¥ã€‚</p><p>è¿™ä¸ªå…¶å®æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ helm å®‰è£…çš„é›†ç¾¤ï¼Œæ‰€ä»¥åªéœ€è¦å¤‡ä»½å¥½ <code>Secret</code> å³å¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>  </span><br><span class="line"><span class="attr">data:</span>  </span><br><span class="line">  <span class="attr">PRIVATEKEY:</span> <span class="string">XXX</span>  </span><br><span class="line">  <span class="attr">PUBLICKEY:</span> <span class="string">XXX</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span>  </span><br><span class="line"><span class="attr">metadata:</span>  </span><br><span class="line">  <span class="attr">name:</span> <span class="string">pulsar-token-asymmetric-key</span>  </span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">pulsar</span>  </span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿˜æœ‰å‡ ä¸ª superUser çš„ Secret</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æ¢å¤"><a href="#æ•°æ®æ¢å¤" class="headerlink" title="æ•°æ®æ¢å¤"></a>æ•°æ®æ¢å¤</h3><h4 id="åˆ›å»ºæ–°é›†ç¾¤"><a href="#åˆ›å»ºæ–°é›†ç¾¤" class="headerlink" title="åˆ›å»ºæ–°é›†ç¾¤"></a>åˆ›å»ºæ–°é›†ç¾¤</h4><p>é¦–å…ˆä½¿ç”¨ helm é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°é›†ç¾¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./scripts/pulsar/prepare_helm_release.sh -n pulsar -k pulsar</span><br><span class="line"></span><br><span class="line">helm install \    --values charts/pulsar/values.yaml \    --set namespace=pulsar\  </span><br><span class="line">    --set initialize=true \  </span><br><span class="line">    pulsar ./charts/pulsar -n pulsar</span><br></pre></td></tr></table></figure><h4 id="æ¢å¤å…¬ç§é’¥"><a href="#æ¢å¤å…¬ç§é’¥" class="headerlink" title="æ¢å¤å…¬ç§é’¥"></a>æ¢å¤å…¬ç§é’¥</h4><p>ç›´æ¥ä½¿ç”¨åˆšæ‰å¤‡ä»½çš„å…¬ç§é’¥è¦†ç›–åˆ°æ–°é›†ç¾¤å³å¯ã€‚</p><h4 id="æ¢å¤namespace"><a href="#æ¢å¤namespace" class="headerlink" title="æ¢å¤namespace"></a>æ¢å¤namespace</h4><p>è¿›å…¥ toolset pod åˆ›å»ºéœ€è¦ä½¿ç”¨çš„ <code>tenant/namespace</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">k exec -it pulsar-toolset-0 -n pulsar bash</span><br><span class="line"></span><br><span class="line">bin/pulsar-admin tenants create tenant</span><br><span class="line"></span><br><span class="line">bin/pulsar-admin namespaces create tenant/namespace</span><br></pre></td></tr></table></figure><h4 id="å…ƒæ•°æ®æ¢å¤"><a href="#å…ƒæ•°æ®æ¢å¤" class="headerlink" title="å…ƒæ•°æ®æ¢å¤"></a>å…ƒæ•°æ®æ¢å¤</h4><p>ä¹‹åä¾¿æ˜¯æœ€é‡è¦çš„å…ƒæ•°æ®æ¢å¤äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SneakyThrows</span>  </span><br><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">restore</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="type">PulsarAdmin</span> <span class="variable">pulsarAdmin</span> <span class="operator">=</span> PulsarAdmin.builder().serviceHttpUrl(<span class="string">&quot;http://url:8080&quot;</span>)  </span><br><span class="line">            .authentication(AuthenticationFactory.token(token))  </span><br><span class="line">            .build();  </span><br><span class="line">    <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Path.of(<span class="string">&quot;restore-ns.json&quot;</span>);  </span><br><span class="line">    <span class="type">String</span> <span class="variable">fileContent</span> <span class="operator">=</span> Files.readString(filePath);  </span><br><span class="line">    List&lt;TopicMeta&gt; topicMetaList = JSON.parseArray(fileContent, TopicMeta.class);  </span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">customThreadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">50</span>);  </span><br><span class="line">    <span class="keyword">for</span> (TopicMeta topicMeta : topicMetaList) &#123;  </span><br><span class="line">        customThreadPool.execute(() -&gt; &#123;  </span><br><span class="line">            <span class="comment">// Create topic  </span></span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                pulsarAdmin.topics().createPartitionedTopic(topicMeta.getName(), topicMeta.getPartition());  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (PulsarAdminException e) &#123;  </span><br><span class="line">                log.error(<span class="string">&quot;Create topic error&quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="comment">// Create sub  </span></span><br><span class="line">            <span class="keyword">for</span> (String subscription : topicMeta.getSubscriptions()) &#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    pulsarAdmin.topics().createSubscription(topicMeta.getName(), subscription, MessageId.latest);  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (PulsarAdminException e) &#123;  </span><br><span class="line">                    log.error(<span class="string">&quot;createSubscription error&quot;</span>);  </span><br><span class="line">                &#125;            &#125;  </span><br><span class="line">            <span class="comment">// Grant permission  </span></span><br><span class="line">            topicMeta.getPermissions().forEach((role, authActions) -&gt; &#123;  </span><br><span class="line">                permission(pulsarAdmin, topicMeta.getName(), role, authActions);  </span><br><span class="line">            &#125;);  </span><br><span class="line">            log.info(<span class="string">&quot;topic:&#123;&#125; restore success&quot;</span>, topicMeta.getName());  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">        &#125;);    &#125;  </span><br><span class="line">    customThreadPool.shutdown();  </span><br><span class="line">    <span class="keyword">while</span> (!customThreadPool.isTerminated()) &#123;  </span><br><span class="line">    &#125;    log.info(<span class="string">&quot;restore success&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">permission</span><span class="params">(PulsarAdmin pulsarAdmin, String topic, String role, Set&lt;AuthAction&gt; authActions)</span> &#123;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        pulsarAdmin.topics().grantPermission(topic, role, authActions);  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (PulsarAdminException e) &#123;  </span><br><span class="line">        log.error(<span class="string">&quot;grantPermission error&quot;</span>, e);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµç¨‹å’Œå¤‡ä»½ç±»ä¼¼ï¼š</p><ul><li>åˆ›å»ºåˆ†åŒº topic</li><li>åˆ›å»ºè®¢é˜…è€…</li><li>æˆæƒè§’è‰²ä¿¡æ¯</li></ul><p>å› ä¸ºæˆæƒæ¥å£é™åˆ¶äº†å¹¶å‘è°ƒç”¨ï¼Œæ‰€æœ‰éœ€è¦åŠ é”ï¼Œå¯¼è‡´æ•´ä¸ªæ¢å¤çš„æµç¨‹å°±ä¼šæ¯”è¾ƒæ…¢ã€‚</p><p>8000 topic çš„ namespace å¤§æ¦‚æ¢å¤æ—¶é—´ä¸º 40min å·¦å³ã€‚</p><p>ä¹‹åä¾æ¬¡æ¢å¤å…¶ä»– namespace å³å¯ã€‚</p><h4 id="æ¢å¤-police"><a href="#æ¢å¤-police" class="headerlink" title="æ¢å¤ police"></a>æ¢å¤ police</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin.namespaces().setNamespaceMessageTTL(<span class="string">&quot;tenant/namespace&quot;</span>, <span class="number">3600</span> * <span class="number">6</span>);</span><br><span class="line">admin.namespaces().setBacklogQuota(<span class="string">&quot;tenant/namespace&quot;</span>,Â BacklogQuota)</span><br></pre></td></tr></table></figure><p>å¦‚æœä¹‹å‰çš„é›†ç¾¤æœ‰è®¾ç½® TTL æˆ–è€…æ˜¯ backlogQuota æ—¶éƒ½éœ€è¦æ‰‹åŠ¨æ¢å¤ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªå‡çº§å’Œç¾éš¾æ¢å¤çš„æµç¨‹ï¼Œå½“ç„¶ç¾éš¾æ¢å¤å¸Œæœ›å¤§å®¶ä¸è¦ç¢°åˆ°ã€‚</p><p>æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡è¯¦ç»†ä»‹ç» <code>Pulsar 3.0</code> çš„æ–°åŠŸèƒ½ä»¥åŠæ‰€ç¢°åˆ°çš„ä¸€äº›å‘ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/12/24/4EVJDOaxl1WI3j9.png&quot; alt=&quot;Pulsar3.0-upgrade.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;Pulsar3-0-ä»‹ç»&quot;&gt;&lt;a href=&quot;#Pulsar3-0-ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Pulsar3.0 ä»‹ç»&quot;&gt;&lt;/a&gt;Pulsar3.0 ä»‹ç»&lt;/h1&gt;&lt;p&gt;Pulsar3.0 æ˜¯ Pulsar ç¤¾åŒºæ¨å‡ºçš„ç¬¬ä¸€ä¸ª LTS é•¿æœŸæ”¯æŒç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/12/22/RL2AvFCQiIseMxH.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼ŒLTS ç‰ˆæœ¬ä¼šæœ€é•¿æ”¯æŒåˆ° 36 ä¸ªæœˆï¼Œè€Œ Feature ç‰ˆæœ¬æœ€å¤šåªæœ‰å…­ä¸ªæœˆï¼›ç±»ä¼¼äºæˆ‘ä»¬ä½¿ç”¨çš„ &lt;code&gt;JDK11,17,21&lt;/code&gt; éƒ½æ˜¯å¯ä»¥é•¿æœŸä½¿ç”¨çš„ï¼›æ‰€ä»¥ä¹Ÿæ¨èå¤§å®¶éƒ½å‡çº§åˆ° LTS ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä½œä¸ºé¦–ä¸ª LTS ç‰ˆæœ¬ï¼Œ3.0 è‡ªç„¶ä¹Ÿæ˜¯è‡ªå¸¦äº†è®¸å¤šæ–°ç‰¹æ€§ï¼Œè¿™ä¸ªä¼šåœ¨åç»­ä»‹ç»ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
  <entry>
    <title>æŠ€æœ¯é˜…è¯»å‘¨åˆŠç¬¬åä¸€æœŸ</title>
    <link href="http://crossoverjie.top/2023/12/22/ob/newsletter/Newsletter10-20231222/"/>
    <id>http://crossoverjie.top/2023/12/22/ob/newsletter/Newsletter10-20231222/</id>
    <published>2023-12-22T09:28:25.000Z</published>
    <updated>2023-12-23T08:19:14.951Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/12/23/VibnQF1pM2K6fsd.png" alt="image.png"></p><p><strong>æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚</strong></p><span id="more"></span><h2 id="å†å²æ›´æ–°"><a href="#å†å²æ›´æ–°" class="headerlink" title="å†å²æ›´æ–°"></a>å†å²æ›´æ–°</h2><ul><li><a href="https://crossoverjie.top/2023/11/24/ob/newsletter/Newsletter07-20231124/">20231124ï¼šç¬¬ä¸ƒæœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/01/ob/newsletter/Newsletter08-20231201/">20231201ï¼šç¬¬å…«æœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/15/ob/newsletter/Newsletter10-20231215/">20231215ï¼šç¬¬åæœŸ</a><!--more--></li></ul><h2 id="A-Comprehensive-guide-to-Spring-Boot-3-2-with-Java-21-Virtual-Threads-Spring-Security-PostgreSQL-Flyway-Caching-Micrometer-Opentelemetry-JUnit-5-RabbitMQ-Keycloak-Integration-and-More-10-x2F-17-by-Jonathan-Chevalier-Nov-2023-Medium"><a href="#A-Comprehensive-guide-to-Spring-Boot-3-2-with-Java-21-Virtual-Threads-Spring-Security-PostgreSQL-Flyway-Caching-Micrometer-Opentelemetry-JUnit-5-RabbitMQ-Keycloak-Integration-and-More-10-x2F-17-by-Jonathan-Chevalier-Nov-2023-Medium" class="headerlink" title="A Comprehensive guide to Spring Boot 3.2 with Java 21, Virtual Threads, Spring Security, PostgreSQL, Flyway, Caching, Micrometer, Opentelemetry, JUnit 5, RabbitMQ, Keycloak Integration, and More! (10&#x2F;17) | by Jonathan Chevalier | Nov, 2023 | Medium"></a>A Comprehensive guide to Spring Boot 3.2 with Java 21, Virtual Threads, Spring Security, PostgreSQL, Flyway, Caching, Micrometer, Opentelemetry, JUnit 5, RabbitMQ, Keycloak Integration, and More! (10&#x2F;17) | by Jonathan Chevalier | Nov, 2023 | Medium</h2><p>URL: <a href="https://medium.com/@jojoooo/exploring-a-base-spring-boot-application-with-java-21-virtual-thread-spring-security-flyway-c0fde13c1eca#551c">https://medium.com/@jojoooo/exploring-a-base-spring-boot-application-with-java-21-virtual-thread-spring-security-flyway-c0fde13c1eca#551c</a></p><blockquote><p>æœ¬æ–‡è®²è§£äº†åŸºäºæœ€æ–°çš„ Spring Boot3.2 å’Œ Java 21 æ‰€ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ ˆ</p></blockquote><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p>æ•°æ®åº“ä½¿ç”¨ <code>Postgres15</code> å’Œ flyway æ¥ç®¡ç†æ•°æ®åº“ schema çš„è¿ç§»ã€‚<br><img src="https://s2.loli.net/2023/12/20/nNEkQpBhHfe6VWb.png" alt="image.png"></p><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>Spring6 å®ç°äº†æ–°çš„ <a href="https://datatracker.ietf.org/doc/html/rfc9457#name-members-of-a-problem-detail">RFC9457</a>è§„èŒƒï¼Œå®ç°ä»¥ä¸‹æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> <span class="keyword">extends</span> <span class="title class_">ResponseEntityExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Process @Valid</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> ResponseEntity&lt;Object&gt; <span class="title function_">handleMethodArgumentNotValid</span><span class="params">(</span></span><br><span class="line"><span class="params">      <span class="meta">@NonNull</span> <span class="keyword">final</span> MethodArgumentNotValidException ex,</span></span><br><span class="line"><span class="params">      <span class="meta">@NonNull</span> <span class="keyword">final</span> HttpHeaders headers,</span></span><br><span class="line"><span class="params">      <span class="meta">@NonNull</span> <span class="keyword">final</span> HttpStatusCode status,</span></span><br><span class="line"><span class="params">      <span class="meta">@NonNull</span> <span class="keyword">final</span> WebRequest request)</span> &#123;</span><br><span class="line">    log.info(ex.getMessage(), ex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List&lt;ApiErrorDetails&gt; errors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> ObjectError err : ex.getBindingResult().getAllErrors()) &#123;</span><br><span class="line">      errors.add(</span><br><span class="line">          ApiErrorDetails.builder()</span><br><span class="line">              .pointer(((FieldError) err).getField())</span><br><span class="line">              .reason(err.getDefaultMessage())</span><br><span class="line">              .build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(BAD_REQUEST)</span><br><span class="line">        .body(<span class="built_in">this</span>.buildProblemDetail(BAD_REQUEST, <span class="string">&quot;Validation failed.&quot;</span>, errors));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ProblemDetail <span class="title function_">buildProblemDetail</span><span class="params">(</span></span><br><span class="line"><span class="params">      <span class="keyword">final</span> HttpStatus status, <span class="keyword">final</span> String detail, <span class="keyword">final</span> List&lt;ApiErrorDetails&gt; errors)</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">ProblemDetail</span> <span class="variable">problemDetail</span> <span class="operator">=</span></span><br><span class="line">        ProblemDetail.forStatusAndDetail(status, StringUtils.normalizeSpace(detail));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Adds errors fields on validation errors, following RFC 9457 best practices.</span></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isNotEmpty(errors)) &#123;</span><br><span class="line">      problemDetail.setProperty(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> problemDetail;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;about:blank&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bad Request&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">400</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Validation failed.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;instance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/management/companies&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pointer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;must not be blank&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pointer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;slug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;must not be blank&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨å¼‚å¸¸"><a href="#åº”ç”¨å¼‚å¸¸" class="headerlink" title="åº”ç”¨å¼‚å¸¸"></a>åº”ç”¨å¼‚å¸¸</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RootException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Serial</span> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">6378336966214073013L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HttpStatus httpStatus;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ApiErrorDetails&gt; errors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">RootException</span><span class="params">(<span class="meta">@NonNull</span> <span class="keyword">final</span> HttpStatus httpStatus)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.httpStatus = httpStatus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">RootException</span><span class="params">(<span class="meta">@NonNull</span> <span class="keyword">final</span> HttpStatus httpStatus, <span class="keyword">final</span> String message)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(message);</span><br><span class="line">    <span class="built_in">this</span>.httpStatus = httpStatus;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExceptionHandler(RootException.class)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;ProblemDetail&gt; <span class="title function_">rootException</span><span class="params">(<span class="keyword">final</span> RootException ex)</span> &#123;</span><br><span class="line">  log.info(ex.getMessage(), ex);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Uses default message, can be adapted to use ex.getMessage().</span></span><br><span class="line">  <span class="keyword">final</span> <span class="type">ProblemDetail</span> <span class="variable">problemDetail</span> <span class="operator">=</span></span><br><span class="line">      <span class="built_in">this</span>.buildProblemDetail(</span><br><span class="line">          ex.getHttpStatus(), API_DEFAULT_REQUEST_FAILED_MESSAGE, ex.getErrors());</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> ResponseEntity.status(ex.getHttpStatus()).body(problemDetail);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;about:blank&quot;</span>,</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Request failed.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;/back-office/hello-world&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼‚å¸¸é™çº§"><a href="#å¼‚å¸¸é™çº§" class="headerlink" title="å¼‚å¸¸é™çº§"></a>å¼‚å¸¸é™çº§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line"><span class="meta">@ExceptionHandler(Throwable.class)</span></span><br><span class="line"><span class="keyword">public</span> ProblemDetail <span class="title function_">handleAllExceptions</span><span class="params">(<span class="keyword">final</span> Throwable ex, <span class="keyword">final</span> WebRequest request)</span> &#123;</span><br><span class="line">  log.warn(ex.getMessage(), ex);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.slack.notify(format(<span class="string">&quot;[API] InternalServerError: %s&quot;</span>, ex.getMessage()));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.buildProblemDetail(HttpStatus.INTERNAL_SERVER_ERROR, API_DEFAULT_ERROR_MESSAGE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;about:blank&quot;</span>,</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Something went wrong. Please try again later or enter in contact with our service.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;/back-office/hello-world&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æœ‰æ— æ³•å¤„ç†çš„å¼‚å¸¸æ—¶ï¼Œå°±éœ€è¦é…ç½®ä¸€ä¸ªå…œåº•çš„å¼‚å¸¸ã€‚</p><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CompanyRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Company, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">String</span> <span class="variable">CACHE_NAME</span> <span class="operator">=</span> <span class="string">&quot;company&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="meta">@Cacheable(value = CACHE_NAME, key = &quot;&#123;&#x27;byId&#x27;, #id&#125;&quot;)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  Optional&lt;Company&gt; <span class="title function_">findById</span><span class="params">(<span class="meta">@NonNull</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Cacheable(value = CACHE_NAME, key = &quot;&#123;&#x27;bySlug&#x27;, #slug&#125;&quot;)</span></span><br><span class="line">  Optional&lt;Company&gt; <span class="title function_">findBySlug</span><span class="params">(String slug)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Caching(</span></span><br><span class="line"><span class="meta">      evict = &#123;</span></span><br><span class="line"><span class="meta">        @CacheEvict(value = CACHE_NAME, key = &quot;&#123;&#x27;byId&#x27;, #entity.id&#125;&quot;),</span></span><br><span class="line"><span class="meta">        @CacheEvict(value = CACHE_NAME, key = &quot;&#123;&#x27;bySlug&#x27;, #entity.slug&#125;&quot;),</span></span><br><span class="line"><span class="meta">      &#125;)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  &lt;S <span class="keyword">extends</span> <span class="title class_">Company</span>&gt; <span class="meta">@NonNull</span> S <span class="title function_">save</span><span class="params">(<span class="meta">@NonNull</span> S entity)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * This cache implementation is only valid if the table is not</span></span><br><span class="line"><span class="comment">   * frequently updated since it will clear the cache at every update operation</span></span><br><span class="line"><span class="comment">   * If you want to be more performant you can use something like https://github.com/ms100/cache-as-multi</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="meta">@CacheEvict(cacheNames = CACHE_NAME, allEntries = true)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  &lt;S <span class="keyword">extends</span> <span class="title class_">Company</span>&gt; List&lt;S&gt; <span class="title function_">saveAll</span><span class="params">(<span class="meta">@NonNull</span> Iterable&lt;S&gt; entities)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Caching(</span></span><br><span class="line"><span class="meta">      evict = &#123;</span></span><br><span class="line"><span class="meta">        @CacheEvict(value = CACHE_NAME, key = &quot;&#123;&#x27;byId&#x27;, #entity.id&#125;&quot;),</span></span><br><span class="line"><span class="meta">        @CacheEvict(value = CACHE_NAME, key = &quot;&#123;&#x27;bySlug&#x27;, #entity.slug&#125;&quot;),</span></span><br><span class="line"><span class="meta">      &#125;)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@NonNull</span> Company entity)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * This cache implementation is only valid if the table is not</span></span><br><span class="line"><span class="comment">   * frequently updated since it will clear the cache at every delete operation</span></span><br><span class="line"><span class="comment">   * If you want to be more performant you can use something like https://github.com/ms100/cache-as-multi</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="meta">@CacheEvict(cacheNames = CACHE_NAME, allEntries = true)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">(<span class="meta">@NonNull</span> Iterable&lt;? extends Company&gt; entities)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring æä¾›äº†æ ‡å‡†çš„ç¼“å­˜æ¥å£ï¼Œå³ä¾¿æ˜¯åç»­éœ€è¦åˆ‡æ¢åˆ° Redisï¼Œä½¿ç”¨çš„ API å’Œæ³¨è§£éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><p>Java21 åæ”¯æŒäº†è™šæ‹Ÿçº¿ç¨‹ï¼Œå‡ ä¹å¯ä»¥æ— é™çš„å®ç°çº¿ç¨‹ï¼Œåœ¨ Spring Boot 3.2 éœ€è¦å•ç‹¬å¼€å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.threads.virtual.enabled</span><br></pre></td></tr></table></figure><h3 id="å¯è§‚æµ‹æ€§"><a href="#å¯è§‚æµ‹æ€§" class="headerlink" title="å¯è§‚æµ‹æ€§"></a>å¯è§‚æµ‹æ€§</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">info,</span> <span class="string">health,</span> <span class="string">prometheus,</span> <span class="string">metrics</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/12/20/Wh3toXGSJV7AU45.png" alt="image.png"></p><blockquote><p>æ³¨æ„åœ¨ç”Ÿæˆç¯å¢ƒä¸è¦æš´éœ²ç®¡ç† API</p></blockquote><h3 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-tracing-bridge-otel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.ttddyy.observation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>datasource-micrometer-spring-boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;datasource-micrometer.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentelemetry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentelemetry-exporter-otlp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;opentelemetry-exporter-otlp.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ­¥è¯·æ±‚çš„æ—¶å€™æ¯ä¸ªè¯·æ±‚éƒ½ä¼šå¸¦ä¸Š <code>traceId</code> å’Œ <code>spanId</code> ï¼Œå¦‚æœæ˜¯å¼‚æ­¥è¯·æ±‚æ—¶å€™éœ€è¦é…ç½®ï¼š<code>spring.reactor.context-propagation=true</code></p><p>å¦‚æœä½¿ç”¨ <code>@Async</code>æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskExecutorConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * Override default SimpleAsyncTaskExecutor to provide context propagation in @Async function</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> TaskExecutor <span class="title function_">simpleAsyncTaskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">SimpleAsyncTaskExecutor</span> <span class="variable">taskExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAsyncTaskExecutor</span>();</span><br><span class="line">    taskExecutor.setTaskDecorator(<span class="keyword">new</span> <span class="title class_">ContextPropagatingTaskDecorator</span>());</span><br><span class="line">    <span class="keyword">return</span> taskExecutor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•æ—¶å€™å¯ä»¥ä½¿ç”¨ <a href="https://github.com/CtrlSpice/otel-desktop-viewer">Otel Desktop Viewer</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span>  </span><br><span class="line">  <span class="attr">tracing:</span></span><br><span class="line">    <span class="attr">sampling:</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">tracing:</span></span><br><span class="line">      <span class="attr">endpoint:</span> <span class="string">http://localhost:4317</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/12/20/r8ko5fm1xTFDLc3.png" alt="image.png"></p><h2 id="Rust-Vs-Go-A-Hands-On-Comparison"><a href="#Rust-Vs-Go-A-Hands-On-Comparison" class="headerlink" title="Rust Vs Go: A Hands-On Comparison"></a>Rust Vs Go: A Hands-On Comparison</h2><p>URL: <a href="https://www.shuttle.rs/blog/2023/09/27/rust-vs-go-comparison">https://www.shuttle.rs/blog/2023/09/27/rust-vs-go-comparison</a></p><blockquote><p>åŠ¨æ‰‹æ¯”è¾ƒ Rust å’Œ Go</p></blockquote><p><img src="https://s2.loli.net/2023/12/23/O5frBYd1pPevzXE.png" alt="image.png"></p><p>æœ¬æ–‡æ˜¯é€šè¿‡ç¼–å†™ä¸€ä¸ª web æœåŠ¡æ¥è¿›è¡Œæ¯”è¾ƒçš„ã€‚</p><ul><li>Go æ›´åŠ ç®€å•æ˜“å­¦ï¼ŒåŒæ—¶æ ‡å‡†åº“éå¸¸å¼ºå¤§ï¼Œåªéœ€è¦é…åˆ gin+sqlx è¿™ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“å°±èƒ½å®ç°ä¸€ä¸ª web æœåŠ¡</li><li>Rustä¹Ÿå¯ä»¥å¿«é€Ÿçš„æ„å»ºä¸€ä¸ªå®‰å…¨çš„ web æœåŠ¡ï¼Œä½†éœ€è¦ä¾èµ–è®¸å¤šç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚http&#x2F;JSON&#x2F;æ¨¡æ¿å¼•æ“&#x2F;æ—¶é—´å¤„ç†ç­‰</li><li>ä½† Rust åœ¨å¼‚å¸¸å¤„ç†æ–¹é¢å¿ƒæ™ºè´Ÿæ‹…æ›´ä½ï¼Œä»£ç æ›´å®¹æ˜“é˜…è¯»ã€‚</li><li>å¦‚æœæ˜¯ä¸€ä¸ªåˆåˆ›å°å›¢é˜Ÿï¼Œä½¿ç”¨ Go çš„ä¸Šæ‰‹éš¾åº¦ç¡®å®æ›´ä½ï¼›</li><li>ä½†å¦‚æœå›¢é˜Ÿæ„¿æ„èŠ±æ—¶é—´æŠ•å…¥åˆ° Rust ä¸­ï¼Œç»“åˆä»–å‡ºè‰²çš„é”™è¯¯å¤„ç†ï¼Œå’Œå¼ºå¤§çš„ç¼–è¯‘æ£€æŸ¥ï¼Œé•¿æ—¶é—´æ¥çœ‹ä¼šå¾—åˆ°æ›´å¥½çš„æ•ˆæœã€‚</li></ul><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Go-è¯­è¨€ï¼ŸGo-è¯­è¨€çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ-çŸ¥ä¹"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Go-è¯­è¨€ï¼ŸGo-è¯­è¨€çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ-çŸ¥ä¹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Go è¯­è¨€ï¼ŸGo è¯­è¨€çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ - çŸ¥ä¹"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Go è¯­è¨€ï¼ŸGo è¯­è¨€çš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿ - çŸ¥ä¹</h2><p>URL: <a href="https://www.zhihu.com/question/21409296/answer/1040884859">https://www.zhihu.com/question/21409296/answer/1040884859</a></p><blockquote><p>å›¾æ–‡å¹¶èŒ‚ï¼Œè®²è§£äº† G-M-P å„è‡ªä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠè°ƒåº¦æ¨¡å‹ã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/12/23/mpNuQKGijy3d6WC.png" alt="image.png"></p><ul><li>G: <strong>Goroutine</strong>ï¼Œç”¨æˆ·åˆ›å»ºçš„åç¨‹ï¼Œå›¾ä¸­æ¬è¿çš„ç –å¤´ã€‚</li><li>M: <strong>Machine</strong>ï¼ŒOS å†…æ ¸çš„çº¿ç¨‹çš„æŠ½è±¡ï¼Œä»£è¡¨çœŸæ­£æ‰§è¡Œçš„èµ„æºï¼›å¯¹åº”åˆ°å°±æ˜¯å›¾ä¸­çš„åœ°é¼ ï¼Œåœ°é¼ ä¸èƒ½ç”¨æˆ·ç›´æ¥åˆ›å»ºï¼›å¾—æ˜¯ç –å¤´ G å¤ªå¤šï¼Œåœ°é¼  M æœ¬èº«å¤ªå°‘ï¼ŒåŒæ—¶è¿˜æœ‰ç©ºé—²çš„å°è½¦ Pï¼Œæ­¤æ—¶å°±ä¼šä»å…¶ä»–åœ°æ–¹å€Ÿä¸€äº›åœ°é¼  M è¿‡æ¥ç›´åˆ°æŠŠå°è½¦ P ç”¨å®Œä¸ºæ­¢ã€‚</li><li>P: Processor å¤„ç†å™¨ï¼ŒG åªæœ‰ç»‘å®šåˆ° P æ‰èƒ½è¢«è°ƒåº¦ï¼›P æ˜¯å›¾ä¸­çš„å°è½¦ï¼Œç”±ç”¨æˆ·è®¾ç½®çš„ <code>GoMAXPROCS</code> å†³å®šå°è½¦çš„æ•°é‡ã€‚</li></ul><p>æ–‡ç« é“¾æ¥ï¼š</p><ul><li><a href="https://blog.canopas.com/golang-14-shorthand-tricks-you-might-not-know-8d8d21954c49">https://blog.canopas.com/golang-14-shorthand-tricks-you-might-not-know-8d8d21954c49</a></li><li><a href="https://medium.com/@jojoooo/exploring-a-base-spring-boot-application-with-java-21-virtual-thread-spring-security-flyway-c0fde13c1eca#551c">https://medium.com/@jojoooo/exploring-a-base-spring-boot-application-with-java-21-virtual-thread-spring-security-flyway-c0fde13c1eca#551c</a></li><li><a href="https://www.zhihu.com/question/21409296/answer/1040884859">https://www.zhihu.com/question/21409296/answer/1040884859</a></li></ul><p>#Newletters </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/12/23/VibnQF1pM2K6fsd.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    <category term="Newsletter" scheme="http://crossoverjie.top/categories/OB/Newsletter/"/>
    
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ç»™å¼€æºé¡¹ç›®å‘èµ·ææ¡ˆ</title>
    <link href="http://crossoverjie.top/2023/12/21/ob/Pulsar%20Proposal/"/>
    <id>http://crossoverjie.top/2023/12/21/ob/Pulsar%20Proposal/</id>
    <published>2023-12-21T03:09:52.000Z</published>
    <updated>2023-12-21T10:10:37.367Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å‰æ®µæ—¶é—´åœ¨ä½¿ç”¨ Pulsar çš„ admin API æ—¶ï¼Œå‘ç°å…¶ä¸­çš„ä¸€ä¸ªæ¥å£å“åº”éå¸¸æ…¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.topics().getPartitionedStats(topic);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ curl æ‹¿åˆ°çš„å“åº”ç»“æœéå¸¸å¤§ï¼ŒåŒæ—¶ä¹Ÿéå¸¸è€—æ—¶ï¼š<br><img src="https://s2.loli.net/2023/12/21/dMsUq1eFNz9IoYC.png" alt="image.png"></p><p>å…·ä½“çš„ issue åœ¨è¿™é‡Œï¼š<a href="https://github.com/apache/pulsar/issues/21200">https://github.com/apache/pulsar/issues/21200</a></p><span id="more"></span><p>åé¢ç»è¿‡åˆ†æï¼Œæ˜¯å› ä¸ºæŸäº› topic çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éå¸¸å¤šï¼Œå¯¼è‡´è¿™ä¸ªæŸ¥è¯¢ topic ç»Ÿè®¡çš„æ¥å£æ•°æ®é‡éå¸¸å¤§ã€‚<br><img src="https://s2.loli.net/2023/12/21/CIwr3qivSQyPnEx.png" alt="image.png"></p><p>ä½†åœ¨æˆ‘è¿™ä¸ªåœºæ™¯å…¶å®æ˜¯ä¸éœ€è¦è¿™äº›ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¿¡æ¯çš„ï¼Œç°åœ¨å°±å¯¼è‡´è¿™ä¸ª topic æ— æ³•æŸ¥çœ‹çŠ¶æ€ï¼Œæ‰€ä»¥å°±å»ºè®®æ–°å¢ä¸¤ä¸ªå‚æ•°å¯ä»¥è¿‡æ»¤è¿™ä¸¤ä¸ªå­—æ®µã€‚</p><h1 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h1><p>å› ä¸ºæ¶‰åŠåˆ°æ–°å¢ API äº†ï¼Œæ‰€ä»¥ç¤¾åŒºç»´æŠ¤è€…å°±å»ºè®®æˆ‘èµ·è‰ä¸€ä¸ªææ¡ˆè¯•è¯•ï¼š<br><img src="https://s2.loli.net/2023/12/21/qyDmVHRsFBoewiQ.png" alt="image.png"></p><h2 id="ä»€ä¹ˆæ—¶å€™éœ€è¦ææ¡ˆ"><a href="#ä»€ä¹ˆæ—¶å€™éœ€è¦ææ¡ˆ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™éœ€è¦ææ¡ˆ"></a>ä»€ä¹ˆæ—¶å€™éœ€è¦ææ¡ˆ</h2><p>æ­¤æ—¶å°±æ¶‰åŠåˆ°ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ç»™ç¤¾åŒºå‘èµ·ä¸€ä¸ªææ¡ˆçš„é—®é¢˜äº†ã€‚<br><img src="https://s2.loli.net/2023/12/21/VH8NqwgWcROLXhP.png" alt="image.png"><br>åœ¨å®˜æ–¹çš„ææ¡ˆæŒ‡å—ä¸­æœ‰ç€è¯¦ç»†çš„è¯´æ˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><ul><li>å¯¹ä»»ä½•æ¨¡å—æ–°å¢äº† APIã€æˆ–è€…æ˜¯é‡å¤§æ”¹åŠ¨çš„æ–°ç‰¹æ€§ã€ç›‘æ§æŒ‡æ ‡ã€é…ç½®å‚æ•°æ—¶éƒ½éœ€è¦å‘èµ·ææ¡ˆ</li><li>å¯¹åº”çš„å¦‚æœåªæ˜¯å¯¹ç°æœ‰ bug çš„ä¿®å¤ã€æ–‡æ¡£ç­‰ä¸€äº›å¯æ§çš„å˜æ›´æ—¶ï¼Œæ˜¯ä¸éœ€è¦å‘èµ·ææ¡ˆçš„ï¼Œç›´æ¥æäº¤ PR å³å¯ã€‚</li></ul><h3 id="ææ¡ˆæ­¥éª¤"><a href="#ææ¡ˆæ­¥éª¤" class="headerlink" title="ææ¡ˆæ­¥éª¤"></a>ææ¡ˆæ­¥éª¤</h3><h4 id="èµ·è‰"><a href="#èµ·è‰" class="headerlink" title="èµ·è‰"></a>èµ·è‰</h4><p>é¦–å…ˆç¬¬ä¸€æ­¥å°±æ˜¯æ ¹æ®å®˜æ–¹æ¨¡ç‰ˆèµ·è‰ä¸€ä¸ªææ¡ˆï¼š<br>é‡ç‚¹æè¿°èƒŒæ™¯ã€ç›®çš„ã€è¯¦ç»†è®¾è®¡ç­‰ã€‚<br><img src="https://s2.loli.net/2023/12/21/eT7xQEk3li6Rdyp.png" alt="image.png"><br>å¹¶å‘èµ·ä¸€ä¸ª PRï¼Œå¦‚æœä¸ç¡®å®šæ€ä¹ˆå†™çš„è¯å¯ä»¥å‚è€ƒå·²ç»åˆå¹¶äº†çš„ææ¡ˆã€‚</p><h4 id="é‚®ä»¶è®¨è®º"><a href="#é‚®ä»¶è®¨è®º" class="headerlink" title="é‚®ä»¶è®¨è®º"></a>é‚®ä»¶è®¨è®º</h4><p>ä¹‹ååˆ™æ˜¯å°†è¿™ä¸ª PR å‘é€åˆ°å¼€å‘ç»„é‚®ç®±ä¸­ï¼Œè®©ç¤¾åŒºæˆå‘˜å‚ä¸è®¨è®ºã€‚</p><p><img src="https://s2.loli.net/2023/12/21/cAlZLYGEOqiyMoh.png" alt="image.png"><br>è¿™ä¸€æ­¥å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œææ¡ˆå†…å®¹å¯èƒ½ä¼šè¢«åå¤ä¿®æ”¹ã€‚</p><p>å‘èµ·ææ¡ˆçš„ä¸€ä¸ªé‡è¦ç›®çš„æ˜¯å¯ä»¥è®©ç¤¾åŒºæˆå‘˜è¿›è¡Œè®¨è®ºï¼Œè¯„ä¼°æ˜¯å¦éœ€è¦è¿™ä¸ªææ¡ˆæˆ–è€…æ˜¯å¦<br>æœ‰å…¶ä»–è§£å†³æ–¹æ³•ã€‚</p><h4 id="å‘èµ·æŠ•ç¥¨"><a href="#å‘èµ·æŠ•ç¥¨" class="headerlink" title="å‘èµ·æŠ•ç¥¨"></a>å‘èµ·æŠ•ç¥¨</h4><p>ç»è¿‡è®¨è®ºï¼Œå¦‚æœææ¡ˆè·å¾—é€šè¿‡åå°±å¯ä»¥å‘èµ·æŠ•ç¥¨äº†ï¼Œè‡³å°‘éœ€è¦æœ‰ä¸‰ä¸ª binding é€šè¿‡çš„æŠ•ç¥¨åè¿™ä¸ªææ¡ˆå°±é€šè¿‡äº†ã€‚</p><blockquote><p>è™½ç„¶ä»»ä½•äººéƒ½å¯ä»¥å‚ä¸æŠ•ç¥¨ï¼Œä½†ç¤¾åŒºåªä¼šè€ƒè™‘ PMC çš„æŠ•ç¥¨å»ºè®®ï¼›æŠ•ç¥¨çš„æ—¶æ•ˆæ€§ä¹Ÿåªæœ‰ 48hã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/12/21/SiHbGyRzX1kBTjt.png" alt="image.png"></p><p>48 å°æ—¶å€™ä¾¿å¯ä»¥å‘ä¸€ä¸ªæŠ•ç¥¨ç»“æœçš„é‚®ä»¶ï¼Œå¦‚æœè¾¾åˆ°é€šè¿‡æ¡ä»¶ä¾¿å¯ä»¥é€šçŸ¥å‚ä¸æŠ•ç¥¨çš„ PMC åˆå¹¶è¿™ä¸ª PR äº†ã€‚<br><img src="https://s2.loli.net/2023/12/21/r7tm8pyVER6QvCf.png" alt="image.png"></p><h4 id="å®ç°ææ¡ˆ"><a href="#å®ç°ææ¡ˆ" class="headerlink" title="å®ç°ææ¡ˆ"></a>å®ç°ææ¡ˆ</h4><p>ä¹‹åå°±æ˜¯æ²¡å•¥å¥½è¯´çš„å®ç°è¿‡ç¨‹ï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬æ˜¯éœ€è¦åœ¨ææ¡ˆé‡Œè¯¦ç»†æè¿°å®ç°è¿‡ç¨‹ä»¥åŠæ¶‰åŠåˆ°ä¿®æ”¹çš„åœ°æ–¹ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åªè¦ææ¡ˆè¢« review é€šè¿‡åå®ç°èµ·æ¥å°±éå¸¸ç®€å•äº†ï¼Œè·Ÿç€ææ¡ˆé‡Œçš„æµç¨‹å®ç°å°±å¥½äº†ã€‚</p><blockquote><p>è¿™ç‚¹éå¸¸ç±»ä¼¼äºæˆ‘ä»¬åœ¨ä¼ä¸šä¸­å¯¹æŸä¸ªä¸šåŠ¡åšæŠ€æœ¯æ–¹æ¡ˆï¼Œå¦‚æœå¤§å®¶éƒ½æŒ‰ç…§ç±»ä¼¼çš„æµç¨‹ä¸¥æ ¼å®¡æ ¸æ–¹æ¡ˆï¼Œé‚£å®ç°èµ·æ¥æ˜¯éå¸¸å¿«çš„ï¼Œè€Œä¸”å¯ä»¥å°½é‡çš„å‡å°‘äº‹åæ‰¯çš®ã€‚</p></blockquote><p>æ‰€ä»¥æœ€åæˆ‘çš„å®ç° PR æäº¤ä¹‹åï¼Œéƒ½æ²¡æœ‰ä»»ä½•çš„ä¿®æ”¹æ„è§ï¼Œç›´æ¥å°±åˆå¹¶äº†ï¼›ä¹Ÿå¤§å¤§é™ä½äº†å®¡æ ¸äººå‘˜çš„è´Ÿæ‹…ï¼Œæé«˜æ•´ä½“æ•ˆç‡ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å‚ä¸ Pulsar ç¤¾åŒºçš„ææ¡ˆè¿‡ç¨‹ï¼Œæˆ‘çŒœæµ‹å…¶ä»–ç¤¾åŒºçš„æµç¨‹ä¹Ÿæ˜¯å¤§å·®ä¸å·®ï¼›å…¶ä¸­é‡ç‚¹å°±æ˜¯å¼‚æ­¥æ²Ÿé€šï¼›å¤§å®¶éƒ½è®¤å¯ä¹‹åçœŸçš„ä¼šæ¯”å®æ—¶é€šä¿¡çš„æ•ˆç‡é«˜å¾ˆå¤šã€‚</p><p>å…·ä½“çš„ææ¡ˆç»†èŠ‚å¯ä»¥é˜…è¯»å®˜æ–¹æŒ‡å— <a href="https://github.com/apache/pulsar/blob/master/pip/README.md">https://github.com/apache/pulsar/blob/master/pip/README.md</a></p><p>#Blog #Pulsar </p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´åœ¨ä½¿ç”¨ Pulsar çš„ admin API æ—¶ï¼Œå‘ç°å…¶ä¸­çš„ä¸€ä¸ªæ¥å£å“åº”éå¸¸æ…¢ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;admin.topics().getPartitionedStats(topic);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½¿ç”¨ curl æ‹¿åˆ°çš„å“åº”ç»“æœéå¸¸å¤§ï¼ŒåŒæ—¶ä¹Ÿéå¸¸è€—æ—¶ï¼š&lt;br&gt;&lt;img src=&quot;https://s2.loli.net/2023/12/21/dMsUq1eFNz9IoYC.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„ issue åœ¨è¿™é‡Œï¼š&lt;a href=&quot;https://github.com/apache/pulsar/issues/21200&quot;&gt;https://github.com/apache/pulsar/issues/21200&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
  <entry>
    <title>æŠ€æœ¯é˜…è¯»å‘¨åˆŠç¬¬ğŸ”ŸæœŸ</title>
    <link href="http://crossoverjie.top/2023/12/15/ob/newsletter/Newsletter10-20231215/"/>
    <id>http://crossoverjie.top/2023/12/15/ob/newsletter/Newsletter10-20231215/</id>
    <published>2023-12-15T09:28:25.000Z</published>
    <updated>2023-12-16T07:59:26.164Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/12/16/keYlOC74XMoPAvZ.png"></p><p><strong>æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚</strong></p><span id="more"></span><h2 id="å†å²æ›´æ–°"><a href="#å†å²æ›´æ–°" class="headerlink" title="å†å²æ›´æ–°"></a>å†å²æ›´æ–°</h2><ul><li><a href="https://crossoverjie.top/2023/11/17/ob/newsletter/Newsletter06-20231117/">20231117ï¼šç¬¬å…­æœŸ</a></li><li><a href="https://crossoverjie.top/2023/11/24/ob/newsletter/Newsletter07-20231124/">20231124ï¼šç¬¬ä¸ƒæœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/01/ob/newsletter/Newsletter08-20231201/">20231201ï¼šç¬¬å…«æœŸ</a></li><li><a href="https://crossoverjie.top/2023/12/08/ob/newsletter/Newsletter09-20231208/">20231215ï¼šç¬¬ä¹æœŸ</a><!--more--></li></ul><h2 id="Golang-14-Shorthand-Tricks-You-Might-Not-Know-by-Nidhi-D-Dec-2023-Canopas"><a href="#Golang-14-Shorthand-Tricks-You-Might-Not-Know-by-Nidhi-D-Dec-2023-Canopas" class="headerlink" title="Golang: 14 Shorthand Tricks You Might Not Know! | by Nidhi D | Dec, 2023 | Canopas"></a>Golang: 14 Shorthand Tricks You Might Not Know! | by Nidhi D | Dec, 2023 | Canopas</h2><p>URL: <a href="https://blog.canopas.com/golang-14-shorthand-tricks-you-might-not-know-8d8d21954c49">https://blog.canopas.com/golang-14-shorthand-tricks-you-might-not-know-8d8d21954c49</a></p><h3 id="åŒæ—¶å£°æ˜å’Œåˆå§‹åŒ–å˜é‡"><a href="#åŒæ—¶å£°æ˜å’Œåˆå§‹åŒ–å˜é‡" class="headerlink" title="åŒæ—¶å£°æ˜å’Œåˆå§‹åŒ–å˜é‡"></a>åŒæ—¶å£°æ˜å’Œåˆå§‹åŒ–å˜é‡</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line"><span class="keyword">var</span> message <span class="type">string</span>  </span><br><span class="line">message = <span class="string">&quot;Hello, Golang!&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line">message := <span class="string">&quot;Hello, Golang!&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å£°æ˜å’Œåˆå§‹åŒ–å¤šä¸ªå˜é‡"><a href="#å£°æ˜å’Œåˆå§‹åŒ–å¤šä¸ªå˜é‡" class="headerlink" title="å£°æ˜å’Œåˆå§‹åŒ–å¤šä¸ªå˜é‡"></a>å£°æ˜å’Œåˆå§‹åŒ–å¤šä¸ªå˜é‡</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line"><span class="keyword">var</span> a, b, c <span class="type">int</span>  </span><br><span class="line">a = <span class="number">1</span>  </span><br><span class="line">b = <span class="number">2</span>  </span><br><span class="line">c = <span class="number">3</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line">a, b, c := <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="äº¤æ¢å˜é‡"><a href="#äº¤æ¢å˜é‡" class="headerlink" title="äº¤æ¢å˜é‡"></a>äº¤æ¢å˜é‡</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a, b := <span class="number">1</span>, <span class="number">2</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Long form  </span></span><br><span class="line">temp := a  </span><br><span class="line">a = b  </span><br><span class="line">b = temp  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line">a, b = b, a</span><br></pre></td></tr></table></figure><h3 id="Defer-å‡½æ•°è°ƒç”¨"><a href="#Defer-å‡½æ•°è°ƒç”¨" class="headerlink" title="Defer å‡½æ•°è°ƒç”¨"></a>Defer å‡½æ•°è°ƒç”¨</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cleanup</span><span class="params">()</span></span> &#123;  </span><br><span class="line"><span class="comment">// Cleanup logic  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">defer</span> cleanup()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;  </span><br><span class="line"><span class="comment">// Cleanup logic  </span></span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹-Map-ä¸­çš„æ•°æ®æ˜¯å¦å­˜åœ¨"><a href="#æ£€æµ‹-Map-ä¸­çš„æ•°æ®æ˜¯å¦å­˜åœ¨" class="headerlink" title="æ£€æµ‹ Map ä¸­çš„æ•°æ®æ˜¯å¦å­˜åœ¨"></a>æ£€æµ‹ Map ä¸­çš„æ•°æ®æ˜¯å¦å­˜åœ¨</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line">value, exists := myMap[key]  </span><br><span class="line"><span class="keyword">if</span> !exists &#123;  </span><br><span class="line">    <span class="comment">// Key doesn&#x27;t exist in the map  </span></span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line"><span class="keyword">if</span> value, exists := myMap[key]; !exists &#123;  </span><br><span class="line">    <span class="comment">// Key doesn&#x27;t exist in the map  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ä¸‹æ ‡å’Œå€¼è¿­ä»£åˆ‡ç‰‡"><a href="#ä½¿ç”¨ä¸‹æ ‡å’Œå€¼è¿­ä»£åˆ‡ç‰‡" class="headerlink" title="ä½¿ç”¨ä¸‹æ ‡å’Œå€¼è¿­ä»£åˆ‡ç‰‡"></a>ä½¿ç”¨ä¸‹æ ‡å’Œå€¼è¿­ä»£åˆ‡ç‰‡</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(numbers); i++ &#123;  </span><br><span class="line">fmt.Println(i, numbers[i])  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line"><span class="keyword">for</span> i, value := <span class="keyword">range</span> numbers &#123;  </span><br><span class="line">fmt.Println(i, value)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é”™è¯¯æ£€æµ‹"><a href="#é”™è¯¯æ£€æµ‹" class="headerlink" title="é”™è¯¯æ£€æµ‹"></a>é”™è¯¯æ£€æµ‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line">result, err := someFunction()  </span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;  </span><br><span class="line"><span class="comment">// Handle the error  </span></span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line"><span class="keyword">if</span> result, err := someFunction(); err != <span class="literal">nil</span> &#123;  </span><br><span class="line"><span class="comment">// Handle the error  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºä¸€ä¸ªå˜é‡çš„æŒ‡é’ˆ"><a href="#åˆ›å»ºä¸€ä¸ªå˜é‡çš„æŒ‡é’ˆ" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå˜é‡çš„æŒ‡é’ˆ"></a>åˆ›å»ºä¸€ä¸ªå˜é‡çš„æŒ‡é’ˆ</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line"><span class="keyword">var</span> x <span class="type">int</span>  </span><br><span class="line">ptr := &amp;x  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line">ptr := <span class="built_in">new</span>(<span class="type">int</span>)</span><br></pre></td></tr></table></figure><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;  </span><br><span class="line"><span class="keyword">return</span> x + y  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line">add := <span class="function"><span class="keyword">func</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;  </span><br><span class="line"><span class="keyword">return</span> x + y  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºå’Œåˆå§‹åŒ–-Map"><a href="#åˆ›å»ºå’Œåˆå§‹åŒ–-Map" class="headerlink" title="åˆ›å»ºå’Œåˆå§‹åŒ– Map"></a>åˆ›å»ºå’Œåˆå§‹åŒ– Map</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line">colors := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)  </span><br><span class="line">colors[<span class="string">&quot;red&quot;</span>] = <span class="string">&quot;#ff0000&quot;</span>  </span><br><span class="line">colors[<span class="string">&quot;green&quot;</span>] = <span class="string">&quot;#00ff00&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line">colors := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;  </span><br><span class="line"><span class="string">&quot;red&quot;</span>: <span class="string">&quot;#ff0000&quot;</span>,  </span><br><span class="line"><span class="string">&quot;green&quot;</span>: <span class="string">&quot;#00ff00&quot;</span>,  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å£°æ˜å¤šä¸ªå¸¸é‡"><a href="#å£°æ˜å¤šä¸ªå¸¸é‡" class="headerlink" title="å£°æ˜å¤šä¸ªå¸¸é‡"></a>å£°æ˜å¤šä¸ªå¸¸é‡</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Long form  </span></span><br><span class="line"><span class="keyword">const</span> pi <span class="type">float64</span> = <span class="number">3.14159</span>  </span><br><span class="line"><span class="keyword">const</span> maxAttempts <span class="type">int</span> = <span class="number">3</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Shorthand  </span></span><br><span class="line"><span class="keyword">const</span> (  </span><br><span class="line">pi = <span class="number">3.14159</span>  </span><br><span class="line">maxAttempts = <span class="number">3</span>  </span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="Java-Mastery-Unleashed-12-Essential-Tips-Every-Developer-Must-Embrace"><a href="#Java-Mastery-Unleashed-12-Essential-Tips-Every-Developer-Must-Embrace" class="headerlink" title="Java Mastery Unleashed: 12 Essential Tips Every Developer Must Embrace"></a>Java Mastery Unleashed: 12 Essential Tips Every Developer Must Embrace</h2><p>URL: <a href="https://blog.stackademic.com/boost-your-java-skills-12-must-know-programming-tips-for-java-developers-34f8381ec431">https://blog.stackademic.com/boost-your-java-skills-12-must-know-programming-tips-for-java-developers-34f8381ec431</a></p><blockquote><p>ä¸€äº›å¸¸ç”¨çš„ Java æŠ€å·§</p></blockquote><ul><li><p>å–„ç”¨ Lambda è¡¨è¾¾å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line">List&lt;String&gt; names = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line"><span class="keyword">for</span> (Person person : people) &#123;  </span><br><span class="line">names.add(person.getName());  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// After</span></span><br><span class="line">List&lt;String&gt; names = people.stream()  </span><br><span class="line">.map(Person::getName)  </span><br><span class="line">.collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ Optionals æ›¿ä»£ null</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; maybeName = Optional.ofNullable(person.getName());  </span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> maybeName.orElse(<span class="string">&quot;Unknown&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ stream ç®€åŒ–é›†åˆæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; evenNumbers = numbers.stream()  </span><br><span class="line">.filter(num -&gt; num % <span class="number">2</span> == <span class="number">0</span>)  </span><br><span class="line">.collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li><li><p>String.format æ‹¼æ¥å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>;  </span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot; World&quot;</span>;  </span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s%s&quot;</span>, s1, s2);</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ default method æ‰©å±•æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TimeClient</span> &#123;  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setTime</span><span class="params">(<span class="type">int</span> hour, <span class="type">int</span> minute, <span class="type">int</span> second)</span>;  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setDate</span><span class="params">(<span class="type">int</span> day, <span class="type">int</span> month, <span class="type">int</span> year)</span>;  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setDateAndTime</span><span class="params">(<span class="type">int</span> day, <span class="type">int</span> month, <span class="type">int</span> year, <span class="type">int</span> hour, <span class="type">int</span> minute, <span class="type">int</span> second)</span>;  </span><br><span class="line">LocalDateTime <span class="title function_">getLocalDateTime</span><span class="params">()</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨æšä¸¾æ›¿æ¢å¸¸é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Level</span> &#123; LOW, MEDIUM, HIGH &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Level</span> <span class="variable">myVar</span> <span class="operator">=</span> Level.MEDIUM;</span><br><span class="line">        System.out.println(myVar);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ try-with-Resource ç®¡ç†èµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;example.txt&quot;</span>);</span><br><span class="line">     <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(fileReader)) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">    <span class="comment">// Process the file</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="comment">// Handle the exception</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="SpringBoot-Webflux-vs-Vert-x-Performance-comparison-for-hello-world-case-Tech-Tonic"><a href="#SpringBoot-Webflux-vs-Vert-x-Performance-comparison-for-hello-world-case-Tech-Tonic" class="headerlink" title="SpringBoot Webflux vs Vert.x: Performance comparison for hello world case | Tech Tonic"></a>SpringBoot Webflux vs Vert.x: Performance comparison for hello world case | Tech Tonic</h2><p>URL: <a href="https://medium.com/deno-the-complete-reference/springboot-webflux-vs-vert-x-performance-comparison-for-hello-world-case-41a6bd8e9f8c">https://medium.com/deno-the-complete-reference/springboot-webflux-vs-vert-x-performance-comparison-for-hello-world-case-41a6bd8e9f8c</a></p><blockquote><p>æœ¬æ–‡å¯¹æ¯”äº† SpringBoot Webflux å’Œ Vert.x çš„æ€§èƒ½å¯¹æ¯”</p></blockquote><p>ä»¥ä¸‹æ˜¯ä¸¤ä¸ªæ¡†æ¶å†™çš„å‹æµ‹æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> hello;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.config.EnableWebFlux;</span><br><span class="line"><span class="keyword">import</span> org.reactivestreams.Publisher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableWebFlux</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        SpringApplication.run(Application.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Publisher&lt;String&gt; <span class="title function_">handler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vert.x</span></span><br><span class="line"><span class="keyword">package</span> com.example.starter;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> io.vertx.core.AbstractVerticle;  </span><br><span class="line"><span class="keyword">import</span> io.vertx.core.Promise;  </span><br><span class="line"><span class="keyword">import</span> io.vertx.core.http.HttpServer;  </span><br><span class="line"><span class="keyword">import</span> io.vertx.ext.web.Router;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainVerticle</span> <span class="keyword">extends</span> <span class="title class_">AbstractVerticle</span> &#123;  </span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span>  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(Promise&lt;Void&gt; startPromise)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">    <span class="type">HttpServer</span> <span class="variable">server</span> <span class="operator">=</span> vertx.createHttpServer();  </span><br><span class="line">    <span class="type">Router</span> <span class="variable">router</span> <span class="operator">=</span> Router.router(vertx);  </span><br><span class="line">  </span><br><span class="line">    router.get(<span class="string">&quot;/&quot;</span>).respond(ctx -&gt; ctx  </span><br><span class="line">        .response()  </span><br><span class="line">        .putHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain&quot;</span>)  </span><br><span class="line">        .end(<span class="string">&quot;hello world!&quot;</span>));  </span><br><span class="line">  </span><br><span class="line">    server.requestHandler(router).listen(<span class="number">3000</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åç›´æ¥çœ‹å¯¹æ¯”ç»“æœå§ï¼š<br><img src="https://s2.loli.net/2023/12/13/smHjAKqN32ETX6I.png" alt="image.png"><br><img src="https://s2.loli.net/2023/12/13/ylwjNGvxUEmgQ5i.png" alt="image.png"><br><img src="https://s2.loli.net/2023/12/13/yY72ipAab8jetUT.png" alt="image.png"><br>æœ€ç»ˆä½œè€…æ ¹æ®ä¸€ä¸ªè®¡ç®—å…¬å¼å¾—å‡ºä¸¤ä¸ªæ¡†æ¶çš„å¾—åˆ†ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>å·®è·å°äº 5% ä¸å¾—åˆ†</li><li>5ï½20 å¾— 1 åˆ†</li><li>20ï½50 å¾—ä¸¤åˆ†</li><li>å¤§äº 50ï¼Œå¾—ä¸‰åˆ†<br><img src="https://s2.loli.net/2023/12/13/wNPSTLRyIt79k85.png" alt="image.png"><br>æœ€ç»ˆæ˜¯ <code>Vert.x</code> å¾—åˆ†è¶…è¿‡ <code>Webflux</code> 55%â¬†ï¸</li></ul><p>ä¸è¿‡ä¸ªäººè§‰å¾—å‹æµ‹ç»“æœå†å¥½ï¼Œå¥—ä¸Šä¸šåŠ¡åï¼Œæ¯”å¦‚ä¸€ä¸ªæ¥å£æŸ¥è¯¢äº†å¤šä¸ªåç«¯æœåŠ¡ï¼Œåç«¯æœåŠ¡æœ‰ä¾èµ–äºå¤šä¸ªæ•°æ®åº“ï¼Œæœ€ç»ˆå‡ºæ¥çš„ RT å¤§å®¶éƒ½å·®ä¸å¤šã€‚</p><p>é™¤éæ˜¯æŸäº›å¯¹æ€§èƒ½æè‡´è¦æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚å®æ—¶æ•°æ®åˆ†æã€ç‰©è”ç½‘ä¸­é—´ä»¶ç­‰å’Œç›´æ¥ä¸šåŠ¡ä¸å¤ªç›¸å…³é¢†åŸŸã€‚</p><p>å®ƒçš„åº•å±‚ä¾ç„¶æ˜¯ Nettyï¼Œä½†æ¯” Netty æä¾›äº†è·Ÿæ˜“ç”¨çš„ APIã€‚</p><h2 id="Git-Cherry-Pick-Examples-to-Apply-Hot-Fixes-and-Security-Patches-â€”-Nick-Janetakis"><a href="#Git-Cherry-Pick-Examples-to-Apply-Hot-Fixes-and-Security-Patches-â€”-Nick-Janetakis" class="headerlink" title="Git Cherry Pick Examples to Apply Hot Fixes and Security Patches â€” Nick Janetakis"></a>Git Cherry Pick Examples to Apply Hot Fixes and Security Patches â€” Nick Janetakis</h2><p>URL: <a href="https://nickjanetakis.com/blog/git-cherry-pick-examples-to-apply-hot-fixes-and-security-patches?ref=dailydev">https://nickjanetakis.com/blog/git-cherry-pick-examples-to-apply-hot-fixes-and-security-patches?ref=dailydev</a></p><blockquote><p>è®²è§£äº† git cherry-pick çš„ä½œç”¨ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨ï¼Œä»€ä¹ˆæ—¶å€™ä¸ç”¨ã€‚</p></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼š<br>ä¸€äº›å¤§å‹çš„å¼€æºé¡¹ç›®å¾€å¾€éƒ½ä¼šæœ‰ä¸€ä¸ªä¸»åˆ†å­ï¼ŒåŒæ—¶ç»´æŠ¤äº†ä¸åŒç‰ˆæœ¬çš„å­åˆ†æ”¯ï¼Œæœ‰äº›ç”¨æˆ·å¯èƒ½å°±ä¼šä¸€ç›´ä½¿ç”¨ä¸€äº›é•¿æœŸç»´æŠ¤çš„å­åˆ†æ”¯ï¼Œæ¯”å¦‚ <code>v2.1.0 \ v2.3.0</code></p><p>ä½†å¯¹äºå¤§éƒ¨åˆ†çš„å¼€å‘è€…æ¥è¯´ä¸»è¦ä¼šç»´æŠ¤ä¸»åˆ†æ”¯ï¼Œä¹Ÿä¼šåœ¨ä¸»åˆ†æ”¯ä¸Šæ¨è¿›ä¸€äº›æ–°åŠŸèƒ½ï¼Œè¿™äº›æ–°åŠŸèƒ½ä¸ä¸€å®šä¼šåŒæ­¥åˆ°ä¸Šè¿°æåˆ°çš„ä¸¤ä¸ªè€ç‰ˆæœ¬ä¸­ã€‚</p><p>ä½†å¯¹äºä¸€äº›å®‰å…¨æ¼æ´ï¼Œé‡å¤§ bug ç­‰æ˜¯éœ€è¦åŒæ­¥åˆ°è¿™äº›å­åˆ†æ”¯çš„ï¼Œä½†åˆä¸èƒ½æŠŠä¸€äº›ä¸å…¼å®¹çš„æ–°ç‰¹æ€§åŒæ­¥åˆ°å­åˆ†æ”¯ä¸­ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨  cherry-pick è¿™ä¸ªåŠŸèƒ½ï¼Œåªå°†æŸä¸€ä¸ªæäº¤ç»™ pick åˆ°ç›®æ ‡åˆ†æ”¯ä¸­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cherry pick more than 1 SHA.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This could be useful if you have a handful of commits that you want to bring over,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">you<span class="string">&#x27;ll likely want to order them with the oldest commit being first in the list.</span></span></span><br><span class="line">git cherry-pick &lt;SHA&gt; &lt;SHA&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Edit the git commit message for the newly applied commit.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># This could be useful if want to customize the git commit message with extra context.</span></span></span><br><span class="line">git cherry-pick &lt;SHA&gt; --edit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Avoid automatically creating the commit which lets you edit the files first.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># This could be useful if you need to make manual code adjustments before committing,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">such as applying a security patch which uses an older library with a different API.</span></span></span><br><span class="line">git cherry-pick &lt;SHA&gt; --no-commit</span><br></pre></td></tr></table></figure><p>æ–‡ç« é“¾æ¥ï¼š</p><ul><li><a href="https://blog.canopas.com/golang-14-shorthand-tricks-you-might-not-know-8d8d21954c49">https://blog.canopas.com/golang-14-shorthand-tricks-you-might-not-know-8d8d21954c49</a></li><li><a href="https://blog.stackademic.com/boost-your-java-skills-12-must-know-programming-tips-for-java-developers-34f8381ec431">https://blog.stackademic.com/boost-your-java-skills-12-must-know-programming-tips-for-java-developers-34f8381ec431</a></li><li><a href="https://medium.com/deno-the-complete-reference/springboot-webflux-vs-vert-x-performance-comparison-for-hello-world-case-41a6bd8e9f8c">https://medium.com/deno-the-complete-reference/springboot-webflux-vs-vert-x-performance-comparison-for-hello-world-case-41a6bd8e9f8c</a></li><li><a href="https://nickjanetakis.com/blog/git-cherry-pick-examples-to-apply-hot-fixes-and-security-patches?ref=dailydev">https://nickjanetakis.com/blog/git-cherry-pick-examples-to-apply-hot-fixes-and-security-patches?ref=dailydev</a></li></ul><p>#Newletters </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/12/16/keYlOC74XMoPAvZ.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯é˜…è¯»å‘¨åˆŠï¼Œæ¯å‘¨æ›´æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    <category term="Newsletter" scheme="http://crossoverjie.top/categories/OB/Newsletter/"/>
    
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ç¼–å†™ä¸€ä¸ª Pulsar Broker Interceptor æ’ä»¶</title>
    <link href="http://crossoverjie.top/2023/12/11/ob/Pulsar-Broker-Interceptor/"/>
    <id>http://crossoverjie.top/2023/12/11/ob/Pulsar-Broker-Interceptor/</id>
    <published>2023-12-11T08:38:27.000Z</published>
    <updated>2023-12-28T02:14:15.211Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç«  <a href="https://crossoverjie.top/2023/08/23/ob/VictoriaLogs-Intro/">VictoriaLogsï¼šä¸€æ¬¾è¶…ä½å ç”¨çš„ ElasticSearch æ›¿ä»£æ–¹æ¡ˆ</a>è®²åˆ°äº†æˆ‘ä»¬ä½¿ç”¨ <code>Victorialogs</code> æ¥å­˜å‚¨ Pulsar æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ trace ä¿¡æ¯ã€‚</p><p><img src="https://s2.loli.net/2023/12/11/UYdMH19uyjrNA2I.png" alt="image.png"></p><p>è€Œå…¶ä¸­çš„å…³é”®çš„åŸ‹ç‚¹ä¿¡æ¯æ˜¯é€šè¿‡ Pulsar çš„ <code>BrokerInterceptor</code> å®ç°çš„ï¼Œåé¢å°±æœ‰æœ‹å‹å’¨è¯¢è¿™å—ä»£ç æ˜¯å¦å¼€æºï¼Œç›®å‰æ˜¯æ²¡æœ‰å¼€æºçš„ï¼Œä¸è¿‡å€Ÿæ­¤æœºä¼šå¯ä»¥èŠèŠå¦‚ä½•å®ç°ä¸€ä¸ª <code>BrokerInterceptor</code> æ’ä»¶ï¼Œå½“å‰è¿˜æ²¡æœ‰ç›¸å…³çš„ä»‹ç»æ–‡æ¡£ã€‚</p><span id="more"></span><p>å…¶å®å½“æ—¶æˆ‘åœ¨æ‰¾ <code>BrokerInterceptor</code> çš„ç›¸å…³èµ„æ–™æ—¶å°±å‘ç°å®˜æ–¹å¹¶æ²¡æœ‰æä¾›å¯¹åº”çš„å¼€å‘æ–‡æ¡£ã€‚</p><p>åªæœ‰ä¸€ä¸ª <a href="https://pulsar.apache.org/docs/3.1.x/develop-plugin/#what-is-an-additional-servlet">additional servlet</a>çš„å¼€å‘æ–‡æ¡£ï¼Œè€Œ <code>BrokerInterceptor</code> åªåœ¨ <a href="https://www.youtube.com/watch?v=alzv7FyOoP0">YouTube</a> ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªç¤¾åŒºåˆ†äº«çš„è§†é¢‘ã€‚<br><img src="https://s2.loli.net/2023/12/11/H3rs8OdYZecQEn5.png" alt="image.png"></p><p>è™½è¯´çœ‹è§†é¢‘å¯ä»¥è·Ÿç€å®ç°ï¼Œä½†æ€»å½’æ˜¯æ²¡æœ‰æ–‡æ¡£æ–¹ä¾¿ã€‚</p><hr><p>åœ¨è¿™ä¹‹å‰è¿˜æ˜¯å…ˆè®²è®² <code>BrokerInterceptor</code> æœ‰ä»€ä¹ˆç”¨ï¼Ÿ<br><img src="https://s2.loli.net/2023/12/11/F8cxdwsTyWuaVGg.png" alt="image.png"></p><p>å…¶å®ä»å®ƒæ‰€æä¾›çš„æ¥å£å°±èƒ½çœ‹å‡ºï¼Œåœ¨æ¶ˆæ¯åˆ°è¾¾ Broker åçš„ä¸€äº›å…³é”®èŠ‚ç‚¹éƒ½æä¾›äº†ç›¸å…³çš„æ¥å£ï¼Œå®ç°è¿™äº›æ¥å£å°±èƒ½åšå¾ˆå¤šäº‹æƒ…äº†ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ‰€éœ€è¦çš„æ¶ˆæ¯è¿½è¸ªã€‚</p><h1 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h1><p>ä¸‹é¢å¼€å§‹å¦‚ä½•ä½¿ç”¨ <code>BrokerInterceptor</code>ï¼š<br>é¦–å…ˆæ˜¯åˆ›å»ºä¸€ä¸ª <code>Maven</code> é¡¹ç›®ï¼Œç„¶åå¼•å…¥ç›¸å…³çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.pulsar<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pulsar-broker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pulsar.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å®ç°æ¥å£"><a href="#å®ç°æ¥å£" class="headerlink" title="å®ç°æ¥å£"></a>å®ç°æ¥å£</h1><p>ç„¶åæˆ‘ä»¬ä¾¿å¯ä»¥å®ç° <code>org.apache.pulsar.broker.intercept.BrokerInterceptor</code> æ¥å®Œæˆå…·ä½“çš„ä¸šåŠ¡äº†ã€‚</p><p>åœ¨æˆ‘ä»¬åšæ¶ˆæ¯è¿½è¸ªçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å®ç°äº†ä»¥ä¸‹å‡ ä¸ªæ¥å£ï¼š</p><ul><li>messageProduced</li><li>messageDispatched</li><li>messageAcked</li></ul><p>ä»¥ <code>messageProduced</code> ä¸ºä¾‹ï¼Œéœ€è¦è§£æå‡ºæ¶ˆæ¯IDï¼Œç„¶åæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥ <code>Victorialogs</code> å­˜å‚¨ä¸­ï¼Œå…¶ä½™çš„ä¸¤ä¸ªåŸ‹ç‚¹ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">messageProduced</span><span class="params">(ServerCnx cnx, Producer producer, <span class="type">long</span> startTimeNs, <span class="type">long</span> ledgerId, <span class="type">long</span> entryId,  </span></span><br><span class="line"><span class="params">                            Topic.PublishContext publishContext)</span> &#123;  </span><br><span class="line">    <span class="type">String</span> <span class="variable">ns</span> <span class="operator">=</span> getNs(producer.getTopic().getName());  </span><br><span class="line">    <span class="keyword">if</span> (!LogSender.checkNamespace(ns)) &#123;  </span><br><span class="line">        <span class="keyword">return</span>;  </span><br><span class="line">    &#125;    <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> producer.getTopic().getName();  </span><br><span class="line">    <span class="type">String</span> <span class="variable">partition</span> <span class="operator">=</span> getPartition(topic);  </span><br><span class="line">    <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s:%s:%s&quot;</span>, ledgerId, entryId, partition);  </span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Event</span>.Publish(msgId, producer.getClientAddress(), System.currentTimeMillis(),  </span><br><span class="line">            producer.getProducerName(), topic).toString();  </span><br><span class="line">    LogSender.send(s);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¼–å†™é¡¹ç›®æè¿°æ–‡ä»¶"><a href="#ç¼–å†™é¡¹ç›®æè¿°æ–‡ä»¶" class="headerlink" title="ç¼–å†™é¡¹ç›®æè¿°æ–‡ä»¶"></a>ç¼–å†™é¡¹ç›®æè¿°æ–‡ä»¶</h1><p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªé¡¹ç›®æè¿°æ–‡ä»¶ï¼Œè·¯å¾„å¦‚ä¸‹ï¼š<br><code>src/main/resources/META-INF/services/broker_interceptor.yml</code><br>åå­—ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œbroker ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">interceptor-name</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">description</span></span><br><span class="line"><span class="attr">interceptorClass:</span> <span class="string">com.xx.CustomInterceptor</span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹æ˜¯å¡«å†™è‡ªå®šä¹‰å®ç°ç±»çš„å…¨é™å®šåã€‚</p><h1 id="é…ç½®æ‰“åŒ…æ’ä»¶"><a href="#é…ç½®æ‰“åŒ…æ’ä»¶" class="headerlink" title="é…ç½®æ‰“åŒ…æ’ä»¶"></a>é…ç½®æ‰“åŒ…æ’ä»¶</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.nifi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nifi-nar-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">extensions</span>&gt;</span>true<span class="tag">&lt;/<span class="name">extensions</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;-$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">executions</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-nar<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">goals</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>nar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;/<span class="name">goals</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">executions</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äº Broker è¯†åˆ«çš„æ˜¯ nar åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½® nar åŒ…æ’ä»¶ï¼Œä¹‹åä½¿ç”¨ <code>mvn package</code> å°±ä¼šç”Ÿæˆå‡º nar åŒ…ã€‚</p><h1 id="é…ç½®-broker-conf"><a href="#é…ç½®-broker-conf" class="headerlink" title="é…ç½® broker.conf"></a>é…ç½® broker.conf</h1><p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨ broker.conf ä¸­é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brokerInterceptors: &quot;interceptor-name&quot;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯åˆšæ‰é…ç½®çš„æ’ä»¶åç§°ã€‚</p><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨ helm å®‰è£…çš„ pulsarï¼Œåœ¨ 3.1 ç‰ˆæœ¬ä¹‹å‰éœ€è¦æ‰‹åŠ¨å°†<code>brokerInterceptors</code> å†™å…¥åˆ° <code>broker.conf</code> ä¸­ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> apachepulsar/pulsar-all:<span class="number">3.0</span>.<span class="number">1</span>  </span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/interceptor-1.0.1.nar /pulsar/interceptors/  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;\n&quot;</span> &gt;&gt; /pulsar/conf/broker.conf  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;brokerInterceptors=&quot;</span> &gt;&gt; /pulsar/conf/broker.conf</span></span><br></pre></td></tr></table></figure><p>ä¸ç„¶åœ¨æœ€ç»ˆå®¹å™¨ä¸­çš„ <code>broker.conf</code> ä¸­æ˜¯è¯»å–ä¸åˆ°è¿™ä¸ªé…ç½®çš„ï¼Œå¯¼è‡´æ’ä»¶æ²¡æœ‰ç”Ÿæ•ˆã€‚</p><blockquote><p>æˆ‘ä»¬æ˜¯é‡æ–°åŸºäºå®˜æ–¹é•œåƒæ‰“çš„ä¸€ä¸ªåŒ…å«è‡ªå®šä¹‰æ’ä»¶çš„é•œåƒï¼Œæœ€ç»ˆä½¿ç”¨è¿™ä¸ªé•œåƒè¿›è¡Œéƒ¨ç½²ã€‚</p></blockquote><p><a href="https://github.com/apache/pulsar/pull/20719">https://github.com/apache/pulsar/pull/20719</a><br>æˆ‘åœ¨è¿™ä¸ª PR ä¸­å·²ç»å°†é…ç½®åŠ å…¥è¿›å»äº†ï¼Œä½†å¾—åœ¨ 3.1 ä¹‹åæ‰èƒ½ç”Ÿæ•ˆï¼›ä¹Ÿå°±æ˜¯åœ¨ 3.1 ä¹‹å‰éƒ½å¾—åŠ ä¸ŠåŠ ä¸Šè¿™è¡Œï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;\n&quot;</span> &gt;&gt; /pulsar/conf/broker.conf  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;brokerInterceptors=&quot;</span> &gt;&gt; /pulsar/conf/broker.conf</span></span><br></pre></td></tr></table></figure><hr><p>ç›®å‰æ¥çœ‹ Pulsar çš„ <code>BrokerInterceptor</code> åº”è¯¥ä½¿ç”¨ä¸å¤šï¼Œä¸ç„¶ä½¿ç”¨ helm å®‰è£…æ—¶æ˜¯ä¸å¯èƒ½ç”Ÿæ•ˆçš„ï¼›è€Œä¸”å®˜æ–¹æ–‡æ¡£ä¹Ÿæ²¡ç”¨ç›¸å…³çš„æè¿°ã€‚</p><p>#Blog #Pulsar </p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç«  &lt;a href=&quot;https://crossoverjie.top/2023/08/23/ob/VictoriaLogs-Intro/&quot;&gt;VictoriaLogsï¼šä¸€æ¬¾è¶…ä½å ç”¨çš„ ElasticSearch æ›¿ä»£æ–¹æ¡ˆ&lt;/a&gt;è®²åˆ°äº†æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;Victorialogs&lt;/code&gt; æ¥å­˜å‚¨ Pulsar æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ trace ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/12/11/UYdMH19uyjrNA2I.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;è€Œå…¶ä¸­çš„å…³é”®çš„åŸ‹ç‚¹ä¿¡æ¯æ˜¯é€šè¿‡ Pulsar çš„ &lt;code&gt;BrokerInterceptor&lt;/code&gt; å®ç°çš„ï¼Œåé¢å°±æœ‰æœ‹å‹å’¨è¯¢è¿™å—ä»£ç æ˜¯å¦å¼€æºï¼Œç›®å‰æ˜¯æ²¡æœ‰å¼€æºçš„ï¼Œä¸è¿‡å€Ÿæ­¤æœºä¼šå¯ä»¥èŠèŠå¦‚ä½•å®ç°ä¸€ä¸ª &lt;code&gt;BrokerInterceptor&lt;/code&gt; æ’ä»¶ï¼Œå½“å‰è¿˜æ²¡æœ‰ç›¸å…³çš„ä»‹ç»æ–‡æ¡£ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="OB" scheme="http://crossoverjie.top/categories/OB/"/>
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/tags/Pulsar/"/>
    
  </entry>
  
</feed>
