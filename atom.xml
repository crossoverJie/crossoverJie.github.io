<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>crossoverJie&#39;s Blog</title>
  
  <subtitle>baller</subtitle>
  <link href="http://crossoverjie.top/atom.xml" rel="self"/>
  
  <link href="http://crossoverjie.top/"/>
  <updated>2023-05-20T15:22:55.419Z</updated>
  <id>http://crossoverjie.top/</id>
  
  <author>
    <name>crossoverJie</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>äº‘åŸç”ŸèƒŒæ™¯ä¸‹å¦‚ä½•é…ç½® JVM å†…å­˜</title>
    <link href="http://crossoverjie.top/2023/05/15/k8s/cloudnative-java/"/>
    <id>http://crossoverjie.top/2023/05/15/k8s/cloudnative-java/</id>
    <published>2023-05-15T00:08:08.000Z</published>
    <updated>2023-05-20T15:22:55.419Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/05/12/IAxSF3oZ1j8GHbi.png" alt="image.png"></p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å‰æ®µæ—¶é—´ä¸šåŠ¡ç ”å‘åé¦ˆè¯´æ˜¯ä»–çš„åº”ç”¨å†…å­˜ä½¿ç”¨ç‡å¾ˆé«˜ï¼Œå¯¼è‡´é¢‘ç¹çš„é‡å¯ï¼Œè®©æˆ‘æ’æŸ¥ä¸‹æ˜¯æ€ä¹ˆå›äº‹ï¼›</p><p>åœ¨è¿™ä¹‹å‰æˆ‘ä¹Ÿæ²¡æ€ä¹ˆåœ¨æ„è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæ­£å¥½è¿™æ¬¡æ’æŸ¥åˆ†æçš„è¿‡ç¨‹åšä¸€ä¸ªè®°å½•ã€‚</p><span id="more"></span><p>é¦–å…ˆæˆ‘æŸ¥çœ‹äº†ç›‘æ§é¢æ¿é‡Œçš„ Pod ç›‘æ§ï¼š<br><img src="https://s2.loli.net/2023/05/14/wyYu8SI7eGprqmQ.png" alt="WeChatWorkScreenshot_ac6f8d80-bdb4-469e-af1a-b2199c9ee288.png"></p><p>å‘ç°ç¡®å®æ˜¯å¿«æ»¡äº†ï¼Œè€Œæ­¤æ—¶å»æŸ¥çœ‹åº”ç”¨çš„ JVM å ç”¨æƒ…å†µå´åªæœ‰30%å·¦å³ï¼›è¯´æ˜å¹¶ä¸æ˜¯åº”ç”¨å†…å­˜æ»¡äº†å¯¼è‡´ JVM çš„ OOMï¼Œè€Œæ˜¯ Pod çš„å†…å­˜æ»¡äº†ï¼Œå¯¼è‡´ Pod çš„å†…å­˜æº¢å‡ºï¼Œä»è€Œè¢« k8s æ€æ‰äº†ã€‚</p><p>è€Œ <code>k8s</code> ä¸ºäº†ç»´æŒåº”ç”¨çš„å‰¯æœ¬æ•°é‡å°±å¾—é‡å¯ä¸€ä¸ª Podï¼Œæ‰€ä»¥çœ‹èµ·æ¥å°±æ˜¯åº”ç”¨è¿è¡Œä¸€æ®µæ—¶é—´åå°±è¢«é‡å¯ã€‚</p><hr><p><img src="https://s2.loli.net/2023/05/14/Lhkjys1TEQUKV86.png" alt="WeChatWorkScreenshot_6213e2f8-c429-4d33-acdd-e639275dd92b.png"><br>è€Œè¿™ä¸ªåº”ç”¨é…ç½®çš„æ˜¯ JVM 8Gï¼Œå®¹å™¨ç”³è¯·çš„å†…å­˜æ˜¯16Gï¼Œæ‰€ä»¥ Pod çš„å†…å­˜å ç”¨çœ‹èµ·æ¥ä¹Ÿå°± 50% å·¦å³ã€‚</p><h1 id="å®¹å™¨çš„åŸç†"><a href="#å®¹å™¨çš„åŸç†" class="headerlink" title="å®¹å™¨çš„åŸç†"></a>å®¹å™¨çš„åŸç†</h1><p>åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰è¿˜æ˜¯å…ˆç®€å•äº†è§£ä¸‹å®¹å™¨çš„è¿è¡ŒåŸç†ï¼Œå› ä¸ºåœ¨ k8s ä¸­æ‰€æœ‰çš„åº”ç”¨éƒ½æ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„ï¼Œè€Œå®¹å™¨æœ¬è´¨ä¸Šä¹Ÿæ˜¯è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªä¸ªè¿›ç¨‹è€Œå·²ã€‚</p><p>ä½†æˆ‘ä»¬ä½¿ç”¨ Docker çš„æ—¶å€™ä¼šæ„Ÿè§‰æ¯ä¸ªå®¹å™¨å¯åŠ¨çš„åº”ç”¨ä¹‹é—´äº’ä¸å¹²æ‰°ï¼Œä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€CPUã€å†…å­˜è¿™äº›éƒ½èƒ½å®Œå…¨éš”ç¦»å¼€æ¥ï¼Œå°±åƒä¸¤ä¸ªè¿è¡Œåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­çš„åº”ç”¨ã€‚</p><p>å…¶å®è¿™ä¸€ç‚¹ä¹Ÿä¸æ˜¯å•¥é»‘ç§‘æŠ€ï¼ŒLinux æ—©å°±æ”¯æŒ 2.6.x çš„ç‰ˆæœ¬å°±å·²ç»æ”¯æŒ <code>namespace</code> éš”ç¦»äº†ï¼Œä½¿ç”¨ <code>namespace</code> å¯ä»¥å°†ä¸¤ä¸ªè¿›ç¨‹å®Œå…¨éš”ç¦»ã€‚</p><p>ä»…ä»…å°†èµ„æºéš”ç¦»è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦é™åˆ¶å¯¹èµ„æºçš„ä½¿ç”¨ï¼Œæ¯”å¦‚ CPUã€å†…å­˜ã€ç£ç›˜ã€å¸¦å®½è¿™äº›ä¹Ÿå¾—åšé™åˆ¶ï¼›è¿™ç‚¹ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>cgroups</code> è¿›è¡Œé…ç½®ã€‚</p><p>å®ƒå¯ä»¥é™åˆ¶æŸä¸ªè¿›ç¨‹çš„èµ„æºï¼Œæ¯”å¦‚å®¿ä¸»æœºæ˜¯ 4 æ ¸ CPUï¼Œ8G å†…å­˜ï¼Œä¸ºäº†ä¿æŠ¤å…¶ä»–å®¹å™¨ï¼Œå¿…é¡»ç»™è¿™ä¸ªå®¹å™¨é…ç½®ä½¿ç”¨ä¸Šé™ï¼š1æ ¸ CPUï¼Œ2Gå†…å­˜ã€‚</p><p><img src="https://s2.loli.net/2023/05/14/dzcHK6G8VZQuFC5.png" alt="image.png"></p><p>è¿™å¼ å›¾å°±å¾ˆæ¸…æ™°çš„è¡¨ç¤ºäº† <code>namespace</code>  å’Œ <code>cgroups</code> åœ¨å®¹å™¨æŠ€æœ¯ä¸­çš„ä½œç”¨ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><ul><li>namespace è´Ÿè´£éš”ç¦»</li><li>cgroups è´Ÿè´£é™åˆ¶</li></ul><p>åœ¨ k8s ä¸­ä¹Ÿæœ‰å¯¹åº”çš„æç°ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resources:</span></span><br><span class="line">  <span class="attr">requests:</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">1024Mi</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="number">0.1</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">1024Mi</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªèµ„æºæ¸…å•è¡¨ç¤ºè¯¥åº”ç”¨è‡³å°‘éœ€è¦ä¸ºä¸€ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ª 0.1 æ ¸å’Œ 1024M çš„èµ„æºï¼ŒCPU çš„æœ€é«˜ä¸Šé™ä¸º 4 ä¸ªæ ¸å¿ƒã€‚</p><h1 id="ä¸åŒçš„OOM"><a href="#ä¸åŒçš„OOM" class="headerlink" title="ä¸åŒçš„OOM"></a>ä¸åŒçš„OOM</h1><p>å›åˆ°æœ¬æ¬¡çš„é—®é¢˜ï¼Œå¯ä»¥ç¡®è®¤æ˜¯å®¹å™¨å‘ç”Ÿäº† OOM ä»è€Œå¯¼è‡´è¢« k8s é‡å¯ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é…ç½® limits çš„ä½œç”¨ã€‚</p><blockquote><p>k8s å†…å­˜æº¢å‡ºå¯¼è‡´å®¹å™¨é€€å‡ºä¼šå‡ºç° exit code 137 çš„ä¸€ä¸ª event æ—¥å¿—ã€‚</p></blockquote><p>å› ä¸ºè¯¥åº”ç”¨çš„ JVM å†…å­˜é…ç½®å’Œå®¹å™¨çš„é…ç½®å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯8GBï¼Œä½† Java åº”ç”¨è¿˜æœ‰ä¸€äº›é JVM ç®¡ç†çš„å†…å­˜ï¼Œæ¯”å¦‚å †å¤–å†…å­˜ä¹‹ç±»çš„ï¼Œè¿™æ ·å¾ˆå®¹æ˜“å°±å¯¼è‡´å®¹å™¨å†…å­˜å¤§å°è¶…è¿‡äº†é™åˆ¶çš„ 8G äº†ï¼Œä¹Ÿå°±å¯¼è‡´äº†å®¹å™¨å†…å­˜æº¢å‡ºã€‚</p><h1 id="äº‘åŸç”ŸèƒŒæ™¯çš„ä¼˜åŒ–"><a href="#äº‘åŸç”ŸèƒŒæ™¯çš„ä¼˜åŒ–" class="headerlink" title="äº‘åŸç”ŸèƒŒæ™¯çš„ä¼˜åŒ–"></a>äº‘åŸç”ŸèƒŒæ™¯çš„ä¼˜åŒ–</h1><p>å› ä¸ºè¿™ä¸ªåº”ç”¨æœ¬èº«ä½¿ç”¨çš„å†…å­˜ä¸å¤šï¼Œæ‰€ä»¥å»ºè®®å°†å †å†…å­˜é™åˆ¶åˆ° 4GBï¼Œè¿™æ ·å°±é¿å…äº†å®¹å™¨å†…å­˜è¶…é™ï¼Œä»è€Œè§£å†³äº†é—®é¢˜ã€‚</p><p>å½“ç„¶ä¹‹åæˆ‘ä»¬ä¹Ÿä¼šåœ¨åº”ç”¨é…ç½®æ é‡ŒåŠ ä¸Šå»ºè®®ï¼šæ¨è JVM çš„é…ç½®å°äºå®¹å™¨é™åˆ¶çš„ 2&#x2F;3ï¼Œé¢„ç•™ä¸€äº›å†…å­˜ã€‚</p><p>å…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯å¼€å‘æ¨¡å¼æ²¡æœ‰è½¬å˜è¿‡æ¥ï¼Œä»¥ä¼ ç»Ÿçš„ Java åº”ç”¨å¼€å‘æ¨¡å¼ç”šè‡³éƒ½ä¸ä¼šå»äº†è§£å®¹å™¨çš„å†…å­˜å¤§å°ï¼Œå› ä¸ºä»¥å‰å¤§å®¶çš„åº”ç”¨éƒ½æ˜¯éƒ¨ç½²åœ¨ä¸€ä¸ªå†…å­˜è¾ƒå¤§çš„è™šæ‹Ÿæœºä¸Šï¼Œæ‰€ä»¥æ„ŸçŸ¥ä¸åˆ°å®¹å™¨å†…å­˜çš„é™åˆ¶ã€‚</p><p>ä»è€Œè¯¯ä»¥ä¸ºå°†ä¸¤è€…ç”»äº†ç­‰å·ï¼Œè¿™ä¸€ç‚¹å¯èƒ½åœ¨ Java åº”ç”¨ä¸­å°¤ä¸ºæ˜æ˜¾ï¼Œæ¯•ç«Ÿå¤šäº†ä¸€ä¸ª JVMï¼›ç”šè‡³åœ¨è€ç‰ˆæœ¬çš„ JDK ä¸­å¦‚æœæ²¡æœ‰è®¾ç½®å †å†…å­˜å¤§å°ï¼Œæ— æ³•æ„ŸçŸ¥åˆ°å®¹å™¨çš„å†…å­˜é™åˆ¶ï¼Œä»è€Œè‡ªåŠ¨ç”Ÿæˆçš„ Xmx å¤§äºäº†å®¹å™¨çš„å†…å­˜å¤§å°ï¼Œä»¥è‡´äº OOMã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/05/12/IAxSF3oZ1j8GHbi.png&quot; alt=&quot;image.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´ä¸šåŠ¡ç ”å‘åé¦ˆè¯´æ˜¯ä»–çš„åº”ç”¨å†…å­˜ä½¿ç”¨ç‡å¾ˆé«˜ï¼Œå¯¼è‡´é¢‘ç¹çš„é‡å¯ï¼Œè®©æˆ‘æ’æŸ¥ä¸‹æ˜¯æ€ä¹ˆå›äº‹ï¼›&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¹‹å‰æˆ‘ä¹Ÿæ²¡æ€ä¹ˆåœ¨æ„è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæ­£å¥½è¿™æ¬¡æ’æŸ¥åˆ†æçš„è¿‡ç¨‹åšä¸€ä¸ªè®°å½•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="cloudnative" scheme="http://crossoverjie.top/categories/cloudnative/"/>
    
    
    <category term="Java" scheme="http://crossoverjie.top/tags/Java/"/>
    
    <category term="JVM" scheme="http://crossoverjie.top/tags/JVM/"/>
    
    <category term="K8s" scheme="http://crossoverjie.top/tags/K8s/"/>
    
  </entry>
  
  <entry>
    <title>ä»æºç å½»åº•ç†è§£ Prometheus/VictoriaMetrics ä¸­çš„ relabel_configs/metric_relabel_configs é…ç½®</title>
    <link href="http://crossoverjie.top/2023/03/13/metrics/relabel_configs_%20metric_relabel_configs/"/>
    <id>http://crossoverjie.top/2023/03/13/metrics/relabel_configs_%20metric_relabel_configs/</id>
    <published>2023-03-13T00:08:08.000Z</published>
    <updated>2023-03-12T10:44:16.552Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/03/11/Xxp5yNTH1ASBk3Z.png"></p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘æ¥æ‰‹ç»´æŠ¤äº†å…¬å¸çš„æŒ‡æ ‡ç›‘æ§ç³»ç»Ÿï¼Œä¹‹åè¸©åˆ°å‘å°±æ²¡ç«™èµ·æ¥è¿‡ã€‚ã€‚<br><img src="https://s2.loli.net/2023/03/11/UwBJ28ZafziRsQS.png"></p><span id="more"></span><p>æœ¬æ¬¡é—®é¢˜çš„èµ·å› æ˜¯æˆ‘ä»¬é…ç½®äº†ä¸€äº›æŒ‡æ ‡çš„åˆ é™¤ç­–ç•¥æ²¡æœ‰ç”Ÿæ•ˆï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">action:</span> <span class="string">drop_metrics</span></span><br><span class="line">  <span class="attr">regex:</span> <span class="string">&quot;^envoy_.*|^url\_\_\_\_.*|istio_request_bytes_sum&quot;</span></span><br></pre></td></tr></table></figure><p>ä¸è¿™ä¸¤ä¸ªå®¹æ˜“å¼•èµ·è¯¯è§£çš„é…ç½®<code>relabel_configs/metric_relabel_configs</code>æœ‰å…³ã€‚</p><p>ä»–ä»¬éƒ½æ˜¯å¯¹æŠ“å–çš„æ•°æ®è¿›è¡Œé‡å‘½åã€è¿‡æ»¤ã€æ–°å¢ã€åˆ é™¤ç­‰æ“ä½œï¼Œä½†åº”ç”¨åœºæ™¯å´å®Œå…¨ä¸åŒã€‚</p><blockquote><p>æˆ‘ä»¬ä½¿ç”¨äº† VictoriaMetrics æ›¿æ¢äº† Prometheusï¼ŒVM å®Œå…¨å…¼å®¹ Prometheus ï¼Œæ‰€ä»¥æœ¬æ–‡ä¹Ÿå¯¹ Prometheus åŒæ ·é€‚ç”¨ã€‚</p></blockquote><h1 id="ç†è§£é”™è¯¯1"><a href="#ç†è§£é”™è¯¯1" class="headerlink" title="ç†è§£é”™è¯¯1"></a>ç†è§£é”™è¯¯1</h1><p><img src="https://s2.loli.net/2023/03/12/9oYRlCGTZaNuc5j.png" alt="image.png"><br>ä½†è¿™é‡Œå…¶å®æ˜¯æœ‰ä¸€ä¸ªé”™è¯¯ç†è§£çš„ï¼Œæˆ‘æ˜¯é€šè¿‡ VM çš„æœåŠ¡å‘ç°é¡µé¢çš„æŒ‡æ ‡å“åº”é¡µé¢æŸ¥è¯¢æŒ‡æ ‡çš„ï¼Œæ‰“å¼€ä¹‹åç¡®å®èƒ½æœåˆ°éœ€è¦è¢«åˆ é™¤çš„ç›¸å…³æŒ‡æ ‡ã€‚</p><p>ä½†å…¶å®å³ä¾¿æ˜¯çœŸçš„åˆ é™¤äº†æ•°æ®è¿™ä¸ªé¡µé¢ä¹Ÿä¼šæœ‰æ•°æ®å­˜åœ¨ï¼Œåˆ é™¤çš„æ•°æ®åªæ˜¯ä¸ä¼šå†™å…¥ VM çš„æ—¶åºæ•°æ®åº“ä¸­ã€‚</p><blockquote><p>è¿™ä¸€ç‚¹æ˜¯åœ¨åç»­æŸ¥æºç æ—¶æ‰å‘ç°ï¼›åé¢æˆ‘é…ç½®å¯¹äº†ä¾ç„¶åœ¨è¿™é‡ŒæŸ¥çœ‹æ•°æ®ï¼Œå‘ç°è¿˜æ˜¯æ²¡æœ‰åˆ é™¤ï¼Œè¿™ä¸ªé”™è¯¯ç†è§£æµªè´¹äº†ä¸å°‘æ—¶é—´ğŸ˜‚ã€‚</p></blockquote><h1 id="ç†è§£é”™è¯¯2"><a href="#ç†è§£é”™è¯¯2" class="headerlink" title="ç†è§£é”™è¯¯2"></a>ç†è§£é”™è¯¯2</h1><p>ä¸ºäº†è§£å†³é—®é¢˜ï¼Œé€šè¿‡ <code>drop metrics</code> è¿™ç±»å…³é”®å­—åœ¨ VM çš„å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥è¯¢ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ç¯‡æ–‡ç« ã€‚<br><a href="https://www.robustperception.io/dropping-metrics-at-scrape-time-with-prometheus/">https://www.robustperception.io/dropping-metrics-at-scrape-time-with-prometheus/</a><br><img src="https://s2.loli.net/2023/03/12/oRQKnf7u6j3Ulq5.png"></p><p>æŒ‰ç…§è¿™é‡Œçš„ä»‹ç»ï¼Œå°†åˆ é™¤çš„é…ç½®åŠ å…¥åˆ° <code>metric_relabel_configs</code> é…ç½®ä¸‹ï¼Œç»è¿‡æµ‹è¯•ç¡®å®æœ‰æ•ˆã€‚</p><p>ä¸è¿‡ä¸ºå•¥å°†åŒæ ·çš„é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">drop_metrics</span></span><br><span class="line">      <span class="attr">regex:</span> <span class="string">&quot;^envoy_.*|^url\_\_\_\_.*|istio_request_bytes_sum&quot;</span></span><br></pre></td></tr></table></figure><p>åŠ å…¥åˆ° <code>relabel_configs</code> æœªèƒ½ç”Ÿæ•ˆå‘¢ï¼Ÿ</p><p>ä¼°è®¡ç¡®å®å®¹æ˜“ä»¤äººè¯¯å¯¼ï¼Œåœ¨æ–‡æ¡£ä¸­ä¹Ÿæ‰¾åˆ°äº†ç›¸å…³çš„è§£é‡Šï¼š<br><a href="https://www.robustperception.io/relabel_configs-vs-metric_relabel_configs/">https://www.robustperception.io/relabel_configs-vs-metric_relabel_configs&#x2F;</a><br><img src="https://s2.loli.net/2023/03/12/xyaqKjkf85YZzeA.png"><br>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è¡¨è¾¾å‡ ä¸ªé‡ç‚¹ï¼š</p><ul><li><code>relabel_configs</code> ç”¨äºé…ç½®å“ªä¸ªç›®æ ‡éœ€è¦è¢«æŠ“å–ï¼Œå‘ç”Ÿåœ¨æŒ‡æ ‡æŠ“å–ä¹‹å‰ã€‚</li><li><code>metric_relabel_configs</code> å‘ç”Ÿåœ¨æŒ‡æ ‡æŠ“å–ä¹‹åï¼Œå†™å…¥å­˜å‚¨ä¹‹å‰ã€‚</li><li>å¦‚æœå…¶ä¸­ä¸€ä¸ªæ²¡ç”Ÿæ•ˆï¼Œå°±æ¢ä¸€ä¸ªï¼ˆè¿™å¥è¯å¾ˆå®¹æ˜“è®©äººçŠ¯è¿·ç³Šï¼‰</li></ul><p>ä½†è¯´å®è¯å½“æ—¶æˆ‘çœ‹åˆ°è¿™é‡Œè¿˜æ˜¯ä¸€è„¸æ‡µï¼Œä¸ºäº†å½»åº•äº†è§£ä¸¤åˆ™çš„åŒºåˆ«è¿˜æ˜¯çœ‹æºç æ¥çš„ç›´æ¥ã€‚</p><h2 id="é˜…è¯»æºç ç†è§£æœ¬è´¨åŸå› "><a href="#é˜…è¯»æºç ç†è§£æœ¬è´¨åŸå› " class="headerlink" title="é˜…è¯»æºç ç†è§£æœ¬è´¨åŸå› "></a>é˜…è¯»æºç ç†è§£æœ¬è´¨åŸå› </h2><h3 id="metric-relabel-configs"><a href="#metric-relabel-configs" class="headerlink" title="metric_relabel_configs"></a>metric_relabel_configs</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metric_relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">drop_metrics</span></span><br><span class="line">      <span class="attr">regex:</span> <span class="string">&quot;^envoy_.*|^url\_\_\_\_.*|istio_request_bytes_sum&quot;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆçœ‹ä¸‹<code>metric_relabel_configs</code>é…ç½®ç”Ÿæ•ˆçš„åŸå› ã€‚</p><p><img src="https://s2.loli.net/2023/03/12/dWA4a3kzGPIxFEX.png"></p><p><code>metric_relabel_configs</code> é…ç½®çš„æ•´ä½“æµç¨‹å¦‚ä¸Šå›¾ï¼š</p><ul><li>å¯åŠ¨ VM æ—¶åŠ è½½é…ç½®åˆ°å†…å­˜</li><li>æ ¹æ®é…ç½®çš„æŠ“å–é—´éš”æ—¶é—´(<code>scrape_interval</code>)æŠ“å–æ•°æ®ï¼Œæ‹¿åˆ°çš„æ¯ä¸€æ¡æ•°æ®éƒ½éœ€è¦é€šè¿‡ <code>metric_relabel_configs</code> çš„åº”ç”¨ã€‚</li><li>é’ˆå¯¹äºè¿™é‡Œçš„ <code>drop_metrics</code> æ¥è¯´ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ é™¤æ‰æ‰€æœ‰çš„ <code>Label</code>ã€‚</li><li>å¦‚æœå¯ä»¥åŒ¹é…åˆ é™¤ï¼Œé‚£å°±ä¸ä¼šå†™å…¥å­˜å‚¨ã€‚</li></ul><p>å…¶ä¸­çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š<br><img src="https://s2.loli.net/2023/03/12/ZlIKFDbhLVpx8Om.png"></p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œæºç é‡Œåˆ¤æ–­çš„ <code>action</code> æ˜¯ <code>drop</code>ï¼Œè€Œæˆ‘ä»¬é…ç½®çš„æ˜¯ <code>drop_metrics</code>ï¼Œå…¶å® <code>drop_metrics</code> ä¹Ÿæ˜¯ drop çš„ä¸€ä¸ªå°è£…è€Œå·²ã€‚</p><p><img src="https://s2.loli.net/2023/03/12/2kQ9rSBsJ3IuAwm.png"><br>åœ¨è§£æé…ç½®çš„æ—¶å€™ä¼šè¿›è¡Œè½¬æ¢ã€‚</p><p>ä¸è¿™ä¸ªå†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">source_labels:</span> [ <span class="string">__name__</span> ]</span><br><span class="line">  <span class="attr">regex:</span> <span class="string">&quot;^envoy_.*|^url\_\_\_\_.*|istio_request_bytes_sum&quot;</span></span><br><span class="line">  <span class="attr">action:</span> <span class="string">drop</span></span><br></pre></td></tr></table></figure><h3 id="relabel-configs"><a href="#relabel-configs" class="headerlink" title="relabel_configs"></a>relabel_configs</h3><p>ç„¶åæ¥çœ‹çœ‹ <code>relabel_configs</code> æ²¡æœ‰æŒ‰ç…§é¢„æœŸç”Ÿæ•ˆçš„åŸå› ã€‚</p><p><img src="https://s2.loli.net/2023/03/12/itlzeXC8DNhpQf4.png"></p><p>å…¶å®æ ¸å¿ƒçš„åº”ç”¨é…ç½®å°±æ˜¯åŒä¸€ä»½ä»£ç ï¼Œåªæ˜¯è§¦å‘ç‚¹ä¸ä¸€æ ·ã€‚</p><p><code>relabel_configs</code> æ˜¯åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™æ ¹æ®æˆ‘ä»¬é…ç½®çš„æŠ“å–ç›®æ ‡çš„æ•°æ®å½“åšæ•°æ®æºï¼Œæ‰€ä»¥è¿™é‡Œçš„ <code>action: drop</code> åˆ é™¤çš„æ˜¯æŠ“å–ç›®æ ‡ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æŠ“å–æ•°æ®ã€‚<br><img src="https://s2.loli.net/2023/03/12/qXbwjh5e3uRds4z.png"></p><p>è€Œä¸”å®ƒçš„ç›®çš„æ˜¯åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œç”¨äºç”ŸæˆæŠ“å–ç›®æ ‡çš„ä»»åŠ¡ï¼Œ<strong>åªä¼šè¿è¡Œä¸€æ¬¡</strong>ã€‚</p><p>å‡è®¾æˆ‘è¿™é‡Œæ”¹å†™ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [ <span class="string">__address__</span> ]</span><br><span class="line">      <span class="attr">regex:</span> <span class="string">&#x27;192.xx.xx.xx:443&#x27;</span></span><br><span class="line">      <span class="attr">action:</span> <span class="string">drop</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/12/SfJnMP547ltQohW.png"><br>é‚£ä¹ˆæˆ‘è¿™ä¸ªæŠ“å–ä»»åŠ¡å°±ä¼šè¢«åˆ é™¤æ‰ï¼Œè€Œä¸æ˜¯åˆ é™¤è¿™ä¸ªæŒ‡æ ‡äº†ã€‚</p><p>å› æ­¤ä¹‹å‰æˆ‘åœ¨è¿™é‡Œé…ç½®çš„æ˜¯ä¸€äº›ä¸šåŠ¡æŒ‡æ ‡ <code>regex: &quot;^envoy_.*|^url\_\_\_\_.*|istio_request_bytes_sum&quot;</code>ï¼Œåœ¨æ‰€æœ‰å…ƒæ•°æ®é‡Œè‡ªç„¶æ˜¯æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå¯ä»¥åŒ¹é…äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— äº‹å‘ç”Ÿã€‚</p><blockquote><p>å…ƒæ•°æ®éƒ½æ˜¯ä»¥ <code>__</code> å¼€å¤´ã€‚</p></blockquote><hr><p>å…¶å® VM ä¹Ÿæœ‰æä¾›ä¸€ä¸ª Debug é¡µé¢ç”¨äºè°ƒè¯• <code>relabel_configs</code>ï¼Œä½†å¦‚æœçŸ¥é“æ€ä¹ˆç”¨è¿™ä¸ªè°ƒè¯•é¡µé¢å…¶å®ä¹Ÿç†è§£äº†ä»–çš„è¿è¡ŒåŸç†ğŸ˜‚<br><img src="https://s2.loli.net/2023/03/12/q8KAwpOsBMIEXT3.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><a href="https://www.robustperception.io/relabelling-can-discard-targets-timeseries-and-alerts/">https://www.robustperception.io/relabelling-can-discard-targets-timeseries-and-alerts/</a> </p><p><img src="https://s2.loli.net/2023/03/12/lJsntMyoCruRYi7.png"><br>åé¢æˆ‘æŸ¥åˆ°è¿™ç¯‡æ–‡ç« ä¹Ÿæœ‰ç›¸å…³è§£é‡Šï¼Œç†è§£äº†ä¸¤è€…çš„åŒºåˆ«åå†çœ‹è¿™é‡Œçš„åˆ†æä¼šæ›´åŠ å®¹æ˜“ç†è§£ã€‚</p><p>æ€»çš„æ¥è¯´ï¼š</p><ul><li><code>relabel_configs</code> ç”¨äºå¯¹æŠ“å–ç›®æ ‡å…ƒæ•°æ®çš„å¢åˆ æ”¹ï¼›å¦‚æœåˆ é™¤åè¿åç»­çš„æŠ“å–ä»»åŠ¡ä¹Ÿä¼šè¢«å–æ¶ˆã€‚</li><li><code>metric_relabel_configs</code> ç”¨äºå¯¹æŠ“å–åˆ°çš„æ•°æ®å¢åˆ æ”¹ï¼Œå¯¹äºä¸éœ€è¦çš„ä¸šåŠ¡æŒ‡æ ‡å¯ä»¥åœ¨è¿™é‡Œé…ç½®ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯å‰æ–‡è®²åˆ°çš„ <code>relabel_configs</code> åº”ç”¨äºæŒ‡æ ‡æŠ“å–å‰ï¼Œ<code>metric_relabel_configs</code> åº”ç”¨äºæŒ‡æ ‡æŠ“å–åã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/03/11/Xxp5yNTH1ASBk3Z.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;æœ€è¿‘æ¥æ‰‹ç»´æŠ¤äº†å…¬å¸çš„æŒ‡æ ‡ç›‘æ§ç³»ç»Ÿï¼Œä¹‹åè¸©åˆ°å‘å°±æ²¡ç«™èµ·æ¥è¿‡ã€‚ã€‚&lt;br&gt;&lt;img src=&quot;https://s2.loli.net/2023/03/11/UwBJ28ZafziRsQS.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="metrics" scheme="http://crossoverjie.top/categories/metrics/"/>
    
    
    <category term="K8s" scheme="http://crossoverjie.top/tags/K8s/"/>
    
    <category term="Prometheus" scheme="http://crossoverjie.top/tags/Prometheus/"/>
    
    <category term="VictoriaMetrics" scheme="http://crossoverjie.top/tags/VictoriaMetrics/"/>
    
  </entry>
  
  <entry>
    <title>é€šè¿‡ Pulsar æºç å½»åº•è§£å†³é‡å¤æ¶ˆè´¹é—®é¢˜</title>
    <link href="http://crossoverjie.top/2023/02/27/pulsar/pulsar-repeat-consume/"/>
    <id>http://crossoverjie.top/2023/02/27/pulsar/pulsar-repeat-consume/</id>
    <published>2023-02-27T00:08:08.000Z</published>
    <updated>2023-02-26T13:42:52.831Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/02/26/Oz94bQasM2Einok.png"></p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æœ€è¿‘çœŸæ˜¯å’Œ <code>Pulsar</code> æ ä¸Šäº†ï¼Œä¸šåŠ¡å›¢é˜Ÿåé¦ˆè¯´æ˜¯çº¿ä¸Šæœ‰ä¸ªåº”ç”¨æ¶ˆæ¯é‡å¤æ¶ˆè´¹ã€‚</p><p><img src="https://s2.loli.net/2023/02/26/c2eZuTPUvrlB1YF.png"></p><p>è€Œä¸”åœ¨æµ‹è¯•ç¯å¢ƒæ˜¯å¯ä»¥ç¨³å®šå¤ç°çš„ï¼Œæ ¹æ®ç»éªŒæ¥çœ‹ä¸€èˆ¬èƒ½ç¨³å®šå¤ç°çš„éƒ½æ¯”è¾ƒå¥½è§£å†³ã€‚</p><span id="more"></span><h1 id="å®šä½é—®é¢˜"><a href="#å®šä½é—®é¢˜" class="headerlink" title="å®šä½é—®é¢˜"></a>å®šä½é—®é¢˜</h1><p>æ¥ç€ä¾¿æ˜¯å®šä½é—®é¢˜äº†ï¼Œæ ¹æ®ä¹‹å‰çš„ç»éªŒè®©ä¸šåŠ¡æŒ‰ç…§è¿™å‡ ç§æƒ…å†µå…ˆæ’æŸ¥ä¸€ä¸‹ï¼š<br><img src="https://s2.loli.net/2023/02/26/IrvxGDQuaSt7AOE.png"></p><p>é€šè¿‡æ’æŸ¥ï¼š1,2å¯ä»¥æ’é™¤äº†ã€‚</p><ol><li>æ²¡æœ‰ç›¸å…³æ—¥å¿—</li><li>å­˜åœ¨å¼‚å¸¸ï¼Œä½†æœ€å¤–å±‚ä¹Ÿæ•è·äº†ï¼Œæ‰€ä»¥ä¸ç®¡æœ‰æ— å¼‚å¸¸éƒ½ä¼š ACKã€‚</li></ol><p>ç¬¬ä¸‰ä¸ªä¹Ÿåœ¨æ¶ˆè´¹çš„å…¥å£å’Œæäº¤æ¶ˆæ¯å‡ºè®¡ç®—äº†æ—¶é—´ï¼Œæœ€ç»ˆå‘ç°éƒ½æ˜¯åœ¨2så·¦å³ ACK çš„ã€‚</p><p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> client.newConsumer()</span><br><span class="line">        .subscriptionType(SubscriptionType.Shared)</span><br><span class="line">        .enableRetry(<span class="literal">true</span>)</span><br><span class="line">        .topic(topic)</span><br><span class="line">        .ackTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">        .subscriptionName(<span class="string">&quot;my-sub&quot;</span>)</span><br><span class="line">        .messageListener(<span class="keyword">new</span> <span class="title class_">MessageListener</span>&lt;<span class="type">byte</span>[]&gt;() &#123;</span><br><span class="line">            <span class="meta">@SneakyThrows</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">received</span><span class="params">(Consumer&lt;<span class="type">byte</span>[]&gt; consumer, Message&lt;<span class="type">byte</span>[]&gt; msg)</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;msg_id&#123;&#125;&quot;</span>,msg.getMessageId().toString());</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                consumer.acknowledge(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .subscribe();</span><br></pre></td></tr></table></figure><p>é‚£è¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œå› ä¸ºä»£ç é‡Œé…ç½®çš„ ackTimeout æ˜¯ 30sï¼Œç†è®ºä¸Šæ¥è¯´æ˜¯ä¸ä¼šå­˜åœ¨è¶…æ—¶å¯¼è‡´æ¶ˆæ¯é‡å‘çš„ã€‚</p><p>ä¸ºäº†æ’é™¤æ˜¯å¦æ˜¯è¶…æ—¶å¼•èµ·çš„ï¼Œç›´æ¥å°†ä¸šåŠ¡ä»£ç æ³¨é‡Šæ‰äº†ï¼Œç­‰äºæ˜¯æ¶ˆæ¯æ”¶åˆ°åç«‹å³å°± ACKï¼Œç»è¿‡æµ‹è¯•å‘ç°è¿™æ ·ç¡®å®å°±æ²¡æœ‰é‡å¤æ¶ˆè´¹äº†ã€‚</p><p>ä¸ºäº†å†æ¬¡ç¡®è®¤æ˜¯ä¸æ˜¯å’Œ ackTimeout æœ‰å…³ï¼Œç›´æ¥å°† <code>.ackTimeout(30, TimeUnit.SECONDS)</code> æ³¨é‡Šæ‰åæµ‹è¯•ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰é‡å¤æ¶ˆè´¹äº†ã€‚</p><h1 id="ç¡®è®¤åŸå› "><a href="#ç¡®è®¤åŸå› " class="headerlink" title="ç¡®è®¤åŸå› "></a>ç¡®è®¤åŸå› </h1><p>æ—¢ç„¶å¦‚æ­¤é‚£ä¸€å®šæ˜¯å’Œè¿™ä¸ªé…ç½®æœ‰å…³äº†ï¼Œä½†çœ‹ä»£ç ç¡®å®æ²¡æœ‰è¶…æ—¶ï¼Œä¸ºäº†å®šä½å…·ä½“åŸå› åªæœ‰å»çœ‹ client çš„æºç äº†ã€‚</p><p>è¿™é‡Œç®€å•æ¢³ç†ä¸‹æ¶ˆæ¯çš„æ¶ˆè´¹çš„æµç¨‹ï¼š</p><ol><li>æ ¹æ® <code>.receiverQueueSize(1000)</code> çš„é…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ broker ä¼šç›´æ¥ç»™å®¢æˆ·ç«¯æ¨é€ 1000 æ¡æ¶ˆæ¯ã€‚</li><li>å®¢æˆ·ç«¯å°†è¿™ 1000 æ¡æ¶ˆæ¯ä¿å­˜åˆ°å†…éƒ¨é˜Ÿåˆ—ä¸­ã€‚</li><li>å¦‚æœä½¿ç”¨åŒæ­¥æ¶ˆè´¹ <code>receive()</code> æ—¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å» <code>take</code> è¿™ä¸ªå†…éƒ¨é˜Ÿåˆ—ã€‚</li><li>å¦‚æœæ˜¯ä½¿ç”¨çš„æ˜¯ <code>messageListener</code> å¼‚æ­¥æ¶ˆè´¹å¹¶é…ç½® <code>ackTimeout</code>ï¼Œæ¯å½“ä»é˜Ÿåˆ—é‡Œè·å¾—ä¸€æ¡æ¶ˆæ¯åä¾¿ä¼šæŠŠè¿™æ¡æ¶ˆæ¯åŠ å…¥ <code>UnAckedMessageTracker</code> å†…éƒ¨çš„ä¸€ä¸ªæ—¶é—´è½®ä¸­ï¼Œå®šæ—¶æ£€æµ‹é¡¶éƒ¨æ˜¯å¦å­˜åœ¨æ¶ˆæ¯ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¼šè§¦å‘é‡æ–°æŠ•é€’ã€‚<br>4.1 åŠ å…¥æ—¶é—´è½®åï¼Œ<code>å¼‚æ­¥</code>è°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œè¿™ä¸ªå¼‚æ­¥æ“ä½œæ˜¯æäº¤åˆ°ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ä¸­ç”±å•ä¸ªçº¿ç¨‹ä¾æ¬¡æ’é˜Ÿæ‰§è¡Œï¼ˆè¿™ç‚¹æ˜¯è¿™æ¬¡é—®é¢˜çš„å…³é”®ï¼‰</li><li>ä¸šåŠ¡ ACK çš„æ—¶å€™ä¼šä»æ—¶é—´è½®ä¸­åˆ é™¤æ¶ˆæ¯ï¼Œæ‰€ä»¥å¦‚æœæ¶ˆæ¯ ACK çš„è¶³å¤Ÿå¿«ï¼Œåœ¨ç¬¬å››æ­¥å°±ä¸ä¼šè·å–åˆ°æ¶ˆæ¯è¿›è¡Œé‡æ–°æŠ•é€’ã€‚</li></ol><p><img src="https://s2.loli.net/2023/02/26/2PuOadlU6oRqHVN.png"></p><p>æ•´ä½“æµç¨‹å¦‚ä¸Šå›¾ï¼Œä»£ç ç»†èŠ‚å¦‚ä¸‹å›¾ï¼š<br><img src="https://s2.loli.net/2023/02/26/jMOqBUe912cdEWg.png"></p><p>æ‰€ä»¥é—®é¢˜çš„æ ¹æœ¬åŸå› å°±æ˜¯å†™å…¥æ—¶é—´è½®ï¼ˆ<code>UnAckedMessageTracker</code>ï¼‰å¼€å§‹å€’è®¡æ—¶çš„çº¿ç¨‹å’Œå›è°ƒä¸šåŠ¡é€»è¾‘çš„ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‚</p><p>å¦‚æœä¸šåŠ¡æ‰§è¡Œè€—æ—¶ï¼Œç­‰åˆ°æ¶ˆæ¯ä»é‚£ä¸ªå•çº¿ç¨‹çš„æ— ç•Œé˜Ÿåˆ—ä¸­å–å‡ºæ¥çš„æ—¶å€™å¾ˆæœ‰å¯èƒ½å·²ç»è¿‡äº† ackTimeou çš„æ—¶é—´ï¼Œä»è€Œå¯¼è‡´äº†è¶…æ—¶é‡å‘ã€‚</p><p>ä¹Ÿå°±æ˜¯ç”¨æˆ·æ‰€ç†è§£çš„ <code>ackTimeout</code> å‘¨æœŸï¼ˆåº”è¯¥è¿›å…¥å›è°ƒæ—¶å€™å¼€å§‹è®¡æ—¶ï¼‰å’Œ SDK å®ç°çš„ä¸ä¸€è‡´é€ æˆçš„ã€‚</p><p>ä¹‹åæˆ‘å†æ¬¡ç¡®è®¤åŒæ ·çš„ä»£ç æ¢ä¸ºåŒæ­¥æ¶ˆè´¹æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä¸ä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> consumer.receive();</span><br><span class="line">            log.info(</span><br><span class="line">                    <span class="string">&quot;consumer Message received: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msg.getData()) + msg.getMessageId().toString());</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            consumer.acknowledge(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä»£ç åå‘ç°åŒæ­¥ä»£ç çš„è·å–æ¶ˆæ¯å’ŒåŠ å…¥ <code>UnAckedMessageTracker</code> æ—¶é—´è½®æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°è¶…æ—¶çš„é—®é¢˜ã€‚<br><img src="https://s2.loli.net/2023/02/26/AUiDgXYO7QvINTF.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ‰€ä»¥å…¶å® æ˜¯<code>messageListener</code> å¼‚æ­¥æ¶ˆè´¹çš„ ackTimeout çš„è¯­ä¹‰æ˜¯æœ‰é—®é¢˜çš„ï¼Œéœ€è¦å°†åŠ å…¥ <code>UnAckedMessageTracker</code> å¤„ç§»åŠ¨åˆ°å›è°ƒå‡½æ•°ä¸­åŒæ­¥è°ƒç”¨ã€‚</p><p>æˆ‘æŸ¥çœ‹äº†æœ€æ–°çš„ <code>2.11.x</code> ç‰ˆæœ¬çš„ä»£ç ä¾ç„¶æ²¡æœ‰ä¿®å¤ï¼Œæ­£å‡†å¤‡æä¸ª PR åˆ‡æ¢åˆ° master æ—¶æ‰å‘ç°å·²ç»æœ‰ç›¸å…³çš„ PR äº†ï¼Œåªæ˜¯è¿˜æ²¡æœ‰å‘ç‰ˆã€‚</p><p>ä¿®å¤çš„èƒŒæ™¯å’Œæ€è·¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå…·ä½“å‚è€ƒï¼š</p><p><a href="https://github.com/apache/pulsar/pull/18911">https://github.com/apache/pulsar/pull/18911</a></p><p>å…¶å®ä¸šåŠ¡ä¸­å¹¶ä¸æ¨èä½¿ç”¨ ackTimeout è¿™ä¸ªé…ç½®äº†ï¼Œä¸å¥½é¢„ä¼°æ—¶é—´ä»è€Œå¯¼è‡´è¶…æ—¶ï¼Œè€Œä¸”æˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†ä¸šåŠ¡é…ç½®å¥½ <code>ackTImeout</code> åç›´åˆ°åç»­å‡ºé—®é¢˜çš„æ—¶å€™æ‰æƒ³èµ·æ¥è¦æ”¹ã€‚<br>æ‰€ä»¥å¹²è„†ä¸€å¼€å§‹å°±ä¸è¦ä½¿ç”¨ã€‚</p><p>åœ¨ go ç‰ˆæœ¬çš„ SDK ä¸­ç›´æ¥åºŸå¼ƒæ‰äº†è¿™ä¸ªå‚æ•°ï¼Œæ¨èä½¿ç”¨ nack API æ›¿æ¢ã€‚</p><p><img src="https://s2.loli.net/2023/02/26/kQaZAcJi6WjNDXq.png"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/02/26/Oz94bQasM2Einok.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;æœ€è¿‘çœŸæ˜¯å’Œ &lt;code&gt;Pulsar&lt;/code&gt; æ ä¸Šäº†ï¼Œä¸šåŠ¡å›¢é˜Ÿåé¦ˆè¯´æ˜¯çº¿ä¸Šæœ‰ä¸ªåº”ç”¨æ¶ˆæ¯é‡å¤æ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/02/26/c2eZuTPUvrlB1YF.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;è€Œä¸”åœ¨æµ‹è¯•ç¯å¢ƒæ˜¯å¯ä»¥ç¨³å®šå¤ç°çš„ï¼Œæ ¹æ®ç»éªŒæ¥çœ‹ä¸€èˆ¬èƒ½ç¨³å®šå¤ç°çš„éƒ½æ¯”è¾ƒå¥½è§£å†³ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/categories/Pulsar/"/>
    
    
    <category term="Consumer" scheme="http://crossoverjie.top/tags/Consumer/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªè¯¡å¼‚çš„ Pulsar InterruptedException å¼‚å¸¸</title>
    <link href="http://crossoverjie.top/2023/02/23/pulsar/pulsar-interrupted/"/>
    <id>http://crossoverjie.top/2023/02/23/pulsar/pulsar-interrupted/</id>
    <published>2023-02-23T00:08:08.000Z</published>
    <updated>2023-02-22T17:11:31.775Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/02/22/mQaCJMopS1WAjVN.png"></p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p><img src="https://s2.loli.net/2023/02/22/Lw3UbtiJ1GKyg6x.png"><br>ä»Šå¤©æ”¶åˆ°ä¸šåŠ¡å›¢é˜Ÿåé¦ˆçº¿ä¸Šæœ‰ä¸ªåº”ç”¨å¾€ Pulsar ä¸­å‘é€æ¶ˆæ¯å¤±è´¥äº†ï¼Œç»è¿‡æ—¥å¿—æŸ¥çœ‹å¾—çŸ¥æ˜¯å‘é€æ¶ˆæ¯æ—¶å€™æŠ›å‡ºäº† <code>java.lang.InterruptedException</code> å¼‚å¸¸ã€‚</p><p>å’Œä¸šåŠ¡æ²Ÿé€šåå¾—çŸ¥æ˜¯åœ¨ä¸€ä¸ª <code>gRPC</code> æ¥å£ä¸­è§¦å‘çš„æ¶ˆæ¯å‘é€ï¼Œå¤§çº¦æŒç»­äº†åŠä¸ªå°æ—¶çš„å¼‚å¸¸åä¾¿æ¢å¤æ­£å¸¸äº†ï¼Œè¿™æ˜¯æ•´ä¸ªé—®é¢˜çš„èƒŒæ™¯ã€‚</p><span id="more"></span><h1 id="å‰ç½®æ’æŸ¥"><a href="#å‰ç½®æ’æŸ¥" class="headerlink" title="å‰ç½®æ’æŸ¥"></a>å‰ç½®æ’æŸ¥</h1><p>æ‹¿åˆ°è¯¥é—®é¢˜åé¦–å…ˆæ’æŸ¥ä¸‹æ˜¯å¦æ˜¯å…±æ€§é—®é¢˜ï¼ŒæŸ¥çœ‹äº†å…¶ä»–çš„åº”ç”¨æ²¡æœ‰å‘ç°ç±»ä¼¼çš„å¼‚å¸¸ï¼›åŒæ—¶ä¹ŸæŸ¥çœ‹äº† Pulsar broker çš„ç›‘æ§å¤§ç›˜ï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µä¾ç„¶æ²¡æœ‰æ³¢åŠ¨å’Œå¼‚å¸¸ï¼›</p><p>è¿™æ ·å¯ä»¥åˆæ­¥æ’é™¤æ˜¯ Pulsar æœåŠ¡ç«¯çš„é—®é¢˜ã€‚</p><p>æ¥ç€ä¾¿æ˜¯æŸ¥çœ‹åº”ç”¨é‚£æ®µæ—¶é—´çš„è´Ÿè½½æƒ…å†µï¼Œä»åº”ç”¨ QPS åˆ° JVM çš„å„ä¸ªå†…å­˜æƒ…å†µä¾ç„¶æ²¡å‘ç°æœ‰ä»€ä¹ˆæ˜æ˜¾çš„å˜åŒ–ã€‚</p><h1 id="Pulsar-æºç æ’æŸ¥"><a href="#Pulsar-æºç æ’æŸ¥" class="headerlink" title="Pulsar æºç æ’æŸ¥"></a>Pulsar æºç æ’æŸ¥</h1><p>æ—¢ç„¶çœ‹èµ·æ¥åº”ç”¨æœ¬èº«å’Œ Pulsar broker éƒ½æ²¡æœ‰é—®é¢˜çš„è¯é‚£å°±åªèƒ½ä»å¼‚å¸¸æœ¬èº«æ¥æ’æŸ¥äº†ã€‚</p><p>é¦–å…ˆç¬¬ä¸€æ­¥è¦å¾—çŸ¥å…·ä½“ä½¿ç”¨çš„æ˜¯ <code>Pulsar-client</code> æ˜¯ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Œå› ä¸ºä¸šåŠ¡ä½¿ç”¨çš„æ˜¯å†…éƒ¨åŸºäºå®˜æ–¹ SDK å°è£… <code>springboot starter</code> æ‰€ä»¥ç¬¬ä¸€æ­¥è¿˜å¾—æ’æŸ¥è¿™ä¸ª <code>starter</code> æ˜¯å¦æœ‰å½±å“ã€‚</p><p>é€šè¿‡æŸ¥çœ‹æºç åŸºæœ¬æ’é™¤äº† <code>starter</code> çš„å«Œç–‘ï¼Œé‡Œé¢åªæ˜¯ç®€å•çš„å°è£…äº† <code>SDK</code> çš„åŠŸèƒ½è€Œå·²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.lang.InterruptedException at org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:<span class="number">1027</span>) at org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:<span class="number">91</span>) at </span><br><span class="line">java.base/java.lang.Thread.run(Thread.java:<span class="number">834</span>) Caused by: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.lang.InterruptedException at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:<span class="number">395</span>) </span><br><span class="line">at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:<span class="number">1999</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:<span class="number">89</span>) ... <span class="number">49</span> common frames omitted Caused by: org.apache.pulsar.client.api.PulsarClientException: java.lang.InterruptedException </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.canEnqueueRequest(ProducerImpl.java:<span class="number">775</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.sendAsync$original$BWm7PPlZ(ProducerImpl.java:<span class="number">393</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.sendAsync$original$BWm7PPlZ$accessor$i7NYMN6i(ProducerImpl.java) </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl$auxiliary$EfuVvJLT.call(Unknown Source) </span><br><span class="line">at org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:<span class="number">86</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.sendAsync(ProducerImpl.java) </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(ProducerImpl.java:<span class="number">292</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.internalSendWithTxnAsync(ProducerImpl.java:<span class="number">363</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.PartitionedProducerImpl.internalSendWithTxnAsync(PartitionedProducerImpl.java:<span class="number">191</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.PartitionedProducerImpl.internalSendAsync(PartitionedProducerImpl.java:<span class="number">167</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.TypedMessageBuilderImpl.sendAsync(TypedMessageBuilderImpl.java:<span class="number">103</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:<span class="number">82</span>) ... <span class="number">49</span> common frames omitted Caused by: java.lang.InterruptedException: <span class="literal">null</span></span><br><span class="line">at java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:<span class="number">1343</span>) </span><br><span class="line">at java.base/java.util.concurrent.Semaphore.acquire(Semaphore.java:<span class="number">318</span>) </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.canEnqueueRequest(ProducerImpl.java:<span class="number">758</span>)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¾¿åªèƒ½æ˜¯åˆ†æå †æ ˆäº†ï¼Œå› ä¸º Pulsar-client çš„éƒ¨åˆ†å®ç°æºç æ˜¯æ²¡æœ‰ç›´æ¥æ‰“åŒ…åˆ°ä¾èµ–ä¸­çš„ï¼Œåç¼–è¯‘çš„è¯è®¸å¤šä»£ç è¡Œæ•°å¯¹ä¸ä¸Šï¼Œæ‰€ä»¥éœ€è¦å°†å®˜æ–¹çš„æºç æ‹‰åˆ°æœ¬åœ°ï¼Œåˆ‡æ¢åˆ°å¯¹äºçš„åˆ†æ”¯è¿›è¡ŒæŸ¥çœ‹ã€‚</p><blockquote><p>è¿™ä¸€æ­¥ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œé¦–å…ˆæ˜¯ä»£ç åº“è¿˜æŒºå¤§çš„ï¼ŒåŠ ä¸Šä¹‹å‰å¦‚æœæ²¡æœ‰å‡†å¤‡å¥½ Pulsar çš„å¼€å‘ç¯å¢ƒçš„è¯ä¼°è®¡ä¼šåŠé€€ä¸€éƒ¨åˆ†äººï¼›ä½†å…¶å®å¤§éƒ¨åˆ†é—®é¢˜éƒ½æ˜¯ç½‘ç»œé€ æˆçš„ï¼Œåªè¦é…ç½®ä¸€äº› Maven é•œåƒå¤šè¯•å‡ æ¬¡æ€»ä¼šç¼–è¯‘æˆåŠŸã€‚</p></blockquote><p>æˆ‘è¿™é‡Œç›´æ¥å°†åˆ†æ”¯åˆ‡æ¢åˆ° <code>branch-2.8</code>ã€‚</p><p>ä»å †æ ˆçš„é¡¶éƒ¨å¼€å§‹æ’æŸ¥ <code>TypedMessageBuilderImpl.java:91</code>ï¼š<br><img src="https://s2.loli.net/2023/02/23/Q53Vm1Fkau9Yn2c.png"><br>çœ‹èµ·æ¥æ˜¯å†…éƒ¨å¼‚æ­¥å‘é€æ¶ˆæ¯çš„æ—¶å€™æŠ›äº†å¼‚å¸¸ã€‚</p><p>æ¥ç€å¾€ä¸‹çœ‹åˆ°è¿™é‡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.InterruptedException </span><br><span class="line">at org.apache.pulsar.client.impl.ProducerImpl.canEnqueueRequest(ProducerImpl.java:<span class="number">775</span>) at</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/02/23/LdJspv5CfaRm3EW.png"><br>çœ‹èµ·æ¥æ˜¯è¿™é‡Œæ²¡é”™ï¼Œä½†æ˜¯ä»£ç è¡Œæ•°æ˜æ˜¾ä¸å¯¹ï¼›å› ä¸º 2.8 è¿™ä¸ªåˆ†æ”¯ä¹Ÿæ˜¯ä¿®å¤è¿‡å‡ ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸­é—´æœ‰ä¿®æ”¹å¯¼è‡´ä»£ç è¡Œæ•°ä¸æœ€æ–°ä»£ç å¯¹ä¸ä¸Šä¹Ÿæ­£å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">semaphore.get().acquire();</span><br></pre></td></tr></table></figure><p>ä¸è¿‡åˆæ­¥æ¥çœ‹åº”è¯¥æ˜¯è¿™è¡Œä»£ç æŠ›å‡ºçš„çº¿ç¨‹ç»ˆç«¯å¼‚å¸¸ï¼Œè¿™é‡Œçœ‹èµ·æ¥åªæœ‰ä»–æœ€æœ‰å¯èƒ½äº†ã€‚</p><p><img src="https://s2.loli.net/2023/02/23/V3mFAuRKzgWnN5T.png"><br>ä¸ºäº†ç¡®è®¤æ˜¯å¦æ˜¯çœŸçš„æ˜¯è¿™è¡Œä»£ç ï¼Œè¿™ä¸ªæ–‡ä»¶å†å¾€å‰ç¿»äº†å‡ ä¸ªç‰ˆæœ¬æœ€ç»ˆç¡®è®¤äº†å°±æ˜¯è¿™è¡Œä»£ç æ²¡é”™äº†ã€‚</p><p>æˆ‘ä»¬ç‚¹å¼€<code>java.util.concurrent.Semaphore#acquire()</code>çš„æºç ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;has its interrupted status set on entry to this method; or</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;is &#123;<span class="doctag">@linkplain</span> Thread#interrupt interrupted&#125; while waiting</span></span><br><span class="line"><span class="comment"> * for a permit,</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> * then &#123;<span class="doctag">@link</span> InterruptedException&#125; is thrown and the current thread&#x27;s</span></span><br><span class="line"><span class="comment"> * interrupted status is cleared.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InterruptedException if the current thread is interrupted</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">acquire</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    sync.acquireSharedInterruptibly(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquireSharedInterruptibly</span><span class="params">(<span class="type">int</span> arg)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted() ||</span><br><span class="line">        (tryAcquireShared(arg) &lt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">         acquire(<span class="literal">null</span>, arg, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="number">0L</span>) &lt; <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>é€šè¿‡æºç ä¼šå‘ç° <code>acquire()</code> å‡½æ•°ç¡®å®ä¼šå“åº”ä¸­æ–­ï¼Œä¸€æ—¦æ£€æµ‹åˆ°å½“å‰çº¿ç¨‹è¢«ä¸­æ–­åä¾¿ä¼šæŠ›å‡º <code>InterruptedException</code> å¼‚å¸¸ã€‚</p><h1 id="å®šä½é—®é¢˜"><a href="#å®šä½é—®é¢˜" class="headerlink" title="å®šä½é—®é¢˜"></a>å®šä½é—®é¢˜</h1><p>æ‰€ä»¥é—®é¢˜çš„åŸå› åŸºæœ¬ç¡®å®šäº†ï¼Œå°±æ˜¯åœ¨ Pulsar çš„å‘é€æ¶ˆæ¯çº¿ç¨‹è¢«ä¸­æ–­äº†å¯¼è‡´çš„ï¼Œä½†ä¸ºå•¥ä¼šè¢«ä¸­æ–­è¿˜éœ€è¦ç»§ç»­æ’æŸ¥ã€‚</p><p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹ä¸­æ–­æ˜¯éœ€è¦è°ƒç”¨ <code>Thread.currentThread().interrupt();</code> APIçš„ï¼Œé¦–å…ˆçŒœæµ‹æ˜¯å¦ Pulsar å®¢æˆ·ç«¯å†…éƒ¨æœ‰ä¸ªçº¿ç¨‹ä¸­æ–­äº†è¿™ä¸ªå‘é€çº¿ç¨‹ã€‚</p><p>äºæ˜¯æˆ‘åœ¨ <code>pulsar-client</code> è¿™ä¸ªæ¨¡å—ä¸­æœç´¢äº†ç›¸å…³ä»£ç ï¼š<br><img src="https://s2.loli.net/2023/02/23/w6USaRvMqAIjCfm.png"><br>æ’é™¤æ‰å’Œ producer ä¸ç›¸å…³çš„åœ°æ–¹ï¼Œå…¶ä½™æ‰€æœ‰ä¸­æ–­çº¿ç¨‹çš„ä»£ç éƒ½æ˜¯åœ¨æœ‰äº†è¯¥å¼‚å¸¸ä¹‹åç»§ç»­ä¼ é€’è€Œå·²ï¼›æ‰€ä»¥åˆæ­¥æ¥çœ‹ pulsar-client å†…éƒ¨æ²¡æœ‰ä¸»åŠ¨ä¸­æ–­çš„æ“ä½œã€‚</p><p>æ—¢ç„¶ Pulsar è‡ªå·±æ²¡æœ‰åšï¼Œé‚£å°±åªå¯èƒ½æ˜¯ä¸šåŠ¡åšçš„äº†ï¼Ÿ</p><p>äºæ˜¯æˆ‘åœ¨ä¸šåŠ¡ä»£ç ä¸­æœç´¢äº†ä¸€ä¸‹ï¼š<br><img src="https://s2.loli.net/2023/02/23/lVzJPf9ZWBGmuti.png"></p><p>æœç„¶åœ¨ä¸šåŠ¡ä»£ç ä¸­æœåˆ°äº†å”¯ä¸€ä¸€å¤„ä¸­æ–­çš„åœ°æ–¹ï¼Œè€Œä¸”é€šè¿‡è°ƒç”¨å…³ç³»å¾—çŸ¥è¿™æ®µä»£ç æ˜¯åœ¨æ¶ˆæ¯å‘é€å‰æ‰§è¡Œçš„ï¼Œå¹¶ä¸”å’Œ Pulsar å‘é€å‡½æ•°å¤„äºåŒä¸€çº¿ç¨‹ã€‚</p><p>å¤§æ¦‚çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).stream().map(e -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        TimeUnit.MILLISECONDS.sleep(<span class="number">10</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">    ).collect(Collectors.toList()).forEach(f -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> f.get();</span><br><span class="line">            log.info(<span class="string">&quot;====&quot;</span> + integer);</span><br><span class="line">            <span class="keyword">if</span> (integer==<span class="number">3</span>)&#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">10</span>);</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="type">MessageId</span> <span class="variable">send</span> <span class="operator">=</span> producer.newMessage().value(msg.getBytes()).send();</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿™æ®µä»£ç å¯ä»¥å®Œå…¨å¤ç°åŒæ ·çš„å †æ ˆã€‚</p><p>å¹¸å¥½ä¸­æ–­è¿™é‡Œè¿˜æ‰“å¾—æœ‰æ—¥å¿—ï¼š</p><p><img src="https://s2.loli.net/2023/02/23/nHE4WcfaKD8iqSb.png"><br><img src="https://s2.loli.net/2023/02/23/4df5ehMBwj9DyQV.png"></p><p>é€šè¿‡æ—¥å¿—æœç´¢å‘ç°å¼‚å¸¸çš„æ—¶é—´å’Œè¿™ä¸ªä¸­æ–­çš„æ—¥å¿—æ—¶é—´ç‚¹å®Œå…¨é‡åˆï¼Œè¿™æ ·ä¹Ÿå°±çŸ¥é“æ ¹æœ¬åŸå› äº†ã€‚</p><p>å› ä¸ºä¸šåŠ¡çº¿ç¨‹å’Œæ¶ˆæ¯å‘é€çº¿ç¨‹æ˜¯åŒä¸€ä¸ªï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šæ‰§è¡Œ <code>Thread.currentThread().interrupt();</code>ï¼Œå…¶å®å•çº¯æ‰§è¡Œè¿™è¡Œå‡½æ•°å¹¶ä¸ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œåªè¦æ²¡æœ‰å»å“åº”è¿™ä¸ªä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯ <code>Semaphore</code> æºç ä¸­çš„åˆ¤æ–­äº†çº¿ç¨‹ä¸­æ–­çš„æ ‡è®°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquireSharedInterruptibly</span><span class="params">(<span class="type">int</span> arg)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted() ||</span><br><span class="line">        (tryAcquireShared(arg) &lt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">         acquire(<span class="literal">null</span>, arg, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="number">0L</span>) &lt; <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ°å¥½è¿™é‡Œä¸šåŠ¡ä¸­æ–­åè‡ªå·±å¹¶æ²¡æœ‰å»åˆ¤æ–­è¿™ä¸ªæ ‡è®°ï¼Œå¯¼è‡´ Pulsar å†…éƒ¨å»åˆ¤æ–­äº†ï¼Œæœ€ç»ˆæŠ›å‡ºäº†è¿™ä¸ªå¼‚å¸¸ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ‰€ä»¥å½’æ ¹ç»“åº•è¿˜æ˜¯è¿™é‡Œçš„ä»£ç ä¸åˆç†å¯¼è‡´çš„ï¼Œé¦–å…ˆæ˜¯è‡ªå·±ä¸­æ–­äº†çº¿ç¨‹ä½†ä¹Ÿæ²¡ä½¿ç”¨ï¼Œä»è€Œå¯¼è‡´æœ‰è¢«å…¶ä»–åŸºç¡€åº“ä½¿ç”¨çš„å¯èƒ½ï¼Œæ‰€ä»¥ä¼šé€ æˆäº†ä¸€äº›ä¸å¯é¢„çŸ¥çš„åæœã€‚</p><p>å†ä¸€ä¸ªæ˜¯ä¸å»ºè®®åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨ <code>Thread.currentThread().interrupt();</code> è¿™ç±»ä»£ç ï¼Œç¬¬ä¸€çœ¼æ ¹æœ¬ä¸çŸ¥é“æ˜¯è¦å¹²å•¥ï¼Œä¹Ÿä¸æ˜“ç»´æŠ¤ã€‚</p><p>å…¶å®æœ¬è´¨ä¸Šçº¿ç¨‹ä¸­æ–­ä¹Ÿæ˜¯çº¿ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ‰‹æ®µï¼Œæœ‰è¿™ç±»éœ€æ±‚å®Œå…¨å¯ä»¥æ¢ä¸ºå†…ç½®çš„ <code>BlockQueue</code> è¿™ç±»å‡½æ•°æ¥å®ç°ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/02/22/mQaCJMopS1WAjVN.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/02/22/Lw3UbtiJ1GKyg6x.png&quot;&gt;&lt;br&gt;ä»Šå¤©æ”¶åˆ°ä¸šåŠ¡å›¢é˜Ÿåé¦ˆçº¿ä¸Šæœ‰ä¸ªåº”ç”¨å¾€ Pulsar ä¸­å‘é€æ¶ˆæ¯å¤±è´¥äº†ï¼Œç»è¿‡æ—¥å¿—æŸ¥çœ‹å¾—çŸ¥æ˜¯å‘é€æ¶ˆæ¯æ—¶å€™æŠ›å‡ºäº† &lt;code&gt;java.lang.InterruptedException&lt;/code&gt; å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;å’Œä¸šåŠ¡æ²Ÿé€šåå¾—çŸ¥æ˜¯åœ¨ä¸€ä¸ª &lt;code&gt;gRPC&lt;/code&gt; æ¥å£ä¸­è§¦å‘çš„æ¶ˆæ¯å‘é€ï¼Œå¤§çº¦æŒç»­äº†åŠä¸ªå°æ—¶çš„å¼‚å¸¸åä¾¿æ¢å¤æ­£å¸¸äº†ï¼Œè¿™æ˜¯æ•´ä¸ªé—®é¢˜çš„èƒŒæ™¯ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/categories/Pulsar/"/>
    
    
    <category term="InterruptedException" scheme="http://crossoverjie.top/tags/InterruptedException/"/>
    
  </entry>
  
  <entry>
    <title>Istio å‡çº§åè¸©çš„å‘</title>
    <link href="http://crossoverjie.top/2023/02/20/istio/istio1.12-upgrade-fix/"/>
    <id>http://crossoverjie.top/2023/02/20/istio/istio1.12-upgrade-fix/</id>
    <published>2023-02-20T00:08:08.000Z</published>
    <updated>2023-02-19T13:42:29.744Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/02/19/FwgABGdDrhR4a3j.png"></p><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å‰æ®µæ—¶é—´æˆ‘ä»¬å°† istio ç‰ˆæœ¬å‡çº§åˆ° 1.12 åå¯¼è‡´ç°æœ‰çš„åº”ç”¨ç›‘æ§æœ‰éƒ¨åˆ†æ•°æ®ä¸¢å¤±ï¼ˆé¡µé¢ä¸Šæ˜¾ç¤ºä¸å‡ºæ¥ï¼‰ã€‚</p><ul><li>ä¸€ä¸ªæ˜¯åº”ç”¨åŸºç¡€ä¿¡æ¯ä¸¢å¤±ã€‚</li><li>å†ä¸€ä¸ªæ˜¯åº”ç”¨ JVM æ•°æ®ä¸¢å¤±ã€‚</li><li>æ¥å£ç»´åº¦çš„ç›‘æ§æ•°æ®ä¸¢å¤±ã€‚</li></ul><span id="more"></span><p><img src="https://s2.loli.net/2023/02/19/6eSAIF1Jcjhrp4x.png"></p><hr><p><img src="https://s2.loli.net/2023/02/19/Lyr4cSxVmutjJU6.png"></p><hr><p><img src="https://s2.loli.net/2023/02/19/aPzD9t7L1mGqiJR.png"></p><hr><h2 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h2><h3 id="åŸºç¡€ä¿¡æ¯"><a href="#åŸºç¡€ä¿¡æ¯" class="headerlink" title="åŸºç¡€ä¿¡æ¯"></a>åŸºç¡€ä¿¡æ¯</h3><p>é¦–å…ˆæ˜¯ç¬¬ä¸€ä¸ªåŸºç¡€ä¿¡æ¯ä¸¢å¤±çš„é—®é¢˜ï¼Œé¡µé¢ä¸Šå…¶å®æ˜¾ç¤ºçš„æ˜¯æˆ‘ä»¬çš„ä¸€ä¸ªèšåˆæŒ‡æ ‡<code>istio_requests_total:source:rate1m</code>ã€‚</p><blockquote><p>èšåˆåå¯ä»¥å°†å¤šä¸ªæŒ‡æ ‡åˆå¹¶ä¸ºä¸€ä¸ªï¼Œå‡å°‘ç³»ç»Ÿå‹åŠ›</p></blockquote><p>å…·ä½“å¯ä»¥å‚è€ƒ Istio çš„æœ€ä½³å®è·µ <a href="https://istio.io/latest/docs/ops/best-practices/observability/#workload-level-aggregation-via-recording-rules">Observability Best Practices</a> æœ‰è¯¦ç»†è¯´æ˜ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">groups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">istio.service.source.istio_requests_total</span></span><br><span class="line">      <span class="attr">rules:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">expr:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            sum(irate(istio_requests_total&#123;reporter=&quot;source&quot;&#125;[1m]))</span></span><br><span class="line"><span class="string">            by (</span></span><br><span class="line"><span class="string">              destination_app,</span></span><br><span class="line"><span class="string">              source_workload_namespace,</span></span><br><span class="line"><span class="string">              response_code,</span></span><br><span class="line"><span class="string">              source_app</span></span><br><span class="line"><span class="string">            )</span></span><br><span class="line"><span class="string"></span>          <span class="attr">record:</span> <span class="string">istio_requests_total:source:rate1m</span></span><br></pre></td></tr></table></figure><p>æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä»¥ä¸Šå››ä¸ªç»´åº¦è¿›è¡Œç»Ÿè®¡ <code>istio_requests_total</code>ï¼›ä½†åœ¨å‡çº§ä¹‹åæŸ¥çœ‹åŸå§‹æ•°æ®å‘ç°ä¸¢å¤±äº† <code>destination_app, source_app</code> è¿™ä¸¤ä¸ª tagã€‚</p><p>è‡³äºä¸ºå•¥ä¸¢å¤±ï¼ŒæŸ¥äº†è®¸ä¹…ï¼Œæœ€ååœ¨å‡çº§åçš„èµ„æºæ–‡ä»¶ <code>stats-filter-1.12.yaml</code> ä¸­æ‰¾åˆ°äº†ç­”æ¡ˆ:<br><img src="https://s2.loli.net/2023/02/19/B7a6sH9CYznVGUI.png"><br>å‡çº§åæ–°å¢äº† <code>tags_to_remove</code> æ ‡è®°ï¼Œå°†æˆ‘ä»¬æ‰€éœ€è¦çš„ä¸¤ä¸ª tag ç›´æ¥åˆ æ‰äº†ã€‚</p><p>åç»­åœ¨å½“å‰ namespace ä¸‹é‡æ–°å»ºä¸€ä¸ª <code>EnvoyFilter</code> èµ„æºè¦†ç›–æ‰é»˜è®¤çš„ä¾¿èƒ½æ¢å¤è¿™ä¸¤ä¸ª tagï¼Œä¿®å¤åç›‘æ§é¡µé¢ä¹Ÿæ˜¾ç¤ºæ­£å¸¸äº†ã€‚</p><blockquote><p>EnvoyFilter æ˜¯å®æ—¶ç”Ÿæ•ˆçš„ï¼Œå¹¶ä¸éœ€è¦é‡å»ºåº”ç”¨ Podã€‚</p></blockquote><h3 id="JVM-ç›‘æ§"><a href="#JVM-ç›‘æ§" class="headerlink" title="JVM ç›‘æ§"></a>JVM ç›‘æ§</h3><p><code>JVM</code> æ•°æ®ä¸¢å¤±çš„è¿™ä¸ªåº”ç”¨ï¼Œç›´æ¥è¿›å…¥ <code>Pod</code> æŸ¥çœ‹æš´éœ²å‡ºçš„ <code>metric</code>ï¼Œå‘ç°æ•°æ®éƒ½æœ‰ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jvm_memory_pool_bytes_used&#123;pool=&quot;Code Cache&quot;,&#125; 1.32126784E8</span><br><span class="line">jvm_memory_pool_bytes_used&#123;pool=&quot;Metaspace&quot;,&#125; 2.74250552E8</span><br><span class="line">jvm_memory_pool_bytes_used&#123;pool=&quot;Compressed Class Space&quot;,&#125; 3.1766024E7</span><br><span class="line">jvm_memory_pool_bytes_used&#123;pool=&quot;G1 Eden Space&quot;,&#125; 1.409286144E9</span><br><span class="line">jvm_memory_pool_bytes_used&#123;pool=&quot;G1 Survivor Space&quot;,&#125; 2.01326592E8</span><br><span class="line">jvm_memory_pool_bytes_used&#123;pool=&quot;G1 Old Gen&quot;,&#125; 2.583691248E9</span><br></pre></td></tr></table></figure><p>è¯´æ˜ä¸æ˜¯æ•°æ®æºçš„é—®é¢˜ï¼Œé‚£å°±å¯èƒ½æ˜¯æ•°æ®é‡‡é›†èŠ‚ç‚¹çš„é—®é¢˜äº†ã€‚</p><p>è¿›å…¥<code>VictoriaMetrics</code> çš„ <code>target</code> é¡µé¢å‘ç°åº”ç”¨ç¡®å®å·²ç»ä¸‹çº¿ï¼ŒåŸæ¥æ˜¯é‡‡é›†çš„ç«¯å£ä¸é€šå¯¼è‡´çš„ã€‚</p><blockquote><p>æˆ‘ä»¬ä½¿ç”¨ VictoriaMetrics ä»£æ›¿äº† Prometheusã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/02/19/Hhj6LutlvUsycES.png"></p><p>è€Œè¿™ä¸ªç«¯å£ 15020 ä¹‹å‰å¹¶æœªä½¿ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¦å¤–ä¸€ä¸ªè‡ªå®šä¹‰ç«¯å£å’Œç«¯ç‚¹æ¥é‡‡é›†æ•°æ®ã€‚</p><p>ç»è¿‡æŸ¥é˜…å‘ç° 15020 æ˜¯ istio é»˜è®¤çš„ç«¯å£ï¼š<br><img src="https://s2.loli.net/2023/02/19/LjOewSXl5IVPv6q.png"></p><p>åŸæ¥åœ¨é»˜è®¤æƒ…å†µä¸‹ Istio ä¼šä¸ºæ‰€æœ‰çš„æ•°æ®é¢ Pod åŠ ä¸Šï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">prometheus.io/path:</span> <span class="string">/stats/prometheus</span></span><br><span class="line">    <span class="attr">prometheus.io/port:</span> <span class="string">&quot;15020&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ³¨è§£ç”¨äºé‡‡é›†æ•°æ®ï¼Œç”±äºæˆ‘ä»¬æ˜¯è‡ªå®šä¹‰çš„ç«¯ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼š<br><img src="https://s2.loli.net/2023/02/19/R7v8rG6f2XixlBU.png"></p><p>åœ¨æ§åˆ¶é¢å°† <code>--set meshConfig.enablePrometheusMerge=false</code> è®¾ç½®ä¸º falseï¼Œå…¶å®å®˜æ–¹æ–‡æ¡£å·²ç»è¯´æ˜ï¼Œå¦‚æœä¸æ˜¯ä½¿ç”¨çš„æ ‡å‡† <code>prometheus.io</code> æ³¨è§£ï¼Œéœ€è¦å°†è¿™ä¸ªè®¾ç½®ä¸º falseã€‚</p><blockquote><p>ä¿®æ”¹åéœ€è¦é‡å»ºåº”ç”¨ Pod æ–¹èƒ½ç”Ÿæ•ˆã€‚</p></blockquote><p>æœ‰äº† url è¿™ä¸ª tag åï¼Œæ¥å£ç›‘æ§é¡µä¹Ÿæ¢å¤äº†æ­£å¸¸ã€‚</p><h3 id="æ¥å£ç»´åº¦"><a href="#æ¥å£ç»´åº¦" class="headerlink" title="æ¥å£ç»´åº¦"></a>æ¥å£ç»´åº¦</h3><p>æ¥å£ç»´åº¦çš„æ•°æ®ä¸¢å¤±å’ŒåŸºæœ¬æ•°æ®ä¸¢å¤±çš„åŸå› ç±»ä¼¼ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åŸå§‹æ•°æ®ä¸­ç¼ºå°‘äº† url è¿™ä¸ª tagï¼Œå› ä¸ºæˆ‘ä»¬æ‰€èšåˆçš„æŒ‡æ ‡ä½¿ç”¨äº† urlï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">istio.service.source.url.istio_requests_total</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">expr:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        sum(irate(istio_requests_total&#123;reporter=&quot;source&quot;&#125;[1m]))</span></span><br><span class="line"><span class="string">        by (</span></span><br><span class="line"><span class="string">          destination_app,</span></span><br><span class="line"><span class="string">          source_workload_namespace,</span></span><br><span class="line"><span class="string">          response_code,</span></span><br><span class="line"><span class="string">          source_app,</span></span><br><span class="line"><span class="string">          url</span></span><br><span class="line"><span class="string">        )</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå‚è€ƒäº† <a href="https://istio.io/latest/docs/reference/config/proxy_extensions/stats/#MetricConfig">MetricConfig</a> è‡ªå®šä¹‰äº† URL çš„tag.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;dimensions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;request.url_path&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/02/19/tERXzV3TI1oe7bJ.png"><br>ä½†è¿™ä¹Ÿæœ‰ä¸ªå¤§å‰æï¼Œå½“æˆ‘ä»¬ tag çš„æŒ‡æ ‡æ²¡æœ‰åœ¨é»˜è®¤ tag åˆ—è¡¨ä¸­æ—¶ï¼Œéœ€è¦åœ¨ Deployment æˆ–è€…æ˜¯ Istio æ§åˆ¶é¢ä¸­å…¨å±€åŠ å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ tag å£°æ˜ã€‚</p><p>æ¯”å¦‚è¿™é‡Œæ–°å¢äº† url çš„ tagï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨æ§åˆ¶é¢ä¸­åŠ å…¥ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meshConfig:</span></span><br><span class="line">  <span class="attr">defaultConfig:</span></span><br><span class="line">    <span class="attr">extraStatTags:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">url</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹äº†æ§åˆ¶é¢åéœ€è¦é‡æ–°æ„å»º Pod åæ‰ä¼šç”Ÿæ•ˆã€‚</p></blockquote><h2 id="EnvoyFilterçš„é—®é¢˜"><a href="#EnvoyFilterçš„é—®é¢˜" class="headerlink" title="EnvoyFilterçš„é—®é¢˜"></a>EnvoyFilterçš„é—®é¢˜</h2><p>æŸ¥çœ‹<a href="https://istio.io/latest/docs/reference/config/proxy_extensions/stats/#MetricConfig">MetricConfig</a>çš„é…ç½®åå‘ç°æ˜¯å¯ä»¥ç›´æ¥å»æ‰æŒ‡æ ‡ä»¥åŠå»æ‰æŒ‡æ ‡ä¸­çš„ tag ï¼Œè¿™ä¸ªå¾ˆæœ‰ç”¨ï¼Œèƒ½å¤Ÿå¤§å¤§å‡ä½æŒ‡æ ‡é‡‡é›†ç³»ç»Ÿ <code>VictoriaMetrics</code> çš„ç³»ç»Ÿè´Ÿè½½ã€‚</p><p>äºæ˜¯å‚è€ƒäº†å®˜æ–¹çš„ç¤ºä¾‹ï¼Œå»æ‰äº†ä¸€äº› tagï¼ŒåŒæ—¶è¿˜å»æ‰äº†æŒ‡æ ‡ï¼š<code>istio_request_messages_total</code>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      <span class="attr">&quot;tags_to_remove&quot;:</span> [</span><br><span class="line">        <span class="string">&quot;source_principal&quot;</span>,</span><br><span class="line">        <span class="string">&quot;source_version&quot;</span>,</span><br><span class="line">        <span class="string">&quot;destination_principal&quot;</span>,</span><br><span class="line">        <span class="string">&quot;destination_version&quot;</span>,</span><br><span class="line">        <span class="string">&quot;source_workload&quot;</span>,</span><br><span class="line">        <span class="string">&quot;source_cluster&quot;</span>,</span><br><span class="line">      ]</span><br><span class="line">&#125;<span class="string">,</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;name&quot;:</span> <span class="string">&quot;istio_request_messages_total&quot;</span>,</span><br><span class="line"><span class="attr">&quot;drop&quot;:</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œäºæ˜¯æ¢æˆäº†åœ¨ <code>v1.12</code> ä¸­æ–°å¢çš„ <code>Telemetry API</code>ã€‚</p><h1 id="ä½¿ç”¨-Telemetry-API"><a href="#ä½¿ç”¨-Telemetry-API" class="headerlink" title="ä½¿ç”¨ Telemetry API"></a>ä½¿ç”¨ Telemetry API</h1><p><img src="https://s2.loli.net/2023/02/19/bN4LiwQZm7rJHXW.png"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">telemetry.istio.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Telemetry</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mesh-istio-test</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">istio-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># no selector specified, applies to all workloads</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">overrides:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">            <span class="attr">metric:</span> <span class="string">GRPC_REQUEST_MESSAGES</span></span><br><span class="line">            <span class="attr">mode:</span> <span class="string">CLIENT_AND_SERVER</span></span><br><span class="line">          <span class="attr">disabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£åå‘ç°ä¾ç„¶ä¸èƒ½ç”Ÿæ•ˆï¼Œ<code>GRPC_REQUEST_MESSAGES</code> æ‰€å¯¹åº”çš„ <code>istio_request_messages_total</code> æŒ‡æ ‡ä¾ç„¶å­˜åœ¨ã€‚</p><p>æ¥ç€åœ¨æˆ‘é¢†å¯¼æŸ¥çœ‹ <code>Istio</code> æºç ä»¥åŠç›¸å…³ <a href="https://github.com/istio/istio/issues/37645">issue</a> åå‘ç° <code>Telemetry API</code> å’Œ <code>EnvoyFilter</code> æ˜¯ä¸èƒ½åŒæ—¶å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä¼˜å…ˆä½¿ç”¨ <code>EnvoyFilter</code>ï¼›è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¹‹å‰é…ç½®æ²¡æœ‰ç”Ÿæ•ˆçš„åŸå› ã€‚<br><img src="https://s2.loli.net/2023/02/19/M3uevVscNk5XOTd.png"></p><blockquote><p>ååˆå§‹åŒ– EnvoyFilter</p></blockquote><p><img src="https://s2.loli.net/2023/02/19/sbkrBdRwULSo9Yg.png"><br>æ­£å¦‚è¿™ä¸ª issue ä¸­æ‰€è¯´ï¼Œéœ€è¦åˆ æ‰ç°åœ¨æ‰€æœ‰çš„ EnvoyFilterï¼›åˆ é™¤åæœç„¶å°±ç”Ÿæ•ˆäº†ã€‚</p><p>æ–°çš„ <code>Telemetry API</code> ä¸ä½†è¯­ä¹‰æ›´åŠ æ¸…æ™°ï¼ŒåŠŸèƒ½ä¹Ÿä¸€æ ·æ²¡å°‘ï¼Œå€ŸåŠ©ä»–æˆ‘ä»¬ä¾ç„¶å¯ä»¥è‡ªå®šä¹‰ã€åˆ é™¤æŒ‡æ ‡ã€tag ç­‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">telemetry.istio.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Telemetry</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mesh-istio-telemetry-test</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">overrides:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">            <span class="attr">metric:</span> <span class="string">GRPC_RESPONSE_MESSAGES</span></span><br><span class="line">            <span class="attr">mode:</span> <span class="string">CLIENT_AND_SERVER</span></span><br><span class="line">          <span class="attr">disabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">tagOverrides:</span></span><br><span class="line">            <span class="attr">url:</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;request.url_path&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">            <span class="attr">metric:</span> <span class="string">ALL_METRICS</span></span><br><span class="line">          <span class="attr">tagOverrides:</span></span><br><span class="line">            <span class="attr">source_workload:</span></span><br><span class="line">              <span class="attr">operation:</span> <span class="string">REMOVE</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä»¥ä¸Šé…ç½®ä¾¿å¯ä»¥åˆ é™¤æ‰ <code>GRPC_RESPONSE_MESSAGES</code> æŒ‡æ ‡ï¼Œæ–°å¢ä¸€ä¸ª url çš„æŒ‡æ ‡ï¼ŒåŒæ—¶åœ¨æ‰€æœ‰æŒ‡æ ‡ä¸­åˆ é™¤äº† <code>source_workload</code> è¿™ä¸ª tagã€‚</p><p>å€ŸåŠ©äºè¿™ä¸€ä¸ªå£°æ˜æ–‡ä»¶ä¾¿èƒ½æ»¡è¶³æˆ‘ä»¬å¤šä¸ªéœ€æ±‚ã€‚</p><h2 id="è£å‰ªæŒ‡æ ‡"><a href="#è£å‰ªæŒ‡æ ‡" class="headerlink" title="è£å‰ªæŒ‡æ ‡"></a>è£å‰ªæŒ‡æ ‡</h2><p>åç»­æ ¹æ®æˆ‘ä»¬å®é™…éœ€æ±‚å€ŸåŠ©äº <code>Telemetry API</code> è£å‰ªæ‰äº†è®¸å¤šæŒ‡æ ‡å’Œ tagï¼Œä½¿å¾—æŒ‡æ ‡ç³»ç»Ÿè´Ÿè½½ä¸‹é™äº†ä¸€åŠå·¦å³ã€‚<br><img src="https://s2.loli.net/2023/02/19/rLqd3lUTgOK9RbS.png"><br>æ•ˆæœç›¸å½“æ˜æ˜¾ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ¬¡å®šä½ä¿®å¤ <code>Istio</code> å‡çº§åå¸¦æ¥çš„æŒ‡æ ‡ç³»ç»Ÿé—®é¢˜æ”¶è·å·¨å¤§ï¼Œä¹‹å‰å¯¹ Istio ä¸€ç›´åªåœç•™åœ¨ç†è®ºé˜¶æ®µï¼ŒåªçŸ¥é“ä»–å¯ä»¥å®ç°ä¼ ç»Ÿå¾®æœåŠ¡ä¸­å¯¹æ¥å£ç²’åº¦çš„æ§åˆ¶ï¼Œå®Œç¾å¼¥è¡¥äº† <code>k8s</code> åªæœ‰æœåŠ¡å±‚çº§çš„ç²—ç²’åº¦æ§åˆ¶ï¼›</p><p>è¿™ä¸¤å‘¨ä¸‹æ¥å¯¹ä¸€ä¸ªç°ä»£äº‘åŸç”Ÿç›‘æ§ç³»ç»Ÿä¹Ÿæœ‰äº†ç³»ç»Ÿçš„è®¤è¯†ï¼Œä» <code>App-&gt;Pod-&gt;sidecar-&gt;VictoriaMetrics(Prometheus)-&gt;Grafana</code> è¿™ä¸€å¥—æµç¨‹ä¸­æ¯ä¸ªç¯èŠ‚éƒ½å¯èƒ½ä¼šå‡ºé”™ï¼›</p><p>æ‰€ä»¥å­¦æ— æ­¢å¢ƒå§ï¼Œå¹¸å¥½å€ŸåŠ©å…¬å¸ä¸šåŠ¡åœºæ™¯åç»­è¿˜æœ‰æ›´å¤šæœºä¼šå‚ä¸å®è·µã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/02/19/FwgABGdDrhR4a3j.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´æˆ‘ä»¬å°† istio ç‰ˆæœ¬å‡çº§åˆ° 1.12 åå¯¼è‡´ç°æœ‰çš„åº”ç”¨ç›‘æ§æœ‰éƒ¨åˆ†æ•°æ®ä¸¢å¤±ï¼ˆé¡µé¢ä¸Šæ˜¾ç¤ºä¸å‡ºæ¥ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªæ˜¯åº”ç”¨åŸºç¡€ä¿¡æ¯ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;li&gt;å†ä¸€ä¸ªæ˜¯åº”ç”¨ JVM æ•°æ®ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å£ç»´åº¦çš„ç›‘æ§æ•°æ®ä¸¢å¤±ã€‚&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Istio" scheme="http://crossoverjie.top/categories/Istio/"/>
    
    
    <category term="K8s" scheme="http://crossoverjie.top/tags/K8s/"/>
    
    <category term="äº‘åŸç”Ÿ" scheme="http://crossoverjie.top/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
  </entry>
  
  <entry>
    <title>Pulsarè´Ÿè½½å‡è¡¡åŸç†åŠä¼˜åŒ–</title>
    <link href="http://crossoverjie.top/2023/02/07/pulsar/pulsar-load-banance/"/>
    <id>http://crossoverjie.top/2023/02/07/pulsar/pulsar-load-banance/</id>
    <published>2023-02-07T00:12:26.000Z</published>
    <updated>2023-02-07T01:38:09.189Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/02/04/d4NqxaoulEXnr5s.png"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰æ®µæ—¶é—´æˆ‘ä»¬åœ¨å‡çº§ Pulsar ç‰ˆæœ¬çš„æ—¶å€™å‘ç°å‡çº§åæœ€åä¸€ä¸ªèŠ‚ç‚¹å§‹ç»ˆæ²¡æœ‰æµé‡ã€‚<br><img src="https://s2.loli.net/2023/02/07/ZwQ7sfVhuzb4tyv.jpg"></p><blockquote><p>è™½ç„¶å¯¹ä¸šåŠ¡ä½¿ç”¨æ²¡æœ‰ä»»ä½•å½±å“ï¼Œä½†è´Ÿè½½ä¸å‡ä¼šå¯¼è‡´èµ„æºçš„æµªè´¹ã€‚</p></blockquote><p>å’ŒåŒäº‹æ²Ÿé€šåå¾—çŸ¥ä¹‹å‰çš„å‡çº§ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œæœ€ç»ˆè¿˜æ˜¯äººå·¥è°ƒç”¨ Pulsar çš„ <code>admin API</code> å®Œæˆçš„è´Ÿè½½å‡è¡¡ã€‚</p><p>è¿™ä¸ªé—®é¢˜æˆ‘å°è¯•åœ¨ Google å’Œ Pulsar ç¤¾åŒºéƒ½æ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼çš„ï¼Œä¸çŸ¥é“æ˜¯å¤§å®¶éƒ½æ²¡ç¢°åˆ°è¿˜æ˜¯å¾ˆå°‘å‡çº§é›†ç¾¤ã€‚</p><blockquote><p>æˆ‘ä¹‹å‰æ‰€åœ¨çš„å…¬å¸å°±æ˜¯ä¸€ä¸ªç‰ˆæœ¬èµ°åˆ°é»‘ğŸ˜‚</p></blockquote><span id="more"></span><h1 id="Pulsar-è´Ÿè½½å‡è¡¡åŸç†"><a href="#Pulsar-è´Ÿè½½å‡è¡¡åŸç†" class="headerlink" title="Pulsar è´Ÿè½½å‡è¡¡åŸç†"></a>Pulsar è´Ÿè½½å‡è¡¡åŸç†</h1><p>å½“ä¸€ä¸ªé›†ç¾¤å¯ä»¥æ°´å¹³æ‰©å±•åè´Ÿè½½å‡è¡¡å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œæ ¹æœ¬ç›®çš„æ˜¯ä¸ºäº†è®©æ¯ä¸ªæä¾›æœåŠ¡çš„èŠ‚ç‚¹éƒ½èƒ½å‡åŒ€çš„å¤„ç†è¯·æ±‚ï¼Œä¸ç„¶æ‰©å®¹å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚</p><p>åœ¨åˆ†æè¿™ä¸ªé—®é¢˜çš„åŸå› ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹ Pulsar è´Ÿè½½å‡è¡¡çš„å®ç°æ–¹æ¡ˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Enable load balancer</span><br><span class="line">loadBalancerEnabled=true</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ª broker çš„è¿™ä¸ªé…ç½®æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡å™¨çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯æ‰“å¼€ã€‚</p><p>ä½†å…·ä½“ä½¿ç”¨å“ªä¸ªå®ç°ç±»æ¥ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Name of load manager to use</span><br><span class="line">loadManagerClassName=org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl</span><br></pre></td></tr></table></figure><p>é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>ModularLoadManagerImpl</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> LoadManager <span class="title function_">create</span><span class="params">(<span class="keyword">final</span> PulsarService pulsar)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ServiceConfiguration</span> <span class="variable">conf</span> <span class="operator">=</span> pulsar.getConfiguration();</span><br><span class="line">        <span class="comment">// Assume there is a constructor with one argument of PulsarService.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">loadManagerInstance</span> <span class="operator">=</span> Reflections.createInstance(conf.getLoadManagerClassName(),</span><br><span class="line">                Thread.currentThread().getContextClassLoader());</span><br><span class="line">        <span class="keyword">if</span> (loadManagerInstance <span class="keyword">instanceof</span> LoadManager) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">LoadManager</span> <span class="variable">casted</span> <span class="operator">=</span> (LoadManager) loadManagerInstance;</span><br><span class="line">            casted.initialize(pulsar);</span><br><span class="line">            <span class="keyword">return</span> casted;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (loadManagerInstance <span class="keyword">instanceof</span> ModularLoadManager) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">LoadManager</span> <span class="variable">casted</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModularLoadManagerWrapper</span>((ModularLoadManager) loadManagerInstance);</span><br><span class="line">            casted.initialize(pulsar);</span><br><span class="line">            <span class="keyword">return</span> casted;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        LOG.warn(<span class="string">&quot;Error when trying to create load manager: &quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If we failed to create a load manager, default to SimpleLoadManagerImpl.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleLoadManagerImpl</span>(pulsar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ <code>broker</code> å¯åŠ¨æ—¶ä¼šä»é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®è¿›è¡ŒåŠ è½½ï¼Œå¦‚æœåŠ è½½å¤±è´¥ä¼šä½¿ç”¨ <code>SimpleLoadManagerImpl</code> ä½œä¸ºå…œåº•ç­–ç•¥ã€‚</p><p>å½“ broker æ˜¯ä¸€ä¸ªé›†ç¾¤æ—¶ï¼Œåªæœ‰ leader èŠ‚ç‚¹çš„ broker æ‰ä¼šæ‰§è¡Œè´Ÿè½½å‡è¡¡å™¨çš„é€»è¾‘ã€‚</p><blockquote><p>Leader é€‰ä¸¾æ˜¯é€šè¿‡ Zookeeper å®ç°çš„ã€‚</p></blockquote><p>é»˜ç„¶æƒ…å†µä¸‹æˆä¸º Leader èŠ‚ç‚¹çš„ broker ä¼šæ¯åˆ†é’Ÿè¯»å–å„ä¸ª broker çš„æ•°æ®æ¥åˆ¤æ–­æ˜¯å¦æœ‰èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜éœ€è¦åšé‡å¹³è¡¡ã€‚</p><p>è€Œæ˜¯å¦é‡å¹³è¡¡çš„åˆ¤æ–­ä¾æ®æ˜¯ç”± <code>org.apache.pulsar.broker.loadbalance.LoadSheddingStrategy</code> æ¥å£æä¾›çš„ï¼Œå®ƒå…¶å®åªæœ‰ä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoadSheddingStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Recommend that all of the returned bundles be unloaded.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A map from all selected bundles to the brokers on which they reside.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Multimap&lt;String, String&gt; <span class="title function_">findBundlesForUnloading</span><span class="params">(LoadData loadData, ServiceConfiguration conf)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æ‰€æœ‰ broker çš„è´Ÿè½½ä¿¡æ¯è®¡ç®—å‡ºä¸€ä¸ªéœ€è¦è¢« unload çš„ broker ä»¥åŠ bundleã€‚</p><p>è¿™é‡Œè§£é‡Šä¸‹ unload å’Œ bundle çš„æ¦‚å¿µï¼š</p><ul><li><code>bundle</code> æ˜¯ä¸€æ‰¹ <code>topic</code> çš„æŠ½è±¡ï¼Œå°† <code>bundle</code> å’Œ <code>broker</code> è¿›è¡Œå…³è”åå®¢æˆ·ç«¯æ‰èƒ½çŸ¥é“åº”å½“è¿æ¥å“ªä¸ª brokerï¼›è€Œä¸æ˜¯ç›´æ¥å°† topic ä¸ <code>broker</code> ç»‘å®šï¼Œè¿™æ ·æ‰èƒ½å®ç°æµ·é‡ topic çš„ç®¡ç†ã€‚</li><li>unload åˆ™æ˜¯å°†å·²ç»ä¸ broker ç»‘å®šçš„ bundle æ‰‹åŠ¨è§£ç»‘ï¼Œä»è€Œè§¦å‘è´Ÿè½½å‡è¡¡å™¨é€‰æ‹©ä¸€å°åˆé€‚çš„ broker é‡æ–°è¿›è¡Œç»‘å®šï¼›é€šå¸¸æ˜¯æ•´ä¸ªé›†ç¾¤è´Ÿè½½ä¸å‡çš„æ—¶å€™è§¦å‘ã€‚</li></ul><h2 id="ThresholdShedder-åŸç†"><a href="#ThresholdShedder-åŸç†" class="headerlink" title="ThresholdShedder åŸç†"></a>ThresholdShedder åŸç†</h2><p><code>LoadSheddingStrategy</code> æ¥å£ç›®å‰æœ‰ä¸‰ä¸ªå®ç°ï¼Œè¿™é‡Œä»¥å®˜æ–¹é»˜è®¤çš„ <code>ThresholdShedder</code> ä¸ºä¾‹ï¼š<br><img src="https://s2.loli.net/2023/02/07/9xqNPs31RtHOC2u.jpg"></p><p>å®ƒçš„å®ç°ç®—æ³•æ˜¯æ ¹æ®å¸¦å®½ã€å†…å­˜ã€æµé‡ç­‰å„ä¸ªæŒ‡æ ‡çš„æƒé‡ç®—å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½å€¼ï¼Œä¹‹åä¸ºæ•´ä¸ªé›†ç¾¤è®¡ç®—å‡ºä¸€ä¸ªå¹³å‡è´Ÿè½½å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># é˜ˆå€¼</span><br><span class="line">loadBalancerBrokerThresholdShedderPercentage=10</span><br></pre></td></tr></table></figure><p>å½“é›†ç¾¤ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹çš„è´Ÿè½½å€¼è¶…è¿‡å¹³å‡è´Ÿè½½å€¼è¾¾åˆ°ä¸€å®šç¨‹åº¦ï¼ˆå¯é…ç½®çš„é˜ˆå€¼ï¼‰æ—¶ï¼Œå°±ä¼šè§¦å‘ unloadï¼Œä»¥ä¸Šå›¾ä¸ºä¾‹å°±ä¼šå°†æœ€å·¦è¾¹èŠ‚ç‚¹ä¸­çº¢è‰²éƒ¨åˆ†çš„ bundle å¸è½½æ‰ï¼Œç„¶åå†é‡æ–°è®¡ç®—ä¸€ä¸ªåˆé€‚çš„ broker è¿›è¡Œç»‘å®šã€‚</p><blockquote><p>é˜ˆå€¼å­˜åœ¨çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…é¢‘ç¹çš„ unloadï¼Œä»è€Œå½±å“å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</p></blockquote><h2 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h2><p>å½“æŸäº› topic çš„æµé‡çªç„¶çˆ†å¢çš„æ—¶å€™è¿™ç§è´Ÿè½½ç­–ç•¥ç¡®å®å¯ä»¥å¤„ç†çš„å¾ˆå¥½ï¼Œä½†åœ¨æˆ‘ä»¬é›†ç¾¤å‡çº§çš„æƒ…å†µå°±ä¸ä¸€å®šäº†ã€‚</p><p>å‡è®¾æˆ‘è¿™é‡Œæœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼š</p><ul><li>broker0</li><li>broker1</li><li>broker2</li></ul><p><img src="https://s2.loli.net/2023/02/07/9fpusPqY8BmkGdl.png"><br>é›†ç¾¤å‡çº§æ—¶ä¼šä» <code>broker2-&gt;0</code> è¿›è¡Œé•œåƒæ›¿æ¢é‡å¯ï¼Œå‡è®¾åœ¨å‡çº§å‰æ¯ä¸ª broker çš„è´Ÿè½½å€¼éƒ½æ˜¯ 10ã€‚</p><ul><li>é‡å¯ broker2 æ—¶ï¼Œå®ƒæ‰€ç»‘å®šçš„ bundle è¢« broker0&#x2F;1 æ¥ç®¡ã€‚</li><li>å‡çº§ broker1 æ—¶ï¼Œå®ƒæ‰€ç»‘å®šçš„ bundle åˆè¢« broker0&#x2F;2 æ¥ç®¡ã€‚</li><li>æœ€åå‡çº§ broker0, å®ƒæ‰€ç»‘å®šçš„ bundle ä¼šè¢«broker1&#x2F;2 æ¥ç®¡ã€‚</li></ul><p>åªè¦åœ¨è¿™ä¹‹åæ²¡æœ‰å‘ç”Ÿæµé‡æ¿€å¢åˆ°è§¦å‘è´Ÿè½½çš„é˜ˆå€¼ï¼Œé‚£ä¹ˆå½“å‰çš„è´Ÿè½½æƒ…å†µå°±ä¼šä¸€ç›´ä¿ç•™ä¸‹å»ï¼Œä¹Ÿå°±æ˜¯ <code>broker0</code> ä¼šä¸€ç›´æ²¡æœ‰æµé‡ã€‚</p><p>ç»è¿‡æˆ‘åå¤æµ‹è¯•ï¼Œç°è±¡ä¹Ÿç¡®å®å¦‚æ­¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./pulsar-perf monitor-brokers --connect-string pulsar-test-zookeeper:2181</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/02/07/nDaOlsMprJ1hCwg.png"><br>é€šè¿‡è¿™ä¸ªå·¥å…·ä¹Ÿå¯ä»¥æŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½æƒ…å†µ</p><h1 id="ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h1><p>è¿™ç§åœºæ™¯æ˜¯å½“å‰ <code>ThresholdShedder</code> æ‰€æ²¡æœ‰è€ƒè™‘åˆ°çš„ï¼Œäºæ˜¯æˆ‘åœ¨æˆ‘ä»¬æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ 2.10.3 çš„åŸºç¡€ä¸Šåšäº†ç®€å•çš„ä¼˜åŒ–ï¼š<br><img src="https://s2.loli.net/2023/02/07/iRkm2FaBz4wtbG6.png"></p><ul><li>å½“åŸæœ‰é€»è¾‘èµ°å®Œä¹‹åä¹Ÿæ²¡æœ‰è·å–éœ€è¦éœ€è¦å¸è½½çš„ bundleï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨ä¸€ä¸ªè´Ÿè½½æä½çš„ broker æ—¶(<code>emptyBundle</code>)ï¼Œå†è§¦å‘ä¸€æ¬¡ bundle æŸ¥è¯¢ã€‚</li><li>æŒ‰ç…§ broker æ‰€ç»‘å®šçš„æ•°é‡æ’åºï¼Œé€‰æ‹©ä¸€ä¸ªæ•°é‡æœ€å¤šçš„ broker çš„ ç¬¬ä¸€ä¸ª bundle è¿›è¡Œå¸è½½ã€‚</li></ul><p>ä¿®æ”¹åæ‰“åŒ…å‘å¸ƒï¼Œå†èµ°ä¸€éå‡çº§æµç¨‹åæ•´ä¸ªé›†ç¾¤è´Ÿè½½å°±æ˜¯å‡è¡¡çš„äº†ã€‚<br><img src="https://s2.loli.net/2023/02/07/oCYzJBj7xavkLub.jpg"></p><p>ä½†å…¶å®è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸ä¸¥è°¨ï¼Œç¬¬äºŒæ­¥é€‰æ‹©çš„é‡ç‚¹æ˜¯ç­›é€‰å‡ºè´Ÿè½½æœ€é«˜çš„é›†ç¾¤ä¸­è´Ÿè½½æœ€é«˜çš„ bundleï¼›è¿™é‡Œåªæ˜¯ç®€å•çš„æ ¹æ®æ•°é‡æ¥åˆ¤æ–­ï¼Œå¹¶ä¸å¤Ÿå‡†ç¡®ã€‚</p><p>æ­£å½“æˆ‘å‡†å¤‡æŒç»­ä¼˜åŒ–æ—¶ï¼Œé¬¼ä½¿ç¥å·®çš„æˆ‘æƒ³çœ‹çœ‹ master ä¸Šæœ‰äººä¿®å¤è¿™ä¸ªé—®é¢˜æ²¡ï¼Œç»“æœä¸€çœ‹è¿˜çœŸæœ‰äººä¿®å¤äº†ï¼›åªæ˜¯è¿˜æ²¡æ­£å¼å‘ç‰ˆã€‚</p><p><a href="https://github.com/apache/pulsar/pull/17456">https://github.com/apache/pulsar/pull/17456</a></p><p><img src="https://s2.loli.net/2023/02/07/7TKxPv8BfblngRc.png"></p><p>æ•´ä½“æ€è·¯æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯ç­›é€‰è´Ÿè½½éœ€è¦å¸è½½ bundle æ—¶æ˜¯æ ¹æ® bundle è‡ªèº«çš„æµé‡æ¥çš„ï¼Œè¿™æ ·ä¼šæ›´åŠ ç²¾å‡†ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸è¿‡çœ‹ç¤¾åŒºçš„è¿›åº¦ç­‰è¿™ä¸ªä¼˜åŒ–æœ€ç»ˆèƒ½ç”¨è¿˜ä¸çŸ¥é“å¾—å¤šä¹…ï¼Œäºæ˜¯æˆ‘ä»¬å°±è‡ªå·±å‚è€ƒè¿™ä¸ªæ€è·¯åœ¨ç®¡ç†å°åšäº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå½“å‡çº§åå‡ºç°è´Ÿè½½ä¸å‡è¡¡æ—¶äººå·¥è§¦å‘ä¸€ä¸ªé€»è¾‘ï¼š</p><ul><li>ç³»ç»Ÿæ ¹æ®å„ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½æƒ…å†µè®¡ç®—å‡ºä¸€ä¸ªè´Ÿè½½æœ€é«˜çš„èŠ‚ç‚¹å’Œ bundle åœ¨é¡µé¢ä¸Šå±•ç¤ºã€‚</li><li>äººå·¥äºŒæ¬¡ç¡®è®¤æ˜¯å¦è¦å¸è½½ï¼Œç¡®è®¤æ— è¯¯åè¿›è¡Œå¸è½½ã€‚</li></ul><p>æœ¬è´¨ä¸Šåªæ˜¯å°†ä¸Šè¿°ä¼˜åŒ–çš„è‡ªåŠ¨è´Ÿè½½æµç¨‹æ”¹ä¸ºäººå·¥å¤„ç†äº†ï¼Œç»è¿‡æµ‹è¯•æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><p>Pulsar æ•´ä¸ªé¡¹ç›®å…¶å®éå¸¸åºå¤§ï¼Œæœ‰ç€å‡ åä¸Šç™¾ä¸ªæ¨¡å—ï¼Œå“ªæ€•æ¯æ¬¡æˆ‘åªæ”¹åŠ¨ä¸€è¡Œä»£ç å‡†å¤‡å‘å¸ƒæµ‹è¯•æ—¶éƒ½å¾—ç»è¿‡æ¼«é•¿çš„ç¼–è¯‘+ Dockeré•œåƒæ‰“åŒ…+ä¸Šä¼ ç§æœè¿™äº›æµç¨‹ï¼Œé€šå¸¸éœ€è¦1~2ä¸ªå°æ—¶ï¼›ä½†æ€»çš„æ¥è¯´æ”¶è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæœ€è¿‘ä¹Ÿåœ¨æä¸€äº› issue å’Œ PRï¼Œå¸Œæœ›åé¢èƒ½æ›´æ·±å…¥çš„å‚ä¸è¿›ç¤¾åŒºã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/02/04/d4NqxaoulEXnr5s.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´æˆ‘ä»¬åœ¨å‡çº§ Pulsar ç‰ˆæœ¬çš„æ—¶å€™å‘ç°å‡çº§åæœ€åä¸€ä¸ªèŠ‚ç‚¹å§‹ç»ˆæ²¡æœ‰æµé‡ã€‚&lt;br&gt;&lt;img src=&quot;https://s2.loli.net/2023/02/07/ZwQ7sfVhuzb4tyv.jpg&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è™½ç„¶å¯¹ä¸šåŠ¡ä½¿ç”¨æ²¡æœ‰ä»»ä½•å½±å“ï¼Œä½†è´Ÿè½½ä¸å‡ä¼šå¯¼è‡´èµ„æºçš„æµªè´¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å’ŒåŒäº‹æ²Ÿé€šåå¾—çŸ¥ä¹‹å‰çš„å‡çº§ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œæœ€ç»ˆè¿˜æ˜¯äººå·¥è°ƒç”¨ Pulsar çš„ &lt;code&gt;admin API&lt;/code&gt; å®Œæˆçš„è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜æˆ‘å°è¯•åœ¨ Google å’Œ Pulsar ç¤¾åŒºéƒ½æ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼çš„ï¼Œä¸çŸ¥é“æ˜¯å¤§å®¶éƒ½æ²¡ç¢°åˆ°è¿˜æ˜¯å¾ˆå°‘å‡çº§é›†ç¾¤ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä¹‹å‰æ‰€åœ¨çš„å…¬å¸å°±æ˜¯ä¸€ä¸ªç‰ˆæœ¬èµ°åˆ°é»‘ğŸ˜‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/categories/Pulsar/"/>
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="http://crossoverjie.top/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="è´Ÿè½½å‡è¡¡" scheme="http://crossoverjie.top/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    
  </entry>
  
  <entry>
    <title>2022 å¹´åº¦æ€»ç»“</title>
    <link href="http://crossoverjie.top/2023/01/18/annual-summary/2022/"/>
    <id>http://crossoverjie.top/2023/01/18/annual-summary/2022/</id>
    <published>2023-01-18T00:08:08.000Z</published>
    <updated>2023-01-17T13:00:54.832Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/01/17/C9tczrjDlwfVqvR.png"></p><p>ä¸€è½¬çœ¼ 2022 å¹´åˆè¿‡å»äº†ï¼Œä¸å¤šä¸å°‘è·ç¦»ä¸Šæ¬¡å†™å¹´ç»ˆæ€»ç»“è¿‡å»äº† 365 å¤©ï¼›ä»Šå¹´çš„è‰°éš¾æƒ…å†µæƒ³å¿…å¤§å®¶éƒ½äº²èº«ç»å†è¿‡äº†ï¼›å¦‚æœè¦ä¸¾è¡Œå–æƒ¨å¤§ä¼šçš„è¯ä»Šå¹´ä¹Ÿè®¸æˆ‘èƒ½æ’çš„ä¸Šå·ã€‚</p><span id="more"></span><h1 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h1><p>ä»Šå¹´å¯¹å¤§å®¶å½±å“æœ€å¤§çš„äº‹åº”è¯¥éƒ½æ˜¯ç–«æƒ…äº†ï¼Œåœ¨å¹´åº•çš„æœ€åå‡ å¤©å®¶é‡Œçš„è€äººè¿˜æ˜¯æ²¡é¡¶ä½ç–«æƒ…çš„å†²å‡»ç¦»å¼€äº†ï¼ŒåŸä»¥ä¸ºæˆå¹´åæˆ‘å·²ç»çœ‹æ·¡äº†ç”Ÿè€ç—…æ­»ï¼Œç›´åˆ°æˆ‘ç°åœ¨æ•²ä¸‹è¿™å‡ è¡Œå­—æ—¶æ‰å‘ç°è¿™ä¹ˆéš¾è¿‡ã€‚</p><p>æ‚²ä¼¤çš„äº‹æš‚ä¸”ä¸æï¼Œè¿˜æ˜¯èŠèŠä»Šå¹´ç”Ÿæ´»ä¸Šçš„å¥½äº‹å§ã€‚</p><h2 id="å¥èº«"><a href="#å¥èº«" class="headerlink" title="å¥èº«"></a>å¥èº«</h2><p>é¦–å…ˆæ˜¯å¥èº«è¿™ä¸ªæˆ‘å¿µå¨äº†å‡ å¹´çš„è¿åŠ¨ä»Šå¹´ç»ˆäºè¢«æˆ‘æä¸Šäº†è®®ç¨‹ã€‚</p><blockquote><p>æœ¬è´¨åŸå› æ˜¯è¯·äº†ç§æ•™ï¼Œæœç„¶æ˜¯èŠ±è‡ªå·±çš„é’±æ‰ä¼šå¿ƒç–¼ã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/01/17/ojP8sQXracSHM3u.png"><br><img src="https://s2.loli.net/2023/01/17/LWSkPHGEMf1R2UO.png"></p><p>ä½“é‡ä¹Ÿç”±å·…å³°çš„ 75kg é™åˆ°äº†66kg å·¦å³ã€‚<br><img src="https://s2.loli.net/2023/01/17/R38tM2FOocjHGxI.png"></p><iframe src="//player.bilibili.com/player.html?aid=685069016&bvid=BV1aU4y1X7Ya&cid=749168314&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><p>ä¸€æ®µè§†é¢‘ä¾¿èƒ½çœ‹å‡ºå·®è·ã€‚</p><h2 id="æ¸¸æˆ"><a href="#æ¸¸æˆ" class="headerlink" title="æ¸¸æˆ"></a>æ¸¸æˆ</h2><p>ä»Šå¹´ä¸è®°å¾—è¢«å“ªä¸ªè§†é¢‘å®‰åˆ©äº†å¾®è½¯çš„ XGP æœåŠ¡ï¼Œå†²åŠ¨ä¸‹å•äº† xboxï¼Œé¡ºé“é›†é½äº†å¾¡ä¸‰å®¶çš„å…¨å®¶æ¡¶ã€‚<br><img src="https://s2.loli.net/2023/01/17/DzUT7yHYm59iZ2R.jpg"></p><p>ä¸å¾—ä¸è¯´ XGP æœåŠ¡æ˜¯çœŸçš„é¦™ï¼Œæ¸¸æˆä¹Ÿå¾ˆå¤šï¼Œæˆ‘ç©çš„æœ€å¤šçš„å°±æ˜¯å…‰ç¯ã€åœ°å¹³çº¿5ã€å¥¥æ—¥è¿™å‡ æ¬¾æ¸¸æˆï¼›åŸä»¥ä¸º xbox åç»­ä¼šæˆä¸ºæˆ‘çš„ä¸»åŠ›æœºï¼Œç›´åˆ°å‡ ä¸ªæœˆåæˆ‘åœ¨ tb å¥¸å•†é‚£å„¿è´­ä¹°çš„ XGP æœåŠ¡è¢«å¾®è½¯é€€æ¬¾åæˆ‘å°±æ²¡æ€ä¹ˆç¢°äº†ã€‚</p><p>åé¢è€å¤´ç¯ä¸Šçº¿ï¼Œä¹Ÿæ˜¯æˆ‘å”¯ä¸€ä¸€æ¬¾èŠ±é’±è´­ä¹°çš„ xbox æ¸¸æˆï¼Œåœ¨è¢«è€å¤´ç¯æ‰æ‹§äº†å‡ å‘¨åæ‰‹æ®‹å…šä¹Ÿè¢«åŠé€€ï¼Œä¸€ç›´åˆ°ç°åœ¨ä¼°è®¡ä¸‰ä¸ªæœˆæ²¡å¼€è¿‡æœºäº†ã€‚</p><p>ä¸è¿‡æœ€è¿‘å€’è¿˜å–œæ¬¢ä¸Šç© Steam ä¸Šçš„ä¸€äº›ç‹¬ç«‹å°æ¸¸æˆï¼Œç‰¹åˆ«æ˜¯è‚‰é¸½ç±»å‹çš„ï¼Œæ¯”å¦‚è¿™ä¸ªâ€œå¸è¡€é¬¼å¹¸å­˜è€…â€ç©ç€çœŸçš„éå¸¸ä¸Šå¤´ã€‚</p><p><img src="https://s2.loli.net/2023/01/17/6Y7lmhtQRMy2TiU.png"></p><p>å½“ç„¶ä»Šå¹´æœ€æœŸå¾…ä¾ç„¶æ˜¯é‚£ä¸ªå¸¦æˆ‘å…¥ä¸»æœºå‘çš„â€œå¡å°”è¾¾ä¼ è¯´â€ï¼Œæ¨ä¸å¾—ç°åœ¨é©¬ä¸Šå¿«è¿›åˆ°5æœˆ12å·å‘å”®æ—¥ã€‚</p><h2 id="ä¸–ç•Œæ¯"><a href="#ä¸–ç•Œæ¯" class="headerlink" title="ä¸–ç•Œæ¯"></a>ä¸–ç•Œæ¯</h2><p>ä»Šå¹´è¿˜æœ‰ä»¶å¤§äº‹é‚£å°±æ˜¯ä¸–ç•Œæ¯çš„å¬å¼€ï¼ŒçœŸæ²¡æƒ³åˆ°æˆ‘è¿˜ä¼šå¯¹è¶³çƒè¿™ä¹ˆæ„Ÿå…´è¶£ï¼›å› ä¸ºå½“æ—¶æ˜¯å°æ§åœ¨å®¶è¿œç¨‹å·¥ä½œï¼Œæ‰€ä»¥æˆ‘å‡ ä¹æŠŠå‡Œæ™¨ä¸‰ç‚¹åœºçš„éƒ½çœ‹å®Œäº†ã€‚</p><p>é‚£æ®µæ—¶é—´å› ä¸ºç¦»èŒå¿ƒæƒ…è¿˜æ¯”è¾ƒ EMOï¼Œæ„Ÿè°¢ä¸–ç•Œæ¯å¸¦ç»™äº†æˆ‘ä¸€ä¸ªæœˆçš„å¿«ä¹æ—¶é—´ã€‚</p><p>å½“ç„¶ä¸å‡ºæ„å¤–çš„åœ¨ä¸–ç•Œæ¯æœŸé—´å‘ç”Ÿäº†æ„å¤–ã€‚</p><p><img src="https://s2.loli.net/2023/01/17/jUMOHidkxapyRbW.jpg"></p><p>å¤§åŠå¤œç¡å¾—å¥½å¥½çš„ï¼Œçœ¼ç›è¢«æˆ‘è€å©†çš„æ‰‹æŒ‡ç”²åˆ¨åˆ°äº†ï¼Œè¿å¤œèµ¶å¾€åŒ»é™¢ï¼Œæœ€åå°±æˆäº†â€œå¸¦åœŸâ€çš„ cos ä½é…ç‰ˆã€‚</p><h1 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h1><p>ç»å¸¸éƒ½æœ‰å¤§ä½¬è¯´ä¸‰å¹´æ˜¯åœ¨ä¸€å®¶å…¬å¸çš„æ•æ„Ÿæ—¶é—´ï¼Œå¦‚æœæ„Ÿè§‰ä¸åˆ°æå‡é‚£å°±éœ€è¦é€‚å½“çš„è·³å‡ºèˆ’é€‚åœˆï¼Œå…¶å®æˆ‘å‹æ ¹æ²¡è¿™ä¸ªæ‰“ç®—ï¼Œä½†ç”Ÿæ´»æ€»åœ¨ä½ æ²¡å‡†å¤‡å¥½çš„æ—¶å€™æ¨ä½ ä¸€æŠŠã€‚</p><p><img src="https://s2.loli.net/2023/01/17/3MGYFZ1fCvLsXBz.png"><br><img src="https://s2.loli.net/2023/01/17/qcZoD2Mr7YX1Ble.jpg"></p><p>ç”±äºä¸å¯æŠ—åŠ›å› ç´ ï¼Œæˆ‘è¿˜æ˜¯ç¦»å¼€äº†è¿™å®¶æˆ‘æœ‰ç”Ÿä»¥æ¥å‘†çš„æœ€å¼€å¿ƒçš„ä¸€å®¶å…¬å¸ï¼›è™½ç„¶æœ‰è®¸å¤šä¸èˆï¼Œä½†æ±Ÿæ¹–æ€»ä¼šç›¸è§ã€‚</p><p><img src="https://s2.loli.net/2023/01/17/ztTP1F9ChJ23AR8.png"><br><strong>è¿™ä¸æˆ‘å¾®ä¿¡é‡Œæœ€æ´»è·ƒçš„ä¾ç„¶è¿˜æ˜¯é‚£ä¸ªç¾¤ã€‚</strong></p><hr><p>åé¢æˆ‘èŠ±äº†ä¸€ä¸ªæœˆçš„æ—¶é—´æŠŠé‡åº†å¤§å¤§å°å°çš„å…¬å¸å‡ ä¹éƒ½çœ‹äº†ä¸€éï¼Œç”šè‡³è¿˜å·®ç‚¹å»æˆéƒ½å·¥ä½œäº†ï¼›æœ€åé˜´å·®é˜³é”™çš„æ¥åˆ°äº†ç°åœ¨çš„å…¬å¸åšæˆ‘ä¹‹å‰éå¸¸å‘å¾€çš„åŸºç¡€æ¶æ„+ä¸­é—´ä»¶ç ”å‘ï¼Œç›®å‰ä¹Ÿæ¯”è¾ƒæ»¡æ„ã€‚</p><blockquote><p>æ‰¾å·¥ä½œé‚£æ®µæ—¶é—´ä¹Ÿç¢°åˆ°è®¸å¤šæœ‰æ„æ€çš„å’Œç‹—è¡€çš„äº‹æƒ…ï¼Œå¹´åå•ç‹¬åˆ†äº«ã€‚</p></blockquote><h1 id="æŠ€èƒ½"><a href="#æŠ€èƒ½" class="headerlink" title="æŠ€èƒ½"></a>æŠ€èƒ½</h1><h2 id="GScript"><a href="#GScript" class="headerlink" title="GScript"></a><a href="https://github.com/crossoverJie/gscript">GScript</a></h2><p><img src="https://s2.loli.net/2023/01/17/9O4pzlC6T2ISKkA.png"></p><p>ä»Šå¹´ä¸ªäººæœ€æ»¡æ„çš„å°±æ˜¯æ¶è¡¥äº†ç¼–è¯‘åŸç†çš„çŸ¥è¯†ï¼Œé¡ºå¸¦è¿˜åšäº†ä¸€ä¸ª<a href="https://gscript.crossoverjie.top/">è„šæœ¬è¯­è¨€</a>ï¼›ç°åœ¨å·²ç»å¯ä»¥æ‹¿æ¥ç¼–å†™ç½‘ç«™äº†ï¼›ä¹Ÿç®—æ˜¯ä¸€ä¸ªå°ç›®æ ‡è¾¾æˆå§ã€‚</p><p>å›æƒ³èµ·å¼€å‘ gscript çš„é‚£æ®µæ—¶é—´ï¼ŒçœŸçš„æ˜¯æ²¡æ—¥æ²¡å¤œçš„å¹²ï¼Œæ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½å°±å¼€å¿ƒçš„é£èµ·ã€‚</p><h2 id="äº‘åŸç”Ÿ"><a href="#äº‘åŸç”Ÿ" class="headerlink" title="äº‘åŸç”Ÿ"></a>äº‘åŸç”Ÿ</h2><p><img src="https://s2.loli.net/2023/01/17/kHa4Demu15OiytE.png"><br>é™¤æ­¤ä¹‹å¤–åœ¨æ¥åˆ°ç°åœ¨è¿™å®¶å…¬å¸åæ¥è§¦äº†å¤§é‡ k8s ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œä¹Ÿç®—æ˜¯æŠŠä¹‹å‰å­¦åˆ°çš„ç†è®ºå®è·µä¸Šäº†ï¼›è¿™ä¸æ˜¨æ™šä¸Šæ‰åœ¨ç”Ÿäº§ç¯å¢ƒå‡çº§äº† Pulsarï¼Œè¿™ä¸ªæŠ€èƒ½æ ‘ç»ˆäºç‚¹äº®äº†ä¸€äº›å¶å­èŠ‚ç‚¹ã€‚</p><h2 id="åšå®¢"><a href="#åšå®¢" class="headerlink" title="åšå®¢"></a>åšå®¢</h2><p><img src="https://s2.loli.net/2023/01/17/q3CLIhWoM8yEtGY.png"><br><img src="https://s2.loli.net/2023/01/17/hSxHZDsEArRFow1.png"></p><p>ä»Šå¹´çš„æŠ€æœ¯åšå®¢äº§å‡ºå±…ç„¶ 23 ç¯‡ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯å’Œç¼–è¯‘åŸç†ç›¸å…³çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä¸€æ­¥æ­¥å­¦ä¹ ç¼–è¯‘åŸç†åˆ°å®ç°è„šæœ¬è¯­è¨€çš„è¿‡ç¨‹ã€‚</p><hr><p><img src="https://s2.loli.net/2023/01/17/mEPTMByJIAKaiwX.png"><br>åŒæ—¶ä»Šå¹´ä¹Ÿå…»æˆäº†æ¯æ—¥çœ‹ä¸€ç¯‡è‹±æ–‡åšå®¢çš„ä¹ æƒ¯ï¼ŒåšæŒäº†å‡ ä¸ªæœˆæ•ˆæœè¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼›æ¯”å¦‚ä»¥å‰æˆ‘éå¸¸æ’æ–¥çœ‹ä¸€äº›è‹±æ–‡èµ„æ–™ï¼Œè¦ä¹ˆé ä¸€é”®ç¿»è¯‘ï¼Œè¦ä¹ˆå°±ç›´æ¥åªçœ‹ä¸­æ–‡å†…å®¹ã€‚</p><p>ç°åœ¨å‡ ä¹æ²¡æœ‰è¿™ç§æ’æ–¥çš„æ„Ÿè§‰äº†ï¼Œå¤§éƒ¨åˆ†è‹±æ–‡å†…å®¹ä¹Ÿä¼šè€å¿ƒçš„é˜…è¯»å®Œï¼Œè¿™ç‚¹åœ¨æˆ‘è®¢é˜…äº† Pulsar çš„å¼€å‘ç»„é‚®ä»¶åè¶Šå‘æ˜æ˜¾ï¼Œæ˜æ˜¾çš„èƒ½å¤ŸçŸ¥é“ä»–ä»¬åœ¨è®²äº›ä»€ä¹ˆï¼Œè¿™ç‚¹ä¸æˆ‘å¤šå¹´å‰è®¢é˜… Dubbo ç¤¾åŒºé‚®ä»¶çš„æ„Ÿè§‰å®Œå…¨ä¸åŒã€‚</p><h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><p>ä»¥ä¸Šå°±æ˜¯æ•´å¹´çš„æµæ°´è´¦å¼çš„å›é¡¾ï¼Œåˆåˆ°äº†ç»å…¸çš„ä¿ç•™ç«‹ flag ç¯èŠ‚ã€‚</p><ul><li>é¦–å…ˆæ˜¯å¥èº«ä¿æŒï¼Œéƒ½è¯´å¥èº«æ˜¯æŒ‰å¹´ç®—çš„ï¼Œå¸Œæœ›åˆ°ä»Šå¹´å››æœˆä»½ä¸ºæœŸä¸€å¹´çš„æ—¶å€™èƒ½çœ‹åˆ°å¥èº«çš„ç—•è¿¹ã€‚</li><li>ä»Šå¹´å¥½æ­¹çš„å‡ºå»ç©ä¸€ç©ï¼Œæ¯”å¦‚æ¸¯æ¾³åœ°åŒºæˆ–æ˜¯æ—¥æœ¬ï¼Œå¿µå¨å‡ å¹´äº†ã€‚</li><li>å·¥ä½œæŠ€æœ¯ä¸Šèƒ½å¤Ÿå†æäº¤å‡ ä¸ª Pulsar çš„ PRï¼Œæœ€å¥½æ˜¯èƒ½èå…¥ç¤¾åŒºï¼›æ··ä¸ªè„¸ç†Ÿã€‚</li><li>äº‘åŸç”Ÿå’Œç¼–è¯‘åŸç†ç›¸å…³çš„ç»§ç»­å­¦èµ·æ¥ï¼Œä¸‹åŠå¹´æŠŠ GScript å®ç°ä¸ºç¼–å†™å‹è¯­è¨€ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/17/C9tczrjDlwfVqvR.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€è½¬çœ¼ 2022 å¹´åˆè¿‡å»äº†ï¼Œä¸å¤šä¸å°‘è·ç¦»ä¸Šæ¬¡å†™å¹´ç»ˆæ€»ç»“è¿‡å»äº† 365 å¤©ï¼›ä»Šå¹´çš„è‰°éš¾æƒ…å†µæƒ³å¿…å¤§å®¶éƒ½äº²èº«ç»å†è¿‡äº†ï¼›å¦‚æœè¦ä¸¾è¡Œå–æƒ¨å¤§ä¼šçš„è¯ä»Šå¹´ä¹Ÿè®¸æˆ‘èƒ½æ’çš„ä¸Šå·ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="annual-summary" scheme="http://crossoverjie.top/categories/annual-summary/"/>
    
    
  </entry>
  
  <entry>
    <title>Pulsarå‹æµ‹åŠä¼˜åŒ–</title>
    <link href="http://crossoverjie.top/2023/01/16/pulsar/pulsar-perf-test/"/>
    <id>http://crossoverjie.top/2023/01/16/pulsar/pulsar-perf-test/</id>
    <published>2023-01-16T00:12:26.000Z</published>
    <updated>2023-01-15T09:56:04.199Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/01/12/tpk3aXFYZ9BPJb8.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™æ®µæ—¶é—´åœ¨åš MQï¼ˆPulsarï¼‰ç›¸å…³çš„æ²»ç†å·¥ä½œï¼Œå…¶ä¸­ä¸€ä¸ªéƒ¨åˆ†å†…å®¹å…³äºæ¶ˆæ¯é˜Ÿåˆ—çš„å‡çº§ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä¸€é”®åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤ã€‚</li><li>è¿è¡Œä¸€æ‰¹æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æˆ‘ä»¬çº¿ä¸Šä½¿ç”¨åˆ°çš„åŠŸèƒ½ï¼Œå¹¶è¾“å‡ºæµ‹è¯•æŠ¥å‘Šã€‚</li><li>æ¨¡æ‹Ÿå‹æµ‹ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœã€‚</li></ul><p>æœ¬è´¨ç›®çš„å°±æ˜¯æƒ³ç›´åˆ°æ–°ç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­å’Œå‡çº§åå¯¹ç°æœ‰ä¸šåŠ¡æ˜¯å¦å­˜åœ¨å½±å“ã€‚</p><span id="more"></span><p>ä¸€é”®åˆ›å»ºé›†ç¾¤å’Œæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ¯”è¾ƒç®€å•ï¼Œåˆ©ç”¨äº† <code>helm</code> å’Œ <code>k8s client</code> çš„ SDK æŠŠæ•´ä¸ªæµç¨‹ä¸²èµ·æ¥å³å¯ã€‚</p><h1 id="å‹æµ‹"><a href="#å‹æµ‹" class="headerlink" title="å‹æµ‹"></a>å‹æµ‹</h1><p>å…¶å®ç¨å¾®éº»çƒ¦ä¸€ç‚¹çš„æ˜¯å‹æµ‹ï¼Œ<code>Pulsar</code> å®˜æ–¹æœ¬èº«æ˜¯æœ‰æä¾›ä¸€ä¸ªå‹æµ‹å·¥å…·ï¼›åªæ˜¯åŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒå•ä¸€ï¼Œåªèƒ½å¯¹æŸæ‰¹ topic æé™å‹æµ‹ï¼Œæœ€åè¾“å‡ºæµ‹è¯•æŠ¥å‘Šã€‚<br>æœ€åå‚è€ƒäº†å®˜æ–¹çš„å‹æµ‹æµç¨‹ï¼ŒåŠ å…¥äº†ä¸€äº›å®æ—¶ç›‘æ§æ•°æ®ï¼Œæ–¹ä¾¿åˆ†ææ•´ä¸ªå‹æµ‹è¿‡ç¨‹ä¸­æ€§èƒ½çš„å˜åŒ–ã€‚</p><h2 id="å®¢æˆ·ç«¯-timeout"><a href="#å®¢æˆ·ç«¯-timeout" class="headerlink" title="å®¢æˆ·ç«¯ timeout"></a>å®¢æˆ·ç«¯ timeout</h2><p>éšç€å‹æµ‹è¿‡ç¨‹ä¸­çš„å‹åŠ›å¢å¤§ï¼Œæ¯”å¦‚å‹æµ‹æ—¶é—´å’Œçº¿ç¨‹æ•°çš„æé«˜ï¼Œå®¢æˆ·ç«¯ä¼šæŠ›å‡ºå‘é€æ¶ˆæ¯ timeout å¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.apache.pulsar.client.api.PulsarClientException$TimeoutException: </span><br><span class="line">The producer pulsar-test-<span class="number">212</span>-<span class="number">20</span> can not send message to the topic persistent:<span class="comment">//my-tenant/my-ns/perf-topic-0 within given timeout : createdAt 82.964 seconds ago, firstSentAt 8.348 seconds ago, lastSentAt 8.348 seconds ago, retryCount 1</span></span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªå¼‚å¸¸åœ¨ç”Ÿäº§ä¸šåŠ¡ç¯å¢ƒçš„é«˜å³°æœŸå¶å°”ä¹Ÿå‡ºç°è¿‡ï¼Œè¿™ä¼šå¯¼è‡´ä¸šåŠ¡æ•°æ®çš„ä¸¢å¤±ï¼›æ‰€ä»¥æ­£å¥½è¿™æ¬¡è¢«æˆ‘å¤ç°å‡ºæ¥åæƒ³ç€åˆ†æä¸‹äº§ç”Ÿçš„åŸå› ä»¥åŠè§£å†³åŠæ³•ã€‚</p><h2 id="æºç åˆ†æå®¢æˆ·ç«¯"><a href="#æºç åˆ†æå®¢æˆ·ç«¯" class="headerlink" title="æºç åˆ†æå®¢æˆ·ç«¯"></a>æºç åˆ†æå®¢æˆ·ç«¯</h2><p>æ—¢ç„¶æ˜¯å®¢æˆ·ç«¯æŠ›å‡ºçš„å¼‚å¸¸æ‰€ä»¥å°±å…ˆçœ‹ä»å¼‚å¸¸ç‚¹å¼€å§‹çœ‹èµ·ï¼Œå…¶å®æ•´ä¸ªè¿‡ç¨‹å’Œäº§ç”Ÿçš„åŸå› å¹¶ä¸å¤æ‚ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://s2.loli.net/2023/01/15/UvNGXC3iz9DjT5k.png"></p><p>å®¢æˆ·ç«¯æµç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯ producer å‘é€æ¶ˆæ¯æ—¶å…ˆå°†æ¶ˆæ¯å‘å¾€æœ¬åœ°çš„ä¸€ä¸ª pending é˜Ÿåˆ—ã€‚</li><li>å¾… broker å¤„ç†å®Œï¼ˆå†™å…¥ bookkeeper) è¿”å› ACK æ—¶åˆ é™¤è¯¥ pending é˜Ÿåˆ—å¤´çš„æ¶ˆæ¯ã€‚</li><li>åå°å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸæ‰«æé˜Ÿåˆ—å¤´ï¼ˆå¤´éƒ¨çš„æ¶ˆæ¯æ˜¯æœ€åå†™å…¥çš„ï¼‰çš„æ¶ˆæ¯æ˜¯å¦å·²ç»è¿‡æœŸï¼ˆè¿‡æœŸæ—¶é—´å¯é…ç½®ï¼Œé»˜è®¤30s)ã€‚</li><li>å¦‚æœå·²ç»è¿‡æœŸï¼ˆå¤´éƒ¨æ¶ˆæ¯è¿‡æœŸï¼Œè¯´æ˜æ‰€æœ‰æ¶ˆæ¯éƒ½å·²è¿‡æœŸï¼‰åˆ™éå†é˜Ÿåˆ—å†…çš„æ¶ˆæ¯ä¾æ¬¡æŠ›å‡º <code>PulsarClientException$TimeoutException</code> å¼‚å¸¸ï¼Œæœ€åæ¸…ç©ºè¯¥é˜Ÿåˆ—ã€‚</li></ol><p>æœåŠ¡ç«¯ broker æµç¨‹ï¼š</p><ol><li>æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨ bookkeeper API å†™å…¥æ¶ˆæ¯ã€‚</li><li>å†™å…¥æ¶ˆæ¯æ—¶åŒæ—¶å†™å…¥å›è°ƒå‡½æ•°ã€‚</li><li>å†™å…¥æˆåŠŸåæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿™æ—¶ä¼šè®°å½•ä¸€æ¡æ¶ˆæ¯çš„å†™å…¥å»¶è¿Ÿï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯ ACKã€‚</li><li>é€šè¿‡ broker metric æŒ‡æ ‡ <code>pulsar_broker_publish_latency</code> å¯ä»¥è·å–å†™å…¥å»¶è¿Ÿã€‚</li></ol><p>ä»ä»¥ä¸Šæµç¨‹å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸åšå…œåº•æªæ–½åˆ™åœ¨ç¬¬å››æ­¥ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±ï¼Œè¿™ç±»æœ¬è´¨ä¸Šä¸ç®—æ˜¯ broker ä¸¢æ¶ˆæ¯ï¼Œè€Œæ˜¯å®¢æˆ·ç«¯è®¤ä¸ºå½“æ—¶ broker çš„å¤„ç†èƒ½åŠ›è¾¾åˆ°ä¸Šé™ï¼Œè€ƒè™‘åˆ°æ¶ˆæ¯çš„å®æ—¶æ€§ä»è€Œä¸¢å¼ƒäº†è¿˜æœªå‘é€çš„æ¶ˆæ¯ã€‚</p><h1 id="æ€§èƒ½åˆ†æ"><a href="#æ€§èƒ½åˆ†æ" class="headerlink" title="æ€§èƒ½åˆ†æ"></a>æ€§èƒ½åˆ†æ</h1><p>é€šè¿‡ä¸Šè¿°åˆ†æï¼Œç‰¹åˆ«æ˜¯ broker çš„å†™å…¥æµç¨‹å¾—çŸ¥ï¼Œæ•´ä¸ªå†™å…¥çš„ä¸»è¦æ“ä½œä¾¿æ˜¯å†™å…¥ bookkeeperï¼Œæ‰€ä»¥ bookkeeper çš„å†™å…¥æ€§èƒ½ä¾¿å…³ç³»åˆ°æ•´ä¸ªé›†ç¾¤çš„å†™å…¥æ€§èƒ½ã€‚</p><p>æç«¯æƒ…å†µä¸‹ï¼Œå‡è®¾ä¸è€ƒè™‘ç½‘ç»œçš„æŸè€—ï¼Œå¦‚æœ <code>bookkeeper</code> çš„å†™å…¥å»¶è¿Ÿæ˜¯ 0msï¼Œé‚£æ•´ä¸ªé›†ç¾¤çš„å†™å…¥æ€§èƒ½å‡ ä¹å°±æ˜¯æ— ä¸Šé™ï¼›æ‰€ä»¥æˆ‘ä»¬é‡ç‚¹çœ‹çœ‹åœ¨å‹æµ‹è¿‡ç¨‹ä¸­ <code>bookkeeper</code> çš„å„é¡¹æŒ‡æ ‡ã€‚</p><h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>é¦–å…ˆæ˜¯ CPUï¼š<br><img src="https://s2.loli.net/2023/01/15/Et5urHVQ2xhP6Ja.png"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°å‹æµ‹è¿‡ç¨‹ä¸­ CPU æ˜¯æœ‰æ˜æ˜¾å¢é«˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°å‹æµ‹è¿‡ç¨‹ä¸­ bookkeeper çš„ CPU å¤§éƒ¨åˆ†æŸè€—åœ¨å“ªé‡Œï¼Ÿ</p><p>è¿™é‡Œä¸å¾—ä¸å¹ä¸€æ³¢é˜¿é‡Œçš„ arthas å·¥å…·ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å¸®æˆ‘ä»¬ç”Ÿæˆç«ç„°å›¾ã€‚</p><p><img src="https://s2.loli.net/2023/01/15/QCUTiXjcYeHG3LV.png"></p><p>åˆ†æç«ç„°å›¾æœ€ç®€å•çš„ä¸€ä¸ªæ–¹æ³•ä¾¿æ˜¯æŸ¥çœ‹é¡¶éƒ¨æœ€å®½çš„å‡½æ•°æ˜¯å“ªä¸ªï¼Œå®ƒå¤§æ¦‚ç‡å°±æ˜¯æ€§èƒ½çš„ç“¶é¢ˆã€‚</p><p>åœ¨è¿™ä¸ªå›¾ä¸­çš„é¡¶éƒ¨å¹¶æ²¡æœ‰æ˜æ˜¾å¾ˆå®½çš„å‡½æ•°ï¼Œå¤§å®¶éƒ½å·®ä¸å¤šï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰æ˜æ˜¾æŸè€— CPU çš„å‡½æ•°ã€‚</p><p>æ­¤æ—¶åœ¨å€ŸåŠ©äº‘å‚å•†çš„ç›‘æ§å¾—çŸ¥å¹¶æ²¡æœ‰å¾—åˆ° CPU çš„ä¸Šé™ï¼ˆlimit é™åˆ¶ä¸º 8æ ¸ï¼‰ã€‚<br><img src="https://s2.loli.net/2023/01/15/8HAkq9ijQNdcFJX.png"></p><hr><p>ä½¿ç”¨ arthas è¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸ªå°å‘ï¼Œåœ¨ k8s ç¯å¢ƒä¸­æœ‰å¯èƒ½åº”ç”¨å¯åŠ¨åæ²¡æœ‰æˆåŠŸåœ¨ç£ç›˜å†™å…¥ pid ï¼Œå¯¼è‡´æŸ¥è¯¢ä¸åˆ° Java è¿›ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar arthas-boot.jar</span><br><span class="line">[INFO] arthas-boot version: <span class="number">3.6</span><span class="number">.7</span></span><br><span class="line">[INFO] Can not find java process. Try to pass &lt;pid&gt; in command line.</span><br><span class="line">Please select an available pid.</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯ä»¥ç›´æ¥ <code>ps</code> æ‹¿åˆ°è¿›ç¨‹ <code>ID</code>ï¼Œç„¶ååœ¨å¯åŠ¨çš„æ—¶å€™ç›´æ¥ä¼ å…¥ <code>pid</code> å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar arthas-boot.jar <span class="number">1</span></span><br></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹è¿™ä¸ª <code>pid</code> æ˜¯ 1ã€‚</p><h2 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h2><p>æ—¢ç„¶ CPU æ²¡æœ‰é—®é¢˜ï¼Œé‚£å°±å†çœ‹çœ‹ç£ç›˜æ˜¯ä¸æ˜¯ç“¶é¢ˆï¼›</p><p><img src="https://s2.loli.net/2023/01/15/PmMFyefXx23gDwC.png"></p><p>å¯ä»¥çœ‹åˆ°å‹æµ‹æ—¶çš„ IO ç­‰å¾…æ—¶é—´æ˜æ˜¾æ˜¯æ¯”æ—¥å¸¸è¯·æ±‚é«˜è®¸å¤šï¼Œä¸ºäº†æœ€ç»ˆç¡®è®¤æ˜¯å¦æ˜¯ç£ç›˜çš„é—®é¢˜ï¼Œå†å°†ç£ç›˜ç±»å‹æ¢ä¸º SSD è¿›è¡Œæµ‹è¯•ã€‚</p><p><img src="https://s2.loli.net/2023/01/15/pqnFjJH3zbRkxIV.png"><br>æœç„¶å³ä¾¿æ˜¯å‹æµ‹ï¼ŒSSDç£ç›˜çš„ IO ä¹Ÿæ¯”æ™®é€šç¡¬ç›˜çš„æ­£å¸¸è¯·æ±‚æœŸé—´å»¶è¿Ÿæ›´ä½ã€‚</p><p>æ—¢ç„¶ç£ç›˜ IO å»¶è¿Ÿé™ä½äº†ï¼Œæ ¹æ®å‰æ–‡çš„åˆ†æç†è®ºä¸Šæ•´ä¸ªé›†ç¾¤çš„æ€§èƒ½åº”è¯¥ä¼šæœ‰æ˜æ˜¾çš„ä¸Šå‡ï¼Œå› æ­¤å¯¹æ¯”äº†å‡çº§å‰åçš„æ¶ˆæ¯ TPS å†™å…¥æŒ‡æ ‡ï¼š</p><p><img src="https://s2.loli.net/2023/01/15/xofeW98vVnUzskY.png"></p><p>å‡çº§åæ¯ç§’çš„å†™å…¥é€Ÿç‡ç”± 40k æ¶¨åˆ° 80k å·¦å³ï¼Œå‡ ä¹æ˜¯ç¿»äº†ä¸€å€ï¼ˆæœç„¶ç”¨é’±æ˜¯æœ€å¿«è§£å†³é—®é¢˜çš„æ–¹å¼ï¼‰ï¼›</p><blockquote><p>ä½†å³ä¾¿æ˜¯è¿™æ ·ï¼Œæé™å‹æµ‹åä¾ç„¶ä¼šå‡ºç°å®¢æˆ·ç«¯ timeoutï¼Œè¿™æ˜¯å› ä¸ºæ— è®ºæ€ä¹ˆæé«˜æœåŠ¡ç«¯çš„å¤„ç†æ€§èƒ½ï¼Œä¾ç„¶æ²¡æ³•åšåˆ°æ²¡æœ‰å»¶è¿Ÿçš„å†™å…¥ï¼Œå„ä¸ªç¯èŠ‚éƒ½ä¼šæœ‰æŸè€—ã€‚</p></blockquote><h1 id="å‡çº§è¿‡ç¨‹ä¸­çš„-timeout"><a href="#å‡çº§è¿‡ç¨‹ä¸­çš„-timeout" class="headerlink" title="å‡çº§è¿‡ç¨‹ä¸­çš„ timeout"></a>å‡çº§è¿‡ç¨‹ä¸­çš„ timeout</h1><p>è¿˜æœ‰ä¸€ä¸ªå…³é”®çš„æ­¥éª¤å¿…é¡»è¦è¦†ç›–ï¼šæ¨¡æ‹Ÿç”Ÿäº§ç°åœºæœ‰ç€å¤§é‡çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¥å…¥æ”¶å‘æ¶ˆæ¯æ—¶è¿›è¡Œé›†ç¾¤å‡çº§ï¼Œå¯¹å®¢æˆ·ç«¯ä¸šåŠ¡çš„å½±å“ã€‚</p><p>æ ¹æ®å®˜æ–¹æ¨èçš„å‡çº§æ­¥éª¤ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>Upgrade Zookeeper.</li><li>Disable autorecovery.</li><li>Upgrade Bookkeeper.</li><li>Upgrade Broker.</li><li>Upgrade Proxy.</li><li>Enable autorecovery.</li></ul><p>å…¶ä¸­æœ€å…³é”®çš„æ˜¯å‡çº§ Broker å’Œ Proxyï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ˜¯å®¢æˆ·ç«¯ç›´æ¥äº¤äº’çš„ç»„ä»¶ã€‚</p><p>æœ¬è´¨ä¸Šå‡çº§çš„è¿‡ç¨‹å°±æ˜¯ä¼˜é›…åœæœºï¼Œç„¶åä½¿ç”¨æ–°ç‰ˆæœ¬çš„ docker å¯åŠ¨ï¼›æ‰€ä»¥å®¢æˆ·ç«¯ä¸€å®šä¼šæ„ŸçŸ¥åˆ° Broker ä¸‹çº¿åè¿›è¡Œé‡è¿ï¼Œå¦‚æœèƒ½å¿«é€Ÿè‡ªåŠ¨é‡è¿é‚£å¯¹å®¢æˆ·ç«¯å‡ ä¹æ²¡æœ‰å½±å“ã€‚</p><p><img src="https://s2.loli.net/2023/01/15/1WjaiXs24dTwZ3S.png"><br>åœ¨æˆ‘çš„æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œ2000å·¦å³çš„ producer ä»¥ 1k çš„å‘é€é€Ÿç‡è¿›è¡Œæ¶ˆæ¯å‘é€ï¼Œåœ¨ 30min å†…å®Œæˆæ‰€æœ‰ç»„ä»¶å‡çº§ï¼Œæ•´ä¸ªè¿‡ç¨‹å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¿«é€Ÿé‡è¿ï¼Œå¹¶ä¸ä¼šå‡ºç°å¼‚å¸¸ä»¥åŠæ¶ˆæ¯ä¸¢å¤±ã€‚</p><p>è€Œä¸€æ—¦å‘é€é¢‘ç‡å¢åŠ æ—¶ï¼Œåœ¨é‡å¯ Broker çš„è¿‡ç¨‹ä¸­ä¾¿ä¼šå‡ºç°ä¸Šæ–‡æåˆ°çš„ timeout å¼‚å¸¸ï¼›åˆæ­¥çœ‹èµ·æ¥æ˜¯åœ¨é»˜è®¤çš„ 30s æ—¶é—´å†…æ²¡æœ‰é‡è¿æˆåŠŸï¼Œå¯¼è‡´ç§¯å‹çš„æ¶ˆæ¯å·²ç»è¶…æ—¶ã€‚</p><p>ç»è¿‡åˆ†ææºç å‘ç°å…³é”®çš„æ­¥éª¤å¦‚ä¸‹ï¼š<br><img src="https://s2.loli.net/2023/01/15/V3lZeALxF7vhYHf.png"></p><p>å®¢æˆ·ç«¯åœ¨ä¸ Broker çš„é•¿è¿æ¥çŠ¶æ€æ–­å¼€åä¼šè‡ªåŠ¨é‡è¿ï¼Œè€Œé‡è¿åˆ°å…·ä½“å“ªå° Broker èŠ‚ç‚¹æ˜¯ç”± <code>LookUpService</code> å¤„ç†çš„ï¼Œå®ƒä¼šæ ¹æ®ä½¿ç”¨çš„ topic è·å–åˆ°å®ƒçš„å…ƒæ•°æ®ã€‚</p><blockquote><p>ç†è®ºä¸Šè¿™ä¸ªè¿‡ç¨‹å¦‚æœè¶³å¤Ÿå¿«ï¼Œå¯¹å®¢æˆ·ç«¯å°±ä¼šè¶Šæ— æ„Ÿã€‚</p></blockquote><p>åœ¨å…ƒæ•°æ®ä¸­åŒ…å«æœ‰è¯¥ topic æ‰€å±çš„ bundle æ‰€ç»‘å®šçš„  Broker çš„å…·ä½“ IP+ç«¯å£ï¼Œè¿™æ ·æ‰èƒ½é‡æ–°è¿æ¥ç„¶åå‘é€æ¶ˆæ¯ã€‚</p><blockquote><p>bundle æ˜¯ä¸€æ‰¹ topic çš„æŠ½è±¡ï¼Œç”¨æ¥å°†ä¸€æ‰¹ topic ä¸ Broker ç»‘å®šã€‚</p></blockquote><p>è€Œåœ¨ä¸€ä¸ª Broker åœæœºçš„æ—¶ä¼šè‡ªåŠ¨å¸è½½å®ƒæ‰€æœ‰çš„ bundleï¼Œå¹¶ç”±è´Ÿè½½å‡è¡¡å™¨è‡ªåŠ¨åˆ’åˆ†åˆ°åœ¨çº¿çš„ Broker ä¸­ï¼Œäº¤ç”±ä»–ä»¬å¤„ç†ã€‚</p><p>è¿™é‡Œä¼šæœ‰ä¸¤ç§æƒ…å†µé™ä½ LookUpSerive è·å–å…ƒæ•°æ®çš„é€Ÿåº¦ï¼š</p><p>å› ä¸ºæ‰€æœ‰çš„ Broker éƒ½æ˜¯ stateful æœ‰çŠ¶æ€èŠ‚ç‚¹ï¼Œæ‰€ä»¥å‡çº§æ—¶æ˜¯ä»æ–°çš„èŠ‚ç‚¹å¼€å§‹å‡çº§ï¼Œå‡è®¾æ˜¯<code>broker-5</code>ï¼Œå‡è®¾å‡çº§çš„é‚£ä¸ªèŠ‚ç‚¹çš„ bundle åˆ‡å¥½è¢«è½¬ç§» <code>broker-4</code>ä¸­ï¼Œå®¢æˆ·ç«¯æ­¤æ—¶ä¾¿ä¼šè‡ªåŠ¨é‡è¿åˆ° 4 è¿™ä¸ªBroker ä¸­ã€‚</p><p>æ­¤æ—¶å®¢æˆ·ç«¯æ­£åœ¨è®²å †ç§¯çš„æ¶ˆæ¯è¿›è¡Œé‡å‘ï¼Œè€Œä¸‹ä¸€ä¸ªå‡çº§çš„èŠ‚ç‚¹æ­£å¥½æ˜¯ 4ï¼Œé‚£å®¢æˆ·ç«¯åˆå¾—ç­‰å¾… bundle æˆåŠŸ unload åˆ°æ–°çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ°å¥½æ˜¯ 3 çš„è¯é‚£åˆå¾—å¥—å¨ƒäº†ï¼Œè¿™æ ·æ•´ä¸ªæ¶ˆæ¯çš„é‡å‘æµç¨‹å°±ä¼šè¢«æ‹‰é•¿ï¼Œç›´åˆ°è¶…è¿‡ç­‰å¾…æ—¶é—´ä¾¿ä¼šè¶…æ—¶ã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ bundle çš„æ•°é‡æ¯”è¾ƒå¤šï¼Œå¯¼è‡´ä¸Šé¢è®²åˆ°çš„ unload æ—¶æ›´æ–°å…ƒæ•°æ®åˆ° zookeeper çš„æ—¶é—´ä¹Ÿä¼šå¢åŠ ã€‚</p><blockquote><p>æ‰€ä»¥æˆ‘åœ¨è€ƒè™‘ Broker åœ¨å‡çº§è¿‡ç¨‹ä¸­æ—¶ï¼Œæ˜¯å¦å¯ä»¥å°† unload çš„ bundle ä¼˜å…ˆä¸ <code>Broker-0</code>è¿›è¡Œç»‘å®šï¼Œæœ€åå…¨éƒ¨å‡çº§æˆåŠŸåå†åšä¸€æ¬¡è´Ÿè½½å‡è¡¡ï¼Œå°½é‡å‡å°‘å®¢æˆ·ç«¯é‡è¿çš„æœºä¼šã€‚</p></blockquote><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>å¦‚æœæˆ‘ä»¬æƒ³è¦è§£å†³è¿™ä¸ª timeout çš„å¼‚å¸¸ï¼Œä¹Ÿæœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ¡ˆï¼š</p><ol><li>å°† bookkeeper çš„ç£ç›˜æ¢ä¸ºå†™å…¥æ—¶å»¶æ›´ä½çš„ SSDï¼Œæé«˜å•èŠ‚ç‚¹æ€§èƒ½ã€‚</li><li>å¢åŠ  bookkeeper èŠ‚ç‚¹ï¼Œä¸è¿‡ç”±äº bookkeeper æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ°´å¹³æ‰©å®¹èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”ä¸€æ—¦æ‰©å®¹å†æƒ³ç¼©å®¹ä¹Ÿæ¯”è¾ƒå›°éš¾ã€‚</li><li>å¢åŠ å®¢æˆ·ç«¯å†™å…¥çš„è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªå¯ä»¥é…ç½®ã€‚</li><li>å®¢æˆ·ç«¯åšå¥½å…œåº•æªæ–½ï¼Œæ•è·å¼‚å¸¸ã€è®°å½•æ—¥å¿—ã€æˆ–è€…å…¥åº“éƒ½å¯ä»¥ï¼Œåç»­è¿›è¡Œæ¶ˆæ¯é‡å‘ã€‚</li><li>ä¸º bookkeeper çš„å†™å…¥å»¶è¿Ÿå¢åŠ æŠ¥è­¦ã€‚</li><li>Spring å®˜æ–¹åˆšå‡ºç‚‰çš„ Pulsar-starter å·²ç»å†…ç½®äº† producer ç›¸å…³çš„ metricsï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å¯¹è¿™ä¸ªè¿›è¡Œç›‘æ§æŠ¥è­¦ã€‚</li></ol><p>ä»¥ä¸Šæœ€å¥½å®ç°çš„å°±æ˜¯ç¬¬å››æ­¥äº†ï¼Œæ•ˆæœå¥½æˆæœ¬ä½ï¼Œæ¨èè¿˜æ²¡æœ‰å®ç°çš„éƒ½å°½å¿« <code>try catch</code> èµ·æ¥ã€‚</p><p>æ•´ä¸ªæµ‹è¯•æµç¨‹è€—è´¹äº†æˆ‘ä¸€ä¸¤å‘¨çš„æ—¶é—´ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å…¨æ–¹ä½çš„å¯¹ä¸€æ¬¾ä¸­é—´ä»¶è¿›è¡Œæµ‹è¯•ï¼Œå…¶ä¸­ä¹Ÿå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼›ä¸ç®¡æ˜¯æºç è¿˜æ˜¯æ¶æ„éƒ½å¯¹ <code>Pulsar</code> æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/12/tpk3aXFYZ9BPJb8.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è¿™æ®µæ—¶é—´åœ¨åš MQï¼ˆPulsarï¼‰ç›¸å…³çš„æ²»ç†å·¥ä½œï¼Œå…¶ä¸­ä¸€ä¸ªéƒ¨åˆ†å†…å®¹å…³äºæ¶ˆæ¯é˜Ÿåˆ—çš„å‡çº§ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€é”®åˆ›å»ºä¸€ä¸ªæµ‹è¯•é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;è¿è¡Œä¸€æ‰¹æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æˆ‘ä»¬çº¿ä¸Šä½¿ç”¨åˆ°çš„åŠŸèƒ½ï¼Œå¹¶è¾“å‡ºæµ‹è¯•æŠ¥å‘Šã€‚&lt;/li&gt;
&lt;li&gt;æ¨¡æ‹Ÿå‹æµ‹ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬è´¨ç›®çš„å°±æ˜¯æƒ³ç›´åˆ°æ–°ç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­å’Œå‡çº§åå¯¹ç°æœ‰ä¸šåŠ¡æ˜¯å¦å­˜åœ¨å½±å“ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Pulsar" scheme="http://crossoverjie.top/categories/Pulsar/"/>
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="http://crossoverjie.top/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>æ¨¡æ¿æ–¹æ³•å®è·µ</title>
    <link href="http://crossoverjie.top/2022/12/27/desigin-patterns/template-method/"/>
    <id>http://crossoverjie.top/2022/12/27/desigin-patterns/template-method/</id>
    <published>2022-12-27T00:08:08.000Z</published>
    <updated>2023-01-12T06:36:40.276Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/01/12/TG3RQnjKDOc7vaF.png"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘ä¸å‡ºæ„å¤–çš„é˜³äº†ï¼ŒåŠ ä¸Šåˆšå…¥èŒæ–°å…¬å¸ä¸ä¹…ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æ€ä¹ˆæ›´æ–°ï¼›è¿™ä¸¤å¤©å¥½äº›ååˆ†äº«ä¸€ç¯‡å‰æ®µæ—¶é—´çš„ä¸€ä¸ªæ¡ˆä¾‹ï¼š</p><p>æœ€è¿‘åœ¨è®¾è®¡ä¸€ä¸ªå¯¹æŸä¸ªä¸­é—´ä»¶çš„æµ‹è¯•æ–¹æ¡ˆï¼Œè¿™ä¸ªæµ‹è¯•æ–¹æ¡ˆéœ€è¦åŒ…å«ä¸åŒçš„æµ‹è¯•é€»è¾‘ï¼Œä½†ç›¸åŒçš„æ˜¯éœ€è¦å¯¹å„ä¸ªç¯èŠ‚è¿›è¡Œè®°å½•ï¼›æ¯”å¦‚ç»Ÿè®¡è€—æ—¶ã€è°ƒç”¨é€šçŸ¥ API ç­‰ç›¸åŒçš„é€»è¾‘ã€‚</p><p>å¦‚æœæ¯ä¸ªæµ‹è¯•éƒ½å•ç‹¬å†™è¿™äº›é€»è¾‘é‚£æ— ç–‘æ˜¯åšäº†è®¸å¤šé‡å¤å·¥ä½œäº†ã€‚</p><span id="more"></span><p>åŸºäºä»¥ä¸Šçš„ç‰¹å¾å¾ˆå®¹æ˜“èƒ½æƒ³åˆ°<strong>æ¨¡æ¿æ–¹æ³•</strong>è¿™ä¸ªè®¾è®¡æ¨¡å¼ã€‚</p><p>è¿™æ˜¯ä¸€ç§æœ‰ä¸Šå±‚å®šä¹‰æ¡†æ¶ï¼Œä¸‹å±‚æä¾›ä¸åŒå®ç°çš„è®¾è®¡æ¨¡å¼ã€‚</p><p>æ¯”å¦‚è£…ä¿®æˆ¿å­çš„æ—¶å€™ä¸šä¸»å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½å¯¹ä¸åŒçš„æˆ¿é—´è¿›è¡Œè£…ä¿®ï¼Œä½†æ˜¯æ•´ä½“çš„æˆ·å‹å›¾ä¸èƒ½åšä¿®æ”¹ï¼Œæ¯”å¦‚æ‰¿é‡å¢™æ˜¯è‚¯å®šä¸èƒ½æ‰“çš„ã€‚</p><p>è€Œè¿™äº›å›ºå®šå¥½çš„æ¡æ¡æ¡†æ¡†å°±æ˜¯ä¸Šå±‚æ¡†æ¶ç»™çš„çº¦æŸï¼Œä¸‹å±‚ä¸åŒçš„å®ç°å°±æœ‰ä¸šä¸»è‡ªå·±å†³å®šï¼›æ‰€ä»¥å¯¹äºæ•´æ ‹æ¥¼æ¥è¯´æ¡†æ¶éƒ½æ˜¯å›ºå®šå¥½çš„ï¼Œè®©ä¸šä¸»åœ¨æœ‰é™çš„èŒƒå›´å†…è‡ªç”±å‘æŒ¥ä¹Ÿæ–¹ä¾¿ç‰©ä¸šçš„ç®¡ç†ã€‚</p><h1 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h1><p>ä»¥æˆ‘è¿™ä¸ªæ¡ˆä¾‹çš„èƒŒæ™¯ä¸ºä¾‹ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰å‡ºä¸Šå±‚æ¡†æ¶ï¼š</p><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p><code>Event</code> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Event</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addJob</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobName    ä»»åŠ¡åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> finishCost ä»»åŠ¡å®Œæˆè€—æ—¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">finishOne</span><span class="params">(String jobName, String finishCost)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**å•ä¸ªä»»åŠ¡æ‰§è¡Œå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobDefine ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">oneException</span><span class="params">(AbstractJobDefine jobDefine, Exception e)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">finishAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">    event.addJob();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="type">StopWatch</span> <span class="variable">watch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                watch.start(jobName);</span><br><span class="line">                <span class="comment">// ä¸åŒçš„å­ä¸šåŠ¡å®ç°</span></span><br><span class="line">                run(client);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                event.oneException(<span class="built_in">this</span>, e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                watch.stop();</span><br><span class="line">                event.finishOne(jobName, StrUtil.format(<span class="string">&quot;cost: &#123;&#125;s&quot;</span>, watch.getTotalTimeSeconds()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, TestCase.EXECUTOR).get(timeout, TimeUnit.SECONDS);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        event.oneException(<span class="built_in">this</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Run busy code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception e</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Client client)</span> <span class="keyword">throws</span> Exception;    </span><br></pre></td></tr></table></figure><p>å…¶ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯ run å‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡å‡½æ•°ï¼Œå…·ä½“å®ç°äº¤ç”±å­ç±»å®Œæˆï¼›è¿™æ ·ä¸åŒçš„æµ‹è¯•ç”¨ä¾‹ä¹‹é—´ä¹Ÿäº’ä¸å¹²æ‰°ï¼ŒåŒæ—¶æ•´ä½“çš„æµç¨‹å®Œå…¨ç›¸åŒï¼š</p><ul><li>è®°å½•ä»»åŠ¡æ•°é‡</li><li>ç»Ÿè®¡è€—æ—¶</li><li>å¼‚å¸¸è®°å½•</li></ul><p>ç­‰æµç¨‹ã€‚</p><hr><p>æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AbstractJobDefine</span> <span class="variable">job1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test1</span>(event, <span class="string">&quot;æµ‹è¯•1&quot;</span>, client, <span class="number">10</span>);</span><br><span class="line">CompletableFuture&lt;Void&gt; c1 = CompletableFuture.runAsync(job1::start, EXECUTOR);</span><br><span class="line"></span><br><span class="line"><span class="type">AbstractJobDefine</span> <span class="variable">job2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test2</span>(event, <span class="string">&quot;æµ‹è¯•2&quot;</span>, client, <span class="number">10</span>);</span><br><span class="line">CompletableFuture&lt;Void&gt; c2 = CompletableFuture.runAsync(job2::start, EXECUTOR);</span><br><span class="line"></span><br><span class="line"><span class="type">AbstractJobDefine</span> <span class="variable">job3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test3</span>(event, <span class="string">&quot;æµ‹è¯•3&quot;</span>, client, <span class="number">20</span>);</span><br><span class="line">CompletableFuture&lt;Void&gt; c3 = CompletableFuture.runAsync(job3::start, EXECUTOR);</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;Void&gt; all = CompletableFuture.allOf(c1, c2, c3);</span><br><span class="line">all.whenComplete((___, __) -&gt; &#123;</span><br><span class="line">    event.finishAll();</span><br><span class="line">    client.close();</span><br><span class="line">&#125;).get();</span><br></pre></td></tr></table></figure><p>æ˜¾è€Œæ˜“è§ <code>Test1~3</code> éƒ½ç»§æ‰¿äº† <code>AbstractJobDefine</code> åŒæ—¶å®ç°äº†å…¶ä¸­çš„ <code>run</code> å‡½æ•°ï¼Œä½¿ç”¨çš„æ—¶å€™åªéœ€è¦åˆ›å»ºä¸åŒçš„å®ä¾‹ç­‰å¾…ä»–ä»¬éƒ½æ‰§è¡Œå®Œæˆå³å¯ã€‚</p><p>ä»¥å‰åœ¨ Java ä¸­ä¹Ÿæœ‰ä¸åŒçš„åº”ç”¨ï¼š<br><img src="https://s2.loli.net/2023/01/12/dRl4DEIXj1BfNZ2.png"></p><p><a href="https://crossoverjie.top/2019/03/01/algorithm/consistent-hash/?highlight=%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95">https://crossoverjie.top/2019/03/01/algorithm/consistent-hash/?highlight=%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95</a></p><h2 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h2><p>åŒæ ·çš„ç¤ºä¾‹ç”¨ Go è‡ªç„¶ä¹Ÿå¯ä»¥å®ç°ï¼š</p><p><img src="https://s2.loli.net/2023/01/12/Eu6OUrb7jGtLozN.png"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestJobDefine_start</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">event := NewEvent()</span><br><span class="line">j1 := &amp;JobDefine&#123;</span><br><span class="line">Event:   event,</span><br><span class="line">Run:     &amp;run1&#123;&#125;,</span><br><span class="line">JobName: <span class="string">&quot;job1&quot;</span>,</span><br><span class="line">Param1:  <span class="string">&quot;p1&quot;</span>,</span><br><span class="line">Param2:  <span class="string">&quot;p2&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">j2 := &amp;JobDefine&#123;</span><br><span class="line">Event:   event,</span><br><span class="line">Run:     &amp;run2&#123;&#125;,</span><br><span class="line">JobName: <span class="string">&quot;job2&quot;</span>,</span><br><span class="line">Param1:  <span class="string">&quot;p11&quot;</span>,</span><br><span class="line">Param2:  <span class="string">&quot;p22&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">j1.Start()</span><br><span class="line">j2.Start()</span><br><span class="line"><span class="keyword">for</span> _, ch := <span class="keyword">range</span> event.GetChan() &#123;</span><br><span class="line">&lt;-ch</span><br><span class="line">&#125;</span><br><span class="line">log.Println(<span class="string">&quot;finish all&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *run2)</span></span> Run(param1, param2 <span class="type">string</span>) <span class="type">error</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;run3 param1:%s, param2:%s&quot;</span>, param1, param2)</span><br><span class="line">time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line"><span class="keyword">return</span> errors.New(<span class="string">&quot;test err&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *run1)</span></span> Run(param1, param2 <span class="type">string</span>) <span class="type">error</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;run1 param1:%s, param2:%s&quot;</span>, param1, param2)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨èµ·æ¥ä¹Ÿä¸ Java ç±»ä¼¼ï¼Œåˆ›å»ºä¸åŒçš„å®ä¾‹ï¼›æœ€åç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è®¾è®¡æ¨¡å¼å¾€å¾€æ˜¯å¯¹æŸäº›å…±æ€§èƒ½åŠ›çš„æŠ½è±¡ï¼Œä½†ä¹Ÿæ²¡æœ‰ä¸€ä¸ªè®¾è®¡æ¨¡å¼å¯ä»¥é€‚ç”¨äºæ‰€æœ‰çš„åœºæ™¯ï¼›éœ€è¦å¯¹ä¸åŒçš„éœ€æ±‚é€‰æ‹©ä¸åŒçš„è®¾è®¡æ¨¡å¼ã€‚</p><p>è‡³äºåœ¨å·¥ä½œä¸­å¦‚ä½•è¿›è¡Œæ­£ç¡®çš„é€‰æ‹©ï¼Œé‚£å°±éœ€è¦è‡ªå·±æ—¥å¸¸çš„ç§¯ç´¯äº†ï¼›æ¯”å¦‚å¤šå»äº†è§£ä¸åŒçš„è®¾è®¡æ¨¡å¼å¯¹äºçš„åœºæ™¯ï¼Œæˆ–è€…å¤šå»é˜…è¯»ä¼˜ç§€çš„ä»£ç ï¼ŒJava ä¸­çš„ <code>InputStream/Reader/Writer</code> è¿™ç±» IO ç›¸å…³çš„ç±»éƒ½æœ‰å…·ä½“çš„åº”ç”¨ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/12/TG3RQnjKDOc7vaF.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘ä¸å‡ºæ„å¤–çš„é˜³äº†ï¼ŒåŠ ä¸Šåˆšå…¥èŒæ–°å…¬å¸ä¸ä¹…ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æ€ä¹ˆæ›´æ–°ï¼›è¿™ä¸¤å¤©å¥½äº›ååˆ†äº«ä¸€ç¯‡å‰æ®µæ—¶é—´çš„ä¸€ä¸ªæ¡ˆä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;æœ€è¿‘åœ¨è®¾è®¡ä¸€ä¸ªå¯¹æŸä¸ªä¸­é—´ä»¶çš„æµ‹è¯•æ–¹æ¡ˆï¼Œè¿™ä¸ªæµ‹è¯•æ–¹æ¡ˆéœ€è¦åŒ…å«ä¸åŒçš„æµ‹è¯•é€»è¾‘ï¼Œä½†ç›¸åŒçš„æ˜¯éœ€è¦å¯¹å„ä¸ªç¯èŠ‚è¿›è¡Œè®°å½•ï¼›æ¯”å¦‚ç»Ÿè®¡è€—æ—¶ã€è°ƒç”¨é€šçŸ¥ API ç­‰ç›¸åŒçš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ¯ä¸ªæµ‹è¯•éƒ½å•ç‹¬å†™è¿™äº›é€»è¾‘é‚£æ— ç–‘æ˜¯åšäº†è®¸å¤šé‡å¤å·¥ä½œäº†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="http://crossoverjie.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="Java" scheme="http://crossoverjie.top/tags/Java/"/>
    
    <category term="Go" scheme="http://crossoverjie.top/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£é—­åŒ…å®ç°åŸç†</title>
    <link href="http://crossoverjie.top/2022/10/24/gscript/gscript11-closure/"/>
    <id>http://crossoverjie.top/2022/10/24/gscript/gscript11-closure/</id>
    <published>2022-10-24T00:08:09.000Z</published>
    <updated>2023-01-14T10:21:02.877Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/01/14/QnYTwcpIxEH5WOm.png"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é—­åŒ…å¯¹äºä¸€ä¸ªé•¿æœŸå†™ <code>Java</code> çš„å¼€å‘è€…æ¥è¯´ä¼°è®¡é²œæœ‰è€³é—»ï¼Œæˆ‘åœ¨å†™ <code>Python</code> å’Œ <code>Go</code> ä¹‹å‰ä¹Ÿæ˜¯æ²¡æ€ä¹ˆäº†è§£ï¼Œå…‰è¿™åå­—æ„Ÿè§‰å°±æœ‰ç‚¹â€ç¥ç§˜è«æµ‹â€ï¼Œè¿™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„å°±æ˜¯ä»ç¼–è¯‘å™¨çš„è§’åº¦æ¥åˆ†æé—­åŒ…ï¼Œå½»åº•ææ‡‚é—­åŒ…çš„å®ç°åŸç†ã€‚</p><span id="more"></span><h1 id="å‡½æ•°ä¸€ç­‰å…¬æ°‘"><a href="#å‡½æ•°ä¸€ç­‰å…¬æ°‘" class="headerlink" title="å‡½æ•°ä¸€ç­‰å…¬æ°‘"></a>å‡½æ•°ä¸€ç­‰å…¬æ°‘</h1><p>ä¸€é—¨è¯­è¨€åœ¨å®ç°é—­åŒ…ä¹‹å‰é¦–å…ˆè¦å…·æœ‰çš„ç‰¹æ€§å°±æ˜¯ï¼š<code>First class function</code> å‡½æ•°æ˜¯ç¬¬ä¸€å…¬æ°‘ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯å‡½æ•°å¯ä»¥åƒä¸€ä¸ªæ™®é€šçš„å€¼ä¸€æ ·åœ¨å‡½æ•°ä¸­ä¼ é€’ï¼Œä¹Ÿèƒ½å¯¹å˜é‡èµ‹å€¼ã€‚</p><p>å…ˆæ¥çœ‹çœ‹åœ¨ Go é‡Œæ˜¯å¦‚ä½•ç¼–å†™çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> varExternal <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">varInner := <span class="number">20</span></span><br><span class="line">innerFun := <span class="function"><span class="keyword">func</span><span class="params">(a <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">fmt.Println(a)</span><br><span class="line">varExternal++</span><br><span class="line">varInner++</span><br><span class="line"><span class="keyword">return</span> varInner</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> innerFun</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">varExternal = <span class="number">10</span></span><br><span class="line">f2 := f1()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;varInner=%d, varExternal=%d \n&quot;</span>, f2(i), varExternal)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;======&quot;</span>)</span><br><span class="line"></span><br><span class="line">f3 := f1()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;varInner=%d, varExternal=%d \n&quot;</span>, f3(i), varExternal)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">varInner=<span class="number">21</span>, varExternal=<span class="number">11</span> </span><br><span class="line"><span class="number">1</span></span><br><span class="line">varInner=<span class="number">22</span>, varExternal=<span class="number">12</span> </span><br><span class="line">======</span><br><span class="line"><span class="number">0</span></span><br><span class="line">varInner=<span class="number">21</span>, varExternal=<span class="number">13</span> </span><br><span class="line"><span class="number">1</span></span><br><span class="line">varInner=<span class="number">22</span>, varExternal=<span class="number">14</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½“ç°äº†é—­åŒ…çš„ä¸¤ä¸ªé‡è¦ç‰¹æ€§ï¼Œç¬¬ä¸€ä¸ªè‡ªç„¶å°±æ˜¯å‡½æ•°å¯ä»¥ä½œä¸ºå€¼è¿”å›ï¼ŒåŒæ—¶ä¹Ÿèƒ½èµ‹å€¼ç»™å˜é‡ã€‚</p><p>ç¬¬äºŒä¸ªå°±æ˜¯åœ¨é—­åŒ…å‡½æ•° <code>f1()</code> å¯¹é—­åŒ…å˜é‡ <code>varInner</code> çš„è®¿é—®ï¼Œæ¯ä¸ªé—­åŒ…å‡½æ•°çš„å¼•ç”¨éƒ½ä¼šåœ¨è‡ªå·±çš„å‡½æ•°å†…éƒ¨ä¿å­˜ä¸€ä»½é—­åŒ…å˜é‡ <code>varInner</code>ï¼Œè¿™æ ·åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å°±ä¸ä¼šäº’ç›¸å½±å“ã€‚</p><p>ä»æ‰“å°çš„ç»“æœä¸­ä¹Ÿèƒ½çœ‹å‡ºè¿™ä¸ªç‰¹æ€§ã€‚</p><h1 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h1><p>é—­åŒ…ä¹‹æ‰€ä»¥ä¸å¤ªå¥½ç†è§£çš„ä¸»è¦åŸå› æ˜¯å®ƒä¸å¤ªç¬¦åˆè‡ªè§‰ã€‚</p><p><img src="https://s2.loli.net/2023/01/14/FwMJpUvdPgyhCNY.png"></p><p>æœ¬è´¨ä¸Šå°±æ˜¯ä½œç”¨åŸŸçš„å…³ç³»ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>f1()</code> å‡½æ•°çš„æ—¶å€™ï¼Œä¼šåœ¨æ ˆä¸­åˆ†é…å˜é‡ <code>varInner</code>ï¼Œæ­£å¸¸æƒ…å†µä¸‹è°ƒç”¨å®Œæ¯•å <code>f1</code> çš„æ ˆä¼šå¼¹å‡ºï¼Œé‡Œé¢çš„å˜é‡ <code>varInner</code> è‡ªç„¶ä¹Ÿä¼šé”€æ¯æ‰å¯¹ã€‚</p><p>ä½†åœ¨åç»­çš„ <code>f2()</code> å’Œ <code>f3()</code> è°ƒç”¨çš„æ—¶ï¼Œå´ä¾ç„¶èƒ½è®¿é—®åˆ° <code>varInner</code>ï¼Œå°±è¿™ç‚¹ä¸ç¬¦åˆæˆ‘ä»¬å¯¹å‡½æ•°è°ƒç”¨çš„ç›´è§‰ã€‚</p><p>ä½†å…¶å®æ¢ä¸ªè§’åº¦æ¥çœ‹ï¼Œå¯¹ <code>innerFun</code> æ¥è¯´ï¼Œä»–èƒ½è®¿é—®åˆ° <code>varExternal</code> å’Œ <code>varInner</code> å˜é‡ï¼Œæœ€å¤–å±‚çš„ <code>varExternal</code> å°±ä¸ç”¨è¯´äº†ï¼Œä¸€å®šæ˜¯å¯ä»¥è®¿é—®çš„ã€‚</p><p>ä½†å¯¹äº <code>varInner</code> æ¥è¯´å°±ä¸ä¸€å®šäº†ï¼Œè¿™é‡Œå¾—åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼›é‡ç‚¹å¾—çœ‹è¯¥è¯­è¨€æ˜¯<strong>é™æ€&#x2F;åŠ¨æ€</strong>ä½œç”¨åŸŸã€‚</p><p>å°±é™æ€ä½œç”¨åŸŸæ¥è¯´ï¼Œæ¯ä¸ªç¬¦å·åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šå¥½äº†æ ‘çŠ¶å…³ç³»ï¼Œè¿è¡Œæ—¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼›ä¹Ÿå°±æ˜¯è¯´ <code>varInner</code> å¯¹äº <code>innerFun</code> è¿™ä¸ªå‡½æ•°æ¥è¯´åœ¨ç¼–è¯‘æœŸå·²ç»ç¡®å®šå¯ä»¥è®¿é—®äº†ï¼Œåœ¨è¿è¡Œæ—¶è‡ªç„¶ä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„ã€‚</p><p>ä½†å¯¹äºåŠ¨æ€ä½œç”¨åŸŸæ¥è¯´ï¼Œå®Œå…¨æ˜¯åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šè®¿é—®çš„å˜é‡æ˜¯å“ªä¸€ä¸ªã€‚</p><p>æ°å¥½ <code>Go</code> å°±æ˜¯ä¸€ä¸ªé™æ€ä½œç”¨åŸŸçš„è¯­è¨€ï¼Œæ‰€ä»¥è¿”å›çš„ <code>innerFun</code> å‡½æ•°å¯ä»¥ä¸€ç›´è®¿é—®åˆ° <code>varInner</code> å˜é‡ã€‚</p><h1 id="å®ç°é—­åŒ…"><a href="#å®ç°é—­åŒ…" class="headerlink" title="å®ç°é—­åŒ…"></a>å®ç°é—­åŒ…</h1><p>ä½† Go æ˜¯å¦‚ä½•åšåˆ°åœ¨ <code>f1()</code> å‡½æ•°é€€å‡ºä¹‹åä¾ç„¶èƒ½è®¿é—®åˆ° <code>f1()</code> ä¸­çš„å˜é‡å‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬ä¸å¦¨å¤§èƒ†å‡è®¾ä¸€ä¸‹ï¼š</p><p>é¦–å…ˆåœ¨ç¼–è¯‘æœŸæ‰«æå‡ºå“ªäº›æ˜¯é—­åŒ…å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ <code>varInner</code>ï¼Œéœ€è¦å°†ä»–ä¿å­˜åˆ°å‡½æ•° <code>innerFun()</code> ä¸­ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f2 := f1()</span><br><span class="line">f2()</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ—¶éœ€è¦åˆ¤æ–­å‡º <code>f2</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼ŒåŒæ—¶å¾—çŸ¥é“å®ƒæ‰€åŒ…å«çš„å‡½æ•°ä½“æ˜¯ <code>innerFun()</code> æ‰€å®šä¹‰çš„ã€‚</p><p>æ¥ç€ä¾¿æ˜¯æ‰§è¡Œå‡½æ•°ä½“çš„ <code>statement</code> å³å¯ã€‚</p><p>è€Œå½“ <code>f3 := f1()</code> é‡æ–°èµ‹å€¼ç»™ <code>f3</code> æ—¶ï¼Œåœ¨ <code>f2</code> ä¸­ç´¯åŠ çš„ <code>varInner</code> å˜é‡å°†ä¸ä¼šå½±å“åˆ° <code>f3</code>ï¼Œè¿™å°±å¾—éœ€è¦åœ¨ç»™ <code>f3</code> èµ‹å€¼çš„é‡æ–°èµ‹å€¼ä¸€ä»½é—­åŒ…å˜é‡åˆ°  <code>f3</code> ä¸­ï¼Œè¿™æ ·ä¾¿èƒ½è¾¾åˆ°äº’ä¸å½±å“çš„æ•ˆæœã€‚</p><h2 id="é—­åŒ…æ‰«æ"><a href="#é—­åŒ…æ‰«æ" class="headerlink" title="é—­åŒ…æ‰«æ"></a>é—­åŒ…æ‰«æ</h2><p><code>GScript</code> æœ¬èº«ä¹Ÿæ˜¯æ”¯æŒé—­åŒ…çš„ï¼Œæ‰€ä»¥æŠŠ Go çš„ä»£ç ç¿»è¯‘è¿‡æ¥ä¾¿é•¿è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">varExternal</span> <span class="operator">=</span><span class="number">10</span>;</span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f1()&#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">varInner</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">innerFun</span><span class="params">(<span class="type">int</span> a)</span>&#123;</span><br><span class="line">println(a);</span><br><span class="line"><span class="type">int</span> c=<span class="number">100</span>;</span><br><span class="line">varExternal++;</span><br><span class="line">varInner++;</span><br><span class="line"><span class="keyword">return</span> varInner;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> innerFun;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f2 = f1();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)&#123;</span><br><span class="line">println(<span class="string">&quot;varInner=&quot;</span> + f2(i) + <span class="string">&quot;, varExternal=&quot;</span> + varExternal);</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;=======&quot;</span>);</span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f3 = f1();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)&#123;</span><br><span class="line">println(<span class="string">&quot;varInner=&quot;</span> + f3(i) + <span class="string">&quot;, varExternal=&quot;</span> + varExternal);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">varInner=<span class="number">21</span>, varExternal=<span class="number">11</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">varInner=<span class="number">22</span>, varExternal=<span class="number">12</span></span><br><span class="line">=======</span><br><span class="line"><span class="number">0</span></span><br><span class="line">varInner=<span class="number">21</span>, varExternal=<span class="number">13</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">varInner=<span class="number">22</span>, varExternal=<span class="number">14</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœå’Œ Go çš„ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹ <code>GScript</code> æ˜¯å¦‚ä½•å®ç°çš„ä¾¿ä¹Ÿèƒ½ç†è§£ Go çš„åŸç†äº†ã€‚</p><hr><p>å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€æ­¥æ‰«æé—­åŒ…å˜é‡ï¼š<br><img src="https://s2.loli.net/2023/01/14/uMxlDhkrs1g9zoT.png"></p><p><code>allVariable := c.allVariable(function)</code><br>æŸ¥è¯¢æ‰€æœ‰çš„å˜é‡ï¼ŒåŒ…æ‹¬çˆ¶ <code>scope</code> çš„å˜é‡ã€‚</p><p><code>scopeVariable := c.currentScopeVariable(function)</code><br>æŸ¥è¯¢å½“å‰ <code>scope</code> åŒ…å«ä¸‹çº§æ‰€æœ‰ <code>scope</code> ä¸­çš„å˜é‡ï¼Œè¿™æ ·ä¸€å‡ä¹‹åå°±èƒ½çŸ¥é“é—­åŒ…å˜é‡äº†ï¼Œç„¶åå°†æ‰€æœ‰çš„é—­åŒ…å˜é‡å­˜æ”¾è¿›é—­åŒ…å‡½æ•°ä¸­ã€‚</p><h2 id="é—­åŒ…èµ‹å€¼"><a href="#é—­åŒ…èµ‹å€¼" class="headerlink" title="é—­åŒ…èµ‹å€¼"></a>é—­åŒ…èµ‹å€¼</h2><p><img src="https://s2.loli.net/2023/01/14/tLBOHCpdwfYj7DX.png"><br>ä¹‹ååœ¨ <code>return innerFun</code> å¤„ï¼Œå°†é—­åŒ…å˜é‡çš„æ•°æ®èµ‹å€¼åˆ°å˜é‡ä¸­ã€‚</p><p><img src="https://s2.loli.net/2023/01/14/2jf6kYVHXBvbmNo.png"></p><h2 id="é—­åŒ…å‡½æ•°è°ƒç”¨"><a href="#é—­åŒ…å‡½æ•°è°ƒç”¨" class="headerlink" title="é—­åŒ…å‡½æ•°è°ƒç”¨"></a>é—­åŒ…å‡½æ•°è°ƒç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f2 = f1();</span><br><span class="line"></span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f3 = f1();</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæ¯ä¸€æ¬¡èµ‹å€¼æ—¶ï¼Œéƒ½ä¼šæŠŠ <code>f1()</code> è¿”å›å‡½æ•°å¤åˆ¶åˆ°å˜é‡ <code>f2/f3</code> ä¸­ï¼Œè¿™æ ·ä¸¤è€…æ‰€åŒ…å«çš„é—­åŒ…å˜é‡å°±ä¸ä¼šäº’ç›¸å½±å“ã€‚</p><hr><p><img src="https://s2.loli.net/2023/01/14/OmlVzJLASZpEP73.png"><br>åœ¨è°ƒç”¨å‡½æ•°å˜é‡æ—¶ï¼Œåˆ¤æ–­åˆ°è¯¥å˜é‡æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ç›´æ¥è¿”å›å‡½æ•°ã€‚</p><p>ä¹‹åç›´æ¥è°ƒç”¨è¯¥å‡½æ•°å³å¯ã€‚</p><h2 id="å‡½æ•°å¼ç¼–ç¨‹"><a href="#å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹"></a>å‡½æ•°å¼ç¼–ç¨‹</h2><p>æ¥ä¸‹æ¥ä¾¿å¯ä»¥åˆ©ç”¨ <code>First class function</code> æ¥è¯•è¯•å‡½æ•°å¼ç¼–ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line"><span class="type">int</span> value=<span class="number">0</span>;</span><br><span class="line">Test(<span class="type">int</span> v)&#123;</span><br><span class="line">value=v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">map</span><span class="params">(func <span class="type">int</span>(<span class="type">int</span>)</span> f)&#123;</span><br><span class="line"><span class="keyword">return</span> f(value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">square</span><span class="params">(<span class="type">int</span> v)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> v*v; </span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> v)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> v++; </span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">add2</span><span class="params">(<span class="type">int</span> v)</span>&#123;</span><br><span class="line">v=v+<span class="number">2</span>;</span><br><span class="line"><span class="keyword">return</span> v; </span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span>Test(<span class="number">100</span>);</span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> s= square;</span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> a= add;</span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> a2= add2;</span><br><span class="line">println(t.map(s));</span><br><span class="line">assertEqual(t.map(s),<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">println(t.map(a));</span><br><span class="line">assertEqual(t.map(a),<span class="number">101</span>);</span><br><span class="line"></span><br><span class="line">println(t.map(a2));</span><br><span class="line">assertEqual(t.map(a2),<span class="number">102</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼äº Java ä¸­æµçš„ map å‡½æ•°ï¼Œå°†å‡½æ•°ä½œä¸ºå€¼ä¼ é€’è¿›å»ï¼Œåç»­æ”¯æŒåŒ¿åå‡½æ•°åä¼šæ›´åƒæ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Œç°åœ¨å¿…é¡»å¾—å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°å˜é‡å†è¿›è¡Œä¼ é€’ã€‚</p><hr><p>é™¤æ­¤ä¹‹å¤–åœ¨ <code>GScript</code> ä¸­çš„ <code>http</code> æ ‡å‡†åº“ä¹Ÿåˆ©ç”¨äº†å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘çš„ç‰¹æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ‡å‡†åº“ï¼šBind route</span></span><br><span class="line">httpHandle(string method, string path, func (HttpContext) handle)&#123;</span><br><span class="line">    <span class="type">HttpContext</span> <span class="variable">ctx</span> <span class="operator">=</span> HttpContext();</span><br><span class="line">    handle(ctx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç»‘å®šè·¯ç”±æ—¶ï¼Œ<code>handle</code> ä¾¿æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨çš„æ—¶å€™ç›´æ¥ä¼ é€’ä¸šåŠ¡é€»è¾‘çš„ <code>handle</code> å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func (HttpContext) handle (HttpContext ctx)&#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> Person();</span><br><span class="line">    p.name = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    println(<span class="string">&quot;p.name=&quot;</span> + p.name);</span><br><span class="line">    println(<span class="string">&quot;ctx=&quot;</span> + ctx);</span><br><span class="line">    ctx.JSON(<span class="number">200</span>, p);</span><br><span class="line">&#125;</span><br><span class="line">httpHandle(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;/p&quot;</span>, handle);</span><br></pre></td></tr></table></figure><hr><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»çš„æ¥è¯´é—­åŒ…å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>å‡½æ•°éœ€è¦ä½œä¸ºä¸€ç­‰å…¬æ°‘ã€‚</li><li>ç¼–è¯‘æœŸæ‰«æå‡ºæ‰€æœ‰çš„é—­åŒ…å˜é‡ã€‚</li><li>åœ¨è¿”å›é—­åŒ…å‡½æ•°æ—¶ï¼Œä¸ºé—­åŒ…å˜é‡èµ‹å€¼ã€‚</li><li>æ¯æ¬¡åˆ›å»ºæ–°çš„å‡½æ•°å˜é‡æ—¶ï¼Œéœ€è¦å°†é—­åŒ…æ•°æ®å¤åˆ¶è¿›å»ï¼Œè¿™æ ·é—­åŒ…å˜é‡æ‰ä¸ä¼šäº’ç›¸å½±å“ã€‚</li><li>è°ƒç”¨å‡½æ•°å˜é‡æ—¶ï¼Œéœ€è¦åˆ¤æ–­ä¸ºå‡½æ•°ï¼Œè€Œä¸æ˜¯å˜é‡ã€‚</li></ul><p><img src="https://s2.loli.net/2023/01/14/y2zhcrXgWJbODju.png"><br>å¯ä»¥åœ¨ <a href="https://gscript.crossoverjie.top/">Playground</a> ä¸­ä½“éªŒé—­åŒ…å‡½æ•°æ‰“å°è£´æ³¢é‚£åˆ‡æ•°åˆ—çš„è¿ç”¨ã€‚</p><p>æœ¬æ–‡ç›¸å…³èµ„æºé“¾æ¥</p><ul><li><p>GScript æºç ï¼š<a href="https://github.com/crossoverJie/gscript">https://github.com/crossoverJie/gscript</a></p></li><li><p>Playground æºç ï¼š<a href="https://github.com/crossoverJie/gscript-homepage">https://github.com/crossoverJie/gscript-homepage</a></p></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/14/QnYTwcpIxEH5WOm.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;é—­åŒ…å¯¹äºä¸€ä¸ªé•¿æœŸå†™ &lt;code&gt;Java&lt;/code&gt; çš„å¼€å‘è€…æ¥è¯´ä¼°è®¡é²œæœ‰è€³é—»ï¼Œæˆ‘åœ¨å†™ &lt;code&gt;Python&lt;/code&gt; å’Œ &lt;code&gt;Go&lt;/code&gt; ä¹‹å‰ä¹Ÿæ˜¯æ²¡æ€ä¹ˆäº†è§£ï¼Œå…‰è¿™åå­—æ„Ÿè§‰å°±æœ‰ç‚¹â€ç¥ç§˜è«æµ‹â€ï¼Œè¿™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„å°±æ˜¯ä»ç¼–è¯‘å™¨çš„è§’åº¦æ¥åˆ†æé—­åŒ…ï¼Œå½»åº•ææ‡‚é—­åŒ…çš„å®ç°åŸç†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="é—­åŒ…" scheme="http://crossoverjie.top/tags/%E9%97%AD%E5%8C%85/"/>
    
    <category term="closure" scheme="http://crossoverjie.top/tags/closure/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä¸º GScript ç¼–å†™æ ‡å‡†åº“</title>
    <link href="http://crossoverjie.top/2022/10/15/gscript/gscript10-write-native-lib/"/>
    <id>http://crossoverjie.top/2022/10/15/gscript/gscript10-write-native-lib/</id>
    <published>2022-10-15T00:08:09.000Z</published>
    <updated>2023-01-17T09:10:55.342Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/01/17/Ig7svqZCcPB9FuU.png"></p><h1 id="ç‰ˆæœ¬æ›´æ–°"><a href="#ç‰ˆæœ¬æ›´æ–°" class="headerlink" title="ç‰ˆæœ¬æ›´æ–°"></a>ç‰ˆæœ¬æ›´æ–°</h1><p>æœ€è¿‘ <code>GScript</code> æ›´æ–°äº† <code>v0.0.11</code> ç‰ˆæœ¬ï¼Œé‡ç‚¹æ›´æ–°äº†ï¼š</p><ul><li><code>Docker</code> è¿è¡Œç¯å¢ƒ</li><li>æ–°å¢äº† byte åŸå§‹ç±»å‹</li><li>æ–°å¢äº†ä¸€äº›å­—ç¬¦ä¸²æ ‡å‡†åº“ <code>Strings/StringBuilder</code></li><li>æ•°ç»„åˆ‡ç‰‡è¯­æ³•ï¼š<code>int[] b = a[1: len(a)];</code></li></ul><blockquote><p>å…·ä½“æ›´æ–°å†…å®¹è¯·çœ‹ä¸‹æ–‡ã€‚</p></blockquote><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰æ®µæ—¶é—´å‘å¸ƒäº† <code>GScript</code> çš„åœ¨çº¿ <code>playground</code>ï¼Œ<br><img src="https://s2.loli.net/2023/01/17/RmTtoqbxPipOgKj.gif"></p><span id="more"></span><p>è¿™æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨çº¿è¿è¡Œ <code>GScript</code> è„šæœ¬çš„ç½‘ç«™ï¼Œå…¶æœ¬è´¨åŸç†æ˜¯æ¥æ”¶ç”¨æˆ·çš„è¾“å…¥æºç ä»è€Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„æœåŠ¡ï¼›è¿™ç®€ç›´å°±æ˜¯åé—¨å¤§å¼€çš„ <code>XSS</code> æ”»å‡»ï¼Œä¸ºä¿ä½æœåŠ¡å™¨æˆ‘è®¾ç½®äº†è¿è¡Œ <code>API</code> çš„åç«¯æœåŠ¡çš„ç”¨æˆ·æƒé™ï¼Œè¿™æ ·å¯ä»¥é¿å…æ‰§è¡Œä¸€äº›æ¶æ„çš„è¯·æ±‚ã€‚</p><p>ä½†ä¹Ÿé¿å…ä¸äº†ä¸€äº›ç”¨æˆ·æ‰§è¡Œäº†ä¸€äº›è€—æ—¶æ“ä½œï¼Œæ¯”å¦‚ä¸€ä¸ªæ­»å¾ªç¯ã€æˆ–è€…æ˜¯æˆ‘æä¾› <code>demo</code> é‡Œçš„æ‰“å°æ¨è¾‰ä¸‰è§’ã€‚<br><img src="https://s2.loli.net/2023/01/17/LR7EAtxQnB42Wf9.png"></p><p>è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå½“æ‰“å°çš„ä¸‰è§’å±‚æ•°è¿‡é«˜æ—¶ä¾¿ä¼šéå¸¸è€—æ—¶ï¼ŒåŒæ—¶ä¹Ÿéå¸¸æ¶ˆè€— CPUã€‚</p><p>æœ‰å‡ æ¬¡æˆ‘å»æ£€æŸ¥æœåŠ¡å™¨æ—¶å‘ç°äº†å‡ ä¸ª CPU è¿‡é«˜çš„è¿›ç¨‹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯è¿™æ ·çš„è€—æ—¶æ“ä½œï¼Œä¸å¯é¿å…çš„ä¼šå½±å“åˆ°æœåŠ¡å™¨çš„æ€§èƒ½ã€‚</p><h1 id="ä½¿ç”¨-Docker"><a href="#ä½¿ç”¨-Docker" class="headerlink" title="ä½¿ç”¨ Docker"></a>ä½¿ç”¨ Docker</h1><p>ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜ï¼Œå¾ˆè‡ªç„¶çš„å°±èƒ½æƒ³åˆ°å¯ä»¥ä½¿ç”¨ <code>Docker</code>ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½å’Œå®¿ä¸»æœºæ˜¯éš”ç¦»å¼€çš„ï¼Œæ— è®ºæ€ä¹ˆçæŠ˜è…¾ä¹Ÿä¸ä¼šå½±å“åˆ°å®¿ä¸»æœºã€‚</p><p>è¯´å¹²å°±å¹²ï¼Œæœ€åä¿®æ”¹äº† API æ‰§è¡Œè„šæœ¬çš„åœ°æ–¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">string</span> <span class="variable">fileName</span> <span class="operator">=</span> d.unix(<span class="string">&quot;Asia/Shanghai&quot;</span>) + <span class="string">&quot;temp.gs&quot;</span> ;</span><br><span class="line">s.writeFile(fileName, body, <span class="number">438</span>);</span><br><span class="line"><span class="type">string</span> <span class="variable">pwd</span> <span class="operator">=</span> s.getwd();</span><br><span class="line"><span class="comment">// string res = s.command(&quot;gscript&quot;, fileName);</span></span><br><span class="line"><span class="type">string</span> <span class="variable">res</span> <span class="operator">=</span> s.command(<span class="string">&quot;docker&quot;</span>,<span class="string">&quot;run&quot;</span>,<span class="string">&quot;--rm&quot;</span>,<span class="string">&quot;-v&quot;</span>, pwd+<span class="string">&quot;:/usr/src/gscript&quot;</span>,<span class="string">&quot;-w&quot;</span>,<span class="string">&quot;/usr/src/gscript&quot;</span>, <span class="string">&quot;crossoverjie/gscript&quot;</span>,<span class="string">&quot;gscript&quot;</span>, fileName);</span><br><span class="line">s.remove(fileName);</span><br><span class="line">r.body = res;</span><br><span class="line">r.ast = dumpAST(body);</span><br><span class="line">r.symbol=dumpSymbol(body);</span><br><span class="line">ctx.JSON(<span class="number">200</span>, r);</span><br></pre></td></tr></table></figure><p>ä¸»è¦ä¿®æ”¹çš„å°±æ˜¯å°†ç›´æ¥æ‰§è¡Œçš„ <code>GScript</code> å‘½ä»¤ä¿®æ”¹ä¸ºäº†è°ƒç”¨ <code>docker</code> æ‰§è¡Œã€‚</p><blockquote><p>ä½†å…¶å®ä¹Ÿè¿˜æœ‰æ”¹è¿›ç©ºé—´ï¼Œåç»­æ–°å¢åç¨‹ä¹‹åå¯ä»¥ä¾¿å¯ç›‘æ§è¿è¡Œæ—¶é—´ï¼Œè¶…æ—¶åä¾¿ä¼šè‡ªåŠ¨ kill è¿›ç¨‹ã€‚</p></blockquote><p>æˆ‘ä¹Ÿå°†è¯¥ <code>Docker</code> ä¸Šä¼ åˆ°äº† <code>DockerHub</code>ï¼Œç°åœ¨å¤§å®¶æƒ³åœ¨æœ¬åœ°ä½“éªŒ <code>GScript</code> çš„ <code>REPL</code> æ—¶ä¹Ÿåªéœ€è¦è¿è¡Œ<code>Docker</code> å°±èƒ½ä½¿ç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull crossoverjie/gscript</span><br><span class="line">docker run --rm -it  crossoverjie/gscript:latest gscript</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/01/17/sg67rJAc4BafouI.png"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥æ‰§è¡Œç”¨ <code>Docker</code> æ‰§è¡Œ <code>GScript</code> è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -v $PWD:/usr/src/gscript -w /usr/src/gscript crossoverjie/gscript gscript &#123;yourpath&#125;/temp.gs</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008vxvgGly1h76194c45pj320g0ee41b.jpg"></p><h1 id="ç¼–å†™-GScript-æ ‡å‡†åº“"><a href="#ç¼–å†™-GScript-æ ‡å‡†åº“" class="headerlink" title="ç¼–å†™ GScript æ ‡å‡†åº“"></a>ç¼–å†™ GScript æ ‡å‡†åº“</h1><p>æ¥ä¸‹æ¥é‡ç‚¹èŠèŠ <code>GScript</code> æ ‡å‡†åº“çš„äº‹æƒ…ï¼Œå…¶å®ç¼–å†™æ ‡å‡†åº“æ˜¯ä¸€ä¸ªè´¹æ—¶è´¹åŠ›çš„äº‹æƒ…ã€‚<br><img src="https://s2.loli.net/2023/01/17/oKnZq5mDPpkF7Ix.png"><br>ç°åœ¨ç¼–è¯‘å™¨å·²ç»æä¾›äº†ä¸€äº›å¯ç”¨çš„å†…ç½®å‡½æ•°ï¼Œå€Ÿç”±è¿™äº›å†…ç½®å‡½æ•°å†™ä¸€äº›å¸¸è§çš„å·¥å…·ç±»æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p>å¯¹å†™ <code>GScript</code> æ ‡å‡†åº“æ„Ÿè°¢çš„æœ‹å‹å¯ä»¥å½“åšä¸€ä¸ªå‚è€ƒï¼Œè¿™é‡Œæˆ‘æ‰“äº†ä¸€ä¸ªæ ·ï¼Œå…ˆçœ‹ä¸‹è¿è¡Œæ•ˆæœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦ä¸²å·¥å…·ç±»</span></span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">b</span> <span class="operator">=</span> StringBuilder();</span><br><span class="line">b.writeString(<span class="string">&quot;10&quot;</span>);</span><br><span class="line">b.writeString(<span class="string">&quot;20&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> b.writeString(<span class="string">&quot;30&quot;</span>);</span><br><span class="line"><span class="type">string</span> <span class="variable">s</span> <span class="operator">=</span> b.String();</span><br><span class="line">printf(<span class="string">&quot;s:%s, len=%d &quot;</span>,s,l);</span><br><span class="line">assertEqual(s,<span class="string">&quot;102030&quot;</span>);</span><br><span class="line"><span class="type">byte</span>[] b2 = toByteArray(<span class="string">&quot;40&quot;</span>);</span><br><span class="line">b.WriteBytes(b2);</span><br><span class="line">s = b.String();</span><br><span class="line">assertEqual(s,<span class="string">&quot;10203040&quot;</span>);</span><br><span class="line">println(s);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Strings å·¥å…·ç±»</span></span><br><span class="line"><span class="type">Strings</span> <span class="variable">s</span> <span class="operator">=</span> Strings();</span><br><span class="line">string[] elems = &#123;<span class="string">&quot;name=xxx&quot;</span>,<span class="string">&quot;age=xx&quot;</span>&#125;;</span><br><span class="line"><span class="type">string</span> <span class="variable">ret</span> <span class="operator">=</span> s.join(elems, <span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">println(ret);</span><br><span class="line">assertEqual(ret, <span class="string">&quot;name=xxx&amp;age=xx&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="variable">b</span> <span class="operator">=</span> s.hasPrefix(<span class="string">&quot;http://www.xx.com&quot;</span>, <span class="string">&quot;http&quot;</span>);</span><br><span class="line">println(b);</span><br><span class="line">assertEqual(b,<span class="literal">true</span>);</span><br><span class="line">b = s.hasPrefix(<span class="string">&quot;http://www.xx.com&quot;</span>, <span class="string">&quot;https&quot;</span>);</span><br><span class="line">println(b);</span><br><span class="line">assertEqual(b,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„å®ç°æºç åŸºæœ¬ä¸Šæ˜¯å€Ÿé‰´äº† Go çš„æ ‡å‡†åº“ï¼Œå…ˆæ¥çœ‹çœ‹ <code>StringBuilder</code> çš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StringBuilder</span>&#123;</span><br><span class="line">    <span class="type">byte</span>[] buf = [<span class="number">0</span>]&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// append contents to buf, it returns the length of s</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">writeString</span><span class="params">(string s)</span>&#123;</span><br><span class="line">        <span class="type">byte</span>[] temp = toByteArray(s);</span><br><span class="line">        append(buf, temp);</span><br><span class="line">        <span class="keyword">return</span> len(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// append b to buf, it returns the length of b.</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">WriteBytes</span><span class="params">(<span class="type">byte</span>[] b)</span>&#123;</span><br><span class="line">        append(buf, b);</span><br><span class="line">        <span class="keyword">return</span> len(b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copies the buffer to a new.</span></span><br><span class="line">    grow(<span class="type">int</span> n)&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// when there is not enough space left.</span></span><br><span class="line">            <span class="keyword">if</span> (cap(buf) - len(buf) &lt; n) &#123;</span><br><span class="line">                <span class="type">byte</span>[] newBuf = [len(buf), <span class="number">2</span>*cap(buf)+n]&#123;&#125;;</span><br><span class="line">                copy(newBuf, buf);</span><br><span class="line">                buf = newBuf;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string <span class="title function_">String</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> toString(buf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯å€ŸåŠ©äº†åŸå§‹çš„æ•°ç»„ç±»å‹ä»¥åŠ <code>toByteArray/toString</code> å­—èŠ‚æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è½¬æ¢å‡½æ•°å®ç°çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Strings</span>&#123;</span><br><span class="line">    <span class="comment">// concatenates the elements of its first argument to create a single string. The separator</span></span><br><span class="line">    <span class="comment">// string sep is placed between elements in the resulting string.</span></span><br><span class="line">    string <span class="title function_">join</span><span class="params">(string[] elems, string sep)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (len(elems) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len(elems) == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> elems[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">byte</span>[] bs = toByteArray(sep);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> len(bs) * (len(elems) -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i &lt; len(elems); i++) &#123;</span><br><span class="line">            <span class="type">string</span> <span class="variable">s</span> <span class="operator">=</span> elems[i];</span><br><span class="line">            <span class="type">byte</span>[] bs = toByteArray(s);</span><br><span class="line">            n = n + len(bs);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> StringBuilder();</span><br><span class="line">        sb.grow(n);</span><br><span class="line">        <span class="type">string</span> <span class="variable">first</span> <span class="operator">=</span> elems[<span class="number">0</span>];</span><br><span class="line">        sb.writeString(first);</span><br><span class="line"></span><br><span class="line">        string[] remain = elems[<span class="number">1</span>:len(elems)];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; len(remain); i++)&#123;</span><br><span class="line">            sb.writeString(sep);</span><br><span class="line">            <span class="type">string</span> <span class="variable">r</span> <span class="operator">=</span> remain[i];</span><br><span class="line">            sb.writeString(r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.String();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// tests whether the string s begins with prefix.</span></span><br><span class="line">    bool <span class="title function_">hasPrefix</span><span class="params">(string s, string prefix)</span>&#123;</span><br><span class="line">        <span class="type">byte</span>[] bs = toByteArray(s);</span><br><span class="line">        <span class="type">byte</span>[] bp = toByteArray(prefix);    </span><br><span class="line">        <span class="keyword">return</span> len(bs) &gt;= len(bp) &amp;&amp; toString(bs[<span class="number">0</span>:len(bp)]) == prefix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Strings</code> å·¥å…·ç±»ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯ä¸€äº›å†…ç½®å‡½æ•°çš„ç»„åˆè¿ç”¨ï¼›</p><p>åœ¨å†™æ ‡å‡†åº“çš„è¿‡ç¨‹ä¸­è¿˜ä¼šæœ‰é¢å¤–æ”¶è·ï¼Œå¯ä»¥å†æ¬¡é˜…è¯»ä¸€é Go æ ‡å‡†åº“çš„å®ç°æµç¨‹ï¼Œæ¢äº†ä¸€ç§è¯­æ³•å®ç°å‡ºæ¥ï¼Œä¼šåŠ æ·±å¯¹ Go æ ‡å‡†åº“çš„ç†è§£ã€‚</p><p>æ‰€ä»¥æ¬¢è¿æ„Ÿå…´è¶£çš„æœ‹å‹å‘ <code>GScript</code> è´¡çŒ®æ ‡å‡†åº“ï¼Œç”±äºæˆ‘ä¸ªäººç²¾åŠ›æœ‰é™ï¼Œå®ç°è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‘ç°ç¼ºå°‘æŸäº›å†…ç½®å‡½æ•°æˆ–æ•°æ®ç»“æ„ï¼Œè¿™ä¹Ÿæ²¡å…³ç³»ï¼Œåé¦ˆ <code>issue</code> åæˆ‘ä¼šå°½å¿«å¤„ç†ã€‚</p><blockquote><p>ç”±äºç›®å‰ <code>GScript</code> è¿˜ä¸æ”¯æŒåŒ…ç®¡ç†ï¼Œæ‰€ä»¥æ–°å¢çš„å‡½æ•°å¯ä»¥åˆ›å»º <code>Class</code> æ¥å®ç°ï¼Œåç»­æ”¯æŒåŒ…æˆ–è€…æ˜¯ <code>namespace</code> ä¹‹åç›´æ¥å°†è¯¥ <code>Class</code> è¿ç§»è¿‡å»å³å¯ã€‚</p></blockquote><hr><p>æœ¬æ–‡ç›¸å…³èµ„æºé“¾æ¥</p><ul><li>GScript æºç ï¼š<a href="https://github.com/crossoverJie/gscript">https://github.com/crossoverJie/gscript</a></li><li>Playground æºç ï¼š<a href="https://github.com/crossoverJie/gscript-homepage">https://github.com/crossoverJie/gscript-homepage</a></li><li>GScript Dockeråœ°å€ï¼š<a href="https://hub.docker.com/r/crossoverjie/gscript">https://hub.docker.com/r/crossoverjie/gscript</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/17/Ig7svqZCcPB9FuU.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;ç‰ˆæœ¬æ›´æ–°&quot;&gt;&lt;a href=&quot;#ç‰ˆæœ¬æ›´æ–°&quot; class=&quot;headerlink&quot; title=&quot;ç‰ˆæœ¬æ›´æ–°&quot;&gt;&lt;/a&gt;ç‰ˆæœ¬æ›´æ–°&lt;/h1&gt;&lt;p&gt;æœ€è¿‘ &lt;code&gt;GScript&lt;/code&gt; æ›´æ–°äº† &lt;code&gt;v0.0.11&lt;/code&gt; ç‰ˆæœ¬ï¼Œé‡ç‚¹æ›´æ–°äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Docker&lt;/code&gt; è¿è¡Œç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;æ–°å¢äº† byte åŸå§‹ç±»å‹&lt;/li&gt;
&lt;li&gt;æ–°å¢äº†ä¸€äº›å­—ç¬¦ä¸²æ ‡å‡†åº“ &lt;code&gt;Strings/StringBuilder&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ•°ç»„åˆ‡ç‰‡è¯­æ³•ï¼š&lt;code&gt;int[] b = a[1: len(a)];&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å…·ä½“æ›´æ–°å†…å®¹è¯·çœ‹ä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´å‘å¸ƒäº† &lt;code&gt;GScript&lt;/code&gt; çš„åœ¨çº¿ &lt;code&gt;playground&lt;/code&gt;ï¼Œ&lt;br&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/17/RmTtoqbxPipOgKj.gif&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨è‡ªå·±çš„ç¼–ç¨‹è¯­è¨€å®ç°äº†ä¸€ä¸ªç½‘ç«™ï¼ˆå¢å¼ºç‰ˆï¼‰</title>
    <link href="http://crossoverjie.top/2022/10/08/gscript/gscript08-write-site-enhance/"/>
    <id>http://crossoverjie.top/2022/10/08/gscript/gscript08-write-site-enhance/</id>
    <published>2022-10-08T00:08:09.000Z</published>
    <updated>2023-01-29T02:28:07.741Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2023/01/29/Tr3H1wBh9NJi5lQ.png"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰æ®µæ—¶é—´åœ¨<a href="https://crossoverjie.top/2022/09/14/gscript/gscript05-write-site/">ã€Šç”¨è‡ªå·±çš„ç¼–ç¨‹è¯­è¨€å®ç°äº†ä¸€ä¸ªç½‘ç«™ã€‹</a>ç”¨ä»‹ç»äº†ç”¨ <code>GScript</code> å†™çš„ä¸€ä¸ªç®€å•â€œç½‘ç«™â€ï¼Œè™½ç„¶æ˜¯æ‰“ä¸Šå¼•å·çš„ï¼›é¡µé¢é•¿è¿™æ ·ï¼š</p><p><img src="https://s2.loli.net/2023/01/29/kXMWY2Dy3RwatHb.png"></p><p>çœ‹èµ·æ¥ç¡®å®éå¸¸çš„æŒ«ï¼Œå…¶å®ä¹‹å‰ä¸€ç›´ä¹Ÿæƒ³åšä¸€ä¸ª <code>GScript</code> çš„åœ¨çº¿ <code>playground</code> ï¼Œäºæ˜¯å›½åº†æœŸé—´å­¦äº†ä¸€ç‚¹  çš®æ¯› <code>Vue</code> åŠ ä¸Šè€å¼Ÿçš„å¸®å¿™ï¼ˆä»–æ˜¯å‰ç«¯å¼€å‘ï¼‰ï¼Œæœ€ç»ˆå®Œæˆäº†ä¸‹é¢è¿™ä¸ªç½‘ç«™ï¼š</p><p><a href="https://gscript.crossoverjie.top/">https://gscript.crossoverjie.top/</a></p><p><img src="https://s2.loli.net/2023/01/29/3iP94haxUzYWbwe.png"></p><blockquote><p>â¤æ‰“å°æºç å‚è€ƒäº†ï¼š<a href="https://wa-lang.org/playground/">https://wa-lang.org/playground/</a></p></blockquote><span id="more"></span><p>åœ¨è¿™é‡Œå¯ä»¥åœ¨çº¿è¿è¡Œ <code>GScript</code> ä»£ç ï¼Œå€ŸåŠ©äºå‰ç«¯çš„ä»£ç ç¼–è¾‘å™¨æ’ä»¶ç”šè‡³è¿˜èƒ½æœ‰ä¸€äº›è¯­æ³•æç¤ºã€‚</p><blockquote><p>ä¸è¿‡æœ‰äº›æç¤ºä¸ GScript çš„è¯­æ³•ä¸å…¼å®¹ï¼Œæ¯•ç«Ÿç¼–è¾‘å™¨çš„æç¤ºæ˜¯åŸºäº JavaScript çš„è¯­æ³•ã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/01/29/RTWZxm42MIJQCBE.png"></p><p>å†…ç½®äº†å‡ ä¸ª demoï¼Œå¯ä»¥é€‰æ‹©è¿è¡Œè¯•è¯•ã€‚</p><p>åŒæ—¶ä¹Ÿæ”¯æŒæŸ¥çœ‹ <code>AST</code> æ ‘å’Œ <code>symbol</code> ç¬¦å·è¡¨ã€‚</p><blockquote><p>è™½ç„¶æ˜¾ç¤ºä¸Šè¿˜æœ‰å¾…ä¼˜åŒ–ã€‚</p></blockquote><p><img src="https://s2.loli.net/2023/01/29/4h1ySCk5QlVMcZG.png"><br><img src="https://s2.loli.net/2023/01/29/gXsqORWBdDaxry2.png"></p><p>æ•´ä¸ªåç«¯æ¥å£å…¨éƒ½æ˜¯ç”¨ <code>GScript</code> åŸç”Ÿä»£ç ç¼–å†™çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿç®—æ˜¯ <code>GScript</code> çš„ä¸€ä¸ªå®é™…åº”ç”¨æ¡ˆä¾‹ã€‚</p><h1 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">func (<span class="title class_">HttpContext</span>) <span class="title function_">run</span>(<span class="params">HttpContext ctx</span>) &#123;</span><br><span class="line">    string body = ctx.<span class="title function_">postFormValue</span>(<span class="string">&quot;body&quot;</span>);</span><br><span class="line">    string local = d.<span class="title function_">getCurrentTime</span>(<span class="string">&quot;Asia/Shanghai&quot;</span>,<span class="string">&quot;2006-01-02 15:04:05&quot;</span>);</span><br><span class="line">    <span class="title function_">println</span>(<span class="string">&quot;===&quot;</span> + local);</span><br><span class="line">    <span class="title function_">println</span>(body);</span><br><span class="line">    <span class="title function_">println</span>(<span class="string">&quot;===&quot;</span>);</span><br><span class="line">    <span class="title class_">RunResponse</span> r = <span class="title class_">RunResponse</span>();</span><br><span class="line">    <span class="keyword">if</span> (body == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        r.<span class="property">body</span> = <span class="string">&quot;empty code&quot;</span>;</span><br><span class="line">        ctx.<span class="title class_">JSON</span>(<span class="number">200</span>, r);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    string fileName = d.<span class="title function_">unix</span>(<span class="string">&quot;Asia/Shanghai&quot;</span>) + <span class="string">&quot;temp.gs&quot;</span> ;</span><br><span class="line">    s.<span class="title function_">writeFile</span>(fileName, body, <span class="number">438</span>);</span><br><span class="line">    string pwd = s.<span class="title function_">getwd</span>();</span><br><span class="line">    <span class="comment">// string res = s.command(&quot;gscript&quot;, fileName);</span></span><br><span class="line">    string res = s.<span class="title function_">command</span>(<span class="string">&quot;docker&quot;</span>,<span class="string">&quot;run&quot;</span>,<span class="string">&quot;--rm&quot;</span>,<span class="string">&quot;-v&quot;</span>, pwd+<span class="string">&quot;:/usr/src/gscript&quot;</span>,<span class="string">&quot;-w&quot;</span>,<span class="string">&quot;/usr/src/gscript&quot;</span>, <span class="string">&quot;crossoverjie/gscript&quot;</span>,<span class="string">&quot;gscript&quot;</span>, fileName);</span><br><span class="line">    s.<span class="title function_">remove</span>(fileName);</span><br><span class="line">    r.<span class="property">body</span> = res;</span><br><span class="line">    r.<span class="property">ast</span> = <span class="title function_">dumpAST</span>(body);</span><br><span class="line">    r.<span class="property">symbol</span>=<span class="title function_">dumpSymbol</span>(body);</span><br><span class="line">    ctx.<span class="title class_">JSON</span>(<span class="number">200</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">httpHandle</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;/index&quot;</span>, index);</span><br><span class="line"><span class="title function_">httpHandle</span>(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;/run&quot;</span>, run);</span><br><span class="line">string[] args = s.<span class="title function_">getOSArgs</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">len</span>(args) ==<span class="number">3</span>)&#123;</span><br><span class="line">    <span class="title function_">httpRun</span>(<span class="string">&quot;:&quot;</span> + args[<span class="number">2</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">httpRun</span>(<span class="string">&quot;:8000&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä»£ç é‡ä¹Ÿå¹¶ä¸å¤šï¼Œå°†å‰ç«¯è¾“å…¥çš„ä»£ç å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå†è°ƒç”¨ OS çš„ <code>command api</code> åœ¨æœ¬åœ°æ‰§è¡Œæ‰§è¡Œ dockerï¼Œæœ€åå°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¿”å›å³å¯ã€‚</p><h1 id="ç‰ˆæœ¬æ›´æ–°"><a href="#ç‰ˆæœ¬æ›´æ–°" class="headerlink" title="ç‰ˆæœ¬æ›´æ–°"></a>ç‰ˆæœ¬æ›´æ–°</h1><p>ä¸ºäº†èƒ½å®ç°ä¸Šè¿°çš„éœ€æ±‚ï¼Œæ‰€ä»¥æœ¬æ¬¡ä¹Ÿæ›´æ–°äº† <code>GScript</code> çš„ç‰ˆæœ¬ï¼Œæ–°å¢äº†ä¸€äº›å†…ç½® <code>API</code>ã€‚</p><p><img src="https://s2.loli.net/2023/01/29/cQUbaZI9s8ONvXA.png"></p><p>ä¸»è¦æ˜¯æ–°å¢äº† <code>playground</code> éœ€è¦çš„ä¸€äº› <code>OS api</code>ã€æ–‡ä»¶å†™å…¥ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€æ—¥æœŸç›¸å…³ç­‰ã€‚</p><p>åŒæ—¶å°†åŒä¸€ç±»çš„ <code>API</code> åˆå¹¶åˆ°ä¸€ä¸ª <code>class</code> ä¸­ï¼Œæ–¹ä¾¿åæœŸç»´æŠ¤ä¸è°ƒç”¨ã€‚</p><h2 id="ç¼–è¯‘é”™è¯¯"><a href="#ç¼–è¯‘é”™è¯¯" class="headerlink" title="ç¼–è¯‘é”™è¯¯"></a>ç¼–è¯‘é”™è¯¯</h2><p>é™¤æ­¤ä¹‹å¤–ä¹Ÿæ–°å¢äº†ä¸€äº›æ˜“ç”¨åŠŸèƒ½ï¼Œæ¯”å¦‚ç°åœ¨æä¾›äº†æ›´å‹å¥½çš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯ï¼š<br><img src="https://s2.loli.net/2023/01/29/Du3Xga8czBTiCQh.png"></p><h2 id="è¿è¡Œæ—¶é”™è¯¯"><a href="#è¿è¡Œæ—¶é”™è¯¯" class="headerlink" title="è¿è¡Œæ—¶é”™è¯¯"></a>è¿è¡Œæ—¶é”™è¯¯</h2><p>è¿è¡Œæ—¶çš„å¼‚å¸¸ç°åœ¨ä¹Ÿæœ‰å¯¹åº”æç¤ºï¼š<br><img src="https://s2.loli.net/2023/01/29/COwbQqXtlsaGdK6.png"></p><p>åªä¸è¿‡ç›®å‰çš„æ˜¾ç¤ºè¿˜ä¸å¤ªå‹å¥½ï¼Œæ‰“å°çš„å †æ ˆè¿˜æ˜¯ <code>Go</code> çš„ï¼Œä¹‹åä¼šä¼˜åŒ–ä¸ºåªæ˜¾ç¤º <code>GScript</code> çš„å †æ ˆã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ‰äº†åœ¨çº¿çš„ <a href="https://gscript.crossoverjie.top/">playground</a> åä½¿å¾—å¯¹ <code>GScript</code> æ„Ÿå…´è¶£çš„é—¨æ§›æ›´ä½äº†ä¸€äº›ï¼Œæ¬¢è¿å¤§å®¶è¯•ç”¨ã€‚</p><hr><p>ç»è¿‡æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œ<code>GScript</code> ä¹Ÿé€æ­¥å®Œå–„äº†ï¼ŒåŸºæœ¬å®Œæˆäº†ç¬¬ä¸€ç‰ˆæœ¬çš„éœ€æ±‚ã€‚</p><p>åç»­ä¼šç»§ç»­å®Œå–„ç¬¬äºŒé˜¶æ®µçš„ï¼Œæ¯”å¦‚ï¼š</p><ul><li>namespace</li><li>åŒ…ç®¡ç†</li><li>å¹¶å‘</li></ul><p>ç­‰å†…å®¹ï¼Œæ¯ä¸€é¡¹çœ‹èµ·æ¥éƒ½ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“å•Šã€‚</p><p>ä¹‹å‰æœ‰ä¸å°‘äººé—®æˆ‘ <code>GScript</code> æ˜¯æ‹¿æ¥è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿå½“æ—¶æˆ‘ç¡®å®æ²¡ä»”ç»†æƒ³è¿‡ï¼›ä¸è¿‡ç°åœ¨ç»è¿‡å‡ ä¸ªç‰ˆæœ¬çš„å¼€å‘æœ‰äº†ä¸€ç‚¹æƒ³æ³•ï¼š</p><p>æ˜¯å¦å¯ä»¥å°† <code>GScript</code> ä½œä¸ºä¸€ä¸ªè„šæœ¬åŒ–çš„ Go è¯­è¨€ï¼Œæ¯•ç«Ÿ Go æ˜¯ç¼–è¯‘ç±»å‹çš„ï¼Œæ¯æ¬¡ä¿®æ”¹å‘å¸ƒéƒ½éœ€è¦ç»è¿‡ç¼–è¯‘æ‰èƒ½è¿è¡Œï¼Œä½†å¦‚æœå¯ä»¥åƒè„šæœ¬è¯­è¨€ï¼Œæ¯”å¦‚ <code>Pythonã€Bash</code> ä¿®æ”¹åå°±å¯ä»¥ç›´æ¥è¿è¡Œï¼Œè¿™åœ¨å†™ä¸€äº›ä¸æ˜¯é‚£ä¹ˆé‡çš„ä¸šåŠ¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>åŒæ—¶å€ŸåŠ©äºè¯­æ³•ç³–ç”šè‡³å¯ä»¥ä¼˜åŒ–æ‰ Go æœ¬èº«è¢«äººâ€œåæ§½â€çš„åœ°æ–¹ï¼Œæ¯”å¦‚å¼‚å¸¸ã€append å‡½æ•°ã€æ²¡æœ‰è¿ç®—ç¬¦é‡è½½ã€ä¸‰ç›®è¿ç®—ç¬¦ç­‰ã€‚</p><blockquote><p>éƒ¨åˆ†åæ§½ <code>GScript</code> å·²ç»æ”¯æŒã€‚</p></blockquote><p>åŒæ—¶å› ä¸ºå¾—ç›Šäºæœ¬èº«ä¹Ÿæ˜¯ Go ç¼–å†™çš„ï¼Œæ‰€ä»¥ Go çš„ä¸€äº›ä¼˜ç‚¹ä¹Ÿèƒ½ç»§æ‰¿è¿‡æ¥ï¼Œæ¯”å¦‚è½»é‡çº§çš„åç¨‹ç­‰ã€‚</p><p>Go æœ¬èº«ä¹Ÿæœ‰å¤§é‡çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåç»­ç”šè‡³ä¹Ÿèƒ½ç›´æ¥ä½¿ç”¨è¿™äº›ç°æˆçš„åº“ã€‚</p><p>ä»¥ä¸Šåªæ˜¯ä¸€äº›ç¾å¥½çš„ç•…æƒ³ï¼Œå°±åƒè€æ¿ç”»çš„å¤§é¥¼ä¸€æ ·ï¼Œå…·ä½“åœ¨å®ç°è¿‡ç¨‹ä¸­å¯èƒ½åˆæœ‰ä¸ä¸€æ ·çš„æƒ³æ³•ï¼Œæ¬¢è¿æä¾›å»ºè®®ã€‚</p><p><code>playground</code> åœ°å€ï¼š<br><a href="https://gscript.crossoverjie.top/">https://gscript.crossoverjie.top/</a></p><p>æºç åœ°å€ï¼š<br><a href="https://github.com/crossoverjie/gscript">https://github.com/crossoverjie/gscript</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/29/Tr3H1wBh9NJi5lQ.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´åœ¨&lt;a href=&quot;https://crossoverjie.top/2022/09/14/gscript/gscript05-write-site/&quot;&gt;ã€Šç”¨è‡ªå·±çš„ç¼–ç¨‹è¯­è¨€å®ç°äº†ä¸€ä¸ªç½‘ç«™ã€‹&lt;/a&gt;ç”¨ä»‹ç»äº†ç”¨ &lt;code&gt;GScript&lt;/code&gt; å†™çš„ä¸€ä¸ªç®€å•â€œç½‘ç«™â€ï¼Œè™½ç„¶æ˜¯æ‰“ä¸Šå¼•å·çš„ï¼›é¡µé¢é•¿è¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/29/kXMWY2Dy3RwatHb.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;çœ‹èµ·æ¥ç¡®å®éå¸¸çš„æŒ«ï¼Œå…¶å®ä¹‹å‰ä¸€ç›´ä¹Ÿæƒ³åšä¸€ä¸ª &lt;code&gt;GScript&lt;/code&gt; çš„åœ¨çº¿ &lt;code&gt;playground&lt;/code&gt; ï¼Œäºæ˜¯å›½åº†æœŸé—´å­¦äº†ä¸€ç‚¹  çš®æ¯› &lt;code&gt;Vue&lt;/code&gt; åŠ ä¸Šè€å¼Ÿçš„å¸®å¿™ï¼ˆä»–æ˜¯å‰ç«¯å¼€å‘ï¼‰ï¼Œæœ€ç»ˆå®Œæˆäº†ä¸‹é¢è¿™ä¸ªç½‘ç«™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gscript.crossoverjie.top/&quot;&gt;https://gscript.crossoverjie.top/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2023/01/29/3iP94haxUzYWbwe.png&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â¤æ‰“å°æºç å‚è€ƒäº†ï¼š&lt;a href=&quot;https://wa-lang.org/playground/&quot;&gt;https://wa-lang.org/playground/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹å†™ç¼–ç¨‹è¯­è¨€-é€’å½’å‡½æ•°æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</title>
    <link href="http://crossoverjie.top/2022/09/27/gscript/gscript07-return/"/>
    <id>http://crossoverjie.top/2022/09/27/gscript/gscript07-return/</id>
    <published>2022-09-27T00:08:08.000Z</published>
    <updated>2022-09-26T17:02:46.600Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6k7cg9ushj20ic05kdge.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹åœ¨ <a href="https://github.com/crossoverJie/gscript">GScript</a> ä¸­å®ç°é€’å½’è°ƒç”¨æ—¶æ‰€é‡åˆ°çš„å‘ï¼Œç±»ä¼¼çš„é—®é¢˜åœ¨ä¸­æ–‡äº’è”ç½‘ä¸Šæˆ‘å‡ ä¹æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„å†…å®¹ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾ˆæœ‰å¿…è¦è®°å½•ä¸€ä¸‹ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰è¿˜æ˜¯ç®€å•ä»‹ç»ä¸‹æœ¬æ¬¡æ›´æ–°çš„ <code>GScript</code> v0.0.9 æ‰€åŒ…å«çš„å†…å®¹ï¼š</p><ul><li>æ”¯æŒå¯å˜å‚æ•°</li><li>ä¼˜åŒ– <code>append</code> å‡½æ•°è¯­ä¹‰</li><li>ä¼˜åŒ–ç¼–è¯‘é”™è¯¯ä¿¡æ¯</li><li>æœ€åä¸€ä¸ªå°±æ˜¯æ”¯æŒé€’å½’è°ƒç”¨</li></ul><span id="more"></span><hr><p>å…ˆçœ‹ç¬¬ä¸€ä¸ªå¯å˜å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//formats according to a format specifier and writes to standard output.</span></span><br><span class="line">printf(string format, any ...a)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//formats according to a format specifier and returns the resulting string.</span></span><br><span class="line">string <span class="title function_">sprintf</span><span class="params">(string format, any ...a)</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯éšç€æœ¬æ¬¡æ›´æ–°æ–°å¢çš„ä¸¤ä¸ªæ ‡å‡†å‡½æ•°ï¼Œå‡æ”¯æŒå¯å˜å‚æ•°ï¼Œå…¶ä¸­ä½¿ç”¨ <code>...</code> è¡¨ç¤ºå¯å˜å‚æ•°ï¼Œè°ƒç”¨æ—¶å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">printf</span>(<span class="string">&quot;hello %s &quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line"><span class="title function_">printf</span>(<span class="string">&quot;hello-%s-%s &quot;</span>,<span class="string">&quot;123&quot;</span>,<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="title function_">printf</span>(<span class="string">&quot;hello-%s-%d &quot;</span>,<span class="string">&quot;123&quot;</span>,<span class="number">123</span>);</span><br><span class="line">string format = <span class="string">&quot;this is %s &quot;</span>;</span><br><span class="line"><span class="title function_">printf</span>(format, <span class="string">&quot;gscript&quot;</span>);</span><br><span class="line"></span><br><span class="line">string s = <span class="title function_">sprintf</span>(<span class="string">&quot;nice to meet %s&quot;</span>, <span class="string">&quot;you&quot;</span>);</span><br><span class="line"><span class="title function_">assertEqual</span>(s,<span class="string">&quot;nice to meet you&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¸å¤§éƒ¨åˆ†è¯­è¨€ç±»ä¼¼ï¼Œå¯å˜å‚æ•°æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥æ‹¿æ¥å¾ªç¯éå†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int <span class="title function_">add</span>(<span class="params">string s, int ...num</span>)&#123;</span><br><span class="line"><span class="title function_">println</span>(s);</span><br><span class="line">int sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(int i=<span class="number">0</span>;i&lt;<span class="title function_">len</span>(num);i++)&#123;</span><br><span class="line">int v = num[i];</span><br><span class="line">sum = sum+v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line">int x = <span class="title function_">add</span>(<span class="string">&quot;abc&quot;</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"><span class="title function_">println</span>(x);</span><br><span class="line"><span class="title function_">assertEqual</span>(x, <span class="number">10</span>);</span><br></pre></td></tr></table></figure><hr><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// appends &quot;v&quot; to the end of a array &quot;a&quot;</span></span><br><span class="line"><span class="title function_">append</span>(<span class="params">any[] a, any v</span>)&#123;&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åæ˜¯ä¼˜åŒ–äº†å†…ç½®å‡½æ•° <code>append()</code> çš„è¯­ä¹‰ï¼Œæœ¬æ¬¡ä¼˜åŒ–æ¥è‡ªäº issue12 çš„å»ºè®®ï¼š<br><a href="https://github.com/crossoverJie/gscript/issues/12">https://github.com/crossoverJie/gscript/issues/12</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before</span></span><br><span class="line">int[] a=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="title function_">println</span>(a);</span><br><span class="line"><span class="title function_">println</span>();</span><br><span class="line">a = <span class="title function_">append</span>(a,<span class="number">4</span>);</span><br><span class="line"><span class="title function_">println</span>(a);</span><br><span class="line"><span class="comment">// Output: [1 2 3 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Now</span></span><br><span class="line">int[] a=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="title function_">println</span>(a);</span><br><span class="line"><span class="title function_">println</span>();</span><br><span class="line"><span class="title function_">append</span>(a,<span class="number">4</span>);</span><br><span class="line">int b = a[<span class="number">3</span>];</span><br><span class="line"><span class="title function_">assertEqual</span>(<span class="number">4</span>, b);</span><br><span class="line"><span class="title function_">println</span>(a);</span><br><span class="line"><span class="comment">// Output: [1 2 3 4]</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ <code>append</code> ä¹‹åä¸éœ€è¦å†é‡æ–°èµ‹å€¼ï¼Œä¹Ÿä¼šè¿½åŠ æ•°æ®ï¼Œä¼˜åŒ–åè¿™é‡Œçœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå€¼&#x2F;å¼•ç”¨ä¼ é€’çš„é—®é¢˜ï¼Œä½†å…¶å®åº•å±‚ä¹Ÿæ˜¯å€¼ä¼ é€’ï¼Œåªæ˜¯åœ¨è¯­æ³•ä¸Šå¢åŠ äº†è¿™æ ·çš„è¯­æ³•ç³–ï¼Œå¸®ä½¿ç”¨è€…é‡æ–°åšäº†ä¸€æ¬¡èµ‹å€¼ã€‚</p><hr><p>ä¹‹åæ˜¯æ–°å¢äº†ç¼–è¯‘é”™è¯¯ä¿¡æ¯æç¤ºï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a+<span class="number">2</span>;</span><br><span class="line">b+c;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ²¡æœ‰å£°æ˜çš„å˜é‡ï¼Œç°åœ¨ä¼šç›´æ¥ç¼–è¯‘å¤±è´¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1:0: undefined: a</span><br><span class="line">2:0: undefined: b</span><br><span class="line">2:2: undefined: c</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T</span>&#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="number">2</span>:<span class="number">0</span>: <span class="keyword">class</span> <span class="title class_">T</span> redeclared <span class="keyword">in</span> <span class="variable language_">this</span> block</span><br></pre></td></tr></table></figure><p>é‡å¤å£°æ˜ä¹‹ç±»çš„è¯­æ³•é”™è¯¯ä¹Ÿæœ‰ç›¸å…³æç¤ºã€‚</p><hr><p>æœ€åä¸€ä¸ªæ‰æ˜¯æœ¬æ¬¡è®¨è®ºçš„é‡ç‚¹ï¼Œä¹Ÿå°±æ˜¯é€’å½’å‡½æ•°çš„æ”¯æŒã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int <span class="title function_">num</span>(<span class="params">int x,int y</span>)&#123;</span><br><span class="line"><span class="keyword">if</span> (y==<span class="number">1</span> || y ==x) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">int v1 = <span class="title function_">num</span>(x - <span class="number">1</span>, y - <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸­ <code>int v1 = num(x - 1, y - 1);</code> è¿™è¡Œä»£ç æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œå…·ä½“åŸå› åæ–‡ä¼šåˆ†æã€‚</p><p>ç°åœ¨åˆ©ç”¨é€’å½’ä¾¿å¯ä»¥å®ç°ç±»ä¼¼äº<code>æ‰“å°æ¨è¾‰ä¸‰è§’</code>ä¹‹ç±»çš„ç¨‹åºäº†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">int <span class="title function_">num</span>(<span class="params">int x,int y</span>)&#123;</span><br><span class="line"><span class="keyword">if</span> (y==<span class="number">1</span> || y ==x) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">    int v1 = <span class="title function_">num</span>(x - <span class="number">1</span>, y - <span class="number">1</span>);</span><br><span class="line">    int v2 = <span class="title function_">num</span>(x - <span class="number">1</span>, y);</span><br><span class="line">int c = v1+v2;</span><br><span class="line">    <span class="comment">// int c = num(x - 1, y - 1)+num(x - 1, y);</span></span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">printTriangle</span>(<span class="params">int row</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (int i = <span class="number">1</span>; i &lt;= row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (int j = <span class="number">1</span>; j &lt;= row - i; j++) &#123;</span><br><span class="line">           <span class="title function_">print</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (int j = <span class="number">1</span>; j &lt;= i; j++) &#123;</span><br><span class="line">            <span class="title function_">print</span>(<span class="title function_">num</span>(i, j) + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">printTriangle</span>(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line">      <span class="number">1</span> </span><br><span class="line">     <span class="number">1</span> <span class="number">1</span> </span><br><span class="line">    <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> </span><br><span class="line">   <span class="number">1</span> <span class="number">3</span> <span class="number">3</span> <span class="number">1</span> </span><br><span class="line">  <span class="number">1</span> <span class="number">4</span> <span class="number">6</span> <span class="number">4</span> <span class="number">1</span> </span><br><span class="line"> <span class="number">1</span> <span class="number">5</span> <span class="number">10</span> <span class="number">10</span> <span class="number">5</span> <span class="number">1</span> </span><br><span class="line"><span class="number">1</span> <span class="number">6</span> <span class="number">15</span> <span class="number">20</span> <span class="number">15</span> <span class="number">6</span> <span class="number">1</span> </span><br></pre></td></tr></table></figure><h1 id="å‡½æ•°ä¸­çš„-return"><a href="#å‡½æ•°ä¸­çš„-return" class="headerlink" title="å‡½æ•°ä¸­çš„ return"></a>å‡½æ•°ä¸­çš„ return</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int <span class="title function_">num</span>(<span class="params">int x,int y</span>)&#123;</span><br><span class="line"><span class="keyword">if</span> (y==<span class="number">1</span> || y ==x) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">int v1 = <span class="title function_">num</span>(x - <span class="number">1</span>, y - <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ ·çš„ä»£ç ä¸ºä»€ä¹ˆæ‰§è¡Œå®Œ <code>return 1</code> ä¹‹åå°±ä¸ä¼šæ‰§è¡Œåè¾¹çš„è¯­å¥äº†ã€‚</p><p>å…¶å®åœ¨æ­¤ä¹‹å‰æˆ‘é¦–å…ˆè§£å†³çš„æ—¶å€™å‡½æ•° <code>return</code> åä¸èƒ½æ‰§è¡Œåç»­ <code>statement</code> çš„éœ€æ±‚ï¼Œå…¶å®æ­£å¥½å°±æ˜¯ä¸Šæ–‡æåˆ°çš„é€»è¾‘ï¼Œåªæ˜¯è¿™é‡Œæ˜¯é€’å½’è€Œå·²ã€‚</p><p>å…ˆæŠŠä»£ç ç®€åŒ–ä¸€ä¸‹æ–¹ä¾¿åˆ†æï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int <span class="title function_">f1</span>(<span class="params">int a</span>)&#123;</span><br><span class="line"><span class="keyword">if</span> (a==<span class="number">10</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">println</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‚æ•° a ç­‰äº 10 çš„æ—¶å€™ç¡®å®ä¸èƒ½æ‰§è¡Œåç»­çš„æ‰“å°è¯­å¥äº†ï¼Œé‚£ä¹ˆå¦‚ä½•å®ç°è¯¥éœ€æ±‚å‘¢ï¼Ÿ</p><p>ä»¥æ­£å¸¸äººç±»çš„æ€è€ƒæ–¹å¼ï¼šå½“æˆ‘ä»¬æ‰§è¡Œå®Œ <code>return</code> è¯­å¥çš„æ—¶å€™ï¼Œå°±åº”è¯¥æ ‡è®°è¯¥è¯­å¥æ‰€å±çš„å‡½æ•°ç›´æ¥è¿”å›ï¼Œä¸èƒ½åœ¨æ‰§è¡Œåç»­çš„ <code>statement</code>ã€‚</p><p>å¯æ˜¯è¿™åº”è¯¥å¦‚ä½•å®æ“å‘¢ï¼Ÿ</p><p>å…¶å®çœ‹çœ‹ <code>AST</code> å°±èƒ½æ˜ç™½äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6kgqzbu9xj21ss0u0wiy.jpg"></p><p>å½“ç¢°åˆ° <code>return</code> è¯­å¥çš„æ—¶ï¼Œä¼šé€’å½’å‘ä¸Šéå†è¯­æ³•æ ‘ï¼Œæ ‡è®°ä¸Šæ‰€æœ‰ <code>block</code> èŠ‚ç‚¹è¡¨æ˜è¿™ä¸ª <code>block</code> åç»­çš„è¯­å¥ä¸å†æ‰§è¡Œäº†ï¼ŒåŒæ—¶è¿˜å¾—æŠŠè¿”å›å€¼è®°å½•ä¸‹æ¥ã€‚</p><p>è¿™æ ·å½“æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª <code>statement</code> æ—¶ï¼Œä¹Ÿå°±æ˜¯ <code>println(&quot;abc&quot;);</code> åˆ™ä¼šåˆ¤æ–­ä»–æ‰€å±çš„ <code>block</code> æ˜¯å¦æœ‰è¢«æ ‡è®°ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œè¿™æ ·ä¾¿å®ç°äº† <code>return</code> è¯­å¥ä¸æ‰§è¡Œåç»­ä»£ç ã€‚</p><p>éƒ¨åˆ†å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ return çš„æ—¶å€™é€’å½’å‘ä¸Šæ‰«ææ‰€æœ‰çš„ Blockï¼Œå¹¶æ‰“ä¸Šæ ‡è®°ï¼Œç”¨äºåé¢æ‰§è¡Œ return çš„æ—¶å€™ç›´æ¥è¿”å›ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Visitor)</span></span> scanBlockStatementCtx(tree antlr.ParseTree, value <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">context, ok := tree.(*parser.BlockContext)</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line"><span class="keyword">if</span> v.blockCtx2Mark == <span class="literal">nil</span> &#123;</span><br><span class="line">v.blockCtx2Mark = <span class="built_in">make</span>(<span class="keyword">map</span>[*parser.BlockContext]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line">v.blockCtx2Mark[context] = value</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> tree.GetParent() != <span class="literal">nil</span> &#123;</span><br><span class="line">v.scanBlockStatementCtx(tree.GetParent().(antlr.ParseTree), value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6kh2esn6jj214m0u0tec.jpg"></p><p>æºç åœ°å€ï¼š<br><a href="https://github.com/crossoverJie/gscript/blob/793d196244416574bd6be641534742e57c54db7a/visitor.go#L182">https://github.com/crossoverJie/gscript/blob/793d196244416574bd6be641534742e57c54db7a/visitor.go#L182</a></p><h1 id="é€’å½’çš„é—®é¢˜"><a href="#é€’å½’çš„é—®é¢˜" class="headerlink" title="é€’å½’çš„é—®é¢˜"></a>é€’å½’çš„é—®é¢˜</h1><p>ä½†åŒæ—¶é—®é¢˜ä¹Ÿæ¥äº†ï¼Œå°±æ˜¯é€’å½’çš„æ—¶å€™ä¹Ÿä¸ä¼šæ‰§è¡Œåç»­çš„é€’å½’ä»£ç äº†ã€‚</p><p>å…¶å®è§£å†³é—®é¢˜çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨åˆ¤æ–­æ˜¯å¦éœ€è¦ç›´æ¥è¿”å›é‚£é‡Œæ–°å¢ä¸€ä¸ªæ¡ä»¶ï¼Œè¿™ä¸ª <code>block</code> ä¸­ä¸å­˜åœ¨é€’å½’è°ƒç”¨ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±å¾—å…ˆçŸ¥é“è¿™ä¸ª <code>block</code> ä¸­æ˜¯å¦å­˜åœ¨é€’å½’è°ƒç”¨ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li>ç¼–è¯‘æœŸï¼šåœ¨å‡½æ•°å£°æ˜å¤„è®°å½•ä¸‹å‡½æ•°ä¸å½“å‰ <code>context</code> çš„æ˜ å°„å…³ç³»ã€‚</li><li>ç¼–è¯‘æœŸï¼šæ‰«æ <code>statement</code> æ—¶ï¼Œå–å‡ºè¯¥ <code>statement</code> çš„ <code>context</code> æ‰€å¯¹åº”çš„å‡½æ•°ã€‚</li><li>ç¼–è¯‘æœŸï¼šæ‰«æåˆ°çš„ <code>statement</code> å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œåˆ™åˆ¤æ–­è¯¥å‡½æ•°æ˜¯å¦ä¸ºè¯¥ <code>block</code> ä¸­çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒæ­¥å–å‡ºçš„å‡½æ•°ã€‚</li><li>ç¼–è¯‘æœŸï¼šå¦‚æœä¸¤ä¸ªå‡½æ•°ç›¸ç­‰ï¼Œåˆ™å°†å½“å‰ <code>block</code> æ ‡è®°ä¸ºé€’å½’è°ƒç”¨ã€‚</li><li>è¿è¡ŒæœŸï¼šåœ¨åˆšæ‰åˆ¤æ–­ <code>return</code> è¯­å¥å¤„ï¼Œé¢å¤–å¤šå‡ºåˆ¤æ–­å½“å‰ <code>block</code> æ˜¯å¦ä¸ºé€’å½’è°ƒç”¨ï¼Œå¦‚æœæ˜¯åˆ™ä¸èƒ½è¿”å›ã€‚</li></ul><p>éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6khkphcxtj21660u043f.jpg"><br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6khle6mnvj219a0g2tbj.jpg"></p><p><a href="https://github.com/crossoverJie/gscript/blob/3e179f27cb30ca5c3af57b3fbf2e46075baa266b/resolver/ref_resolver.go#L70">https://github.com/crossoverJie/gscript/blob/3e179f27cb30ca5c3af57b3fbf2e46075baa266b/resolver/ref_resolver.go#L70</a></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™é‡Œçš„é€’å½’è°ƒç”¨å…¶å®å¡äº†æˆ‘æŒºé•¿æ—¶é—´çš„ï¼Œæ€è·¯æ˜¯æœ‰çš„ï¼Œä½†æ˜¯å†™å‡ºæ¥çš„ä»£ç æ€»æ˜¯å’Œé¢„æœŸä¸ç¬¦ï¼Œå½“å¤©æ™šä¸Šååœ¨ç”µè„‘é¢å‰åˆ°å‡Œæ™¨ä¸¤ä¸‰ç‚¹ï¼Œç™¾æ€ä¸å¾—å…¶è§£ã€‚</p><p>æœ€åå—ä¸äº†ä¸ŠåºŠä¼‘æ¯çš„æ—¶å€™ï¼Œçªç„¶ä¸€ä¸ªçµå…‰ä¹ç°è®©æˆ‘æƒ³åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œäºæ˜¯ç¬¬äºŒå¤©èµ·äº†ä¸ªæ—©åºŠèµ¶å¿™å®è·µï¼Œè¿˜çœŸç»™è§£å†³äº†ã€‚</p><p>æ‰€ä»¥æœ‰äº›æ—¶å€™ç¢°åˆ°æ£˜æ‰‹é—®é¢˜æ—¶ç»™è‡ªå·±æ”¾æ¾ä¸€ä¸‹ï¼Œå¾€å¾€ä¼šæœ‰å‡ºå…¶ä¸æ„çš„æ•ˆæœã€‚</p><p>æœ€åæ˜¯ç›®å‰çš„é€’å½’åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½è¿˜æœ‰äº›é—®é¢˜ï¼Œåç»­ä¼šå°½é‡å°†è¿™äº›æ ‡è®°è¿‡ç¨‹éƒ½æ”¾åœ¨ç¼–è¯‘æœŸï¼Œç¼–è¯‘æ…¢ç‚¹æ²¡äº‹ï¼Œä½†è¿è¡Œæ—¶æ…¢é‚£å°±æœ‰é—®é¢˜äº†ã€‚</p><p>ä¹‹åè¿˜ä¼šç»§ç»­ä¼˜åŒ–è¿è¡Œæ—¶çš„å¼‚å¸¸ï¼Œç›®å‰æ˜¯ç›´æ¥ <code>panic</code>ï¼Œå †æ ˆä¹Ÿæ²¡æœ‰ï¼Œä½“æ„Ÿéå¸¸ä¸å¥½ï¼›æ¬¢è¿æ„Ÿå…´è¶£çš„æœ‹å‹è¯•ç”¨åé¦ˆbugã€‚</p><p>æºç åœ°å€ï¼š</p><p><a href="https://github.com/crossoverJie/gscript">https://github.com/crossoverJie/gscript</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h6k7cg9ushj20ic05kdge.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹åœ¨ &lt;a href=&quot;https://github.com/crossoverJie/gscript&quot;&gt;GScript&lt;/a&gt; ä¸­å®ç°é€’å½’è°ƒç”¨æ—¶æ‰€é‡åˆ°çš„å‘ï¼Œç±»ä¼¼çš„é—®é¢˜åœ¨ä¸­æ–‡äº’è”ç½‘ä¸Šæˆ‘å‡ ä¹æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„å†…å®¹ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾ˆæœ‰å¿…è¦è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å§‹ä¹‹å‰è¿˜æ˜¯ç®€å•ä»‹ç»ä¸‹æœ¬æ¬¡æ›´æ–°çš„ &lt;code&gt;GScript&lt;/code&gt; v0.0.9 æ‰€åŒ…å«çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¯å˜å‚æ•°&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ– &lt;code&gt;append&lt;/code&gt; å‡½æ•°è¯­ä¹‰&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–ç¼–è¯‘é”™è¯¯ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æœ€åä¸€ä¸ªå°±æ˜¯æ”¯æŒé€’å½’è°ƒç”¨&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="é€’å½’" scheme="http://crossoverjie.top/tags/%E9%80%92%E5%BD%92/"/>
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="antlr" scheme="http://crossoverjie.top/tags/antlr/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹å†™ç¼–ç¨‹è¯­è¨€-å®ç°è¿ç®—ç¬¦é‡è½½</title>
    <link href="http://crossoverjie.top/2022/09/18/gscript/gscript06-operator-overloading/"/>
    <id>http://crossoverjie.top/2022/09/18/gscript/gscript06-operator-overloading/</id>
    <published>2022-09-18T00:08:08.000Z</published>
    <updated>2022-09-18T14:04:58.770Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6at95ynkaj21900u07aw.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å…ˆå¸¦æ¥æ—¥å¸¸çš„ <a href="https://github.com/crossoverJie/gscript">GScript</a> æ›´æ–°ï¼šæ–°å¢äº†å¯å˜å‚æ•°çš„ç‰¹æ€§ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int <span class="title function_">add</span>(<span class="params">string s, int ...num</span>)&#123;</span><br><span class="line"><span class="title function_">println</span>(s);</span><br><span class="line">int sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(int i=<span class="number">0</span>;i&lt;<span class="title function_">len</span>(num);i++)&#123;</span><br><span class="line">int v = num[i];</span><br><span class="line">sum = sum+v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line">int x = <span class="title function_">add</span>(<span class="string">&quot;abc&quot;</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"><span class="title function_">println</span>(x);</span><br><span class="line"><span class="title function_">assertEqual</span>(x, <span class="number">10</span>);</span><br></pre></td></tr></table></figure><span id="more"></span><p>å¾—ç›Šäºå¯å˜å‚æ•°ï¼Œæ‰€ä»¥æ–°å¢äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å†…ç½®å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//formats according to a format specifier and writes to standard output.</span></span><br><span class="line"><span class="title function_">printf</span>(<span class="params">string format, any ...a</span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//formats according to a format specifier and returns the resulting string.</span></span><br><span class="line">string <span class="title function_">sprintf</span>(<span class="params">string format, any ...a</span>)&#123;&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢é‡ç‚¹çœ‹çœ‹ <a href="https://github.com/crossoverJie/gscript#operator-overloading">GScript</a> æ‰€æ”¯æŒçš„è¿ç®—ç¬¦é‡è½½æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>è¿ç®—ç¬¦é‡è½½å…¶å®ä¹Ÿæ˜¯å¤šæ€çš„ä¸€ç§è¡¨ç°å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¿ç®—ç¬¦çš„é‡è½½å‡½æ•°ï¼Œä»è€Œæ”¹å˜ä»–ä»¬çš„è®¡ç®—è§„åˆ™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">println</span>(<span class="number">100</span>+<span class="number">2</span>*<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>ä»¥è¿™æ®µä»£ç çš„è¿ç®—ç¬¦ä¸ºä¾‹ï¼Œè¾“å‡ºçš„ç»“æœè‡ªç„¶æ˜¯ï¼š104.</p><p>ä½†å¦‚æœæˆ‘ä»¬æ˜¯å¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œè®¡ç®—å‘¢ï¼Œä¸¾ä¸ªä¾‹å­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"><span class="type">int</span> age;</span><br><span class="line">Person(<span class="type">int</span> a)&#123;</span><br><span class="line">age = a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> Person(<span class="number">10</span>);</span><br><span class="line"><span class="type">Person</span> <span class="variable">p2</span> <span class="operator">=</span> Person(<span class="number">20</span>);</span><br><span class="line"><span class="type">Person</span> <span class="variable">p3</span> <span class="operator">=</span> p1+p2;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„å†™æ³•åœ¨ <code>Java/Go</code> ä¸­éƒ½ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºä»–ä»¬ä¸¤è€…éƒ½ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼›</p><p>ä½† <code>Python/C#</code> æ˜¯æ”¯æŒçš„ï¼Œç›¸æ¯”ä¹‹ä¸‹æˆ‘è§‰å¾— <code>C#</code> çš„å®ç°æ–¹å¼æ›´ç¬¦åˆ <code>GScript</code> è¯­æ³•ï¼Œæ‰€ä»¥å‚è€ƒ C# å®ç°äº†ä»¥ä¸‹çš„è¯­æ³•è§„åˆ™ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Person</span> operator + (<span class="title class_">Person</span> p1, <span class="title class_">Person</span> p2)&#123;</span><br><span class="line"><span class="title class_">Person</span> pp = <span class="title class_">Person</span>(p1.<span class="property">age</span>+p2.<span class="property">age</span>);</span><br><span class="line"><span class="keyword">return</span> pp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span> p3 = p1+p2;</span><br><span class="line"><span class="title function_">println</span>(<span class="string">&quot;p3.age=&quot;</span>+p3.<span class="property">age</span>);</span><br><span class="line"><span class="title function_">assertEqual</span>(p3.<span class="property">age</span>, <span class="number">30</span>);</span><br></pre></td></tr></table></figure><p>æœ‰å‡ ä¸ªç¡¬æ€§æ¡ä»¶ï¼š</p><ul><li>å‡½æ•°åå¿…é¡»æ˜¯ <code>operator</code> </li><li>åç§°åè·Ÿä¸Šè¿ç®—ç¬¦å³å¯ã€‚</li></ul><blockquote><p>ç›®å‰æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ï¼š+-*&#x2F;   &#x3D;&#x3D; !&#x3D; &lt; &lt;&#x3D; &gt; &gt;&#x3D;</p></blockquote><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>ä»¥å‰åœ¨ä½¿ç”¨ <code>Python</code> è¿ç®—ç¬¦é‡è½½æ—¶å°±æœ‰æƒ³è¿‡å®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿä½†æ²¡æœ‰æ·±ç©¶ï¼Œè¿™æ¬¡å€Ÿç€è‡ªå·±å®ç°ç›¸å…³åŠŸèƒ½ä»è€Œéœ€è¦æ·±å…¥ç†è§£ã€‚</p><p>å…¶ä¸­é‡ç‚¹å°±ä¸ºä¸¤æ­¥ï¼š</p><ol><li>ç¼–è¯‘æœŸé—´ï¼šè®°å½•æ‰€æœ‰çš„é‡è½½å‡½æ•°å’Œè¿ç®—ç¬¦çš„å…³ç³»ã€‚</li><li>è¿è¡ŒæœŸï¼šæ ¹æ®å½“å‰çš„è¿ç®—æ‰¾åˆ°å£°æ˜çš„å‡½æ•°ï¼Œç›´æ¥è¿è¡Œå³å¯ã€‚</li></ol><p>ç¬¬ä¸€æ­¥çš„é‡ç‚¹æ˜¯æ‰«ææ‰€æœ‰çš„é‡è½½å‡½æ•°ï¼Œå°†é‡è½½å‡½æ•°ä¸è¿ç®—ç¬¦å­˜æ”¾èµ·æ¥ï¼Œéœ€è¦å…³æ³¨çš„æ˜¯å‡½æ•°çš„è¿”å›å€¼ä¸è¿ç®—ç¬¦ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OpOverload é‡è½½ç¬¦</span></span><br><span class="line"><span class="keyword">type</span> OpOverload <span class="keyword">struct</span> &#123;</span><br><span class="line">function  *Func</span><br><span class="line">tokenType <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿ç®—ç¬¦é‡è½½è‡ªå®šä¹‰å‡½æ•°</span></span><br><span class="line">opOverloads []*symbol.OpOverload</span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘å™¨ä¸­ä½¿ç”¨ä¸€ä¸ªåˆ‡ç‰‡å­˜æ”¾ã€‚</p><p>è€Œåœ¨è¿è¡ŒæœŸä¸­å½“ä¸¤ä¸ªå…¥å‚ç±»å‹ç›¸åŒæ—¶ï¼Œåˆ™éœ€è¦æŸ¥æ‰¾é‡è½½å‡½æ•°ã€‚<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h6b310mefaj21ky05u3zz.jpg"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetOpFunction è·å–è¿ç®—ç¬¦é‡è½½å‡½æ•°</span></span><br><span class="line"><span class="comment">// é€šè¿‡è¿”å›å€¼ä»¥åŠè¿ç®—ç¬¦å·(+-*/) åŒ¹é…é‡è½½å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AnnotatedTree)</span></span> GetOpFunction(returnType symbol.Type, tokenType <span class="type">int</span>) *symbol.Func &#123;</span><br><span class="line"><span class="keyword">for</span> _, overload := <span class="keyword">range</span> a.opOverloads &#123;</span><br><span class="line">isType := overload.GetFunc().GetReturnType().IsType(returnType)</span><br><span class="line"><span class="keyword">if</span> isType &amp;&amp; overload.GetTokenType() == tokenType &#123;</span><br><span class="line"><span class="keyword">return</span> overload.GetFunc()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾æ–¹å¼å°±æ˜¯é€šè¿‡ç¼–è¯‘æœŸå­˜æ”¾çš„æ•°æ®è¿›è¡ŒåŒ¹é…ï¼Œæ‹¿åˆ°é‡è½½å‡½æ•°åè‡ªåŠ¨è°ƒç”¨ä¾¿å®ç°äº†é‡è½½ã€‚</p><p>æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥æŸ¥çœ‹ç›¸å…³ä»£ç ï¼š</p><ul><li><p>ç¼–è¯‘æœŸï¼š<a href="https://github.com/crossoverJie/gscript/blob/ae729ce7d4cf39fe115121993fcd2222716755e5/resolver/type_scope_resolver.go#L127">https://github.com/crossoverJie/gscript/blob/ae729ce7d4cf39fe115121993fcd2222716755e5/resolver/type_scope_resolver.go#L127</a></p></li><li><p>è¿è¡ŒæœŸï¼š<a href="https://github.com/crossoverJie/gscript/blob/499236af549be47ff827c6d55de1fc8e5600b9b3/visitor.go#L387">https://github.com/crossoverJie/gscript/blob/499236af549be47ff827c6d55de1fc8e5600b9b3/visitor.go#L387</a></p></li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿ç®—ç¬¦é‡è½½å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„åŠŸèƒ½ï¼›å› ä¸ºä¼šæ”¹å˜è¿ç®—ç¬¦çš„è¯­ä¹‰ï¼Œæ¯”å¦‚æ˜æ˜æ˜¯åŠ æ³•å´åœ¨é‡è½½å‡½æ•°ä¸­å†™ä¸ºå‡æ³•ã€‚</p><p>è¿™ä¼šä½¿å¾—ä»£ç é˜…è¯»èµ·æ¥å›°éš¾ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬åˆéå¸¸å¸Œæœ›è¯­è¨€æœ¬èº«èƒ½æ”¯æŒè¿ç®—ç¬¦é‡è½½ã€‚</p><p>æ¯”å¦‚åœ¨ Go ä¸­å¸¸ç”¨çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹ç²¾åº¦åº“<code>decimal.Decimal</code>ï¼Œè¿›è¡Œè¿ç®—æ—¶åªèƒ½ä½¿ç”¨ <code>d1.Add(d2)</code> è¿™æ ·çš„å‡½æ•°ï¼Œå½“è¿ç®—å¤æ‚æ—¶ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a5 = (a1.Add(a2).Add(a3)).Mul(a4);</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a5 = (a1+a2+a3)*a4;</span><br></pre></td></tr></table></figure><p>å°±ä¸å¦‚ä¸‹é¢è¿™ç§ç›´è§‚ï¼Œæ‰€ä»¥æœ‰åˆ©æœ‰å¼Šå§ï¼Œå¤šä¸€ä¸ªé€‰é¡¹æ€»ä¸æ˜¯åäº‹ã€‚</p><p>GScript æºç ï¼š<br><a href="https://github.com/crossoverJie/gscript">https://github.com/crossoverJie/gscript</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h6at95ynkaj21900u07aw.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å…ˆå¸¦æ¥æ—¥å¸¸çš„ &lt;a href=&quot;https://github.com/crossoverJie/gscript&quot;&gt;GScript&lt;/a&gt; æ›´æ–°ï¼šæ–°å¢äº†å¯å˜å‚æ•°çš„ç‰¹æ€§ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;int &lt;span class=&quot;title function_&quot;&gt;add&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;string s, int ...num&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;title function_&quot;&gt;println&lt;/span&gt;(s);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int sum = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(int i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;title function_&quot;&gt;len&lt;/span&gt;(num);i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		int v = num[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		sum = sum+v;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;int x = &lt;span class=&quot;title function_&quot;&gt;add&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;abc&amp;quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title function_&quot;&gt;println&lt;/span&gt;(x);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title function_&quot;&gt;assertEqual&lt;/span&gt;(x, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="antlr" scheme="http://crossoverjie.top/tags/antlr/"/>
    
    <category term="è¿ç®—ç¬¦é‡è½½" scheme="http://crossoverjie.top/tags/%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨è‡ªå·±çš„ç¼–ç¨‹è¯­è¨€å®ç°äº†ä¸€ä¸ªç½‘ç«™</title>
    <link href="http://crossoverjie.top/2022/09/14/gscript/gscript05-write-site/"/>
    <id>http://crossoverjie.top/2022/09/14/gscript/gscript05-write-site/</id>
    <published>2022-09-14T00:08:08.000Z</published>
    <updated>2022-09-13T17:38:42.968Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h65ahhmp7uj20h80beweu.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ä¸Šä¸€ç¯‡<a href="https://crossoverjie.top/2022/09/07/gscript/gscript04-preview/">ã€Šç»ˆäºå®ç°äº†ä¸€é—¨å±äºè‡ªå·±çš„ç¼–ç¨‹è¯­è¨€ã€‹</a> ä»‹ç»äº†è‡ªå·±å†™çš„ç¼–ç¨‹è¯­è¨€ <a href="https://github.com/crossoverJie/gscript">GScript</a> ï¼Œåœ¨æ–‡ä¸­æåˆ°å¸Œæœ›æœ€ç»ˆå¯ä»¥ä½¿ç”¨ <code>GScript</code> å¼€å‘ä¸€ä¸ªç½‘ç«™ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ç¡®å®æ˜¯åšåˆ°äº†ï¼Œé¦–é¡µåœ°å€ï¼š</p><p><a href="https://gscript.crossoverjie.top/index">https://gscript.crossoverjie.top/index</a></p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h65g2ios46j20zk0iyabv.jpg"></p><p>è¦ç§°ä¸ºä¸€ä¸ªç½‘ç«™ç¡®å®æœ‰ç‚¹å‹‰å¼ºï¼Œä¸è¿‡ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€ç½‘é¡µï¼Œå› ä¸ºè¿”å›çš„æ˜¯ <code>HTML</code>ï¼Œæ‰€ä»¥åœ¨å½“å‰é˜¶æ®µåªè¦ä¸å«Œéº»çƒ¦å…¶å®ä¹Ÿèƒ½å†™ä¸€ä¸ªâ€œåˆæ ¼â€çš„ç½‘ç«™ï¼Œæœ‰ç‚¹åƒä»¥å‰æˆ‘ä»¬å­¦ä¹  <code>Java</code> æ—¶çš„ <code>servlet</code>ã€‚</p><span id="more"></span><p>è¯¥é¡µé¢çš„æºç åœ°å€åœ¨è¿™é‡Œï¼š<br><a href="https://github.com/crossoverjie/gscript-homepage">https://github.com/crossoverjie/gscript-homepage</a></p><p>å…¶å®æ€»å…±ä¹Ÿå°±40æ¥è¡Œä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GScript</span>&#123;</span><br><span class="line">    string author;</span><br><span class="line">    string[] features;</span><br><span class="line">    string since;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">GScript</span>(string a, string[] f, string s)&#123;</span><br><span class="line">        author = a;</span><br><span class="line">        features = f;</span><br><span class="line">        since = s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (<span class="title class_">HttpContext</span>) <span class="title function_">index</span>(<span class="params">HttpContext ctx</span>)&#123;</span><br><span class="line">    string[] features = &#123;<span class="string">&quot;statically&quot;</span>, <span class="string">&quot;strongly&quot;</span>&#125;;</span><br><span class="line">    <span class="title class_">GScript</span> gs = <span class="title class_">GScript</span>(<span class="string">&quot;crossoverJie&quot;</span>,features, <span class="string">&quot;2022&quot;</span>);</span><br><span class="line">    string j = <span class="title class_">JSON</span>(gs);</span><br><span class="line">    <span class="title function_">println</span>(j);</span><br><span class="line">    string local = <span class="title function_">getCurrentTime</span>(<span class="string">&quot;Asia/Shanghai&quot;</span>,<span class="string">&quot;2006-01-02 15:04:05&quot;</span>);</span><br><span class="line">    <span class="title function_">println</span>(<span class="string">&quot;local=&quot;</span> + local);</span><br><span class="line">    string html = ^</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">title</span>&gt;</span>GScript<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                 _     _   </span></span><br><span class="line"><span class="language-xml"> ___ ___ ___ ___|_|___| |_ </span></span><br><span class="line"><span class="language-xml">| . |_ -|  _|  _| | . |  _|</span></span><br><span class="line"><span class="language-xml">|_  |___|___|_| |_|  _|_|  </span></span><br><span class="line"><span class="language-xml">|___|             |_|   v0.0.7   </span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">^+ j +^</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>current ^+ local +^<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/crossoverjie/gscript-homepage&quot;</span>&gt;</span>GScript-homepace source code<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">    ^;</span><br><span class="line">    ctx.<span class="title function_">HTML</span>(<span class="number">200</span>, html);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">httpHandle</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;/index&quot;</span>, index);</span><br><span class="line">string[] args = <span class="title function_">getOSArgs</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">len</span>(args) ==<span class="number">3</span>)&#123;</span><br><span class="line">    <span class="title function_">httpRun</span>(<span class="string">&quot;:&quot;</span> + args[<span class="number">2</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">httpRun</span>(<span class="string">&quot;:8000&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¨æ˜¯åˆ©ç”¨ <code>GScript</code> æ‰€æä¾›çš„æ ‡å‡†åº“å®ç°çš„ï¼Œåæ–‡ä¼šè¯¦ç»†èŠèŠå†…ç½® HTTP åŒ…ã€‚</p><h1 id="æ›´æ–°å†…å®¹"><a href="#æ›´æ–°å†…å®¹" class="headerlink" title="æ›´æ–°å†…å®¹"></a>æ›´æ–°å†…å®¹</h1><p>ä¸‹é¢é‡ç‚¹æ¥çœ‹çœ‹ <code>v0.0.8</code> è¿™ä¸ªç‰ˆæœ¬ç›¸è¾ƒäºä¸Šä¸€ä¸ªæ›´æ–°äº†å“ªäº›åœ°æ–¹ã€‚</p><p>å› ä¸ºæˆ‘æ˜¯æŠŠè‡ªå·±å½“åšä¸€ä¸ªå¼€å‘è€…çš„è§’åº¦å»å®ç°äº†ä¸€ä¸ª http æœåŠ¡ï¼ŒåŒæ—¶è¿˜ç”¨ <code>GScript</code> åˆ·äº†ä¸¤é“ç®€å•çš„ LeetCodeï¼›ä¸ºäº†è®©è¿™ä¸ªè¿‡ç¨‹æ›´æµç•…ï¼Œæ›´ç¬¦åˆä¸€ä¸ªç°ä»£è¯­è¨€çš„ä½¿ç”¨æ–¹å¼ï¼Œæ‰€ä»¥æœ¬æ¬¡çœŸçš„æ›´æ–°ä¸å°‘ä¸œè¥¿ã€‚</p><blockquote><p>åˆ·é¢˜æºç ï¼š<a href="https://github.com/crossoverJie/gscript/tree/main/example/leetcode">https://github.com/crossoverJie/gscript/tree/main/example/leetcode</a></p></blockquote><p>å¤§æ¦‚å¦‚ä¸‹ï¼š</p><ul><li><code>any</code> ç±»å‹çš„æ”¯æŒï¼Œç®€åŒ–æ ‡å‡†åº“çš„å®ç°ã€‚</li><li>å¯ä»¥ç”¨ <code>^^</code> æ¥å£°æ˜å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿å£°æ˜å¤æ‚å­—ç¬¦ä¸²ã€‚</li><li>æ›´å®Œå–„çš„ç±»å‹æ¨å¯¼ï¼Œä¿®å¤äº†ä¸Šä¸ªç‰ˆæœ¬ä¸­æŸäº›æƒ…å†µæ¨å¯¼ä¸å‡ºç±»å‹çš„bugã€‚</li><li>æ”¯æŒè¿ç®—ç¬¦é‡è½½ã€‚</li><li>åŸºæœ¬çš„ http åŒ…ï¼Œå¯ä»¥å¼€å‘å‡º http æœåŠ¡ï¼Œç›®å‰èƒ½å“åº” <code>JSON</code> ä»¥åŠ <code>HTML</code>ã€‚</li><li>æ–°å¢å†…ç½®å‡½æ•°ï¼šæ ¹æ®æ—¶åŒºè·å–å½“å‰æ—¶é—´ã€è·å–åº”ç”¨å¯åŠ¨å‚æ•°ç­‰ã€‚</li><li><code>JSON</code> çš„åºåˆ—è¡¨ä»¥åŠæŸ¥è¯¢ï¼Œè¯­æ³•çº§é€‚é…äº† <a href="https://github.com/crossoverJie/xjson">XJSON</a>ã€‚</li><li>ä¿®å¤äº†åœ¨å¤šä¸ª <code>block</code> åµŒå¥—æƒ…å†µä¸‹ä¸èƒ½æ­£ç¡® <code>return</code> çš„ bugã€‚</li></ul><p>å…¶å®ä»è¿™äº›æ›´æ–°ä¸­ä¹Ÿèƒ½çœ‹å‡ºï¼Œä¸Šä¸ªç‰ˆæœ¬åªæ˜¯ä¸€ä¸ªç®€å•èƒ½ç”¨çš„çŠ¶æ€ï¼Œè€Œç°åœ¨è¿™ä¸ªç‰ˆæœ¬å·²ç»å¯ä»¥æ‹¿æ¥å†™å¤æ‚é€»è¾‘äº†ï¼Œå½“ç„¶ç›®å‰è¿˜ç¼ºä¹ä¸€äº›æ›´å‹å¥½çš„ç¼–è¯‘æç¤ºä»¥åŠè¿è¡Œæ—¶é”™è¯¯ã€‚</p><p>ä¸‹é¢ä»”ç»†èŠèŠä¸€äº›æ›´æ–°å†…å®¹ã€‚</p><h2 id="any-ç±»å‹"><a href="#any-ç±»å‹" class="headerlink" title="any ç±»å‹"></a>any ç±»å‹</h2><p>é¦–å…ˆæ˜¯ <code>any</code> é€šç”¨ç±»å‹ï¼Œè¿™ä¸ªç±»ä¼¼äº Java ä¸­çš„ <code>Object</code> å’Œ Go ä¸­çš„ <code>interface&#123;&#125;</code>,æå¤§çš„æ–¹ä¾¿äº†æˆ‘ä»¬ç¼–å†™ä¸€äº›æ ‡å‡†åº“ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h65gmnjk39j22u20jyjum.jpg"></p><p>ä»¥ä¹‹å‰å†…ç½®çš„ hash å’Œ len å‡½æ•°ä¸ºä¾‹ï¼Œéœ€è¦å¯¹æ¯ç§ç±»å‹éƒ½å®ç°ä¸€éï¼Œéå¸¸éº»çƒ¦è€Œä¸”æ¯«æ— å¿…è¦ï¼›ç°åœ¨åªéœ€è¦å®šä¹‰ä¸€æ¬¡å³å¯ï¼Œä»£ç é‡ç›´æ¥çœå‡ å€ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h65go7c0lrj22ui0hqaem.jpg"><br>åŒç†ï¼Œä¹‹å‰å®ç°çš„ Map åªæ”¯æŒå­˜æ”¾ string ç±»å‹ï¼Œç°åœ¨ä¾¿èƒ½å­˜æ”¾ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚</p><blockquote><p>å¯¹ any çš„å®ç°è¿‡ç¨‹æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œä»Šåå¯ä»¥å•ç‹¬åˆ†äº«ä¸€ä¸‹ã€‚</p></blockquote><h2 id="è¿ç®—ç¬¦é‡è½½"><a href="#è¿ç®—ç¬¦é‡è½½" class="headerlink" title="è¿ç®—ç¬¦é‡è½½"></a>è¿ç®—ç¬¦é‡è½½</h2><p>å†™ go æˆ–è€…æ˜¯ Java çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œè¿™ä¸¤é—¨è¯­è¨€éƒ½æ— æ³•å¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œè¿ç®—ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ã€‚</p><p>ä½†åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹è¿˜æ˜¯è›®å¥½ç”¨çš„ï¼Œäºæ˜¯æˆ‘å‚è€ƒäº† <code>C#</code> çš„è¯­æ³•åœ¨ <code>GScript</code> ä¸­ä¹Ÿå®ç°äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">int age;</span><br><span class="line"><span class="title class_">Person</span>(int a)&#123;</span><br><span class="line">age = a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span> operator + (<span class="title class_">Person</span> p1, <span class="title class_">Person</span> p2)&#123;</span><br><span class="line"><span class="title class_">Person</span> pp = <span class="title class_">Person</span>(p1.<span class="property">age</span>+p2.<span class="property">age</span>);</span><br><span class="line"><span class="keyword">return</span> pp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span> operator - (<span class="title class_">Person</span> p1, <span class="title class_">Person</span> p2)&#123;</span><br><span class="line"><span class="title class_">Person</span> pp = <span class="title class_">Person</span>(p1.<span class="property">age</span>-p2.<span class="property">age</span>);</span><br><span class="line"><span class="keyword">return</span> pp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span> p1 = <span class="title class_">Person</span>(<span class="number">10</span>);</span><br><span class="line"><span class="title class_">Person</span> p2 = <span class="title class_">Person</span>(<span class="number">20</span>);</span><br><span class="line"><span class="title class_">Person</span> p3 = p1+p2;</span><br><span class="line"><span class="title function_">println</span>(<span class="string">&quot;p3.age=&quot;</span>+p3.<span class="property">age</span>);</span><br><span class="line"><span class="title function_">assertEqual</span>(p3.<span class="property">age</span>, <span class="number">30</span>);</span><br></pre></td></tr></table></figure><p>å£°æ˜çš„å‡½æ•°åç§°å¿…é¡»ä¸º <code>operator</code>ï¼Œä¹‹åè·Ÿä¸Šè¿ç®—ç¬¦ä¾¿å®ç°äº†é‡è½½ã€‚</p><p>æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ï¼š<code>+-*/ &lt; &gt;= &lt;= &gt; ==</code>ã€‚</p><h2 id="JSONæ”¯æŒ"><a href="#JSONæ”¯æŒ" class="headerlink" title="JSONæ”¯æŒ"></a>JSONæ”¯æŒ</h2><p>å½“å‰ç‰ˆæœ¬ä¸­æ”¯æŒå°†å¯¹è±¡ã€åŸºæœ¬ç±»å‹è¿›è¡Œåºåˆ—åŒ–ï¼Œæš‚ä¸æ”¯æŒååºåˆ—åŒ–ä¸ºå¯¹è±¡ï¼Œä½†å¯ä»¥æ ¹æ® <code>JSON</code> å­—ç¬¦ä¸²é€šè¿‡ä¸€å®šçš„è¯­æ³•æŸ¥è¯¢æ•°æ®ã€‚</p><p>å†…ç½®äº†ä¸¤ä¸ª JSON ç›¸å…³å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// return JSON string</span></span><br><span class="line">string <span class="title class_">JSON</span>(any a)&#123;&#125;</span><br><span class="line"><span class="comment">// JSON query with path</span></span><br><span class="line">any <span class="title class_">JSON</span>Get(string json, string path)&#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">int age;</span><br><span class="line">string name;</span><br><span class="line">float weight;</span><br><span class="line">bool man;</span><br><span class="line"><span class="title class_">Person</span>(string n, int a, float w, bool m)&#123;</span><br><span class="line">name = n;</span><br><span class="line">age = a;</span><br><span class="line">weight = w;</span><br><span class="line">man =m;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span> p1 = <span class="title class_">Person</span>(<span class="string">&quot;abc&quot;</span>,<span class="number">10</span>,<span class="number">99.99</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="title class_">Person</span> p2 = <span class="title class_">Person</span>(<span class="string">&quot;a&quot;</span>,<span class="number">11</span>,<span class="number">999.99</span>,<span class="literal">false</span>);</span><br><span class="line">string json = <span class="title class_">JSON</span>(p1);</span><br><span class="line"><span class="title function_">println</span>(json);</span><br><span class="line"><span class="comment">// output:&#123;&quot;age&quot;:10,&quot;man&quot;:true,&quot;name&quot;:&quot;abc&quot;,&quot;weight&quot;:99.99&#125;</span></span><br></pre></td></tr></table></figure><p>ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œè°ƒç”¨ <code>JSON</code> å‡½æ•°å¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ä¸º <code>JSON</code> å­—ç¬¦ä¸²ã€‚</p><hr><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">int age;</span><br><span class="line">string name;</span><br><span class="line">float weight;</span><br><span class="line">bool man;</span><br><span class="line"><span class="title class_">Person</span>(string n, int a, float w, bool m)&#123;</span><br><span class="line">name = n;</span><br><span class="line">age = a;</span><br><span class="line">weight = w;</span><br><span class="line">man =m;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span> p1 = <span class="title class_">Person</span>(<span class="string">&quot;abc&quot;</span>,<span class="number">10</span>,<span class="number">99.99</span>,<span class="literal">true</span>);</span><br><span class="line">string json = <span class="title class_">JSON</span>(p1);</span><br><span class="line"><span class="title function_">println</span>(json);</span><br><span class="line"></span><br><span class="line">int age = <span class="title class_">JSON</span>Get(json, <span class="string">&quot;age&quot;</span>);</span><br><span class="line"><span class="title function_">println</span>(age);</span><br><span class="line"><span class="title function_">assertEqual</span>(age,<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>JSONGet</code> å‡½æ•°å¯ä»¥åœ¨ä¸€ä¸ª JSON å­—ç¬¦ä¸²ä¸­æŸ¥è¯¢ä»»æ„çš„æ•°æ®ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯é€šè¿‡é€‚é… <a href="https://github.com/crossoverJie/xjson">XJSON</a> å®ç°çš„ï¼Œæ‰€ä»¥ <code>XJSON</code> æ”¯æŒçš„æŸ¥è¯¢è¯­æ³•éƒ½èƒ½å®ç°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">string j=^&#123;<span class="string">&quot;age&quot;</span>:<span class="number">10</span>, <span class="string">&quot;abc&quot;</span>:&#123;<span class="string">&quot;def&quot;</span>:<span class="string">&quot;def&quot;</span>&#125;,<span class="string">&quot;list&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;^;</span><br><span class="line"><span class="title class_">String</span> def = <span class="title class_">JSON</span>Get(j, <span class="string">&quot;abc.def&quot;</span>);</span><br><span class="line"><span class="title function_">println</span>(def);</span><br><span class="line"><span class="title function_">assertEqual</span>(def,<span class="string">&quot;def&quot;</span>);</span><br><span class="line">int l1 = <span class="title class_">JSON</span>Get(j, <span class="string">&quot;list[0]&quot;</span>);</span><br><span class="line"><span class="title function_">println</span>(l1);</span><br><span class="line"><span class="title function_">assertEqual</span>(l1,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">string str=^</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;bob&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">&quot;skill&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;lang&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;go&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;feature&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;goroutine&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;channel&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;simple&quot;</span>,</span><br><span class="line">                        <span class="literal">true</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">^;</span><br><span class="line"><span class="title class_">String</span> g = <span class="title class_">JSON</span>Get(str, <span class="string">&quot;skill.lang[0].go.feature[0]&quot;</span>);</span><br><span class="line"><span class="title function_">println</span>(g);</span><br><span class="line"><span class="title function_">assertEqual</span>(g,<span class="string">&quot;goroutine&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¿™æ ·å¤æ‚çš„åµŒå¥— <code>JSON</code>ï¼Œä¹Ÿèƒ½é€šè¿‡æŸ¥è¯¢è¯­æ³•è·å–æ•°æ®ã€‚</p><h2 id="HTTP-åŒ…"><a href="#HTTP-åŒ…" class="headerlink" title="HTTP åŒ…"></a>HTTP åŒ…</h2><p>HTTP åŒ…æ˜¯æœ¬æ¬¡å‡çº§çš„é‡ç‚¹ï¼Œæ ‡å‡†åº“ä¸­æä¾›äº†ä»¥ä¸‹å‡½æ•°å’Œç±»ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http lib</span></span><br><span class="line"><span class="comment">// Response json</span></span><br><span class="line"><span class="title class_">FprintfJSON</span>(int code, string path, string json)&#123;&#125;</span><br><span class="line"><span class="comment">// Resonse html</span></span><br><span class="line"><span class="title class_">FprintfHTML</span>(int code, string path, string html)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// path (relative paths may omit leading slash)</span></span><br><span class="line">string <span class="title class_">QueryPath</span>(string path)&#123;&#125;</span><br><span class="line"></span><br><span class="line">string <span class="title class_">FormValue</span>(string path, string key)&#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpContext</span>&#123;</span><br><span class="line">    string path;</span><br><span class="line">    <span class="title class_">JSON</span>(int code, any v)&#123;</span><br><span class="line">        string json = <span class="title class_">JSON</span>(v);</span><br><span class="line">        <span class="title class_">FprintfJSON</span>(code, path, json);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">HTML</span>(<span class="params">int code, any v</span>) &#123;</span><br><span class="line">        string html = v;</span><br><span class="line">        <span class="title class_">FprintfHTML</span>(code, path, html);</span><br><span class="line">    &#125;</span><br><span class="line">    string <span class="title function_">queryPath</span>(<span class="params"></span>) &#123;</span><br><span class="line">        string p = <span class="title class_">QueryPath</span>(path);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string <span class="title function_">formValue</span>(<span class="params">string key</span>)&#123;</span><br><span class="line">        string v = <span class="title class_">FormValue</span>(path, key);</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Bind route</span></span><br><span class="line"><span class="title function_">httpHandle</span>(<span class="params">string method, string path, func (HttpContext) handle</span>)&#123;</span><br><span class="line">    <span class="comment">// println(&quot;path=&quot;+path);</span></span><br><span class="line">    <span class="title class_">HttpContext</span> ctx = <span class="title class_">HttpContext</span>();</span><br><span class="line">    <span class="title function_">handle</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Run http server.</span></span><br><span class="line"><span class="title function_">httpRun</span>(<span class="params">string addr</span>)&#123;&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„ä½¿ç”¨æµç¨‹ï¼š</p><ol><li>é€šè¿‡å®šä¹‰ä¸€ä¸ªå‡½æ•°å˜é‡å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚</li><li>æ³¨å†Œè·¯ç”±ã€‚</li><li>å¯åŠ¨ HTTP æœåŠ¡ã€‚</li></ol><p>åœ¨è‡ªå·±çš„ <code>handle</code> ä¸­å¯ä»¥é€šè¿‡ <code>HttpContext</code> å¯¹è±¡æ‹¿åˆ°è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥è·å–è¯·æ±‚å‚æ•°ä»¥åŠå“åº”æ•°æ®ã€‚<br>å…·ä½“ä½¿ç”¨ç¤ºä¾‹å¯ä»¥å‚è€ƒè¿™ä»½ä»£ç ã€‚<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h65ha9w1q4j20u00w841m.jpg"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ¬¡æ›´æ–°æ¯”æˆ‘é¢„æœŸçš„è¦é¡ºåˆ©ä¸€äº›ï¼Œå› ä¸ºè¯­æ³•æ ‘å’Œç¼–è¯‘å™¨å·²ç»åŸºæœ¬å®ç°å®Œæ¯•ï¼Œä¸ä¼šæ€ä¹ˆæ”¹äº†ï¼Œç°åœ¨æ–°å¢çš„ç‰¹æ€§æ— éå°±æ˜¯è¿è¡Œæ—¶å®ç°ä¸€äº›è¯­æ³•ç³–ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä½“åŠ›åŠ³åŠ¨ï¼›å¯èƒ½æ˜¯æ–°é²œæ„Ÿå¸¦æ¥çš„å…´å¥‹å‰‚æ•ˆæœï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯ç—›å¹¶å¿«ä¹ç€ã€‚</p><p>æ¯”å¦‚è¿™ä¸¤å¤©ä¸»è¦å°±æ˜¯åœ¨ä¿®å¤å¤šå±‚ <code>block</code> åµŒå¥—æ—¶é‡åˆ° <code>return</code> è¯­å¥æ— æ³•æ­£ç¡®è¿”å›çš„ bugï¼Œæ­»æ´»æŠ˜è…¾äº†ä¸¤å¤œï¼›ç»ˆäºåœ¨æ— æ•°æ¬¡åˆ†æ AST æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œç°åœ¨æƒ³æƒ³ç¡®å®è¿˜æ˜¯ç›¸å…³ç»éªŒå¤ªå°‘ã€‚</p><blockquote><p>å¯¹è¿™ä¸ª Bug æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹ä¸ªèµï¼Œåé¢å¯ä»¥åˆ†äº«ä¸€ä¸‹ã€‚</p></blockquote><p>ä¸‹ä¸€é˜¶æ®µé‡ç‚¹å°±æ˜¯å°†ç¼–è¯‘ä¿¡æ¯å¥½å¥½æ•´ç†ï¼Œè®©å¼€å‘ä½“éªŒæ›´å¥½ã€‚ä¹‹åæŠ½ç©ºå†æŠŠ <code>SQL</code> æ ‡å‡†åº“å®ç°äº†ï¼Œè¿™æ ·å°±èƒ½æ„‰å¿«çš„ <code>CURD</code>äº†ã€‚</p><p>æœ€åå¸Œæœ›å¯¹è¯¥é¡¹ç›®æˆ–è€…æ˜¯ç¼–è¯‘åŸç†æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ä¸‹è½½ä½¿ç”¨ï¼Œæå‡ºå®è´µæ„è§ï¼Œæ¬¢è¿åŠ æˆ‘å¾®ä¿¡äº¤æµã€‚</p><p>v0.0.8 ä¸‹è½½åœ°å€ï¼š<br><a href="https://github.com/crossoverJie/gscript/releases/tag/v0.0.8">https://github.com/crossoverJie/gscript/releases/tag/v0.0.8</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h65ahhmp7uj20h80beweu.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡&lt;a href=&quot;https://crossoverjie.top/2022/09/07/gscript/gscript04-preview/&quot;&gt;ã€Šç»ˆäºå®ç°äº†ä¸€é—¨å±äºè‡ªå·±çš„ç¼–ç¨‹è¯­è¨€ã€‹&lt;/a&gt; ä»‹ç»äº†è‡ªå·±å†™çš„ç¼–ç¨‹è¯­è¨€ &lt;a href=&quot;https://github.com/crossoverJie/gscript&quot;&gt;GScript&lt;/a&gt; ï¼Œåœ¨æ–‡ä¸­æåˆ°å¸Œæœ›æœ€ç»ˆå¯ä»¥ä½¿ç”¨ &lt;code&gt;GScript&lt;/code&gt; å¼€å‘ä¸€ä¸ªç½‘ç«™ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ç¡®å®æ˜¯åšåˆ°äº†ï¼Œé¦–é¡µåœ°å€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gscript.crossoverjie.top/index&quot;&gt;https://gscript.crossoverjie.top/index&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h65g2ios46j20zk0iyabv.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¦ç§°ä¸ºä¸€ä¸ªç½‘ç«™ç¡®å®æœ‰ç‚¹å‹‰å¼ºï¼Œä¸è¿‡ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€ç½‘é¡µï¼Œå› ä¸ºè¿”å›çš„æ˜¯ &lt;code&gt;HTML&lt;/code&gt;ï¼Œæ‰€ä»¥åœ¨å½“å‰é˜¶æ®µåªè¦ä¸å«Œéº»çƒ¦å…¶å®ä¹Ÿèƒ½å†™ä¸€ä¸ªâ€œåˆæ ¼â€çš„ç½‘ç«™ï¼Œæœ‰ç‚¹åƒä»¥å‰æˆ‘ä»¬å­¦ä¹  &lt;code&gt;Java&lt;/code&gt; æ—¶çš„ &lt;code&gt;servlet&lt;/code&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="antlr" scheme="http://crossoverjie.top/tags/antlr/"/>
    
  </entry>
  
  <entry>
    <title>ç»ˆäºå®ç°äº†ä¸€é—¨å±äºè‡ªå·±çš„ç¼–ç¨‹è¯­è¨€</title>
    <link href="http://crossoverjie.top/2022/09/07/gscript/gscript04-preview/"/>
    <id>http://crossoverjie.top/2022/09/07/gscript/gscript04-preview/</id>
    <published>2022-09-07T00:08:08.000Z</published>
    <updated>2022-09-07T09:27:02.794Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5x5v62lgsj21o00u00u2.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>éƒ½è¯´ç¨‹åºå‘˜çš„ä¸‰å¤§æµªæ¼«æ˜¯ï¼šæ“ä½œç³»ç»Ÿã€ç¼–è¯‘åŸç†ã€å›¾å½¢å­¦ï¼›æœ€åçš„å›¾å½¢å­¦ç¡®å®æ˜¯ç‰¹å®šçš„ä¸“ä¸šé¢†åŸŸï¼Œæˆ‘ä»¬å‡ ä¹æ¥è§¦ä¸åˆ°ï¼Œæ‰€ä»¥å¯¹æˆ‘æ¥è¯´æ¢æˆç½‘ç»œæ›´åˆé€‚ä¸€äº›ï¼Œæœ€åå†åŠ ä¸Šä¸€ä¸ªæ•°æ®åº“ã€‚</p><p>è¿™å››é¡¹æŠ€æœ¯å¦‚æœéƒ½èƒ½æŒæ¡çš„è¯é‚£å²‚ä¸æ˜¯åœ¨ IT è¡Œä¸šæ¨ªç€èµ°äº†ï¼ŒåŠ ä¸Šè¿™å‡ å¹´äº’è”ç½‘è¡Œä¸šè¶Šæ¥è¶Šä¸æ™¯æ°”ï¼Œè¶Šåº•å±‚çš„æŠ€æœ¯å°±è¶Šä¸å¯èƒ½è¢«æ›¿ä»£ï¼›æ‰€ä»¥ä¸ºäº†ç»™è‡ªå·±çš„ 30+ å±æœºç•™ç‚¹å‡ºè·¯ï¼Œä»ä»Šå¹´ä¸ŠåŠå¹´å¼€å§‹æˆ‘å°±é€æ¸å¼€å§‹ä»å¤´å­¦ä¹ ç¼–è¯‘åŸç†ã€‚</p><p>åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»è¿‡è¿‘ä¸€ä¸ªæœˆçš„æŒ‘ç¯å¤œæˆ˜ï¼Œæ¯æ™šéƒ½åœ¨è€å©†çš„å‚¬ä¿ƒä¸‹æ‰ä¼‘æ¯ï¼Œå…‹æœäº†ä¸­é€”å¥½å‡ æ¬¡æƒ³æ”¾å¼ƒçš„å†²åŠ¨ï¼Œç»ˆäºç°åœ¨å®Œæˆäº† <a href="https://github.com/crossoverJie/gscript">GScript</a> ä¸€ä¸ªé¢„è§ˆç‰ˆã€‚</p><blockquote><p>é¢„è§ˆç‰ˆçš„æ„æ€æ˜¯è¯­æ³•ç»“æ„ä¸æ•´ä½“è®¾è®¡åŸºæœ¬å®Œæˆï¼Œåç»­æ›´æ–°ä¹Ÿä¸å¤ªä¼šæ”¹åŠ¨è¿™éƒ¨åˆ†å†…å®¹ã€ä½†è¿˜ç¼ºå°‘ä¸€äº›æ˜“ç”¨åŠŸèƒ½ã€‚</p></blockquote><span id="more"></span><h1 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h1><p>é¦–å…ˆæ¥çœ‹çœ‹ä¿ç•™ç¯èŠ‚ï¼Œ <a href="https://github.com/crossoverJie/gscript">GScript</a> æ˜¯å¦‚ä½•ç¼–å†™ <code>hello world</code> çš„ã€‚</p><p>hello_world.gs:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println(<span class="string">&quot;hello world&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â¯ gscript hello_world.gs</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p>åºŸè¯è¯´å®Œäº†æ¥ä¸‹æ¥é‡ç‚¹èŠèŠ <code>GScript</code> æ‰€æ”¯æŒçš„ç‰¹æ€§äº†ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5x9767yayj20mi0h6myk.jpg"><br>åæ–‡ä¼šé‡ç‚¹è¯´æ˜æ¯ä¸€ä¸ªç‰¹æ€§ã€‚</p><h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><p>é™¤äº†åˆšæ‰æåˆ°çš„ hello worldï¼Œå†æ¥çœ‹ä¸€ä¸ªä¹Ÿæ˜¯ç¤ºä¾‹ä»£ç ç»å¸¸æ¼”ç¤ºçš„<code>æ‰“å°æ–æ³¢é‚£å¥‘æ•°åˆ—</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">int</span><span class="params">()</span> fib()&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">fibonacci</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a;</span><br><span class="line">        a = b;</span><br><span class="line">        b = a+c;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fibonacci;</span><br><span class="line">&#125;</span><br><span class="line">func <span class="title function_">int</span><span class="params">()</span> f = fib();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">    println(f());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>æ•´ä½“å†™æ³•ä¸ Go å®˜æ–¹æ¨èçš„ç±»ä¼¼ï¼š<a href="https://go.dev/play/p/NeGuDahW2yP">https://go.dev/play/p/NeGuDahW2yP</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib returns a function that returns</span></span><br><span class="line"><span class="comment">// successive Fibonacci numbers.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fib</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">a, b = b, a+b</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := fib()</span><br><span class="line"><span class="comment">// Function calls are evaluated left-to-right.</span></span><br><span class="line">fmt.Println(f(), f(), f(), f(), f())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éƒ½æ˜¯é€šè¿‡é—­åŒ…å˜é‡å®ç°çš„ï¼ŒåŒæ—¶ä¹Ÿå±•ç¤ºäº† <code>GScript</code> å¯¹é—­åŒ…ã€å‡½æ•°çš„ä½¿ç”¨ï¼Œåæ–‡è¯¦ç»†ä»‹ç»é—­åŒ…çš„ç”¨æ³•ã€‚</p><h1 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h1><p><code>GScript</code> çš„è¯­æ³•ä¸å¸¸è§çš„ <code>Java/Go</code> ç±»ä¼¼ï¼Œæ‰€ä»¥ä¸Šæ‰‹éå¸¸ç®€å•ã€‚</p><h2 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h2><p>å…ˆæ¥çœ‹çœ‹åŸºæœ¬ç±»å‹ï¼Œç›®å‰æ”¯æŒ <code>int/string/float/bool</code> å››ç§åŸºæœ¬ç±»å‹ä»¥åŠ <code>nil</code> ç‰¹æ®Šç±»å‹ã€‚</p><p>å˜é‡å£°æ˜è¯­æ³•å’Œ <code>Java</code> ç±»ä¼¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line">string b,c;</span><br><span class="line"><span class="type">float</span> <span class="variable">e</span> <span class="operator">=</span> <span class="number">10.1</span>;</span><br><span class="line"><span class="type">bool</span> <span class="variable">f</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>ä¸ªäººè§‰å¾—å°†ç±»å‹æ”¾åœ¨å‰é¢ï¼Œä»£ç é˜…è¯»èµ·æ¥ä¼šæ›´æ¸…æ™°ä¸€äº›ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ä¸ªäººå–œå¥½ã€‚</p><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜å¹¶åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">int</span>[] a=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">println(a);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªç©ºæ•°ç»„å¹¶æŒ‡å®šå¤§å°</span></span><br><span class="line"><span class="type">int</span>[] table = [<span class="number">4</span>]&#123;&#125;;</span><br><span class="line"></span><br><span class="line">println();</span><br><span class="line"><span class="comment">// å‘æ•°ç»„ append æ•°æ®</span></span><br><span class="line">a = append(a,<span class="number">4</span>);</span><br><span class="line">println(a);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len(a);i++)&#123;</span><br><span class="line">println(a[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ä¸‹æ ‡è·å–æ•°ç»„æ•°æ®</span></span><br><span class="line"><span class="type">int</span> b=a[<span class="number">2</span>];</span><br><span class="line">println(b);</span><br></pre></td></tr></table></figure><p>å…¶å®ä¸¥æ ¼æ¥è®²è¿™å¹¶ä¸ç®—æ˜¯æ•°ç»„ï¼Œå› ä¸ºå®ƒçš„åº•å±‚æ˜¯ç”¨ <code>Go</code> åˆ‡ç‰‡å®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥åŠ¨æ€æ‰©å®¹ã€‚</p><p>ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a=[<span class="number">2</span>]&#123;&#125;;</span><br><span class="line">println(<span class="string">&quot;æ•°ç»„å¤§å°:&quot;</span>+len(a));</span><br><span class="line">a = append(a,<span class="number">1</span>);</span><br><span class="line">println(<span class="string">&quot;æ•°ç»„å¤§å°:&quot;</span>+len(a));</span><br><span class="line">println(a);</span><br><span class="line">a[<span class="number">0</span>]=<span class="number">100</span>;</span><br><span class="line">println(a);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ•°ç»„å¤§å°:2</span><br><span class="line">æ•°ç»„å¤§å°:3</span><br><span class="line">[&lt;nil&gt; &lt;nil&gt; 1]</span><br><span class="line">[100 &lt;nil&gt; 1]</span><br></pre></td></tr></table></figure><h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><p>ç±»çš„æ”¯æŒéå¸¸é‡è¦ï¼Œæ˜¯å®ç°é¢å‘å¯¹è±¡çš„åŸºç¡€ï¼Œç›®å‰è¿˜æœªå®Œå…¨å®ç°é¢å‘å¯¹è±¡ï¼Œåªå®ç°äº†æ•°æ®ä¸å‡½æ•°çš„å°è£…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span>&#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode(<span class="type">int</span> v, ListNode n)&#123;</span><br><span class="line">        value =v;</span><br><span class="line">        next = n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨æ„é€ å‡½æ•°æ—¶ä¸éœ€è¦ä½¿ç”¨ new å…³é”®å­—ã€‚</span></span><br><span class="line"><span class="type">ListNode</span> <span class="variable">l1</span> <span class="operator">=</span> ListNode(<span class="number">1</span>, nil);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ . è°ƒç”¨å¯¹è±¡å±æ€§æˆ–å‡½æ•°ã€‚</span></span><br><span class="line">println(l1.value);</span><br></pre></td></tr></table></figure><p>ç¼ºçœæƒ…å†µä¸‹ <code>class</code> å…·æœ‰æ— å‚æ„é€ å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"><span class="type">int</span> age=<span class="number">10</span>;</span><br><span class="line">string name=<span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">100</span>+age;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— å‚æ„é€ å‡½æ•°</span></span><br><span class="line">Person xx= Person();</span><br><span class="line">println(xx.age);</span><br><span class="line">assertEqual(xx.age, <span class="number">10</span>);</span><br><span class="line">println(xx.getAge());</span><br><span class="line">assertEqual(xx.getAge(), <span class="number">110</span>);</span><br></pre></td></tr></table></figure><p>å¾—ç›Šäº <code>class</code> çš„å®ç°ï¼Œç»“åˆåˆšæ‰çš„æ•°ç»„ä¹Ÿå¯ä»¥å®šä¹‰å‡ºè‡ªå®šä¹‰ç±»å‹çš„æ•°ç»„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤§å°ä¸º 16 çš„ Person æ•°ç»„</span></span><br><span class="line">Person[] personList = [<span class="number">16</span>]&#123;&#125;;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>å‡½æ•°å…¶å®åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>æ™®é€šçš„å…¨å±€å‡½æ•°ã€‚</li><li>ç±»çš„å‡½æ•°ã€‚</li></ul><p>æœ¬è´¨ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯æ‰€å±èŒƒå›´ä¸åŒè€Œå·²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯</span></span><br><span class="line">bool <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == nil)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head.next == nil)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head.next;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="type">bool</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (fast.next != nil)&#123;</span><br><span class="line">        <span class="keyword">if</span> (fast.next == nil)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fast.next.next == nil)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (slow.next == nil)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fast == slow)&#123;</span><br><span class="line">            ret = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ListNode</span> <span class="variable">l1</span> <span class="operator">=</span> ListNode(<span class="number">1</span>, nil);</span><br><span class="line"><span class="type">bool</span> <span class="variable">b1</span> <span class="operator">=</span>hasCycle(l1);</span><br><span class="line">println(b1);</span><br><span class="line">assertEqual(b1, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ListNode</span> <span class="variable">l4</span> <span class="operator">=</span> ListNode(<span class="number">4</span>, nil);</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">l3</span> <span class="operator">=</span> ListNode(<span class="number">3</span>, l4);</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">l2</span> <span class="operator">=</span> ListNode(<span class="number">2</span>, l3);</span><br><span class="line"><span class="type">bool</span> <span class="variable">b2</span> <span class="operator">=</span> hasCycle(l2);</span><br><span class="line">println(b2);</span><br><span class="line">assertEqual(b2, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">l4.next = l2;</span><br><span class="line"><span class="type">bool</span> <span class="variable">b3</span> <span class="operator">=</span> hasCycle(l2);</span><br><span class="line">println(b3);</span><br><span class="line">assertEqual(b3, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¼”ç¤ºäº†é“¾è¡¨æ˜¯å¦æœ‰ç¯çš„ä¸€ä¸ªå‡½æ•°ï¼Œåªè¦æœ‰å…¶ä»–è¯­è¨€çš„ä½¿ç”¨åŸºç¡€ï¼Œç›¸ä¿¡é˜…è¯»èµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="type">int</span> a)&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“å‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œå¯ä»¥å£°æ˜ä¸º void æˆ–ç›´æ¥å¿½ç•¥è¿”å›ç±»å‹ã€‚</p></blockquote><h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p>é—­åŒ…æˆ‘è®¤ä¸ºæ˜¯éå¸¸æœ‰æ„æ€çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥å®ç°å¾ˆçµæ´»çš„è®¾è®¡ï¼Œä¹Ÿæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„åŸºç¡€ã€‚</p><p>æ‰€ä»¥åœ¨ <code>GScript</code> ä¸­å‡½æ•°æ˜¯ä½œä¸ºä¸€ç­‰å…¬æ°‘å­˜åœ¨ï¼›å› æ­¤ <code>GScript</code> ä¹Ÿæ”¯æŒå‡½æ•°ç±»å‹çš„å˜é‡ã€‚</p><p>å‡½æ•°å˜é‡å£°æ˜è¯­æ³•å¦‚ä¸‹ï¼š<code>func typeTypeOrVoid &#39;(&#39; typeList? &#39;)&#39;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤–éƒ¨å˜é‡ï¼Œå…¨å±€å…±äº«ã€‚</span></span><br><span class="line"><span class="type">int</span> <span class="variable">varExternal</span> <span class="operator">=</span><span class="number">10</span>;</span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f1()&#123;</span><br><span class="line"><span class="comment">// é—­åŒ…å˜é‡å¯¹æ¯ä¸ªé—­åŒ…å•ç‹¬å¯è§</span></span><br><span class="line"><span class="type">int</span> <span class="variable">varInner</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">innerFun</span><span class="params">(<span class="type">int</span> a)</span>&#123;</span><br><span class="line">println(a);</span><br><span class="line"><span class="type">int</span> c=<span class="number">100</span>;</span><br><span class="line">varExternal++;</span><br><span class="line">varInner++;</span><br><span class="line"><span class="keyword">return</span> varInner;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿”å›å‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> innerFun;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// f2 ä½œä¸ºä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œæ¥æ”¶çš„æ˜¯ä¸€ä¸ªè¿”å›å€¼å’Œå‚æ•°éƒ½æ˜¯ int çš„å‡½æ•°ã€‚</span></span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f2 = f1();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)&#123;</span><br><span class="line">println(<span class="string">&quot;varInner=&quot;</span> + f2(i) + <span class="string">&quot;, varExternal=&quot;</span> + varExternal);</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;=======&quot;</span>);</span><br><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f3 = f1();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;i++)&#123;</span><br><span class="line">println(<span class="string">&quot;varInner=&quot;</span> + f3(i) + <span class="string">&quot;, varExternal=&quot;</span> + varExternal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">varInner=21, varExternal=11</span><br><span class="line">1</span><br><span class="line">varInner=22, varExternal=12</span><br><span class="line">=======</span><br><span class="line">0</span><br><span class="line">varInner=21, varExternal=13</span><br><span class="line">1</span><br><span class="line">varInner=22, varExternal=14</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">int</span><span class="params">(<span class="type">int</span>)</span> f2 = f1();</span><br></pre></td></tr></table></figure><p>ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼šf2 æ˜¯ä¸€ä¸ªè¿”å›å€¼ï¼Œå…¥å‚éƒ½ä¸º int çš„å‡½æ•°ç±»å‹ï¼›æ‰€ä»¥åç»­å¯ä»¥ç›´æ¥å½“åšå‡½æ•°è°ƒç”¨ <code>f2(i)</code>.</p><p>ä¾‹å­ä¸­å°†é—­åŒ…åˆ†åˆ«èµ‹å€¼ç»™ f2 å’Œ f3 å˜é‡ï¼Œè¿™ä¸¤ä¸ªå˜é‡ä¸­çš„é—­åŒ…æ•°æ®ä¹Ÿæ˜¯äº’ç›¸éš”ç¦»ã€äº’ä¸å½±å“çš„ï¼Œæ‰€æœ‰åŸºäºè¿™ä¸ªç‰¹æ€§ç”šè‡³è¿˜æ˜¯å®ç°é¢å‘å¯¹è±¡ã€‚</p><blockquote><p>å…³äºé—­åŒ…çš„å®ç°ï¼Œåç»­ä¼šå•ç‹¬æ›´æ–°ä¸€ç¯‡ã€‚</p></blockquote><p>æ›´å¤šæ ·ä¾‹è¯·å‚è€ƒï¼š<a href="https://github.com/crossoverJie/gscript/tree/main/example">https://github.com/crossoverJie/gscript/tree/main/example</a></p><h1 id="æ ‡å‡†åº“"><a href="#æ ‡å‡†åº“" class="headerlink" title="æ ‡å‡†åº“"></a>æ ‡å‡†åº“</h1><p>æ ‡å‡†åº“æºç ï¼š<a href="https://github.com/crossoverJie/gscript/tree/main/internal">https://github.com/crossoverJie/gscript/tree/main/internal</a></p><p>ç›®å‰å®ç°çš„æ ‡å‡†åº“å¹¶ä¸å¤šï¼Œè¿™å®Œå…¨æ˜¯ä¸€ä¸ªä½“åŠ›æ´»ï¼›åŸºäºç°æœ‰çš„è¯­æ³•å’ŒåŸºç¡€æ•°æ®ç±»å‹ï¼Œå‡ ä¹å¯ä»¥å®ç°å¤§éƒ¨åˆ†çš„æ•°æ®ç»“æ„äº†ï¼Œæ‰€ä»¥æ„Ÿå…´è¶£çš„æœ‹å‹ä¹Ÿæ¬¢è¿æ¥è´¡çŒ®æ ‡å‡†åº“ä»£ç ï¼›æ¯”å¦‚ <code>Stack</code>ã€<code>Set</code> ä¹‹ç±»çš„æ•°æ®ç»“æ„ã€‚</p><h2 id="MapString"><a href="#MapString" class="headerlink" title="MapString"></a>MapString</h2><p>ä»¥è¿™ä¸ª <code>MapString</code> ä¸ºä¾‹ï¼šé”®å€¼å¯¹éƒ½ä¸º <code>string</code> çš„ <code>HashMap</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span><span class="number">100</span>;</span><br><span class="line"><span class="type">MapString</span> <span class="variable">m1</span> <span class="operator">=</span> MapString();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;count;i++)&#123;</span><br><span class="line"><span class="type">string</span> <span class="variable">key</span> <span class="operator">=</span> i+<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">string</span> <span class="variable">value</span> <span class="operator">=</span> key;</span><br><span class="line">m1.put(key,value);</span><br><span class="line">&#125;</span><br><span class="line">println(m1.getSize());</span><br><span class="line">assertEqual(m1.getSize(),count);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;count;i++)&#123;</span><br><span class="line"><span class="type">string</span> <span class="variable">key</span> <span class="operator">=</span> i+<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">string</span> <span class="variable">value</span> <span class="operator">=</span> m1.get(key);</span><br><span class="line">println(<span class="string">&quot;key=&quot;</span>+key+ <span class="string">&quot;:&quot;</span>+ value);</span><br><span class="line">assertEqual(key,value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨èµ·æ¥å’Œ <code>Java</code> çš„ <code>HashMap</code> ç±»ä¼¼ï¼Œå½“ç„¶ä»–çš„å®ç°æºç ä¹Ÿæ˜¯å‚è€ƒçš„ jdk1.7 çš„ <code>HashMap</code>ã€‚</p><blockquote><p>ç”±äºç›®å‰å¹¶æœ‰ä¸€ä¸ªç±»ä¼¼äº Java çš„ <code>object</code> æˆ–è€…æ˜¯ go ä¸­çš„ <code>interface&#123;&#125;</code>, æ‰€ä»¥å¦‚æœéœ€è¦å­˜æ”¾ intï¼Œé‚£è¿˜å¾—å®ç°ä¸€ä¸ª MapIntï¼Œä¸è¿‡è¿™ä¸ªé€šç”¨ç±»å‹å¾ˆå¿«ä¼šå®ç°ã€‚</p></blockquote><h2 id="å†…ç½®å‡½æ•°"><a href="#å†…ç½®å‡½æ•°" class="headerlink" title="å†…ç½®å‡½æ•°"></a>å†…ç½®å‡½æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// len è¿”å›æ•°ç»„å¤§å°</span></span><br><span class="line">println(len(a));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘æ•°ç»„è¿½åŠ æ•°æ®</span></span><br><span class="line">a = append(a,<span class="number">4</span>);</span><br><span class="line">println(a);</span><br><span class="line"><span class="comment">// output: [1,2,3,4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–­è¨€å‡½æ•°ï¼Œä¸ç›¸ç­‰æ—¶ä¼šæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¹¶ä¸­æ–­ç¨‹åºã€‚</span></span><br><span class="line">assertEqual(len(a),<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å› hashcode</span></span><br><span class="line"><span class="type">int</span> <span class="variable">hashcode</span> <span class="operator">=</span> hash(key);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå†…ç½®äº†ä¸€äº›åŸºæœ¬å‡½æ•°ï¼Œå½“ç„¶ä¹Ÿè¿™ä¸æ˜¯ç”± <code>GScript</code> æºç å®ç°çš„ï¼Œè€Œæ˜¯ç¼–è¯‘å™¨å®ç°çš„ï¼Œæ‰€ä»¥æ–°å¢èµ·æ¥è¦ç¨å¾®éº»çƒ¦ä¸€äº›ï¼›åç»­ä¼šé€æ­¥å®Œå–„ï¼Œæ¯”å¦‚å’Œ IO ç›¸å…³çš„å†…ç½®å‡½æ•°ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç°é˜¶æ®µçš„ <code>GScript</code> è¿˜æœ‰è®¸å¤šåŠŸèƒ½æ²¡æœ‰å®Œå–„ï¼Œæ¯”å¦‚ JSONã€ç½‘ç»œåº“ã€æ›´å®Œå–„çš„è¯­æ³•æ£€æŸ¥ã€ç¼–è¯‘æŠ¥é”™ä¿¡æ¯ç­‰ï¼›ç°åœ¨æ‹¿æ¥åˆ·åˆ· <code>LeetCode</code> è¿˜æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5xaige47gj216o0lkq78.jpg"></p><p>ä»è¿™ 65 ä¸ª todo å°±èƒ½çœ‹å‡ºè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œæˆ‘å¯¹å®ƒçš„ç»ˆæç›®æ ‡å°±æ˜¯å¯ä»¥ç¼–å†™ä¸€ä¸ªç½‘ç«™é‚£å°±ç®—æ˜¯ä¸€ä¸ªæˆç†Ÿçš„è¯­è¨€äº†ã€‚</p><p>ç›®å‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æ²¡æœ‰é›†æˆå¼€å‘ç¯å¢ƒï¼Œç°åœ¨çš„å¼€å‘ä½“éªŒå’Œç™½æ¿ä¸Šå†™ä»£ç ç›¸å·®æ— å¼‚ï¼Œæ‰€ä»¥åç»­æœ‰æ—¶é—´çš„è¯å°è¯•å†™ä¸€ä¸ª VS Code çš„æ’ä»¶ï¼Œè‡³å°‘èƒ½æœ‰è¯­æ³•é«˜äº®ä¸æç¤ºã€‚</p><p>æœ€åå¯¹ <code>GScript</code> æˆ–è€…æ˜¯ç¼–è¯‘åŸç†æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥åŠ æˆ‘å¾®ä¿¡ä¸€èµ·äº¤æµã€‚</p><p>é¡¹ç›®æºç ï¼š<a href="https://github.com/crossoverJie/gscript">https://github.com/crossoverJie/gscript</a><br>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/crossoverJie/gscript/releases/tag/v0.0.6">https://github.com/crossoverJie/gscript/releases/tag/v0.0.6</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h5x5v62lgsj21o00u00u2.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;éƒ½è¯´ç¨‹åºå‘˜çš„ä¸‰å¤§æµªæ¼«æ˜¯ï¼šæ“ä½œç³»ç»Ÿã€ç¼–è¯‘åŸç†ã€å›¾å½¢å­¦ï¼›æœ€åçš„å›¾å½¢å­¦ç¡®å®æ˜¯ç‰¹å®šçš„ä¸“ä¸šé¢†åŸŸï¼Œæˆ‘ä»¬å‡ ä¹æ¥è§¦ä¸åˆ°ï¼Œæ‰€ä»¥å¯¹æˆ‘æ¥è¯´æ¢æˆç½‘ç»œæ›´åˆé€‚ä¸€äº›ï¼Œæœ€åå†åŠ ä¸Šä¸€ä¸ªæ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å››é¡¹æŠ€æœ¯å¦‚æœéƒ½èƒ½æŒæ¡çš„è¯é‚£å²‚ä¸æ˜¯åœ¨ IT è¡Œä¸šæ¨ªç€èµ°äº†ï¼ŒåŠ ä¸Šè¿™å‡ å¹´äº’è”ç½‘è¡Œä¸šè¶Šæ¥è¶Šä¸æ™¯æ°”ï¼Œè¶Šåº•å±‚çš„æŠ€æœ¯å°±è¶Šä¸å¯èƒ½è¢«æ›¿ä»£ï¼›æ‰€ä»¥ä¸ºäº†ç»™è‡ªå·±çš„ 30+ å±æœºç•™ç‚¹å‡ºè·¯ï¼Œä»ä»Šå¹´ä¸ŠåŠå¹´å¼€å§‹æˆ‘å°±é€æ¸å¼€å§‹ä»å¤´å­¦ä¹ ç¼–è¯‘åŸç†ã€‚&lt;/p&gt;
&lt;p&gt;åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»è¿‡è¿‘ä¸€ä¸ªæœˆçš„æŒ‘ç¯å¤œæˆ˜ï¼Œæ¯æ™šéƒ½åœ¨è€å©†çš„å‚¬ä¿ƒä¸‹æ‰ä¼‘æ¯ï¼Œå…‹æœäº†ä¸­é€”å¥½å‡ æ¬¡æƒ³æ”¾å¼ƒçš„å†²åŠ¨ï¼Œç»ˆäºç°åœ¨å®Œæˆäº† &lt;a href=&quot;https://github.com/crossoverJie/gscript&quot;&gt;GScript&lt;/a&gt; ä¸€ä¸ªé¢„è§ˆç‰ˆã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é¢„è§ˆç‰ˆçš„æ„æ€æ˜¯è¯­æ³•ç»“æ„ä¸æ•´ä½“è®¾è®¡åŸºæœ¬å®Œæˆï¼Œåç»­æ›´æ–°ä¹Ÿä¸å¤ªä¼šæ”¹åŠ¨è¿™éƒ¨åˆ†å†…å®¹ã€ä½†è¿˜ç¼ºå°‘ä¸€äº›æ˜“ç”¨åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="antlr" scheme="http://crossoverjie.top/tags/antlr/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªå·±åŠ¨æ‰‹å†™è„šæœ¬è§£é‡Šå™¨--å®ç°ä½œç”¨åŸŸä¸å‡½æ•°è°ƒç”¨</title>
    <link href="http://crossoverjie.top/2022/08/17/gscript/gscript03-scope-func/"/>
    <id>http://crossoverjie.top/2022/08/17/gscript/gscript03-scope-func/</id>
    <published>2022-08-17T00:08:08.000Z</published>
    <updated>2022-08-16T17:38:48.849Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h594ovvpt6j20k00k0jse.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šæ¬¡åˆ©ç”¨ Antlr é‡æ„ä¸€ç‰ˆ <a href="https://crossoverjie.top/2022/08/08/gscript/gscript02-antlr-statement/">ç”¨ Antlr é‡æ„è„šæœ¬è§£é‡Šå™¨</a> ä¹‹åä¾¿ç€æ‰‹æ–°å¢å…¶ä»–åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çœ‹åˆ°çš„æ”¯æŒäº†ä½œç”¨åŸŸä»¥åŠå‡½æ•°è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> b= <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">foo</span><span class="params">(<span class="type">int</span> age)</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">age++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> b+age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> foo(<span class="number">10</span>);</span><br><span class="line">e = e+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">return</span> a+b+<span class="number">3</span>+e;</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">2</span>,<span class="number">20</span>);</span><br><span class="line"><span class="comment">// Output:65</span></span><br></pre></td></tr></table></figure><span id="more"></span><p>æ•´ä¸ªè¯­æ³•è§„åˆ™å¤§éƒ¨åˆ†å‚è€ƒäº† Javaï¼Œç°é˜¶æ®µæ”¯æŒäº†ï¼š</p><ul><li>å‡½æ•°å£°æ˜ä¸è°ƒç”¨ã€‚</li><li>å‡½æ•°è°ƒç”¨çš„å…¥æ ˆå’Œå‡ºæ ˆï¼Œä¿è¯äº†å‡½æ•°å±€éƒ¨å˜é‡åœ¨å‡½æ•°é€€å‡ºæ—¶é”€æ¯ã€‚</li><li>ä½œç”¨åŸŸæ”¯æŒï¼Œå†…éƒ¨ä½œç”¨åŸŸå¯ä»¥è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ã€‚</li><li>åŸºæœ¬çš„è¡¨è¾¾å¼è¯­å¥ï¼Œå¦‚ <code>i++, !=,==</code></li></ul><p>è¿™æ¬¡å®ç°çš„é‡ç‚¹ä¸éš¾ç‚¹åˆ™æ˜¯ä½œç”¨åŸŸä¸å‡½æ•°è°ƒç”¨ï¼Œå®ç°ä¹‹åä¹Ÿç®—æ˜¯æ»¡è¶³äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œä¸è¿‡åœ¨è®²ä½œç”¨åŸŸä¸å‡½æ•°è°ƒç”¨ä¹‹å‰å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„å˜é‡å£°æ˜ä¸è®¿é—®è¯­å¥æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¿™æ ·åç»­çš„ç†è§£ä¼šæ›´åŠ å®¹æ˜“ã€‚</p><h1 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line">a;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºè¿˜æ²¡æœ‰å®ç°å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚æ§åˆ¶å°è¾“å‡ºå‡½æ•° print()ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥è®¿é—®å˜é‡ä¹Ÿèƒ½æ‹¿åˆ°æ•°æ®</p></blockquote><p>è¿è¡Œåç»“æœå¦‚ä¸‹ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5904p530kj20nc0ewdgo.jpg"></p><p>é¦–å…ˆçœ‹çœ‹å˜é‡å£°æ˜è¯­å¥çš„è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">variableDeclarators</span><br><span class="line">    : typeType variableDeclarator (&#x27;,&#x27; variableDeclarator)*</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">variableDeclarator</span><br><span class="line">    : variableDeclaratorId (&#x27;=&#x27; variableInitializer)?</span><br><span class="line">    ;</span><br><span class="line">typeList</span><br><span class="line">    : typeType (&#x27;,&#x27; typeType)*</span><br><span class="line">    ;</span><br><span class="line">typeType</span><br><span class="line">    : (functionType | primitiveType) (&#x27;[&#x27; &#x27;]&#x27;)*</span><br><span class="line">    ;</span><br><span class="line">primitiveType</span><br><span class="line">    : INT</span><br><span class="line">    | STRING</span><br><span class="line">    | FLOAT</span><br><span class="line">    | BOOLEAN</span><br><span class="line">    ;        </span><br></pre></td></tr></table></figure><p> åªçœ‹è¯­æ³•ä¸å¤ªç›´è§‚ï¼Œç›´æ¥çœ‹ä¸‹ç”Ÿæˆçš„ AST æ ‘å°±æ˜ç™½äº†ï¼š<br> <img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5907v0pzmj20w80gkmy9.jpg"><br> ç¼–è¯‘æœŸ<br> å·¦è¾¹è¿™æ£µ <code>BlockVardeclar</code> æ ‘å¯¹åº”çš„å°±æ˜¯  <code>int a=10;</code>ï¼Œå³è¾¹çš„ <code>blockStm</code> å¯¹åº”çš„å°±æ˜¯å˜é‡è®¿é—® <code>a</code>ã€‚</p><p> æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸï¼Œå¯¹åº”çš„æµç¨‹ï¼š</p><ul><li>éå† AST æ ‘ï¼Œåšè¯­ä¹‰åˆ†æï¼Œç”Ÿæˆå¯¹åº”çš„ç¬¦å·è¡¨ã€ç±»å‹è¡¨ã€å¼•ç”¨æ¶ˆè§£ã€è¿˜æœ‰ä¸€äº›è¯­æ³•æ ¡éªŒï¼Œæ¯”å¦‚å˜é‡åã€å‡½æ•°åæ˜¯å¦é‡å¤ã€æ˜¯å¦èƒ½è®¿é—®ç§æœ‰å˜é‡ç­‰ã€‚</li><li>è¿è¡ŒæœŸï¼šä»ç¼–è¯‘æœŸä¸­ç”Ÿæˆçš„ç¬¦å·è¡¨ã€ç±»å‹è¡¨ä¸­è·å–æ•°æ®ï¼Œæ‰§è¡Œå…·ä½“çš„ä»£ç é€»è¾‘ã€‚</li></ul><h2 id="è®¿é—®-AST"><a href="#è®¿é—®-AST" class="headerlink" title="è®¿é—® AST"></a>è®¿é—® AST</h2><p>å¯¹äºåˆšæ‰æåˆ°çš„ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸå…¶å®åˆ†åˆ«å¯¹åº”ä¸¤ç§è®¿é—® <code>AST</code> çš„æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯ <code>Antlr</code> æ‰€æä¾›ä¸¤ç§æ–¹å¼ã€‚</p><h3 id="Listener-æ¨¡å¼"><a href="#Listener-æ¨¡å¼" class="headerlink" title="Listener æ¨¡å¼"></a>Listener æ¨¡å¼</h3><p>ç¬¬ä¸€ç§æ˜¯ <code>Listener</code> æ¨¡å¼ï¼Œå°±è¿™åå­—ä¹Ÿèƒ½çŒœåˆ°æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼›æˆ‘ä»¬éœ€è¦å®ç° Antlr æ‰€æä¾›çš„æ¥å£ï¼Œè¿™äº›æ¥å£åˆ†åˆ«å¯¹åº” AST æ ‘ä¸­çš„ä¸åŒèŠ‚ç‚¹ã€‚</p><p>æ¥ç€ Antlr ä¼šè‡ªåŠ¨éå†è¿™æ£µæ ‘ï¼Œå½“è®¿é—®å’Œé€€å‡ºæŸä¸ªèŠ‚ç‚¹æ—¶å˜ä¼šå›è°ƒæˆ‘ä»¬è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œè¿™äº›æ¥å£éƒ½æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†éå†è¿‡ç¨‹ä¸­çš„æ•°æ®è‡ªè¡Œå­˜æ”¾èµ·æ¥ã€‚</p><p>è¿™ç‚¹éå¸¸é€‚åˆä¸Šæ–‡æåˆ°çš„ç¼–è¯‘æœŸï¼Œéå†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®è‡ªç„¶å°±ä¼šå­˜æ”¾åˆ°ç¬¦å·è¡¨ã€ç±»å‹è¡¨è¿™äº›å®¹å™¨ä¸­ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h591ozeop0j20u00uote1.jpg"><br>ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œæˆ‘ä»¬å®ç°äº†ç¨‹åºæ ¹èŠ‚ç‚¹ã€forå¾ªç¯èŠ‚ç‚¹çš„è¿›å…¥å’Œé€€å‡º Listenerï¼Œå½“ Antlr è¿è¡Œåˆ°è¿™äº›èŠ‚ç‚¹æ—¶ä¾¿ä¼šæ‰§è¡Œå…¶ä¸­çš„é€»è¾‘ã€‚</p><p><a href="https://github.com/crossoverJie/gscript/blob/main/resolver/type_scope_resolver.go">https://github.com/crossoverJie/gscript/blob/main/resolver/type_scope_resolver.go</a></p><h3 id="Visitor-æ¨¡å¼"><a href="#Visitor-æ¨¡å¼" class="headerlink" title="Visitor æ¨¡å¼"></a>Visitor æ¨¡å¼</h3><p><code>Visitor</code> æ¨¡å¼æ­£å¥½å’Œ <code>Listener</code> ç›¸åï¼Œè¿™æ˜¯ç”±æˆ‘ä»¬è‡ªè¡Œæ§åˆ¶éœ€è¦è®¿é—®å“ªä¸ª AST èŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦åœ¨æ¯æ¬¡è®¿é—®ä¹‹åè¿”å›æ•°æ®ï¼Œè¿™ç‚¹éå¸¸é€‚åˆæ¥åšç¨‹åºè¿è¡ŒæœŸã€‚</p><p>é…åˆåœ¨ç¼–è¯‘æœŸä¸­å­˜æ”¾çš„æ•°æ®ï¼Œä¾¿å¯ä»¥å®ç°å„ç§ç‰¹æ€§äº†ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h5922ws8o0j21n00tcgsc.jpg"></p><p>ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œåœ¨è®¿é—® Prog èŠ‚ç‚¹æ—¶ä¾¿å¯ä»¥ä»ç¼–è¯‘æœŸä¸­æ‹¿åˆ°å½“å‰èŠ‚ç‚¹æ‰€å¯¹åº”çš„ä½œç”¨åŸŸ <code>scope</code>ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥è‡ªè¡Œæ§åˆ¶è®¿é—®ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ <code>VisitBlockStms</code>ï¼Œè®¿é—®å…¶ä»–èŠ‚ç‚¹å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡é€šå¸¸æˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§è¯­æ³•ä¸­å®šä¹‰çš„ç»“æ„è¿›è¡Œè®¿é—®ã€‚</p><h1 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h1><p>å³ä¾¿æ˜¯åŒä¸€ä¸ªè¯­æ³•ç”Ÿæˆçš„ AST æ˜¯ç›¸åŒçš„ï¼Œä½†æˆ‘ä»¬åœ¨éå† AST æ—¶å®ç°ä¸åŒä¹Ÿå°±ä¼šå¯¼è‡´ä¸åŒçš„è¯­ä¹‰ï¼Œè¿™å°±æ˜¯å„ä¸ªè¯­è¨€è¯­ä¹‰åˆ†æçš„ä¸åŒä¹‹å¤„ã€‚</p><blockquote><p>æ¯”å¦‚ Java ä¸å…è®¸åœ¨å­ä½œç”¨åŸŸä¸­å£°æ˜å’Œçˆ¶ä½œç”¨åŸŸä¸­ç›¸åŒçš„å˜é‡ï¼Œä½† JavaScript å´æ˜¯å¯ä»¥çš„ã€‚</p></blockquote><p>æœ‰äº†ä¸Šé¢çš„åŸºç¡€ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä½œç”¨åŸŸæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line">a;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h59355xwevj21bw0rsq9k.jpg"></p><p>è¿™é‡Œæˆ‘ç®€å•ç”»äº†ä¸‹æµç¨‹ï¼š</p><p>åœ¨ç¼–è¯‘æœŸé—´ä¼šä¼šä¸ºå½“å‰èŠ‚ç‚¹å†™å…¥ä¸€ä¸ª <code>scope</code>ï¼Œä»¥åŠåœ¨ <code>scope</code> ä¸­å†™å…¥å˜é‡ <code>â€œaâ€</code>ã€‚</p><blockquote><p>è¿™é‡Œçš„å†™å…¥ scope å’Œå†™å…¥å˜é‡æ˜¯åˆ†ä¸ºä¸¤æ¬¡ Listener è¿›è¡Œçš„ï¼Œå…·ä½“ä»£ç å®ç°åœ¨ä¸‹é¢æŸ¥çœ‹æºç ã€‚</p></blockquote><p>ç¬¬ä¸€æ¬¡ï¼š<br><a href="https://github.com/crossoverJie/gscript/blob/main/resolver/type_scope_resolver.go#L21">https://github.com/crossoverJie/gscript/blob/main/resolver/type_scope_resolver.go#L21</a></p><p>ç¬¬äºŒæ¬¡ï¼š<br><a href="https://github.com/crossoverJie/gscript/blob/main/resolver/type_resolver.go#L59">https://github.com/crossoverJie/gscript/blob/main/resolver/type_resolver.go#L59</a></p><p>æ¥ç€æ˜¯è¿è¡ŒæœŸï¼Œä»ç¼–è¯‘æœŸä¸­ç”Ÿæˆçš„æ•°æ®æ‹¿åˆ° <code>scope</code> ä»¥åŠå…¶ä¸­çš„å˜é‡ï¼Œè·å–å˜é‡æ—¶æœ‰ä¸€ä¸ªç»†èŠ‚ï¼š<br>å½“å‰ scope ä¸­å¦‚æœè·å–ä¸åˆ°éœ€è¦å°è¯•ä»çˆ¶çº§ <code>scope</code> ä¸­è·å–ï¼Œæ¯”å¦‚å¦‚ä¸‹æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> b= <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ b åœ¨å½“å‰å‡½æ•°ä½œç”¨åŸŸä¸­æ˜¯è·å–ä¸åˆ°çš„ï¼Œåªèƒ½åœ¨çˆ¶çº§ <code>scope</code> ä¸­è·å–ã€‚</p><blockquote><p>çˆ¶çº§ scope çš„å…³ç³»æ˜¯åœ¨åˆ›å»º scope çš„æ—¶å€™ç»´æŠ¤è¿›å»çš„ï¼Œé»˜è®¤å½“å‰ scope å°±æ˜¯å†™å…¥æ—¶ scope çš„çˆ¶çº§ã€‚</p></blockquote><p>å…³é”®ä»£ç è¯•ä¸‹å¦‚ä¸‹å›¾ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h593bq2mrgj211e0lwtby.jpg"></p><p>ç¬¬å››æ­¥è·å–å˜é‡çš„å€¼ä¹Ÿæ˜¯éœ€è¦è®¿é—®åˆ° AST ä¸­çš„å­—é¢é‡èŠ‚ç‚¹è·å–å€¼å³å¯ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h593fchoccj20wa0ia3zy.jpg"><br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h593fwqkgmj217p0u078h.jpg"></p><h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><p>å‡½æ•°çš„è°ƒç”¨æœ€æ ¸å¿ƒçš„å°±æ˜¯åœ¨è¿è¡Œæ—¶éœ€è¦æŠŠå½“å‰å‡½æ•°ä¸­çš„æ‰€æœ‰æ•°æ®å…¥æ ˆï¼Œè®¿é—®å®Œæ¯•åå‡ºæ ˆï¼Œè¿™æ ·æ‰èƒ½å®ç°å‡½æ•°é€€å‡ºåè‡ªåŠ¨é‡Šæ”¾å‡½æ•°ä½“ç±»çš„æ•°æ®ã€‚</p><p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h593mb2qrqj216y0u0n37.jpg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> b= <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">func</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> foo();</span><br><span class="line"><span class="keyword">return</span> a+b+<span class="number">3</span>+e;</span><br><span class="line">&#125;</span><br><span class="line">func(<span class="number">2</span>,<span class="number">20</span>);</span><br></pre></td></tr></table></figure><p>å³ä¾¿æ˜¯æœ‰ä¸Šé¢è¿™ç±»å‡½æ•°ç±»è°ƒå…¶ä»–å‡½æ•°æƒ…å†µä¹Ÿä¸å¿…æ‹…å¿ƒï¼Œæ— éå°±æ˜¯åœ¨æ‰§è¡Œå‡½æ•°ä½“çš„æ—¶å€™å†å¾€æ ˆä¸­å†™å…¥æ•°æ®è€Œå·²ï¼Œå‡½æ•°é€€å‡ºåä¼šä¾æ¬¡é€€å‡ºæ ˆå¸§ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h593r5bgs5j20rs11bq4b.jpg"></p><p>æœ‰ç‚¹ç±»ä¼¼äºåŒ¹é…æ‹¬å·çš„ç®—æ³• <code>&#123;[()]&#125;</code>ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯é€’å½’è°ƒç”¨ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é™äºç¯‡å¹…å…¶ä¸­çš„è®¸å¤šç»†èŠ‚æ²¡æœ‰ä»”ç»†è®¨è®ºï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç›´æ¥è·‘è·‘å•æµ‹ï¼Œdebug è¯•è¯•ã€‚</p><p><a href="https://github.com/crossoverJie/gscript/blob/main/compiler_test.go">https://github.com/crossoverJie/gscript/blob/main/compiler_test.go</a></p><p>ç›®å‰çš„ç‰ˆæœ¬è¿˜æ¯”è¾ƒåˆçº§ï¼Œæ¯”å¦‚åŸºæœ¬ç±»å‹è¿˜åªæœ‰ intï¼Œä¹Ÿæ²¡æœ‰ä¸€äº›å¸¸ç”¨çš„å†…ç½®å‡½æ•°ã€‚</p><p>åç»­ä¼šé€æ­¥å®Œå–„ï¼Œæ¯”å¦‚æ–°å¢ï¼š</p><ul><li>å‡½æ•°å¤šè¿”å›å€¼ã€‚</li><li>è‡ªå®šä¹‰ç±»å‹</li><li>é—­åŒ…</li></ul><p>ç­‰ç‰¹æ€§ï¼Œè¿™ä¸ªå‘ä¼šä¸€ç›´å¡«ä¸‹å»ï¼Œå¸Œæœ›åœ¨å¹´åº•å¯ä»¥ç”¨ <code>gscript</code> å†™ä¸€ä¸ª <code>web</code> æœåŠ¡ç«¯é‚£å°±ç®—æ˜¯é‡Œç¨‹ç¢‘å®Œæˆäº†ã€‚</p><p>ç°é˜¶æ®µä¹Ÿå®ç°äº†ä¸€ä¸ªç®€æ˜“çš„ <code>REPL</code> å·¥å…·ï¼Œå¤§å®¶å¯ä»¥å®‰è£…è¯•ç”¨ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h594523npmj20bc0de74n.jpg"></p><p>æºç åœ°å€ï¼š<br><a href="https://github.com/crossoverJie/gscript">https://github.com/crossoverJie/gscript</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h594ovvpt6j20k00k0jse.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¸Šæ¬¡åˆ©ç”¨ Antlr é‡æ„ä¸€ç‰ˆ &lt;a href=&quot;https://crossoverjie.top/2022/08/08/gscript/gscript02-antlr-statement/&quot;&gt;ç”¨ Antlr é‡æ„è„šæœ¬è§£é‡Šå™¨&lt;/a&gt; ä¹‹åä¾¿ç€æ‰‹æ–°å¢å…¶ä»–åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çœ‹åˆ°çš„æ”¯æŒäº†ä½œç”¨åŸŸä»¥åŠå‡½æ•°è°ƒç”¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; b= &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; age)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		age++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; b+age;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; a,&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; b)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; foo(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	e = e+&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; a+b+&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;+e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;add(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Output:65&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="antlr" scheme="http://crossoverjie.top/tags/antlr/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ Antlr é‡æ„è„šæœ¬è§£é‡Šå™¨</title>
    <link href="http://crossoverjie.top/2022/08/08/gscript/gscript02-antlr-statement/"/>
    <id>http://crossoverjie.top/2022/08/08/gscript/gscript02-antlr-statement/</id>
    <published>2022-08-08T00:08:08.000Z</published>
    <updated>2022-08-07T11:08:02.871Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4y7c4s1gbj20z20kd0we.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ä¸Šä¸€ä¸ªç‰ˆæœ¬å®ç°çš„è„šæœ¬è§£é‡Šå™¨ <a href="https://github.com/crossoverJie/gscript">GScript</a> ä¸­å®ç°äº†åŸºæœ¬çš„å››åˆ™è¿ç®—ä»¥åŠ <code>AST</code> çš„ç”Ÿæˆã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4ybcb7x07j20im0hcgne.jpg"></p><p>å½“æˆ‘å‡†å¤‡å†æ–°å¢ä¸€ä¸ª <code>%</code> å–æ¨¡çš„è¿ç®—ç¬¦æ—¶ï¼Œä¼šå‘ç°å·¥ä½œå¾ˆç¹çè€Œä¸”å‡ ä¹éƒ½æ˜¯é‡å¤çš„ï¼›ä¸»è¦æ˜¯ä¸¤æ­¥ï¼š</p><ol><li>éœ€è¦åœ¨è¯æ³•è§£æå™¨ä¸­æ–°å¢å¯¹ <code>%</code> ç¬¦å·çš„æ”¯æŒã€‚</li><li>åœ¨è¯­æ³•è§£æå™¨éå† AST æ—¶å¯¹ <code>%</code> token å®ç°å…·ä½“é€»è¾‘ã€‚</li></ol><p>å…¶ä¸­çš„è¯æ³•è§£æå’Œéå† AST å®Œå…¨æ˜¯é‡å¤å·¥ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯å¦èƒ½å¤Ÿç®€åŒ–è¿™ä¸¤æ­¥å‘¢ï¼Ÿ</p><span id="more"></span><h1 id="Antlr"><a href="#Antlr" class="headerlink" title="Antlr"></a>Antlr</h1><p><code>Antlr</code> å°±æ˜¯åšå¸®æˆ‘ä»¬è§£å†³è¿™äº›é—®é¢˜çš„å¸¸ç”¨å·¥å…·ï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬åªéœ€è¦ç¼–å†™è¯æ³•æ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆè¯æ³•ã€è¯­æ³•è§£æå™¨ï¼Œå¹¶ä¸”å¯ä»¥ç”Ÿæˆä¸åŒè¯­è¨€çš„ä»£ç ã€‚</p><p>ä¸‹é¢ä»¥ <code>GScript</code> çš„ç¤ºä¾‹æ¥çœ‹çœ‹ antlr æ˜¯å¦‚ä½•å¸®æˆ‘ä»¬ç”Ÿæˆè¯æ³•åˆ†æå™¨çš„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGScriptVisitor_Visit_Lexer</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">expression := <span class="string">&quot;(2+3) * 2&quot;</span></span><br><span class="line">input := antlr.NewInputStream(expression)</span><br><span class="line">lexer := parser.NewGScriptLexer(input)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">t := lexer.NextToken()</span><br><span class="line"><span class="keyword">if</span> t.GetTokenType() == antlr.TokenEOF &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s (%q) %d\n&quot;</span>,</span><br><span class="line">lexer.SymbolicNames[t.GetTokenType()], t.GetText(),t.GetColumn())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//output:</span><br><span class="line"> (&quot;(&quot;) 0</span><br><span class="line">DECIMAL_LITERAL (&quot;2&quot;) 1</span><br><span class="line">PLUS (&quot;+&quot;) 2</span><br><span class="line">DECIMAL_LITERAL (&quot;3&quot;) 3</span><br><span class="line"> (&quot;)&quot;) 4</span><br><span class="line">MULT (&quot;*&quot;) 6</span><br><span class="line">DECIMAL_LITERAL (&quot;2&quot;) 8</span><br></pre></td></tr></table></figure><p><code>Antlr </code> ä¼šè‡ªåŠ¨å°†æˆ‘ä»¬çš„è¡¨è¾¾å¼è§£æä¸º <code>token</code>ï¼Œéå† <code>token</code> æ—¶è¿˜èƒ½æ‹¿åˆ°è¯¥ <code>token</code> æ‰€åœ¨çš„ä»£ç è¡Œæ•°ã€ä½ç½®ç­‰ä¿¡æ¯ï¼Œåœ¨ç¼–è¯‘æœŸé—´åšè¯­æ³•æ£€æŸ¥éå¸¸æœ‰ç”¨ã€‚</p><p>è¦å®ç°è¿™äº›æˆ‘ä»¬åªéœ€è¦ç¼–å†™è¯æ³•ã€è¯­æ³•è§„åˆ™æ–‡ä»¶å³å¯ã€‚</p><p>åˆšæ‰çš„ç¤ºä¾‹æ‰€å¯¹åº”çš„è¯æ³•ã€è¯­æ³•è§„åˆ™å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">expr</span><br><span class="line">    : &#x27;(&#x27; expr &#x27;)&#x27;                        #NestedExpr</span><br><span class="line">    | liter=literal #Liter</span><br><span class="line">    | lhs=expr bop=( MULT | DIV ) rhs=expr #MultDivExpr</span><br><span class="line">    | lhs=expr bop=MOD rhs=expr            #ModExpr</span><br><span class="line">    | lhs=expr bop=( PLUS | SUB ) rhs=expr #PlusSubExpr</span><br><span class="line">    | expr bop=(LE | GE | GT | LT ) expr # GLe</span><br><span class="line">    | expr bop=(EQUAL | NOTEQUAL) expr # EqualOrNot</span><br><span class="line">    ;</span><br><span class="line">DECIMAL_LITERAL:    (&#x27;0&#x27; | [1-9] (Digits? | &#x27;_&#x27;+ Digits)) [lL]?;    </span><br></pre></td></tr></table></figure><blockquote><p>å®Œæ•´è§„åˆ™ï¼š<a href="https://github.com/crossoverJie/gscript/blob/main/GScript.g4">https://github.com/crossoverJie/gscript/blob/main/GScript.g4</a></p></blockquote><p>è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">antlr -Dlanguage=Go -o parser -visitor -no-listener GScript.g4</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å¸®æˆ‘ä»¬ç”Ÿæˆ <code>Go</code> çš„ä»£ç ï¼ˆé»˜è®¤æ˜¯ <code>Java</code>ï¼‰ï¼Œå…³äº <code>Antlr</code> çš„è¯æ³•ã€æ–‡æ³•è§„åˆ™ä»¥åŠå®‰è£…æ­¥éª¤è¯·å‚è€ƒ<a href="https://www.antlr.org/">å®˜ç½‘</a>ã€‚</p><p>è€Œæˆ‘ä»¬è¦å®ç°å…·ä½“çš„è¯­æ³•é€»è¾‘æ—¶åªéœ€è¦å®ç°ç›¸å…³çš„æ¥å£ï¼Œ<code>Antlr</code> ä¼šè‡ªåŠ¨éå† <code>AST</code>ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ§åˆ¶ï¼‰ï¼ŒåŒæ—¶åœ¨è®¿é—®ä¸åŒçš„ <code>AST</code> èŠ‚ç‚¹æ—¶ä¼šå›è°ƒæˆ‘ä»¬è‡ªå·±å®ç°çš„æ¥å£ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç¼–å†™è‡ªå·±çš„è¯­æ³•è§„åˆ™äº†ã€‚</p><p>ä»¥è¿™é‡Œçš„æ–°å¢çš„å–æ¨¡è¿ç®—ä¸ºä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *GScriptVisitor)</span></span> VisitModExpr(ctx *parser.ModExprContext) <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">lhs := v.Visit(ctx.GetLhs())</span><br><span class="line">rhs := v.Visit(ctx.GetRhs())</span><br><span class="line"><span class="keyword">return</span> lhs.(<span class="type">int</span>) % rhs.(<span class="type">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ <code>Antlr</code> å›è°ƒ <code>VisitModExpr</code> æ–¹æ³•æ—¶ï¼Œä¾¿èƒ½è·å–åˆ° % ç¬¦å·å·¦å³ä¸¤ä¾§çš„æ•°æ®ï¼Œè¿™æ—¶åªéœ€è¦åšç›¸å…³è¿ç®—å³å¯ã€‚</p><p>åŸºäºè¿™ä¸ªæ¨¡å¼è¿™æ¬¡æ–°å¢äº†ä¸€ä¸ª <code>statement</code>ï¼Œå…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGScriptVisitor_VisitIfElse8</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">expression := <span class="string">`</span></span><br><span class="line"><span class="string">if(3!=(1+2))&#123;</span></span><br><span class="line"><span class="string">return 1+3</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">return false</span></span><br><span class="line"><span class="string">&#125;`</span></span><br><span class="line">input := antlr.NewInputStream(expression)</span><br><span class="line">lexer := parser.NewGScriptLexer(input)</span><br><span class="line">stream := antlr.NewCommonTokenStream(lexer, <span class="number">0</span>)</span><br><span class="line">parser := parser.NewGScriptParser(stream)</span><br><span class="line">parser.BuildParseTrees = <span class="literal">true</span></span><br><span class="line">tree := parser.Prog()</span><br><span class="line">visitor := GScriptVisitor&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> result = visitor.Visit(tree)</span><br><span class="line">fmt.Println(expression, <span class="string">&quot; result:&quot;</span>, result)</span><br><span class="line">assert.Equal(t, result, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Antlr è¿˜æœ‰å…¶ä»–å„ç§ä¼˜åŠ¿ï¼Œæ¯”å¦‚å¯ä»¥è§£å†³ï¼š</p><ul><li>å·¦é€’å½’ã€‚</li><li>äºŒä¹‰æ€§ã€‚</li><li>ä¼˜å…ˆçº§ã€‚</li></ul><p>ç­‰é—®é¢˜ã€‚</p><p>è¿™é‡Œä¹Ÿæ¨èåœ¨ IDE ä¸­å®‰è£… Antlr çš„æ’ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ç›´è§‚çš„æŸ¥çœ‹  AST è¯­æ³•æ ‘ï¼Œå¯ä»¥å¸®æˆ‘ä»¬æ›´å¥½çš„è°ƒè¯•ä»£ç ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4ydh1xkenj22gk0qm43a.jpg"><br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4ydhe0vnpj217s0r277g.jpg"></p><h1 id="å‡çº§-xjson"><a href="#å‡çº§-xjson" class="headerlink" title="å‡çº§ xjson"></a>å‡çº§ xjson</h1><p>å€ŸåŠ© <code>GScript</code> æä¾›çš„ <code>statement</code>ï¼Œ<code>xjson</code> ä¹Ÿæä¾›äº†æœ‰äº›æœ‰æ„æ€çš„å†™æ³•ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4yekrs5r5j219w0fu0v9.jpg"></p><p>å› ä¸º <code>xjson</code> çš„å››åˆ™è¿ç®—è¯­æ³•æ²¡æœ‰ä½¿ç”¨ <code>Antlr</code> ç”Ÿæˆï¼Œæ‰€ä»¥ä¸ºäº†èƒ½æ”¯æŒ <code>GScript</code> æä¾›çš„ <code>statement</code> éœ€è¦æ‰‹å†™è®¸å¤šè¯æ³•ä»£ç ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4ye5optx1j21ji0u0wir.jpg"></p><p>è¿™ä¹Ÿä½“ç°äº† <code>Antlr</code> è¿™ç±»å‰ç«¯å·¥å…·çš„é‡è¦æ€§ï¼Œæ•ˆç‡æå‡æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å€ŸåŠ©äº <code>Antlr</code> åç»­ <code>GScript</code> ä¼šç»§ç»­æ”¯æŒå‡½æ•°è°ƒç”¨ã€æ›´å®Œå–„çš„ç±»å‹ç³»ç»Ÿã€é¢å‘å¯¹è±¡ç­‰ç‰¹æ€§ï¼›æ„Ÿå…´è¶£çš„æœ‹å‹è¯·æŒç»­å…³æ³¨ã€‚</p><p>æºç åœ°å€ï¼š<br><a href="https://github.com/crossoverJie/gscript">https://github.com/crossoverJie/gscript</a><br><a href="https://github.com/crossoverJie/xjson">https://github.com/crossoverJie/xjson</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h4y7c4s1gbj20z20kd0we.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ä¸Šä¸€ä¸ªç‰ˆæœ¬å®ç°çš„è„šæœ¬è§£é‡Šå™¨ &lt;a href=&quot;https://github.com/crossoverJie/gscript&quot;&gt;GScript&lt;/a&gt; ä¸­å®ç°äº†åŸºæœ¬çš„å››åˆ™è¿ç®—ä»¥åŠ &lt;code&gt;AST&lt;/code&gt; çš„ç”Ÿæˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h4ybcb7x07j20im0hcgne.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘å‡†å¤‡å†æ–°å¢ä¸€ä¸ª &lt;code&gt;%&lt;/code&gt; å–æ¨¡çš„è¿ç®—ç¬¦æ—¶ï¼Œä¼šå‘ç°å·¥ä½œå¾ˆç¹çè€Œä¸”å‡ ä¹éƒ½æ˜¯é‡å¤çš„ï¼›ä¸»è¦æ˜¯ä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éœ€è¦åœ¨è¯æ³•è§£æå™¨ä¸­æ–°å¢å¯¹ &lt;code&gt;%&lt;/code&gt; ç¬¦å·çš„æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¯­æ³•è§£æå™¨éå† AST æ—¶å¯¹ &lt;code&gt;%&lt;/code&gt; token å®ç°å…·ä½“é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…¶ä¸­çš„è¯æ³•è§£æå’Œéå† AST å®Œå…¨æ˜¯é‡å¤å·¥ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯å¦èƒ½å¤Ÿç®€åŒ–è¿™ä¸¤æ­¥å‘¢ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="gscript" scheme="http://crossoverjie.top/categories/gscript/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/gscript/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="antlr" scheme="http://crossoverjie.top/tags/antlr/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ä½è¿ç®—ä¸ºä½ çš„ç¨‹åºåŠ é€Ÿ</title>
    <link href="http://crossoverjie.top/2022/08/01/gjson/xjson04-bitwisee-operation/"/>
    <id>http://crossoverjie.top/2022/08/01/gjson/xjson04-bitwisee-operation/</id>
    <published>2022-08-01T00:14:36.000Z</published>
    <updated>2022-07-31T07:12:35.226Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4p37zeb9aj20xc0go0tv.jpg"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘åœ¨æŒç»­ä¼˜åŒ–ä¹‹å‰ç¼–å†™çš„ <code>JSON</code> è§£æåº“ <a href="https://github.com/crossoverJie/xjson">xjson</a>ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªæ–¹é¢çš„ä¼˜åŒ–ã€‚</p><p>ç¬¬ä¸€ä¸ªæ˜¯æ”¯æŒå°†ä¸€ä¸ª <code>JSONObject</code> å¯¹è±¡è¾“å‡ºä¸º <code>JSON</code> å­—ç¬¦ä¸²ã€‚</p><p>è¿™ç‚¹åœ¨ä¸Šä¸ªç‰ˆæœ¬ä¸­åªæ˜¯åˆ©ç”¨è‡ªå¸¦çš„ <code>Print</code> å‡½æ•°æ‰“å°æ•°æ®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestJson4</span><span class="params">(t *testing.T)</span></span>  &#123;</span><br><span class="line">str := <span class="string">`&#123;&quot;people&quot;:&#123;&quot;name&quot;:&#123;&quot;first&quot;:&quot;bob&quot;&#125;&#125;&#125;`</span></span><br><span class="line">first := xjson.Get(str, <span class="string">&quot;people.name.first&quot;</span>)</span><br><span class="line">assert.Equal(t, first.String(), <span class="string">&quot;bob&quot;</span>)</span><br><span class="line">get := xjson.Get(str, <span class="string">&quot;people&quot;</span>)</span><br><span class="line">fmt.Println(get.String())</span><br><span class="line"><span class="comment">//assert.Equal(t, get.String(),`&#123;&quot;name&quot;:&#123;&quot;first&quot;:&quot;bob&quot;&#125;&#125;`)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map[name:map[first:bob]]</span><br></pre></td></tr></table></figure><span id="more"></span><p>æœ¬æ¬¡ä¼˜åŒ–ä¹‹åä¾¿èƒ½ç›´æ¥è¾“å‡º JSON å­—ç¬¦ä¸²äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4p3ihijjgj20ne05s0sw.jpg"></p><p>å®ç°è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦é€’å½’éå† object ä¸­çš„æ•°æ®ï¼Œç„¶åæ‹¼æ¥å­—ç¬¦ä¸²å³å¯ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Result)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> r.Token &#123;</span><br><span class="line"><span class="keyword">case</span> String:</span><br><span class="line"><span class="keyword">return</span> fmt.Sprint(r.object)</span><br><span class="line"><span class="keyword">case</span> Bool:</span><br><span class="line"><span class="keyword">return</span> fmt.Sprint(r.object)</span><br><span class="line"><span class="keyword">case</span> Number:</span><br><span class="line">i, _ := strconv.Atoi(fmt.Sprint(r.object))</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%d&quot;</span>, i)</span><br><span class="line"><span class="keyword">case</span> Float:</span><br><span class="line">i, _ := strconv.ParseFloat(fmt.Sprint(r.object), <span class="number">64</span>)</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%f&quot;</span>, i)</span><br><span class="line"><span class="keyword">case</span> JSONObject:</span><br><span class="line"><span class="keyword">return</span> object2JSONString(r.object)</span><br><span class="line"><span class="keyword">case</span> ArrayObject:</span><br><span class="line"><span class="keyword">return</span> object2JSONString(r.Array())</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4q0yqg8u1j20u00zl0vy.jpg"></p><h1 id="ç”¨ä½è¿ç®—ä¼˜åŒ–"><a href="#ç”¨ä½è¿ç®—ä¼˜åŒ–" class="headerlink" title="ç”¨ä½è¿ç®—ä¼˜åŒ–"></a>ç”¨ä½è¿ç®—ä¼˜åŒ–</h1><p>ç¬¬äºŒä¸ªä¼˜åŒ–ä¸»è¦æ˜¯æé«˜äº†æ€§èƒ½ï¼ŒæŸ¥è¯¢ä¸€ä¸ªå¤æ‚ JSON æ•°æ®çš„æ—¶å€™æ€§èƒ½æé«˜äº†å¤§çº¦ â«16%.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼˜åŒ–å‰</span></span><br><span class="line">BenchmarkDecode-12         90013             66905 ns/op           42512 B/op       1446 allocs/op</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼˜åŒ–å</span></span><br><span class="line">BenchmarkDecode-12        104746             59766 ns/op           37749 B/op       1141 allocs/op</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆªå–äº†ä¸€äº›é‡ç‚¹æ”¹åŠ¨çš„éƒ¨åˆ†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4q29pojhdj223g0u0gsv.jpg"></p><p>åœ¨ JSON è§£æè¿‡ç¨‹ä¸­ä¼šæœ‰ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºçŠ¶æ€è¿ç§»çš„è¿‡ç¨‹ï¼Œè€Œè¿ç§»çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°å¤šä¸ªçŠ¶æ€ã€‚</p><p>æ¯”å¦‚å½“å‰è§£æåˆ°çš„ token å€¼ä¸º <code>&#123;</code>ï¼Œé‚£å®ƒæ¥ä¸‹æ¥çš„ token å¯èƒ½ä¼šä¸º <code>ObjectKey:&quot;name&quot;</code>,ä¹Ÿå¯èƒ½ä¼šæ˜¯ <code>BeginObject:&#123;</code>,å½“ç„¶ä¹Ÿå¯èƒ½ä¼šæ˜¯ <code>EndObject:&#125;</code>ï¼Œ<br>æ‰€ä»¥åœ¨ä¼˜åŒ–ä¹‹å‰æˆ‘æ˜¯å°†çŠ¶æ€å…¨éƒ¨å­˜æ”¾åœ¨ä¸€ä¸ªé›†åˆä¸­çš„ï¼Œåœ¨è§£æè¿‡ç¨‹ä¸­å¦‚æœå‘ç°çŠ¶æ€ä¸æ»¡è¶³é¢„æœŸçš„åˆ—è¡¨æ—¶åˆ™ä¼šæŠ›å‡ºè¯­æ³•å¼‚å¸¸çš„é”™è¯¯ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4q2ysk89kj22s409omyd.jpg"></p><p>æ‰€ä»¥ä¼˜åŒ–ä¹‹å‰æ˜¯éå†è¿™ä¸ªé›†åˆæ¥è¿›è¡Œåˆ¤æ–­çš„ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(N)</code>,ä½†å½“æˆ‘ä»¬æ¢æˆä½è¿ç®—å°±ä¸ä¸€æ ·äº†ï¼Œæ—¶é—´å¤æ‚åº¦ç›´æ¥å°±å˜ä¸º<code>O(1)</code>äº†ï¼ŒåŒæ—¶è¿˜èŠ‚çœäº†ä¸€ä¸ªåˆ‡ç‰‡çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>æˆ‘ä»¬ç®€å•æ¥åˆ†æä¸‹è¿™ä¸ªä½è¿ç®—ä¸ºä»€ä¹ˆä¼šè¾¾åˆ°åˆ¤æ–­ä¸€ä¸ªæ•°æ®æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­åŒæ ·çš„æ•ˆæœã€‚</p><p>é¦–å…ˆä»¥è¿™ä¸¤ä¸ªçŠ¶æ€ä¸ºä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StatusObjectKey   status = <span class="number">0x0002</span></span><br><span class="line">StatusColon       status = <span class="number">0x0004</span></span><br></pre></td></tr></table></figure><p>ä»–ä»¬åˆ†åˆ«å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ä¸ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StatusObjectKey   status = <span class="number">0x0002</span> <span class="comment">//0010</span></span><br><span class="line">StatusColon       status = <span class="number">0x0004</span> <span class="comment">//0100</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªæ•°æ®æ±‚ <code>|</code> è¿ç®—å¾—åˆ°çš„æ•°æ®æ˜¯ <code>0110</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A:<span class="number">0010</span></span><br><span class="line">B:<span class="number">0100</span></span><br><span class="line"></span><br><span class="line">C:<span class="number">0110</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å¦‚ä½•æˆ‘ä»¬å¦‚æœç”¨è¿™ä¸¤ä¸ªåŸå§‹æ•°æ®ä¸ <code>C:0110</code> åš <code>&amp;</code> è¿ç®—æ—¶å°±ä¼šè¿˜åŸä¸ºåˆšæ‰çš„ä¸¤ä¸ªæ•°æ®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// input:</span></span><br><span class="line">A:<span class="number">0010</span></span><br><span class="line">C:<span class="number">0110</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line">A:<span class="number">0010</span></span><br><span class="line"></span><br><span class="line">----------</span><br><span class="line"><span class="comment">// input:</span></span><br><span class="line">B:<span class="number">0100</span></span><br><span class="line">C:<span class="number">0110</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line">B:<span class="number">0100</span></span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬æ¢ä¸€ä¸ª D ä¸ C æ±‚ <code>&amp;</code> æ—¶ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D: <span class="number">1000</span> <span class="comment">// 0x0008 å¯¹åº”çš„äºŒè¿›åˆ¶ä¸º 1000</span></span><br><span class="line">C: <span class="number">0110</span></span><br><span class="line">D<span class="string">&#x27;:0000</span></span><br></pre></td></tr></table></figure><p>å°†ä¼šå¾—åˆ°ä¸€ä¸ª 0 å€¼ï¼Œåªè¦å¾—å‡ºçš„æ•°æ®å¤§äº 0 æˆ‘ä»¬å°±èƒ½åˆ¤æ–­ä¸€ä¸ªæ•°æ®æ˜¯å¦åœ¨ç»™å®šçš„é›†åˆä¸­äº†ã€‚</p><blockquote><p>å½“ç„¶è¿™é‡Œæœ‰ä¸€ä¸ªå‰ææ¡ä»¶å°±æ˜¯ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ•°æ®é«˜ä½æ°¸è¿œéƒ½æ˜¯æ˜¯ 1 æ‰è¡Œï¼Œä¹Ÿå°±æ˜¯2çš„å¹‚ã€‚</p></blockquote><p>åŒæ ·çš„ä¼˜åŒ–åœ¨è§£ææŸ¥è¯¢è¯­æ³•æ—¶ä¹Ÿæœ‰ä½¿ç”¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4q45v8q2dj22va0msaf2.jpg"></p><h1 id="å…¶ä»–å¥‡æ·«å·§æŠ€"><a href="#å…¶ä»–å¥‡æ·«å·§æŠ€" class="headerlink" title="å…¶ä»–å¥‡æ·«å·§æŠ€"></a>å…¶ä»–å¥‡æ·«å·§æŠ€</h1><p>å½“ç„¶ä½è¿ç®—è¿˜æœ‰ä¸€äº›å…¶ä»–æŠ€å·§ï¼Œæ¯”å¦‚åˆ¤æ–­å¥‡å¶æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¶æ•°</span></span><br><span class="line">a &amp; <span class="number">1</span> == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¥‡æ•°</span></span><br><span class="line">a &amp; <span class="number">1</span> == <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¹˜æ³•å’Œé™¤æ³•ï¼Œå³ç§»1ä¸€ä½æ˜¯é™¤ä»¥2ï¼Œå·¦ç§»ä¸€ä½æ˜¯ä¹˜ä»¥2.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x := <span class="number">2</span></span><br><span class="line">fmt.Println(x&gt;&gt;<span class="number">1</span>) <span class="comment">//1</span></span><br><span class="line">fmt.Println(x&lt;&lt;<span class="number">1</span>) <span class="comment">//4</span></span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä½è¿ç®—åœ¨å¸¦æ¥ç¨‹åºæ€§èƒ½æå‡çš„åŒæ—¶ä¹Ÿé™ä½ä»£ç å¯è¯»æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æŒ‰éœ€é€‰æ‹©æ˜¯å¦ä½¿ç”¨ï¼›</p><p>å†ä¸€äº›åº•å±‚åº“ã€æ¡†æ¶ä»£ç å¯¹æ€§èƒ½æœ‰æè‡´è¿½æ±‚çš„åœºæ™¯æ¨èä½¿ç”¨ï¼Œä½†åœ¨ä¸šåŠ¡ä»£ç ä¸­å¯¹æ•°æ®åšåŠ å‡ä¹˜é™¤å°±æ²¡å¿…è¦ç”¨ä½è¿ç®—äº†ï¼Œåªä¼šè®©åç»­çš„ç»´æŠ¤è€…ä¸€è„¸æ‡µé€¼ã€‚</p><p>ç›¸å…³ä»£ç ï¼š<a href="https://github.com/crossoverJie/xjson">https://github.com/crossoverJie/xjson</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h4p37zeb9aj20xc0go0tv.jpg&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨æŒç»­ä¼˜åŒ–ä¹‹å‰ç¼–å†™çš„ &lt;code&gt;JSON&lt;/code&gt; è§£æåº“ &lt;a href=&quot;https://github.com/crossoverJie/xjson&quot;&gt;xjson&lt;/a&gt;ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªæ–¹é¢çš„ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªæ˜¯æ”¯æŒå°†ä¸€ä¸ª &lt;code&gt;JSONObject&lt;/code&gt; å¯¹è±¡è¾“å‡ºä¸º &lt;code&gt;JSON&lt;/code&gt; å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç‚¹åœ¨ä¸Šä¸ªç‰ˆæœ¬ä¸­åªæ˜¯åˆ©ç”¨è‡ªå¸¦çš„ &lt;code&gt;Print&lt;/code&gt; å‡½æ•°æ‰“å°æ•°æ®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TestJson4&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(t *testing.T)&lt;/span&gt;&lt;/span&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	str := &lt;span class=&quot;string&quot;&gt;`&amp;#123;&amp;quot;people&amp;quot;:&amp;#123;&amp;quot;name&amp;quot;:&amp;#123;&amp;quot;first&amp;quot;:&amp;quot;bob&amp;quot;&amp;#125;&amp;#125;&amp;#125;`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	first := xjson.Get(str, &lt;span class=&quot;string&quot;&gt;&amp;quot;people.name.first&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	assert.Equal(t, first.String(), &lt;span class=&quot;string&quot;&gt;&amp;quot;bob&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	get := xjson.Get(str, &lt;span class=&quot;string&quot;&gt;&amp;quot;people&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fmt.Println(get.String())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;//assert.Equal(t, get.String(),`&amp;#123;&amp;quot;name&amp;quot;:&amp;#123;&amp;quot;first&amp;quot;:&amp;quot;bob&amp;quot;&amp;#125;&amp;#125;`)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Output:&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;map[name:map[first:bob]]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="xjson" scheme="http://crossoverjie.top/categories/xjson/"/>
    
    <category term="compiler" scheme="http://crossoverjie.top/categories/xjson/compiler/"/>
    
    
    <category term="go" scheme="http://crossoverjie.top/tags/go/"/>
    
    <category term="Bitwise operation" scheme="http://crossoverjie.top/tags/Bitwise-operation/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Goland ä¸­çš„éšè—å®çŸ³</title>
    <link href="http://crossoverjie.top/2022/07/28/translation/hidden-gems-goland/"/>
    <id>http://crossoverjie.top/2022/07/28/translation/hidden-gems-goland/</id>
    <published>2022-07-28T00:03:13.000Z</published>
    <updated>2022-07-27T16:49:13.445Z</updated>
    
    <content type="html"><![CDATA[<p><strong><a href="https://blog.jetbrains.com/go/2022/07/21/hidden-gems-in-goland/">åŸæ–‡é“¾æ¥</a></strong></p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h4lrsooqqjj212w0k6t9k.jpg"></p><p>åœ¨æ—¥å¸¸ä½¿ç”¨ <code>Goland</code> æ—¶ï¼Œå›¢é˜Ÿæ”¶é›†äº†ä¸€äº›å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¸“æ³¨äºåˆ›é€ çš„åŒæ—¶å‡å°‘é‡å¤å·¥ä½œçš„å°æŠ€å·§ã€‚<br>å¦‚æœä½ æ˜¯åœ¨ <code>IDEA</code> ä¸­ä½¿ç”¨çš„ <code>Go</code> æ’ä»¶ï¼Œæˆ–è€…å…¶ä»– <code>IntelliJ</code> çš„äº§å“ï¼ŒåŒæ ·ä¹Ÿæœ‰è¿™äº›ç‰¹æ€§ã€‚</p><span id="more"></span><h1 id="è¡Œæ’åº"><a href="#è¡Œæ’åº" class="headerlink" title="è¡Œæ’åº"></a>è¡Œæ’åº</h1><p>å½“ä½ åœ¨æŸ¥çœ‹æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œè¡Œæ’åºéå¸¸æœ‰ç”¨ï¼›æŒ‰ç…§å­—æ¯æ’åºåèƒ½å¤Ÿå¸®æˆ‘ä»¬æ›´å¥½çš„é˜…è¯»ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“æ‰¾åˆ°é‡å¤çš„è¡Œã€‚</p><p>åœ¨èœå•æ ä¸­ä½¿ç”¨ <code>Edit | Sort Lines or Edit | Reverse Lines</code>å¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿçš„å¯¹é€‰ä¸­çš„ä»£ç æˆ–è€…æ˜¯æ•´ä¸ªæ–‡ä»¶è¿›è¡Œæ’åºï¼›æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨å¿«é€Ÿå‘½ä»¤æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</p><p><img src="https://lh4.googleusercontent.com/G6g_eIinHwfZchGFPW9cBWYqYzrLuDTQYFafJZ0U0XlibbgANGVZwfgu7UM7bdN1Kr5tiPxk1ELV5F6sgQILyJKyDiziwUGqBOZxUWugfxNvZ9kw4KQBbl9zv-Z4oj8Uxru3Y12glEkhvWAqXxy0R-Q"></p><h1 id="æ‰“å¼€å¯¹æ¯”çª—å£"><a href="#æ‰“å¼€å¯¹æ¯”çª—å£" class="headerlink" title="æ‰“å¼€å¯¹æ¯”çª—å£"></a>æ‰“å¼€å¯¹æ¯”çª—å£</h1><p>æ‰“å¼€ä¸€ä¸ªå¯¹æ¯”çª—å£å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹æ¯”ä»»ä½•æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€æ–‡æœ¬ï¼›ä¸¾ä¸ªä¾‹å­ï¼Œå°†å¤åˆ¶çš„å†…å®¹ç²˜è´´åˆ°å¯¹æ¯”çª—å£ä¸­ï¼ŒIDE ä¼šç±»ä¼¼äºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé‚£æ ·å±•ç¤ºä¸¤è€…çš„å·®å¼‚ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨å¿«é€ŸæŒ‡ä»¤æ‰“å¼€å¯¹æ¯”çª—å£ï¼ˆdouble shift)ã€‚</p><p><img src="https://lh4.googleusercontent.com/2GtGBX33TZw7WEyVgSYwYcRozVp4AYp8xNYUp4fXtjWXiwolR5ikJdf-AoROpJw1A2HKyolrLR5HAdYUYWbIgJydX01FBOlUQ54BMHh7KS9Jda1Slc0QQp_N-uGwYsBBKAr-yhtsiVWTNrSB6PpYeIA"></p><p>æ­¤å¤–ä½ ä¹Ÿå¯ä»¥åœ¨ IDE ç¼–è¾‘å™¨çš„ä»»ä½•åœ°æ–¹å³é”®é¼ æ ‡é€‰æ‹©ä¸å½“å‰ç²˜è´´æ¿æ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</p><blockquote><p>è¿™ä¸ªåŠŸèƒ½å¾ˆæ£’ï¼Œå¯ä»¥æ›¿æ¢æ‰ä»¥å‰å¤§éƒ¨åˆ†ç”¨ BeyondCompare çš„åœºæ™¯äº†ã€‚</p></blockquote><h1 id="æš‚å­˜æ–‡ä»¶"><a href="#æš‚å­˜æ–‡ä»¶" class="headerlink" title="æš‚å­˜æ–‡ä»¶"></a>æš‚å­˜æ–‡ä»¶</h1><p>æœ‰æ—¶å€™ä½ éœ€è¦ä¸€ä¸ªéšæ„çš„åœ°æ–¹æ¥ç¼–å†™ä¸€æ®µæ–‡æœ¬ï¼Œä¸å½“å‰å·¥ä½œç›¸å…³çš„ä¸€äº›è®°å½•ï¼Œä¹Ÿæˆ–æ˜¯ä¸å½“å‰é¡¹ç›®ä¸Šä¸‹æ–‡æ— å…³çš„è‰ç¨¿ä»£ç ï¼›è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°æš‚å­˜æ–‡ä»¶äº†ã€‚</p><p>æš‚å­˜æ–‡ä»¶å¯ä¸åªæ˜¯ç®€å•çš„ç¬”è®°ï¼Œå®ƒæ”¯æŒè¯­æ³•é«˜äº®ã€ä»£ç æç¤ºä»¥åŠæ‰€æœ‰å’Œè¿™ä¸ªæ–‡ä»¶ç±»å‹ç›¸å…³çš„ç‰¹æ€§ã€‚</p><p>æš‚å­˜æ–‡ä»¶ä¸å½“å‰é¡¹ç›®æ— å…³ï¼Œä½ å¯ä»¥åœ¨ä»»æ„é¡¹ç›®ä¸­è®¿é—®åˆ°è¿™äº›æ–‡ä»¶ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦ç¦»å¼€ IDE åˆ°å…¶ä»–åœ°æ–¹æ¥ä¿å­˜è¿™äº›æ–‡ä»¶äº†ã€‚</p><p>å¯ä»¥åœ¨èœå•æ ä¸­æ–°å»ºæš‚å­˜æ–‡ä»¶<code>File | New | Scratch File or</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¿«æ·é”® <code>â‡§ âŒ˜ N</code>.</p><p><img src="https://lh4.googleusercontent.com/d-HxnmVYaZOJq8mqJzCMagroGVpg6i7E2VF2j44MhGsqluWKRXENxgZI4sy8pLNaYex6hxSD9Yg0hNM06PgKvKjifGNYYfbA21C4mCiQAN0GctH2SK2fW9DFg1boZ3G2gZyradsaGVH08clG96s1KnY"></p><blockquote><p>é€šå¸¸ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥å­˜æ”¾å’Œè¿è¡Œä¸€äº›æµ‹è¯•æˆ–è€…æ˜¯å®ä¾‹ä»£ç ã€‚</p></blockquote><h1 id="å¤šè¡Œå…‰æ ‡"><a href="#å¤šè¡Œå…‰æ ‡" class="headerlink" title="å¤šè¡Œå…‰æ ‡"></a>å¤šè¡Œå…‰æ ‡</h1><p>å¤šè¡Œå…‰æ ‡å¯ä»¥è®©ä½ å¿«é€Ÿåœ¨å¤šä¸ªåœ°æ–¹åŒæ—¶ä¿®æ”¹ä»£ç ï¼ŒåŒæ—¶å®ƒä¹Ÿæ”¯æŒä»£ç æç¤ºä»¥åŠå®æ—¶æ¨¡æ¿ã€‚</p><p>å¼€å¯å¤šè¡Œå…‰æ ‡å¯ä»¥åŒå‡» <code>âŒ¥/Ctrl</code> åä¸è¦é‡Šæ”¾ï¼Œç„¶åç‚¹å‡»ä¸Šä¸‹ç®­å¤´é”®ã€‚ä½¿ç”¨ <code>Escape</code> é”®å¯ä»¥é€€å‡ºå¤šè¡Œå…‰æ ‡ã€‚</p><p><img src="https://lh3.googleusercontent.com/Zb_1_CiZAP0_6rvAKurH-LsP3OOXqUufkLeeOTWtsCj2EtHAgPZ7sJq3_39oLwwT8bL8gH1eLynMLCQoBI73pUi5STUozXcCOBFry4lGLI-XVEAQYSrQ-opyFv1S_HKt56jYwDAimcFWskDbPpp85nQ"></p><blockquote><p>è¿™ä¸ªåœ¨æ‰¹é‡ä¿®æ”¹ä»£ç æ—¶éå¸¸æœ‰ç”¨ã€‚</p></blockquote><h1 id="æ‰¹é‡æŠ˜å å’Œå±•å¼€"><a href="#æ‰¹é‡æŠ˜å å’Œå±•å¼€" class="headerlink" title="æ‰¹é‡æŠ˜å å’Œå±•å¼€"></a>æ‰¹é‡æŠ˜å å’Œå±•å¼€</h1><p>åœ¨é˜…è¯»å¤æ‚é•¿ç¯‡ä»£ç çš„è¿‡ç¨‹ä¸­æœ‰æ—¶å€™å¾ˆéš¾å¼„æ‡‚ä»£ç ç»“æ„ï¼Œå³ä¾¿æ˜¯ä»£ç æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„ã€‚</p><p>è¿™ä¹Ÿå®¹æ˜“è§£å†³ï¼Œæ‰¹é‡æŠ˜å å’Œå±•å¼€å¯ä»¥å¿«é€Ÿå¸®æˆ‘ä»¬æµè§ˆä»£ç ï¼Œå¿«æ·é”®æ˜¯ï¼šmacOS:<code>â‡§âŒ˜- /â‡§âŒ˜+</code>,Windows&#x2F;Linux: <code>Ctrl+Shift+NumPad + / Ctrl+Shift+NumPad</code>ã€‚</p><p>IDE å¯ä»¥å¸®æˆ‘ä»¬æŠ˜å &#x2F;å±•å¼€é€‰ä¸­çš„ä»£ç ï¼Œå¦‚æœæ²¡æœ‰é€‰ä¸­åˆ™æ˜¯å¤„ç†æ•´ä¸ªæ–‡ä»¶ã€‚</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ macOS:<code> âŒ¥âŒ˜- / âŒ¥âŒ˜+</code>, Windows&#x2F;Linux:<code>Ctrl+Alt+NumPad + / Ctrl+Alt+NumPad</code> æ¥é€’å½’çš„å¤„ç†ä»£ç ï¼ŒIDE å°†ä¼šæŠ˜å &#x2F;å±•å¼€å½“å‰ä»£ç ç‰‡æ®µæˆ–è€…æ˜¯ä»–ä»¬åŒ…å«çš„ç‰‡æ®µã€‚</p><p><img src="https://lh5.googleusercontent.com/cYtEgj2G98zshGwM-1a91f6_kqP1ZjLdWA_yQOCsXOo_0KQC4O9HL1Lphs-vdN71kiD_XjZ_Rh5oDo8zhuh9u7KuSacMFqfv6U1F0kXd8zJT3uF3f0GkZgu1P-OgAPGrG77ByWn5UmcK-uIdZ0Iahqo"></p><h1 id="æœ€è¿‘æ–‡ä»¶"><a href="#æœ€è¿‘æ–‡ä»¶" class="headerlink" title="æœ€è¿‘æ–‡ä»¶"></a>æœ€è¿‘æ–‡ä»¶</h1><p>æœ€è¿‘æ–‡ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿè·³è½¬åˆ°æœ€è¿‘ç»å¸¸æ‰“å¼€çš„æ–‡ä»¶ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ macOS:<code>âŒ˜+E</code> Windows&#x2F;Linux:<code>Ctrl + E</code> æ‰“å¼€æœ€è¿‘æ–‡ä»¶å¯¹è¯æ¡†çš„æ—¶ï¼Œå†ä½¿ç”¨<code>âŒ˜+E</code>å¯ä»¥å†æ¬¡è¿‡æ»¤åªæ˜¾ç¤ºå·²ç»ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥å¸®æˆ‘ä»¬æ›´ç²¾å‡†çš„æŸ¥æ‰¾ã€‚</p><p><img src="https://lh5.googleusercontent.com/dfCbbr1RJYJGM12VmuNf7ebgvi01W3yseLvHLELhaMSyTy_MK2N3VmgXxJqcgJ3NVlYzsX9PV3_qiUA9cy_T8_Z5HGY9FDYyn6AwT9Xk6wTieDHl89hKf0JsCeV3XNZEgPcB9TgjbM8CH4o12RyRhfQ"></p><p>è¿™äº›ç‰¹æ€§å¯èƒ½æœ‰äº›å¹¶ä¸å¸¸ç”¨ï¼Œä¸€æ—¦ç”¨ä¸Šä¸€æ¬¡è§£å†³é—®é¢˜åä¼šå‘ç° <code>IntelliJ</code> çš„ <code>IDE</code> åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¦‚æœä½ è¿˜å‘ç°äº†ä¸€äº›å…¶ä»–æœ‰ç”¨çš„ç‰¹æ€§è¯·åœ¨ç•™è¨€åŒºåˆ†äº«ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://blog.jetbrains.com/go/2022/07/21/hidden-gems-in-goland/&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/e6c9d24ely1h4lrsooqqjj212w0k6t9k.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ—¥å¸¸ä½¿ç”¨ &lt;code&gt;Goland&lt;/code&gt; æ—¶ï¼Œå›¢é˜Ÿæ”¶é›†äº†ä¸€äº›å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¸“æ³¨äºåˆ›é€ çš„åŒæ—¶å‡å°‘é‡å¤å·¥ä½œçš„å°æŠ€å·§ã€‚&lt;br&gt;å¦‚æœä½ æ˜¯åœ¨ &lt;code&gt;IDEA&lt;/code&gt; ä¸­ä½¿ç”¨çš„ &lt;code&gt;Go&lt;/code&gt; æ’ä»¶ï¼Œæˆ–è€…å…¶ä»– &lt;code&gt;IntelliJ&lt;/code&gt; çš„äº§å“ï¼ŒåŒæ ·ä¹Ÿæœ‰è¿™äº›ç‰¹æ€§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¿»è¯‘" scheme="http://crossoverjie.top/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
    <category term="IDE" scheme="http://crossoverjie.top/tags/IDE/"/>
    
  </entry>
  
</feed>
